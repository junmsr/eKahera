import{j as e}from"./utils-L0j39QIW.js";import{a as t,u as n,R as s}from"./vendor-DPJ7iNYg.js";import{S as r}from"./ScannerCard-Jlmgx9qX.js";import{S as o,C as a,D as i,P as c,a as l,b as d,c as u,d as m}from"./ScanCustomerCartModal-Cvqgd6M0.js";import{b as p,a as h,d as x,e as g}from"./index-Bs-5R3qF.js";import{C as f}from"./ChangePasswordModal-BDTO8ALA.js";import{B as y}from"./BaseModal-Cy73DE2S.js";import{c as b,d as v}from"./index-D5t29eUG.js";import{u as w}from"./useKeyboardShortcuts-CivZ88Rl.js";import"./qr-52H9kDsU.js";import"./Card-DXlcOk_J.js";import"./Input-DoNyYXSI.js";import"./PasswordInput-B67VXabr.js";function k({isOpen:n,onClose:s}){const[r,o]=t.useState([]),[a,i]=t.useState(!1),[c,l]=t.useState(""),[d,u]=t.useState(0),m=t.useRef(null),x=t.useRef(null);t.useEffect(()=>{if(!n)return;(async()=>{i(!0),l("");try{const e=sessionStorage.getItem("auth_token"),t=await h("/api/sales/cashier/recent",{headers:{Authorization:`Bearer ${e}`}});o(Array.isArray(t)?t:[])}catch(e){l("Failed to load receipts")}finally{i(!1)}})()},[n]);const g=e=>{const t=new URL(window.location.origin+"/receipt");e.transaction_number&&t.searchParams.set("tn",e.transaction_number),e.transaction_id&&t.searchParams.set("tid",String(e.transaction_id)),window.open(t.toString(),"_blank")};t.useCallback(e=>{r[e]&&g(r[e])},[r]);const f=t.useCallback(e=>{if(n&&r.length)switch(e.preventDefault(),e.key){case"ArrowUp":u(e=>{const t=e<=0?r.length-1:e-1;return setTimeout(()=>{const e=m.current?.querySelectorAll("button");e?.[t]&&e[t].focus({preventScroll:!0})},0),t});break;case"ArrowDown":u(e=>{const t=e>=r.length-1?0:e+1;return setTimeout(()=>{const e=m.current?.querySelectorAll("button");e?.[t]&&e[t].focus({preventScroll:!0})},0),t});break;case"Enter":e.preventDefault(),r[d]&&g(r[d]);break;case"Escape":s()}},[n,r,d,s,g]);return t.useEffect(()=>{n&&(u(0),m.current&&m.current.focus({preventScroll:!0}))},[n,r]),t.useEffect(()=>{if(m.current&&d>=0){const e=m.current,t=e.children[d];if(t){const n=e.getBoundingClientRect(),s=t.getBoundingClientRect();s.top<n.top?e.scrollBy(0,s.top-n.top-10):s.bottom>n.bottom&&e.scrollBy(0,s.bottom-n.bottom+10)}}},[d]),t.useEffect(()=>{if(!n)return;const e=e=>{["ArrowUp","ArrowDown","Enter","Escape"].includes(e.key)&&(e.preventDefault(),f(e))},t=m.current;return t?(t.addEventListener("keydown",e),t.focus({preventScroll:!0}),()=>{t.removeEventListener("keydown",e)}):void 0},[n,f]),e.jsxs(y,{isOpen:n,onClose:s,title:"Recent Receipts",subtitle:"Latest transactions handled by you",size:"lg",contentRef:x,footer:e.jsx(p,{label:"Close (Esc)",variant:"secondary",onClick:s,className:"w-full"}),children:[a&&e.jsx("div",{className:"text-sm text-gray-600 py-4 text-center",children:"Loading receipts..."}),c&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 border border-red-100 rounded-lg px-3 py-2 mb-2",children:c}),!a&&!c&&0===r.length&&e.jsx("div",{className:"text-sm text-gray-500 py-6 text-center",children:"No receipts found."}),e.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto outline-none focus:outline-none",ref:m,tabIndex:"0",role:"listbox","aria-label":"Recent receipts",children:r.map((t,n)=>e.jsxs("button",{onClick:()=>g(t),className:"w-full text-left border rounded-xl px-3 py-2 transition-all duration-200 "+(d===n?"border-blue-500 bg-blue-50 ring-2 ring-blue-200 scale-[1.01] shadow-sm":"border-gray-200 hover:border-blue-300 hover:bg-blue-50"),onFocus:()=>u(n),role:"option","aria-selected":d===n,tabIndex:"-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.transaction_number||"Txn"}),e.jsx("p",{className:"text-xs text-gray-600",children:new Date(t.updated_at||t.created_at).toLocaleString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-blue-700",children:["₱",Number(t.total_amount||t.total||0).toFixed(2)]}),e.jsx("p",{className:"text-[11px] text-gray-600 uppercase",children:t.payment?.method||t.payment_type||"cash"})]})]}),(t.discount_percentage||t.discount_amount)&&e.jsxs("p",{className:"text-[11px] text-emerald-700 mt-1",children:["Discount applied"," ",t.discount_percentage?`${t.discount_percentage}%`:`₱${Number(t.discount_amount||0).toFixed(2)}`]})]},`${t.transaction_id}-${t.transaction_number}`))})]})}const j=({text:t,shortcut:n,variant:s="secondary"})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t}),e.jsx("span",{className:"hidden sm:inline-block text-xs font-bold px-1.5 py-0.5 rounded border "+("primary"===s?"bg-white/20 border-white/40 text-white":"bg-gray-100 border-gray-300 text-gray-600"),children:n})]});function N(){const y=n(),[N,_]=t.useState(""),[S,C]=t.useState(""),[E,L]=t.useState(1),[I,P]=t.useState([]),[q,M]=t.useState(null),[R,A]=t.useState(!1),[D,O]=t.useState(!1),[T,$]=t.useState(!1),[U,B]=t.useState(!1),[z,F]=t.useState(!1),[W,H]=t.useState(null),[V,J]=t.useState(!1),[Q,K]=t.useState(!1),[G,Z]=t.useState(!1),[X,Y]=t.useState(""),[ee,te]=t.useState(!1),[ne,se]=t.useState(""),[re,oe]=t.useState(null);t.useEffect(()=>{if(X){const e=setTimeout(()=>{Y("")},5e3);return()=>clearTimeout(e)}},[X]);const[ae,ie]=t.useState(!1),[ce,le]=t.useState(!1);t.useRef(null);const[de,ue]=t.useState(!1);t.useRef(null),t.useRef(!1);const[me,pe]=t.useState(0),[he,xe]=t.useState(null),[ge,fe]=t.useState("1"),ye=t.useRef(null),be=t.useRef(null),[ve,we]=t.useState(new Date);t.useEffect(()=>{const e=setInterval(()=>we(new Date),1e3);return()=>clearInterval(e)},[]),t.useEffect(()=>{const e=setTimeout(()=>{ye.current?.focus()},300);return()=>clearTimeout(e)},[]);const ke=sessionStorage.getItem("auth_token"),je=JSON.parse(sessionStorage.getItem("user")||"{}"),Ne=s.useRef(!1);t.useEffect(()=>{if(!ne){const e=je?.businessId||je?.business_id||"BIZ",t=(new Date).toISOString().replace(/[-:T.Z]/g,"").slice(0,14),n=Math.floor(1e3+9e3*Math.random());se(`T-${e.toString().padStart(2,"0")}-${t}-${n}`)}},[]),t.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("payment"),t=window.opener&&!window.opener.closed,n=async(n,s)=>{const r=localStorage.getItem(n);if("success"===e&&r)try{const e=JSON.parse(r);(async()=>{if(Ne.current)return;const r=`${s.toLowerCase()}_finalize_done`;if("1"!==sessionStorage.getItem(r)){Ne.current=!0,sessionStorage.setItem(r,"1");try{Y("");const n={items:e.items||[],payment_type:s.toLowerCase(),money_received:e.total||null,transaction_id:e.transactionId||null,transaction_number:e.transactionNumber||null,discount_id:e.discount_id||null,discount_percentage:e.discount_percentage||null,discount_amount:e.discount_amount||null},r=await h("/api/sales/checkout",{method:"POST",headers:{Authorization:`Bearer ${ke}`},body:JSON.stringify(n)});r?.transaction_number&&se(r.transaction_number),r?.transaction_id&&oe(r.transaction_id),P([]);try{const e=new URL(window.location.origin+"/receipt");r?.transaction_number&&e.searchParams.set("tn",r.transaction_number),r?.transaction_id&&e.searchParams.set("tid",String(r.transaction_id)),null!=r?.total&&e.searchParams.set("total",String(r.total)),t&&window.opener?(window.opener.location.href=e.toString(),window.close()):y(e.pathname+e.search)}catch(o){}}catch(a){Y(`Failed to record ${s} payment`)}finally{if(localStorage.removeItem(n),!t){const e=new URL(window.location.href);e.searchParams.delete("payment"),window.history.replaceState({},"",e.toString())}}}})()}catch(o){localStorage.removeItem(n)}else if("cancel"===e&&r)if(localStorage.removeItem(n),t&&window.opener)window.close();else{const e=new URL(window.location.href);e.searchParams.delete("payment"),window.history.replaceState({},"",e.toString())}};n("pending_gcash_cart","GCash"),n("pending_maya_cart","Maya")},[]);const _e=async(e,t=1)=>{if(e&&!(t<1)){Y("");try{const n=je?.businessId||je?.business_id||null,s=n?`/api/products/sku/${encodeURIComponent(e)}?business_id=${n}`:`/api/products/sku/${encodeURIComponent(e)}`,r=await h(s,{headers:{Authorization:`Bearer ${ke}`}}),o=Number(r.selling_price||0),a=Number(r.stock_quantity??0);if(a<=0)return void Y(`Stock for ${r.product_name} (SKU ${r.sku}) is 0.`);if(t>a)return void Y(`Insufficient stock. Available: ${a}, requested: ${t}.`);P(e=>{const n=e.findIndex(e=>e.product_id===r.product_id);if(n>=0){const s=[...e],r=s[n].quantity+t;return r>a?(Y(`Insufficient stock. Available: ${a}, requested: ${r}.`),e):(s[n]={...s[n],quantity:r},s)}return[...e,{product_id:r.product_id,sku:r.sku,name:r.product_name,quantity:t,price:o}]}),_(""),L(1),setTimeout(()=>{ye.current?.focus()},50)}catch(n){Y("Product not found")}finally{setTimeout(()=>{Z(!1)},300)}}},Se=async()=>{await _e(N,E)},Ce=e=>{e>=0&&e<I.length&&P(I.filter((t,n)=>n!==e))},Ee=()=>{if(0===I.length||me<0||me>=I.length)return;const e=I[me];if(!e)return;const t=e.quantity+1;P(e=>e.map((e,n)=>n===me?{...e,quantity:t}:e))},Le=()=>{if(0===I.length||me<0||me>=I.length)return;const e=I[me];if(!e)return;const t=e.quantity;if(t<=1)return;const n=t-1;P(e=>e.map((e,t)=>t===me?{...e,quantity:n}:e))};t.useEffect(()=>{const e=e=>{if(R||D||T||U||z||V||ae||ce||ee)return;const t=e.target&&("INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName||e.target.isContentEditable);if(t&&null===he&&!["ArrowUp","ArrowDown","Enter","Escape"].includes(e.key)&&!["e","E","d","D"].includes(e.key)&&!["=","-"].includes(e.key))return;if("Escape"===e.key&&null!==he)return e.preventDefault(),e.stopPropagation(),void xe(null);if("Enter"===e.key&&null!==he)return e.preventDefault(),e.stopPropagation(),((e,t)=>{const n=""===t?1:Math.max(1,Number(t)||1);P(t=>t.map((t,s)=>s===e?{...t,quantity:n}:t)),fe(n),xe(null)})(he,ge),void xe(null);const n=e.target===ye.current,s="ArrowUp"===e.key||"ArrowDown"===e.key,r="="===e.key||"-"===e.key;if(s&&(n||!t||null!==he))switch(e.key){case"ArrowUp":e.preventDefault(),e.stopPropagation(),pe(e=>e>0?e-1:I.length-1);break;case"ArrowDown":e.preventDefault(),e.stopPropagation(),pe(e=>e<I.length-1?e+1:0)}!r||!n&&t&&null===he||I.length>0&&me>=0&&me<I.length&&("="===e.key?(e.preventDefault(),e.stopPropagation(),Ee()):"-"===e.key&&(e.preventDefault(),e.stopPropagation(),Le()))};return window.addEventListener("keydown",e,!1),()=>{window.removeEventListener("keydown",e,!1)}},[I.length,me,he,ge,R,D,T,U,z,V,ae,ce,ee,Ee,Le]),t.useEffect(()=>{0===I.length?pe(0):pe(e=>Math.min(e,I.length-1))},[I.length]),t.useEffect(()=>{const e=R||D||T||U||z||V||ae||ce||ee;if(Z(e),!e){const e=setTimeout(()=>{const e=document.activeElement;e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.isContentEditable||"BUTTON"===e.tagName)||document.body!==e||ye.current?.focus()},300);return()=>clearTimeout(e)}},[R,D,T,U,z,V,ae,ce,ee]);const Ie=I.reduce((e,t)=>e+t.price*t.quantity,0);let Pe=Ie;if(q)if("percentage"===q.type){const e=Number(q.value);if(!isNaN(e)&&e>0){const t=Ie*(e/100);Pe=Math.max(0,Ie-t)}else console.warn("Invalid discount value:",q.value,"for discount:",q)}else if("amount"===q.type){const e=Number(q.value);!isNaN(e)&&e>0?Pe=Math.max(0,Ie-e):console.warn("Invalid discount value:",q.value,"for discount:",q)}const qe=async(e="cash",t=Pe)=>{if(0!==I.length){Y("");try{const s={transaction_id:re||null,transaction_number:ne||null,items:I.map(e=>({product_id:e.product_id,quantity:e.quantity})),payment_type:e,money_received:t,discount_id:q?.discount_id||null,discount_percentage:"percentage"===q?.type?Number(q.value):null,discount_amount:"amount"===q?.type?Number(q.value):null},r=await h("/api/sales/checkout",{method:"POST",headers:{Authorization:`Bearer ${ke}`},body:JSON.stringify(s)});r?.transaction_number&&se(r.transaction_number),r?.transaction_id&&oe(r.transaction_id),P([]);try{const e=new URL(window.location.origin+"/receipt");r?.transaction_number&&e.searchParams.set("tn",r.transaction_number),r?.transaction_id&&e.searchParams.set("tid",String(r.transaction_id)),null!=r?.total&&e.searchParams.set("total",String(r.total)),y(e.pathname+e.search)}catch(n){}const o=je?.businessId||je?.business_id||"BIZ",a=(new Date).toISOString().replace(/[-:T.Z]/g,"").slice(0,14),i=Math.floor(1e3+9e3*Math.random());se(`T-${o.toString().padStart(2,"0")}-${a}-${i}`),M(null),oe(null)}catch(s){Y("Checkout failed")}}};w([{key:"`",action:()=>{ye.current?.focus(),ye.current?.select?.()}},{key:"f1",action:()=>{I.length>0&&me>=0&&me<I.length&&(xe(me),fe(String(I[me].quantity)))},enabled:I.length>0&&me>=0},{key:"f2",action:()=>{0!==I.length&&null!=me&&Ce(me)},enabled:I.length>0},{key:"f3",description:"Logout",action:()=>te(!0)},{key:"f4",action:Se,enabled:!!N},{key:"f5",action:()=>B(!0)},{key:"f6",action:()=>{A(!R)}},{key:"f7",description:"Price Check",action:()=>{O(!0)}},{key:"f8",description:"Scan Customer Cart",action:()=>$(!0)},{key:"f9",description:"Receipts",action:()=>ie(!0)},{key:"f10",description:"Change Password",action:()=>le(!0)},{key:"f11",action:()=>{q&&M(null)},enabled:!!q},{key:"f12",description:"Checkout",action:()=>F(!0),enabled:I.length>0},{key:"=",action:Ee,enabled:I.length>0&&me>=0&&me<I.length},{key:"-",action:Le,enabled:I.length>0&&me>=0&&me<I.length},{key:"escape",description:"Close Open Modals",action:()=>{z?F(!1):R?A(!1):D?O(!1):T?$(!1):V?J(!1):U?B(!1):ae?ie(!1):ce?le(!1):ee&&te(!1)},allowWhileTyping:!0,stopPropagation:!1}],[I.length,me,N,q,z,R,D,T,V,U,ae,ce,ee]);const Me=()=>{sessionStorage.removeItem("auth_token"),sessionStorage.removeItem("user"),te(!1),y("/")},Re=()=>{te(!1)};t.useEffect(()=>{if(!ee)return;const e=e=>{e.stopPropagation(),"Escape"===e.key||"Esc"===e.key?(e.preventDefault(),Re()):"Enter"===e.key&&(e.preventDefault(),Me())};return document.addEventListener("keydown",e,{capture:!0}),()=>document.removeEventListener("keydown",e,{capture:!0})},[ee]);const Ae=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"hidden md:block text-right mr-2",children:[e.jsx("div",{className:"text-xs text-gray-500 font-medium",children:ve.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})}),e.jsx("div",{className:"text-sm font-bold text-gray-700",children:ve.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})})]}),e.jsxs("button",{onClick:()=>ie(!0),className:"flex items-center gap-2 bg-white/80 backdrop-blur-sm p-1.5 sm:px-3 sm:py-2 rounded-lg border border-gray-200/80 hover:bg-gray-50 transition-colors group relative",title:"View all receipts (F9)",children:[e.jsx("div",{className:"relative",children:e.jsx(b,{className:"w-5 h-5 text-blue-600"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700 hidden sm:inline",children:"Receipts"}),e.jsx("span",{className:"hidden sm:inline-block bg-blue-50 text-blue-700 border border-blue-200 text-xs font-bold px-1.5 py-0.5 rounded",children:"F9"})]}),e.jsxs("button",{onClick:()=>le(!0),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors flex items-center gap-2",title:"Change Password (F10)",children:[e.jsx(v,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"hidden sm:inline-block bg-gray-100 text-gray-600 border border-gray-200 text-xs font-bold px-1.5 py-0.5 rounded",children:"F10"})]}),e.jsxs("button",{onClick:()=>{te(!0)},className:"flex items-center gap-2 p-1.5 sm:px-3 sm:py-2 rounded-lg hover:bg-red-50 transition-colors",title:"Logout (F3)",children:[e.jsx("div",{className:"relative",children:e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h6a2 2 0 012 2v1"})})}),e.jsx("span",{className:"text-sm font-medium text-gray-700 hidden sm:inline",children:"Logout"}),e.jsx("span",{className:"hidden sm:inline-block bg-red-100 text-red-700 border border-red-200 text-[11px] font-bold rounded px-1.5 py-0.5",children:"F3"})]})]});return e.jsx("div",{className:"bg-white min-h-screen",children:e.jsxs("div",{className:"flex-1 flex flex-col min-h-screen",children:[e.jsxs("header",{className:"flex items-center gap-2 px-4 sm:px-6 py-3 bg-white/90 backdrop-blur-md shadow-md border-b border-gray-200/50 h-[64px] min-h-[64px] max-h-[64px] sticky top-0 z-30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl sm:text-2xl font-bold text-gray-900 tracking-tight",children:"POS"}),e.jsxs("span",{className:"text-xs sm:text-sm font-semibold text-blue-700 bg-blue-50 border border-blue-200 px-2 py-1 rounded-lg",children:["Cashier ID: ",je?.userId||je?.user_id||je?.id||"N/A"]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-2",children:e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(je.store_name)},title:"Copy store name",className:"inline-flex items-center gap-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg px-2.5 py-1.5 shadow-sm hover:bg-blue-100 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2M8 16h8a2 2 0 002-2v-6m-10 8l-2 2m2-2l2 2"})}),e.jsx("span",{className:"font-mono text-xs sm:text-sm md:text-base font-bold tracking-wider truncate max-w-[50vw]",children:je.store_name})]})}),e.jsx("div",{className:"ml-auto",children:Ae})]}),e.jsx("main",{className:"flex-1 bg-gradient-to-br from-gray-50/50 via-blue-50/30 to-indigo-50/50 overflow-y-auto p-2 sm:p-3 md:p-4 pb-55 lg:pb-4",children:e.jsxs("div",{className:"grid gap-2 sm:gap-3 md:gap-4 h-full grid-cols-1 lg:grid-cols-12",children:[e.jsxs("div",{className:"lg:col-span-4 flex flex-col gap-2 sm:gap-3 md:gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(r,{onScan:async e=>{const t=e?.[0]?.rawValue;if(t)if(Z(!0),D)C(t);else try{let e;try{e=JSON.parse(t)}catch(n){e=null}if(e&&"cart"===e.t&&Array.isArray(e.items)){e.transaction_id&&oe(e.transaction_id),e.transaction_number&&se(e.transaction_number);const t=e.items.map(e=>({product_id:e.p,quantity:e.q,sku:e.sku||""}));try{const e=await Promise.all(t.map(async e=>{const t=await h(`/api/products/${e.product_id}`,{headers:{Authorization:`Bearer ${ke}`}});return{product_id:e.product_id,sku:t.sku||e.sku||"",name:t.product_name||"",price:Number(t.selling_price)||0,quantity:e.quantity}}));return void P(t=>{const n=new Map(t.map(e=>[e.product_id,e]));for(const s of e){const e=n.get(s.product_id);e?e.quantity+=s.quantity:n.set(s.product_id,{...s})}return Array.from(n.values())})}catch(s){return console.error("Error fetching product details for scanned cart:",s),void P(e=>{const n=new Map(e.map(e=>[e.product_id,e]));for(const s of t){const e=n.get(s.product_id);e?e.quantity+=s.quantity:n.set(s.product_id,{...s,name:"",price:0})}return Array.from(n.values())})}}await _e(t,1)}catch(s){console.error("Error processing scanned code:",s),await _e(t,1)}},paused:G,onResume:()=>Z(!1),textMain:"text-blue-700"})}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx(o,{ref:ye,sku:N,setSku:_,quantity:E,setQuantity:L,handleAddToCart:Se,quantityInputRef:be}),X&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-3 flex items-start gap-2 mt-3 relative animate-in slide-in-from-top-2 duration-300",children:[e.jsx("svg",{className:"w-4 h-4 text-red-500 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("p",{className:"text-sm font-medium text-red-700 flex-1",children:(()=>{try{const e=JSON.parse(X);return e.error||e.message||X}catch{return X}})()}),e.jsx("button",{onClick:()=>Y(""),className:"text-red-400 hover:text-red-600 transition-colors flex-shrink-0 ml-2","aria-label":"Dismiss error",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})]}),e.jsxs("div",{className:"lg:col-span-8 flex flex-col gap-2 sm:gap-3 min-h-0",children:[e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx(a,{cart:I,handleRemove:Ce,handleEditQuantity:(e,t)=>{const n=[...I];n[e].quantity=t,P(n),xe(null)},total:Pe,appliedDiscount:q,selectedIdx:me,onSelectRow:e=>{pe(e),e>=0&&e<I.length&&fe(String(I[e].quantity))},editingIdx:he,editQty:ge,onEditQtyChange:e=>{fe(e)},onEditComplete:()=>xe(null),onStartEdit:e=>xe(e),className:"flex-1 h-full"})}),e.jsxs("div",{className:"grid grid-cols-12 gap-2 sm:gap-3 flex-shrink-0",children:[q&&e.jsxs("div",{className:"col-span-12 flex items-center justify-between bg-emerald-50 border border-emerald-200 text-emerald-800 rounded-lg px-3 py-2",children:[e.jsxs("span",{className:"text-sm font-semibold",children:["Discount applied: ",q.label]}),e.jsxs("button",{className:"text-xs font-bold underline flex items-center gap-1",onClick:()=>M(null),children:[e.jsx("span",{className:"text-yellow-600",children:"(F11)"})," Remove"]})]}),e.jsx("div",{className:"col-span-8",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3",children:[e.jsx(p,{label:e.jsx(j,{text:"CASH LEDGER",shortcut:"F5"}),size:"md",className:"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold",variant:"secondary",microinteraction:!0,onClick:()=>B(!0),icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),iconPosition:"left"}),e.jsxs("div",{className:"relative group w-full",children:[e.jsx(p,{label:q?e.jsx(j,{text:"REMOVE DISCOUNT",shortcut:"F11",variant:"secondary"}):e.jsx(j,{text:"DISCOUNT",shortcut:"F6"}),size:"md",className:"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold",onClick:()=>{q?window.confirm(`Remove ${q.label||"discount"}?`)&&M(null):A(!0)},variant:"secondary",microinteraction:!0,icon:q?e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),iconPosition:"left"}),q&&e.jsxs("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:["Click to remove discount",e.jsx("div",{className:"absolute bottom-0 left-1/2 w-2 h-2 bg-gray-800 transform -translate-x-1/2 translate-y-1/2 rotate-45"})]})]}),e.jsx(p,{label:e.jsx(j,{text:"PRICE CHECK",shortcut:"F7"}),size:"md",className:"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold",onClick:()=>O(!0),variant:"secondary",microinteraction:!0,icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),iconPosition:"left"}),e.jsx(p,{label:e.jsx(j,{text:"SCAN CUSTOMER QR",shortcut:"F8"}),size:"md",className:"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold",onClick:()=>$(!0),variant:"secondary",microinteraction:!0,icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),iconPosition:"left"})]})}),e.jsx("div",{className:"col-span-4",children:e.jsx(p,{label:e.jsx(j,{text:"CHECKOUT",shortcut:"F12",variant:"primary"}),size:"md",className:"w-full h-full text-sm sm:text-base font-bold",variant:"primary",microinteraction:!0,onClick:()=>F(!0),disabled:0===I.length,icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),iconPosition:"left"})})]})]})]})}),ee&&e.jsxs("div",{className:"fixed inset-0 z-90 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 z-90",onClick:Re}),e.jsxs("div",{className:"relative bg-white rounded-xl shadow-xl w-[92%] max-w-md z-100 p-0",onKeyDown:e=>{e.stopPropagation(),"Enter"!==e.key||e.isPropagationStopped()||(e.preventDefault(),Me())},children:[e.jsx("div",{className:"bg-gradient-to-r from-red-50 via-red-50/80 to-orange-50/50 border-b border-red-100 px-6 py-5 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"white",viewBox:"0 0 24 24",children:e.jsx("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"Confirm Logout"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Are you sure you want to log out? ",e.jsx("span",{className:"text-xs opacity-70",children:"(Press Esc to cancel, Enter to confirm)"})]})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-6",children:"You will be redirected to the login page and your session will end."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:Re,className:"px-5 py-2.5 rounded-lg text-sm font-semibold text-gray-700 bg-white border-2 border-gray-300 hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",autoFocus:!0,children:"Cancel (Esc)"}),e.jsxs("button",{onClick:Me,className:"px-5 py-2.5 rounded-lg text-sm font-semibold text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 shadow-md hover:shadow-lg transition-all duration-200 flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Logout (Enter)"]})]})]})]})]}),e.jsx(i,{isOpen:R,onClose:()=>A(!1),onApplyDiscount:e=>{M(e),A(!1)}}),e.jsx(c,{isOpen:D,onClose:()=>O(!1),sku:S,setSku:C}),e.jsx(l,{isOpen:U,onClose:()=>B(!1)}),e.jsx(d,{isOpen:z,onClose:()=>F(!1),total:Pe,onSelectPayment:e=>{H(e),F(!1),"cash"===e?J(!0):"gcash"===e?(async()=>{try{const e=window.location.origin+"/pos?payment=success",t=window.location.origin+"/pos?payment=cancel";localStorage.setItem("pending_gcash_cart",JSON.stringify({items:I.map(e=>({product_id:e.product_id,quantity:e.quantity})),total:Pe,transactionId:re,transactionNumber:ne,discount_id:q?.discount_id||null,discount_percentage:"percentage"===q?.type?Number(q.value):null,discount_amount:"amount"===q?.type?Number(q.value):null}));const{checkoutUrl:n}=await x({amount:Number(Pe||0),description:"POS Order",referenceNumber:ne||`POS-${Date.now()}`,cancelUrl:t,successUrl:e});window.open(n,"_blank")}catch(e){Y("Failed to init GCash"),localStorage.removeItem("pending_gcash_cart")}})():"maya"===e?(async()=>{try{const e=window.location.origin+"/pos?payment=success",t=window.location.origin+"/pos?payment=cancel";localStorage.setItem("pending_maya_cart",JSON.stringify({items:I.map(e=>({product_id:e.product_id,quantity:e.quantity})),total:Pe,transactionId:re,transactionNumber:ne,discount_id:q?.discount_id||null,discount_percentage:"percentage"===q?.type?Number(q.value):null,discount_amount:"amount"===q?.type?Number(q.value):null}));const{checkoutUrl:n}=await g({amount:Number(Pe||0),description:"POS Order",referenceNumber:ne||`POS-${Date.now()}`,cancelUrl:t,successUrl:e});window.open(n,"_blank")}catch(e){Y("Failed to init Maya"),localStorage.removeItem("pending_maya_cart")}})():qe(e)}}),e.jsx(u,{isOpen:V,onClose:()=>J(!1),total:Pe,onConfirm:e=>{qe("cash",e),J(!1)}}),e.jsx(m,{isOpen:T,onClose:()=>$(!1),onImport:async(e,t,n)=>{try{if(n&&t)return P([]),oe(null),se(null),Y(""),$(!1),void(window.location.href=`/receipt?tn=${n.transaction_number||t}`);if(!e||0===e.length)return void Y("No items found in QR code");console.log("Scanned items:",e);const s=await Promise.all(e.map(async e=>{const t=await h(`/api/products/${e.product_id}`,{headers:{Authorization:`Bearer ${ke}`}});return console.log("Fetched product for id",e.product_id,":",t),{product_id:e.product_id,sku:t.sku||e.sku||"",name:t.product_name||"",price:Number(t.selling_price)||0,quantity:e.quantity}}));P(e=>{const t=new Map(e.map(e=>[e.sku,e]));for(const n of s){const e=t.get(n.sku);e?e.quantity+=n.quantity:t.set(n.sku,{...n})}return Array.from(t.values())})}catch(s){console.error("Error fetching products for scanned items:",s),P(t=>{const n=new Map(t.map(e=>[e.sku,e]));for(const s of e){const e=n.get(s.sku);e?e.quantity+=s.quantity:n.set(s.sku,{...s})}return Array.from(n.values())})}}}),e.jsx(k,{isOpen:ae,onClose:()=>ie(!1)}),e.jsx(f,{isOpen:ce,onClose:()=>le(!1)})]})})}export{N as default};
//# sourceMappingURL=CashierPOS-DMQ1nOVg.js.map
