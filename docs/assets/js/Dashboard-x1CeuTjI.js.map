{"version":3,"file":"Dashboard-x1CeuTjI.js","sources":["../../../frontend/src/pages/Dashboard.jsx"],"sourcesContent":["// Dashboard.jsx — Part 1/3 (start)\r\nimport React, { useState, useEffect, useMemo, useRef } from \"react\";\r\nimport { api, authHeaders } from \"../lib/api\";\r\nimport dayjs from \"dayjs\"; \r\nimport minMax from \"dayjs/plugin/minMax\";\r\nimport html2canvas from \"html2canvas\";\r\nimport jsPDF from \"jspdf\"; \r\n\r\nimport {\r\n  LineChart,\r\n  Line,\r\n  XAxis,\r\n  YAxis,\r\n  CartesianGrid,\r\n  Tooltip,\r\n  BarChart,\r\n  Bar,\r\n  ResponsiveContainer,\r\n  Legend,\r\n} from \"recharts\";\r\n\r\nimport { useAuth } from \"../hooks/useAuth\";\r\n\r\n// Components\r\nimport PageLayout from \"../components/layout/PageLayout\";\r\nimport NavAdmin from \"../components/layout/Nav-Admin\";\r\nimport ChartCard from \"../components/ui/Dashboard/ChartCard\";\r\nimport DashboardStatsCard from \"../components/ui/Dashboard/DashboardStatsCard\";\r\nimport DashboardBusinessReport from \"../components/ui/Dashboard/DashboardBusinessReport\";\r\nimport Button from \"../components/common/Button\";\r\nimport { BiBell, BiRefresh, BiCalendarAlt } from \"react-icons/bi\";\r\nimport NotificationDropdown from \"../components/common/NotificationDropdown\";\r\nimport DateRangeFilterModal from \"../components/modals/DateRangeFilterModal\";\r\n\r\n// Extend the minMax plugin globally for this file\r\ndayjs.extend(minMax);\r\n\r\n// Constants\r\nconst BLUE_COLORS = [\"#2563eb\", \"#60a5fa\", \"#93c5fd\", \"#dbeafe\"]; // Blue shades\r\nconst SOFT_BLUE = \"#3b82f6\"; // Tailwind blue-500/600 for lines/accents\r\nconst SOFT_GREEN = \"#10b981\"; // Retain green for profit\r\nconst SOFT_PURPLE = \"#8b5cf6\"; // Retain purple/accent for pie chart variation\r\nconst TODAY_START = dayjs().startOf(\"day\");\r\nconst TODAY_END = dayjs().endOf(\"day\");\r\n\r\nfunction VisitorsChart({ data, className = \"\", rangeType = \"Custom\" }) {\r\n  const getChartTitle = (rangeType) => {\r\n    switch (rangeType) {\r\n      case \"Day\":\r\n        return \"Customer's Transactions for Today\";\r\n      case \"Week\":\r\n        return \"Customer's Transactions for 7 days\";\r\n      case \"Month\":\r\n        return \"Customer's Transactions for Month\";\r\n      case \"Custom\":\r\n      default:\r\n        return \"Customer's Transactions for the selected range\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <ChartCard\r\n      title={<span className=\"text-blue-700\">{getChartTitle(rangeType)}</span>}\r\n      className={`bg-white/80 backdrop-blur-md border border-white/60 shadow-xl ${className}`}\r\n    >\r\n      <div className=\"h-72 w-full\">\r\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n          <LineChart\r\n            data={data}\r\n            margin={{ top: 20, right: 20, left: 0, bottom: 5 }}\r\n          >\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\r\n            <XAxis dataKey=\"name\" tick={{ fill: \"#374151\", fontSize: 10 }} />\r\n            <YAxis tick={{ fill: \"#374151\", fontSize: 10 }} />\r\n            <Tooltip\r\n              contentStyle={{\r\n                background: \"#fff\",\r\n                borderColor: \"#e5e7eb\",\r\n                borderRadius: 8,\r\n              }}\r\n            />\r\n            <Line\r\n              type=\"monotone\"\r\n              dataKey=\"value\"\r\n              stroke={SOFT_BLUE}\r\n              strokeWidth={3}\r\n              dot={{ r: 5, fill: SOFT_BLUE }}\r\n              isAnimationActive={false}\r\n            />\r\n          </LineChart>\r\n        </ResponsiveContainer>\r\n      </div>\r\n    </ChartCard>\r\n  );\r\n}\r\n\r\nfunction SalesPieChart({ data, className = \"\" }) {\r\n  return (\r\n    <ChartCard\r\n      title={<span className=\"text-blue-700\">Sales by Product Category</span>}\r\n      className={`bg-white/80 backdrop-blur-md border border-white/60 shadow-xl ${className}`}\r\n    >\r\n      <div className=\"h-72 w-full\">\r\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n          <BarChart\r\n            data={data}\r\n            margin={{ top: 20, right: 20, left: 0, bottom: 5 }}\r\n          >\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\r\n            <XAxis\r\n              dataKey=\"name\"\r\n              tick={{ fill: \"#374151\", fontSize: 12 }}\r\n              interval={0}\r\n              angle={-20}\r\n              textAnchor=\"end\"\r\n              height={60}\r\n            />\r\n            <YAxis tick={{ fill: \"#374151\", fontSize: 12 }} />\r\n            <Tooltip\r\n              formatter={(value, name, props) => [\r\n                Number(value).toLocaleString(),\r\n                props?.payload?.name,\r\n              ]}\r\n              contentStyle={{\r\n                background: \"#fafafa\",\r\n                borderColor: SOFT_PURPLE,\r\n                borderRadius: 8,\r\n              }}\r\n            />\r\n            <Legend />\r\n            <Bar dataKey=\"value\" fill={SOFT_BLUE} radius={[8, 8, 0, 0]} isAnimationActive={false} />\r\n          </BarChart>\r\n        </ResponsiveContainer>\r\n      </div>\r\n    </ChartCard>\r\n  );\r\n}\r\n\r\n// Main Dashboard Component\r\nexport default function Dashboard() {\r\n  const [keyMetrics, setKeyMetrics] = useState({\r\n    revenue: 0,\r\n    expenses: 0,\r\n    netProfit: 0,\r\n    grossMargin: 0,\r\n    totalTransactions: 0,\r\n    totalItemsSold: 0,\r\n    averageTransactionValue: 0,\r\n  });\r\n\r\n  // State\r\n  const [stats, setStats] = useState([]);\r\n  const [dateRange, setDateRange] = useState({\r\n    startDate: dayjs().startOf(\"month\"),\r\n    endDate: dayjs().endOf(\"day\"),\r\n    rangeType: \"Month\",\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n  const [chartData, setChartData] = useState([]);\r\n  const [pieData, setPieData] = useState([]);\r\n  const [lowStockProducts, setLowStockProducts] = useState([]);\r\n  const [showFilterModal, setShowFilterModal] = useState(false);\r\n  const [notifications, setNotifications] = useState([]);\r\n  const [unreadCount, setUnreadCount] = useState(0);\r\n  const [showNotifications, setShowNotifications] = useState(false);\r\n  const notificationRef = React.useRef(null);\r\n  const { logout } = useAuth();\r\n  const [isSidebarOpen, setSidebarOpen] = useState(false);\r\n  const [todayHighlight, setTodayHighlight] = useState({\r\n    sales: 0,\r\n    transactions: 0,\r\n    topProduct: \"-\",\r\n    totalItemsSold: 0,\r\n    averageTransactionValue: 0,\r\n  });\r\n  const [exportingPDF, setExportingPDF] = useState(false);\r\n  const [exportingSales, setExportingSales] = useState(false);\r\n  const [currentTime, setCurrentTime] = useState(dayjs());\r\n\r\n  // Refs for PDF export\r\n  const dashboardRef = useRef(null);\r\n  const visitorsChartRef = useRef(null);\r\n  const pieChartRef = useRef(null);\r\n  const keyMetricsRef = useRef(null);\r\n  const businessReportRef = useRef(null);\r\n\r\n  // Optimized timer: only update when page is visible and reduce frequency to every 10 seconds\r\n  useEffect(() => {\r\n    let timer;\r\n    const updateTime = () => {\r\n      if (document.visibilityState === 'visible') {\r\n        setCurrentTime(dayjs());\r\n      }\r\n    };\r\n    \r\n    // Update immediately\r\n    updateTime();\r\n    \r\n    // Update every 10 seconds (instead of every second) and only when visible\r\n    timer = setInterval(updateTime, 10000);\r\n    \r\n    // Also update when page becomes visible\r\n    const handleVisibilityChange = () => {\r\n      if (document.visibilityState === 'visible') {\r\n        updateTime();\r\n      }\r\n    };\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    \r\n    return () => {\r\n      clearInterval(timer);\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n    };\r\n  }, []);\r\n\r\n  // Helper function to detect modern CSS color functions\r\n  const hasModernColor = (val = \"\") => {\r\n    if (!val) return false;\r\n    const lower = val.toLowerCase();\r\n    return (\r\n      lower.includes(\"oklab\") ||\r\n      lower.includes(\"oklch\") ||\r\n      lower.includes(\"color(\") ||\r\n      lower.includes(\"color-mix\") ||\r\n      lower.includes(\"lab(\") ||\r\n      lower.includes(\"lch(\") ||\r\n      lower.includes(\"hwb(\")\r\n    );\r\n  };\r\n\r\n  // Normalize any CSS color string to a safe RGB/HEX; returns fallback when unsupported\r\n  const normalizeToRGB = (() => {\r\n    const canvas = document.createElement(\"canvas\");\r\n    const ctx = canvas.getContext(\"2d\");\r\n    return (value, fallback = \"#ffffff\") => {\r\n      if (!value) return fallback;\r\n      try {\r\n        ctx.fillStyle = value;\r\n        return ctx.fillStyle || fallback;\r\n      } catch (_) {\r\n        return fallback;\r\n      }\r\n    };\r\n  })();\r\n\r\n  // Fetch Today's data (independent of the main filter)\r\n  useEffect(() => {\r\n    const fetchTodayData = async () => {\r\n      try {\r\n        const token = sessionStorage.getItem(\"auth_token\");\r\n        const todayStr = dayjs().format(\"YYYY-MM-DD\");\r\n\r\n        const overview = await api(\"/api/dashboard/overview\", {\r\n          headers: authHeaders(token),\r\n          params: { startDate: todayStr, endDate: todayStr },\r\n        });\r\n\r\n        if (overview) {\r\n          setTodayHighlight({\r\n            sales: overview.totalSales || 0,\r\n            transactions: overview.totalTransactions || 0,\r\n            totalItemsSold: overview.totalItemsSold || 0,\r\n            averageTransactionValue: overview.averageTransactionValue || 0,\r\n            topProduct: overview.topProducts?.[0]?.product_name || \"-\",\r\n          });\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Failed to fetch today's data\", err);\r\n      }\r\n    };\r\n    fetchTodayData();\r\n  }, []);\r\n// Dashboard.jsx — Part 2/3 (middle)\r\n  const user = useMemo(() => {\r\n    try {\r\n      return JSON.parse(sessionStorage.getItem(\"user\") || \"{}\");\r\n    } catch (e) {\r\n      return {};\r\n    }\r\n  }, []);\r\n\r\n  // Close notification dropdown on outside click\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (\r\n        notificationRef.current &&\r\n        !notificationRef.current.contains(event.target)\r\n      ) {\r\n        setShowNotifications(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  // Data fetching\r\n  const fetchData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n\r\n      const { startDate, endDate, rangeType } = dateRange;\r\n\r\n      const formatDate = (date) => dayjs(date).format(\"YYYY-MM-DD\");\r\n\r\n      const finalStart = dayjs.min(startDate, endDate);\r\n      const finalEnd = dayjs.max(startDate, endDate);\r\n\r\n      const startDateStr = formatDate(finalStart);\r\n      const endDateStr = formatDate(finalEnd);\r\n\r\n      console.log(\"Fetching data for date range:\", {\r\n        rangeType,\r\n        formattedStart: startDateStr,\r\n        formattedEnd: endDateStr,\r\n      });\r\n\r\n      const [overview, timeseries, pie, oldLowStock] = await Promise.all([\r\n        api(\"/api/dashboard/overview\", {\r\n          headers: authHeaders(token),\r\n          params: {\r\n            startDate: startDateStr,\r\n            endDate: endDateStr,\r\n          },\r\n        }),\r\n        api(`/api/stats/customers-timeseries`, {\r\n          headers: authHeaders(token),\r\n          params: {\r\n            startDate: startDateStr,\r\n            endDate: endDateStr,\r\n          },\r\n        }),\r\n        api(\"/api/stats/sales-by-category\", {\r\n          headers: authHeaders(token),\r\n          params: {\r\n            startDate: startDateStr,\r\n            endDate: endDateStr,\r\n          },\r\n        }),\r\n        api(\"/api/products/low-stock\", { headers: authHeaders(token) }),\r\n      ]);\r\n\r\n      const derived = (timeseries || []).map((d) => ({\r\n        ...d,\r\n        name: d.date || d.name,\r\n        value: Number(d.customers || d.total || d.value || 0),\r\n      }));\r\n\r\n      const pieTotal =\r\n        (pie || []).reduce((s, p) => s + Number(p.value || 0), 0) || 1;\r\n      const piePercent = (pie || []).map((p) => ({\r\n        ...p,\r\n        percent: (Number(p.value || 0) / pieTotal) * 100,\r\n      }));\r\n\r\n      if (overview) {\r\n        const revenue = Number(overview.totalSales || 0);\r\n        const expenses = Number(overview.totalExpenses || 0);\r\n        const netProfit = revenue - expenses;\r\n        const grossMargin =\r\n          revenue > 0 ? ((revenue - expenses) / revenue) * 100 : 0;\r\n        const totalTransactions = Number(overview.totalTransactions || 0);\r\n        const totalItemsSold = Number(overview.totalItemsSold || 0);\r\n        const avgTxValue = Number(\r\n          overview.averageTransactionValue || revenue / (totalTransactions || 1)\r\n        );\r\n        const topProduct = overview.topProducts?.[0]?.product_name || \"-\";\r\n\r\n        setKeyMetrics({\r\n          revenue,\r\n          expenses,\r\n          netProfit,\r\n          grossMargin,\r\n          totalTransactions,\r\n          totalItemsSold,\r\n          averageTransactionValue: avgTxValue,\r\n        });\r\n\r\n        const dateRangeText =\r\n          rangeType === \"Day\"\r\n            ? finalStart.format(\"MMM D, YYYY\")\r\n            : `${finalStart.format(\"MMM D\")} - ${finalEnd.format(\r\n                \"MMM D, YYYY\"\r\n              )}`;\r\n\r\n        const salesLabel =\r\n          rangeType === \"Day\"\r\n            ? \"Daily Sales\"\r\n            : rangeType === \"Week\"\r\n            ? \"7-Day Sales\"\r\n            : rangeType === \"Month\"\r\n            ? \"Monthly Sales\"\r\n            : \"Total Sales\";\r\n        const transactionsLabel =\r\n          rangeType === \"Day\"\r\n            ? \"Daily Transactions\"\r\n            : rangeType === \"Week\"\r\n            ? \"7-Day Transactions\"\r\n            : rangeType === \"Month\"\r\n            ? \"Monthly Transactions\"\r\n            : \"Total Transactions\";\r\n\r\n        setStats([\r\n          {\r\n            label: salesLabel,\r\n            value: `₱${revenue.toLocaleString(undefined, {\r\n              minimumFractionDigits: 2,\r\n              maximumFractionDigits: 2,\r\n            })}`,\r\n            subtext: dateRangeText,\r\n          },\r\n          {\r\n            label: transactionsLabel,\r\n            value: totalTransactions,\r\n            subtext: `${dateRangeText}`,\r\n          },\r\n          {\r\n            label: \"Top Product\",\r\n            value: topProduct,\r\n            subtext: `Total: ${\r\n              overview.topProducts?.[0]?.total_sold || 0\r\n            } sold`,\r\n          },\r\n          {\r\n            label: \"Items Sold\",\r\n            value: totalItemsSold,\r\n            subtext: `${totalTransactions} transactions`,\r\n          },\r\n        ]);\r\n      }\r\n\r\n      setChartData(derived);\r\n      setPieData(piePercent);\r\n\r\n      const lowStock = oldLowStock || [];\r\n      setLowStockProducts(lowStock);\r\n    } catch (err) {\r\n      console.error(\"Failed to fetch dashboard data\", err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchNotifications = async () => {\r\n    try {\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n      const resp = await api(\"/api/logs\", { headers: authHeaders(token) });\r\n      const readIds = new Set(\r\n        JSON.parse(sessionStorage.getItem(\"read_notif_ids\") || \"[]\")\r\n      );\r\n      const deletedIds = new Set(\r\n        JSON.parse(sessionStorage.getItem(\"deleted_notif_ids\") || \"[]\")\r\n      );\r\n      const mapped = (resp || [])\r\n        .filter((log) => !deletedIds.has(log.log_id))\r\n        .map((log) => ({\r\n          id: log.log_id,\r\n          title: log.action,\r\n          message: `${log.username} (${log.role}) did an action: ${log.action}`,\r\n          time: dayjs(log.date_time).format(\"MMM D, h:mm A\"),\r\n          isRead: readIds.has(log.log_id),\r\n        }));\r\n      setNotifications(mapped);\r\n      setUnreadCount(mapped.filter((n) => !n.isRead).length);\r\n    } catch (e) {\r\n      console.error(\"Failed to fetch notifications\", e);\r\n    }\r\n  };\r\n\r\n  const handleMarkAsRead = (id) => {\r\n    const readIds = JSON.parse(\r\n      sessionStorage.getItem(\"read_notif_ids\") || \"[]\"\r\n    );\r\n    if (!readIds.includes(id)) {\r\n      sessionStorage.setItem(\r\n        \"read_notif_ids\",\r\n        JSON.stringify([...readIds, id])\r\n      );\r\n    }\r\n    setNotifications((notifs) =>\r\n      notifs.map((n) => (n.id === id ? { ...n, isRead: true } : n))\r\n    );\r\n    setUnreadCount((c) => Math.max(0, c - 1));\r\n  };\r\n\r\n  const handleDeleteNotification = (id) => {\r\n    const deletedIds = JSON.parse(\r\n      sessionStorage.getItem(\"deleted_notif_ids\") || \"[]\"\r\n    );\r\n    sessionStorage.setItem(\r\n      \"deleted_notif_ids\",\r\n      JSON.stringify([...deletedIds, id])\r\n    );\r\n    setNotifications((notifs) => notifs.filter((n) => n.id !== id));\r\n    const notif = notifications.find((n) => n.id === id);\r\n    if (notif && !notif.isRead) {\r\n      setUnreadCount((c) => Math.max(0, c - 1));\r\n    }\r\n  };\r\n\r\n  const handleMarkAsUnread = (id) => {\r\n    const readIds = JSON.parse(\r\n      sessionStorage.getItem(\"read_notif_ids\") || \"[]\"\r\n    );\r\n    const filtered = readIds.filter((rid) => rid !== id);\r\n    sessionStorage.setItem(\"read_notif_ids\", JSON.stringify(filtered));\r\n    setNotifications((notifs) =>\r\n      notifs.map((n) => (n.id === id ? { ...n, isRead: false } : n))\r\n    );\r\n    setUnreadCount((c) => c + 1);\r\n  };\r\n\r\n  // Robust captureElement that clones and copies computed styles safely (forces RGB colors and strips unsupported effects)\r\n  const captureElement = async (element) => {\r\n    if (!element) return null;\r\n\r\n    const normalizeColor = (() => {\r\n      const canvas = document.createElement(\"canvas\");\r\n      const ctx = canvas.getContext(\"2d\");\r\n      return (value, fallback = \"#ffffff\") => {\r\n        if (!value) return fallback;\r\n        try {\r\n          ctx.fillStyle = value;\r\n          return ctx.fillStyle || fallback;\r\n        } catch (_) {\r\n          return fallback;\r\n        }\r\n      };\r\n    })();\r\n\r\n    // Using the top-level hasModernColor function\r\n\r\n    const shouldStripBackgroundImage = (value) => {\r\n      if (!value || value === \"none\") return false;\r\n      const lower = value.toLowerCase();\r\n      return (\r\n        lower.includes(\"gradient\") ||\r\n        lower.includes(\"image-set\") ||\r\n        hasModernColor(lower)\r\n      );\r\n    };\r\n\r\n    const stripProps = new Set([\r\n      \"box-shadow\",\r\n      \"filter\",\r\n      \"backdrop-filter\",\r\n      \"mix-blend-mode\",\r\n      \"text-shadow\",\r\n    ]);\r\n\r\n    const colorProps = new Set([\r\n      \"color\",\r\n      \"background-color\",\r\n      \"border-color\",\r\n      \"outline-color\",\r\n      \"text-decoration-color\",\r\n      \"column-rule-color\",\r\n      \"caret-color\",\r\n      \"accent-color\",\r\n      \"fill\",\r\n      \"stroke\",\r\n    ]);\r\n\r\n    const copyComputedStyles = (source, target) => {\r\n      const computed = window.getComputedStyle(source);\r\n\r\n      for (const prop of computed) {\r\n        if (prop.startsWith(\"--\")) continue; // drop CSS variables that may carry modern colors\r\n        if (prop === \"background-image\" || prop === \"background\" || prop === \"border-image\") continue;\r\n\r\n        let value = computed.getPropertyValue(prop);\r\n        const priority = computed.getPropertyPriority(prop);\r\n\r\n        if (hasModernColor(value) && !colorProps.has(prop)) {\r\n          continue; // skip unsupported color functions on non-color props\r\n        }\r\n\r\n        if (colorProps.has(prop)) {\r\n          value = normalizeColor(value, value);\r\n        }\r\n\r\n        if (stripProps.has(prop)) {\r\n          value = prop === \"mix-blend-mode\" ? \"normal\" : \"none\";\r\n        }\r\n\r\n        target.style.setProperty(prop, value, priority);\r\n      }\r\n\r\n      // Force safe backgrounds and borders\r\n      target.style.backgroundColor = normalizeColor(computed.getPropertyValue(\"background-color\"), \"#ffffff\");\r\n      target.style.backgroundImage = \"none\";\r\n      target.style.background = normalizeColor(computed.getPropertyValue(\"background-color\"), \"#ffffff\");\r\n      target.style.borderColor = normalizeColor(computed.getPropertyValue(\"border-color\"), \"transparent\");\r\n      target.style.boxShadow = \"none\";\r\n      target.style.filter = \"none\";\r\n      target.style.mixBlendMode = \"normal\";\r\n      target.style.textShadow = \"none\";\r\n\r\n      const rect = source.getBoundingClientRect();\r\n      target.style.width = `${rect.width}px`;\r\n      target.style.height = `${rect.height}px`;\r\n      target.style.boxSizing = computed.getPropertyValue(\"box-sizing\") || \"border-box\";\r\n    };\r\n\r\n    const clone = element.cloneNode(true);\r\n\r\n    const origNodes = [element, ...Array.from(element.querySelectorAll(\"*\"))];\r\n    const cloneNodes = [clone, ...Array.from(clone.querySelectorAll(\"*\"))];\r\n    const len = Math.min(origNodes.length, cloneNodes.length);\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      try {\r\n        copyComputedStyles(origNodes[i], cloneNodes[i]);\r\n      } catch {\r\n        // Best-effort; skip nodes that fail style copying\r\n      }\r\n    }\r\n\r\n    // Sanitize SVG/HTML attributes that may carry modern color functions\r\n    const sanitizeAttributes = (node) => {\r\n      if (!(node instanceof Element)) return;\r\n      const attrs = Array.from(node.attributes || []);\r\n      for (const attr of attrs) {\r\n        const name = attr.name;\r\n        const value = attr.value || \"\";\r\n        if (hasModernColor(value)) {\r\n          if (\r\n            name === \"fill\" ||\r\n            name === \"stroke\" ||\r\n            name === \"stop-color\" ||\r\n            name === \"color\"\r\n          ) {\r\n            node.setAttribute(name, normalizeColor(value, \"#000000\"));\r\n          } else {\r\n            node.removeAttribute(name);\r\n          }\r\n        }\r\n        if (name === \"style\" && hasModernColor(value)) {\r\n          node.removeAttribute(\"style\");\r\n        }\r\n      }\r\n      // For SVG gradients/defs, disable by forcing fill/stroke to currentColor\r\n      if (node.tagName === \"linearGradient\" || node.tagName === \"radialGradient\") {\r\n        node.parentNode && node.parentNode.removeChild(node);\r\n      }\r\n      if (node.tagName === \"stop\" && node.hasAttribute(\"stop-color\")) {\r\n        node.setAttribute(\r\n          \"stop-color\",\r\n          normalizeColor(node.getAttribute(\"stop-color\"), \"#000000\")\r\n        );\r\n      }\r\n    };\r\n\r\n    clone.querySelectorAll(\"*\").forEach(sanitizeAttributes);\r\n    sanitizeAttributes(clone);\r\n\r\n    const sandbox = document.createElement(\"div\");\r\n    sandbox.style.position = \"absolute\";\r\n    sandbox.style.left = \"-9999px\";\r\n    sandbox.style.top = \"0\";\r\n    sandbox.style.zIndex = \"-9999\";\r\n    sandbox.style.background = normalizeColor(\r\n      window.getComputedStyle(element).backgroundColor,\r\n      \"#ffffff\"\r\n    );\r\n    sandbox.appendChild(clone);\r\n    document.body.appendChild(sandbox);\r\n\r\n    await new Promise((resolve) => setTimeout(resolve, 50));\r\n\r\n    const canvas = await html2canvas(clone, {\r\n      useCORS: true,\r\n      scale: 2,\r\n      backgroundColor: \"#ffffff\",\r\n      allowTaint: true,\r\n    });\r\n\r\n    document.body.removeChild(sandbox);\r\n\r\n    return canvas.toDataURL(\"image/png\");\r\n  };\r\n\r\n  const exportSalesToPDF = async () => {\r\n    setExportingSales(true);\r\n    try {\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n      const { startDate, endDate, rangeType } = dateRange;\r\n\r\n      const formatDate = (date) => dayjs(date).format(\"YYYY-MM-DD\");\r\n      const finalStart = dayjs.min(startDate, endDate);\r\n      const finalEnd = dayjs.max(startDate, endDate);\r\n      const startDateStr = formatDate(finalStart);\r\n      const endDateStr = formatDate(finalEnd);\r\n\r\n      // Fetch sales data\r\n      const salesData = await api(\"/api/dashboard/sales-data\", {\r\n        headers: authHeaders(token),\r\n        params: {\r\n          startDate: startDateStr,\r\n          endDate: endDateStr,\r\n        },\r\n      });\r\n\r\n      // Fetch store information\r\n      const profileData = await api(\"/auth/profile\", {\r\n        headers: authHeaders(token),\r\n      });\r\n\r\n      const business = profileData?.business || {};\r\n      const storeName = business.business_name || \"Store\";\r\n      const addressParts = [\r\n        business.house_number,\r\n        business.barangay,\r\n        business.city,\r\n        business.province,\r\n      ].filter(Boolean);\r\n      const address = addressParts.join(\", \") || \"N/A\";\r\n      const contact = business.mobile || business.email || \"N/A\";\r\n\r\n      // Format date range text\r\n      const dateRangeText =\r\n        rangeType === \"Day\"\r\n          ? finalStart.format(\"MMM D, YYYY\")\r\n          : `${finalStart.format(\"MMM D\")} - ${finalEnd.format(\"MMM D, YYYY\")}`;\r\n\r\n      // Check if there's any sales data\r\n      if (!salesData || salesData.length === 0) {\r\n        alert(\"No sales data found for the selected date range.\");\r\n        return;\r\n      }\r\n\r\n      // Calculate total\r\n      const total = salesData.reduce((sum, item) => sum + (item.subtotal || 0), 0);\r\n\r\n      // Create PDF\r\n      const pdf = new jsPDF(\"p\", \"mm\", \"a4\");\r\n      const pageWidth = pdf.internal.pageSize.getWidth();\r\n      const margin = 20;\r\n      const contentWidth = pageWidth - 2 * margin;\r\n      let yPos = margin;\r\n\r\n      // Helper function to add a new page if needed\r\n      const checkPageBreak = (requiredHeight) => {\r\n        if (yPos + requiredHeight > pdf.internal.pageSize.getHeight() - margin) {\r\n          pdf.addPage();\r\n          yPos = margin;\r\n          return true;\r\n        }\r\n        return false;\r\n      };\r\n\r\n      // Store name (centered, top middle)\r\n      pdf.setFontSize(20);\r\n      pdf.setFont(\"helvetica\", \"bold\");\r\n      const storeNameWidth = pdf.getTextWidth(storeName);\r\n      pdf.text(storeName, (pageWidth - storeNameWidth) / 2, yPos);\r\n      yPos += 10;\r\n\r\n      // Address (centered, under store name)\r\n      pdf.setFontSize(12);\r\n      pdf.setFont(\"helvetica\", \"normal\");\r\n      const addressWidth = pdf.getTextWidth(address);\r\n      pdf.text(address, (pageWidth - addressWidth) / 2, yPos);\r\n      yPos += 7;\r\n\r\n      // Contact information (centered, under address)\r\n      const contactWidth = pdf.getTextWidth(contact);\r\n      pdf.text(contact, (pageWidth - contactWidth) / 2, yPos);\r\n      yPos += 15;\r\n\r\n      // Sales Report heading\r\n      pdf.setFontSize(16);\r\n      pdf.setFont(\"helvetica\", \"bold\");\r\n      pdf.text(\"Sales Report\", margin, yPos);\r\n      yPos += 8;\r\n\r\n      // Date range\r\n      pdf.setFontSize(12);\r\n      pdf.setFont(\"helvetica\", \"normal\");\r\n      pdf.text(`Date: ${dateRangeText}`, margin, yPos);\r\n      yPos += 10;\r\n\r\n      // Table header\r\n      const colWidths = [\r\n        contentWidth * 0.15, // Product ID\r\n        contentWidth * 0.25, // Product Name\r\n        contentWidth * 0.15, // Number of Sold Items\r\n        contentWidth * 0.1,  // Unit\r\n        contentWidth * 0.15, // Price\r\n        contentWidth * 0.2,   // Subtotal\r\n      ];\r\n      const colX = [margin];\r\n      for (let i = 1; i < colWidths.length; i++) {\r\n        colX.push(colX[i - 1] + colWidths[i - 1]);\r\n      }\r\n\r\n      pdf.setFontSize(10);\r\n      pdf.setFont(\"helvetica\", \"bold\");\r\n      const headerY = yPos;\r\n      pdf.text(\"Product ID\", colX[0], headerY);\r\n      pdf.text(\"Product Name\", colX[1], headerY);\r\n      pdf.text(\"Sold Items\", colX[2], headerY);\r\n      pdf.text(\"Unit\", colX[3], headerY);\r\n      pdf.text(\"Price\", colX[4], headerY);\r\n      pdf.text(\"Subtotal\", colX[5], headerY);\r\n      yPos += 8;\r\n\r\n      // Draw header line\r\n      pdf.setLineWidth(0.5);\r\n      pdf.line(margin, yPos - 2, pageWidth - margin, yPos - 2);\r\n      yPos += 3;\r\n\r\n      // Table rows\r\n      pdf.setFont(\"helvetica\", \"normal\");\r\n      pdf.setFontSize(9);\r\n\r\n      salesData.forEach((item) => {\r\n        checkPageBreak(10);\r\n\r\n        const productId = String(item.product_id || \"\");\r\n        const productName = item.product_name || \"\";\r\n        const soldItems = Number(item.number_of_sold_items || 0).toFixed(2);\r\n        const unit = item.unit || \"pc\";\r\n        const price = `PHP ${Number(item.price || 0).toFixed(2)}`;\r\n        const subtotal = `PHP ${Number(item.subtotal || 0).toFixed(2)}`;\r\n\r\n        // Truncate product name if too long\r\n        const maxNameWidth = colWidths[1] - 2;\r\n        let displayName = productName;\r\n        if (pdf.getTextWidth(displayName) > maxNameWidth) {\r\n          while (pdf.getTextWidth(displayName + \"...\") > maxNameWidth && displayName.length > 0) {\r\n            displayName = displayName.slice(0, -1);\r\n          }\r\n          displayName += \"...\";\r\n        }\r\n\r\n        pdf.text(productId, colX[0], yPos);\r\n        pdf.text(displayName, colX[1], yPos);\r\n        pdf.text(soldItems, colX[2], yPos);\r\n        pdf.text(unit, colX[3], yPos);\r\n        pdf.text(price, colX[4], yPos);\r\n        pdf.text(subtotal, colX[5], yPos);\r\n        yPos += 7;\r\n      });\r\n\r\n      // Total row\r\n      checkPageBreak(10);\r\n      yPos += 3;\r\n      pdf.setLineWidth(0.5);\r\n      pdf.line(margin, yPos, pageWidth - margin, yPos);\r\n      yPos += 5;\r\n\r\n      pdf.setFont(\"helvetica\", \"bold\");\r\n      pdf.setFontSize(10);\r\n      pdf.text(\"Total:\", colX[4], yPos);\r\n      pdf.text(`PHP ${total.toFixed(2)}`, colX[5], yPos);\r\n\r\n      // Save PDF\r\n      const fileName = `Sales-Report-${dateRange.rangeType}-${dayjs().format(\"YYYY-MM-DD\")}.pdf`;\r\n      pdf.save(fileName);\r\n    } catch (error) {\r\n      console.error(\"Error exporting sales PDF:\", error);\r\n      alert(\"Failed to generate sales report. Please try again or contact support.\");\r\n    } finally {\r\n      setExportingSales(false);\r\n    }\r\n  };\r\n\r\n  const exportToPDF = async () => {\r\n    setExportingPDF(true);\r\n    try {\r\n      const element = document.getElementById(\"pdf-wrapper\");\r\n      if (!element) throw new Error(\"Dashboard content not found\");\r\n\r\n      // Create a clone of the element to avoid affecting the original\r\n      const clone = element.cloneNode(true);\r\n      clone.style.position = 'absolute';\r\n      clone.style.left = '-9999px';\r\n      document.body.appendChild(clone);\r\n\r\n      // Create a header with business information\r\n      const header = document.createElement('div');\r\n      header.style.padding = '15px 20px';\r\n      header.style.backgroundColor = '#1a365d';\r\n      header.style.color = 'white';\r\n      header.style.borderBottom = '2px solid #2c5282';\r\n      \r\n      // Format the date range\r\n      const { startDate, endDate, rangeType } = dateRange;\r\n      const formatDate = (date) => dayjs(date).format('MMM D, YYYY');\r\n      const dateRangeText = rangeType === 'Day' \r\n        ? formatDate(startDate)\r\n        : `${formatDate(startDate)} - ${formatDate(endDate)}`;\r\n      \r\n      // Business information (you can customize these values)\r\n      const businessInfo = {\r\n        name: \"eKahera Business\",\r\n        address: \"Bicol University, West (Main Campus) Legazpi City, Albay, Philippines\",\r\n        contact: \"ekahera.business@gmail.com | +63 970 846 8324\"\r\n      };\r\n\r\n      header.innerHTML = `\r\n        <div style=\"max-width: 100%; color: white;\">\r\n          <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;\">\r\n            <h1 style=\"margin: 0; font-size: 24px; font-weight: 600; color: white;\">${businessInfo.name}</h1>\r\n            <div style=\"text-align: right;\">\r\n              <div style=\"font-size: 14px; color: #a0aec0;\">Report Period</div>\r\n              <div style=\"font-weight: 600; font-size: 16px;\">${dateRangeText}</div>\r\n            </div>\r\n          </div>\r\n          <div style=\"display: flex; justify-content: space-between; font-size: 12px; color: #cbd5e0;\">\r\n            <div>${businessInfo.address}</div>\r\n            <div>${businessInfo.contact}</div>\r\n          </div>\r\n        </div>\r\n      `;\r\n\r\n      // Create a summary section\r\n      const summarySection = document.createElement('div');\r\n      summarySection.style.padding = '15px';\r\n      summarySection.style.backgroundColor = '#f7fafc';\r\n      summarySection.style.borderBottom = '1px solid #e2e8f0';\r\n      summarySection.style.marginBottom = '20px';\r\n      \r\n      // Add key metrics to the summary\r\n      summarySection.innerHTML = `\r\n        <h3 style=\"margin: 0 0 10px 0; color: #2d3748; font-size: 18px;\">Key Metrics Summary</h3>\r\n        <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;\">\r\n          <div style=\"background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);\">\r\n            <div style=\"font-size: 12px; color: #718096;\">Total Revenue</div>\r\n            <div style=\"font-size: 20px; font-weight: 600; color: #2b6cb0;\">${formatCurrency(keyMetrics.revenue)}</div>\r\n          </div>\r\n          <div style=\"background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);\">\r\n            <div style=\"font-size: 12px; color: #718096;\">Total Transactions</div>\r\n            <div style=\"font-size: 20px; font-weight: 600; color: #2f855a;\">${keyMetrics.totalTransactions}</div>\r\n          </div>\r\n          <div style=\"background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);\">\r\n            <div style=\"font-size: 12px; color: #718096;\">Items Sold</div>\r\n            <div style=\"font-size: 20px; font-weight: 600; color: #b7791f;\">${keyMetrics.totalItemsSold}</div>\r\n          </div>\r\n          <div style=\"background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);\">\r\n            <div style=\"font-size: 12px; color: #718096;\">Net Profit</div>\r\n            <div style=\"font-size: 20px; font-weight: 600; color: #2c5282;\">${formatCurrency(keyMetrics.netProfit)}</div>\r\n          </div>\r\n        </div>\r\n      `;\r\n\r\n      // Insert the header and summary at the top of the clone\r\n      clone.insertBefore(summarySection, clone.firstChild);\r\n      clone.insertBefore(header, clone.firstChild);\r\n\r\n      // Add a footer with page numbers\r\n      const footer = document.createElement('div');\r\n      footer.style.padding = '10px';\r\n      footer.style.backgroundColor = '#f7fafc';\r\n      footer.style.borderTop = '1px solid #e2e8f0';\r\n      footer.style.textAlign = 'center';\r\n      footer.style.fontSize = '10px';\r\n      footer.style.color = '#718096';\r\n      footer.innerText = `Page 1 of 1 • Generated on ${new Date().toLocaleString()}`;\r\n      clone.appendChild(footer);\r\n\r\n      // Process all elements for modern color functions\r\n      const allElements = clone.querySelectorAll('*');\r\n      allElements.forEach(el => {\r\n        const style = window.getComputedStyle(el);\r\n        \r\n        // Process background and color properties\r\n        ['background', 'background-color', 'color', 'border', 'border-color'].forEach(prop => {\r\n          try {\r\n            const value = style.getPropertyValue(prop);\r\n            if (value && hasModernColor(value)) {\r\n              el.style.setProperty(prop, 'transparent', 'important');\r\n            }\r\n          } catch (e) {\r\n            console.warn(`Error processing ${prop}:`, e);\r\n          }\r\n        });\r\n      });\r\n\r\n      // Capture chart areas separately to ensure they render inside the PDF\r\n      const liveCharts = Array.from(document.querySelectorAll(\".chart-export-container\"));\r\n      const chartSnapshots = [];\r\n      const chartRestorers = [];\r\n      const sanitizeChartNode = (root) => {\r\n        const colorProps = [\r\n          \"color\",\r\n          \"background-color\",\r\n          \"border-color\",\r\n          \"outline-color\",\r\n          \"text-decoration-color\",\r\n          \"column-rule-color\",\r\n          \"caret-color\",\r\n          \"accent-color\",\r\n          \"fill\",\r\n          \"stroke\",\r\n        ];\r\n        const extraProps = [\r\n          \"background\",\r\n          \"background-image\",\r\n          \"border\",\r\n          \"border-top-color\",\r\n          \"border-right-color\",\r\n          \"border-bottom-color\",\r\n          \"border-left-color\",\r\n          \"box-shadow\",\r\n          \"text-shadow\",\r\n          \"outline-color\",\r\n        ];\r\n        const restores = [];\r\n        const normalizeOrStrip = (node, prop, value, priority) => {\r\n          if (!value) return;\r\n          const lower = value.toLowerCase();\r\n          const isGradient = lower.includes(\"gradient\") || lower.includes(\"image-set\");\r\n          if (hasModernColor(lower) || isGradient) {\r\n            const prev = node.style.getPropertyValue(prop);\r\n            restores.push(() => node.style.setProperty(prop, prev || \"\", priority));\r\n            if (prop.includes(\"background\")) {\r\n              node.style.setProperty(prop, \"none\", \"important\");\r\n            } else if (prop.includes(\"shadow\")) {\r\n              node.style.setProperty(prop, \"none\", \"important\");\r\n            } else if (prop.includes(\"border\")) {\r\n              node.style.setProperty(prop, normalizeToRGB(value, \"#e5e7eb\"), \"important\");\r\n            } else {\r\n              node.style.setProperty(prop, normalizeToRGB(value, \"#1f2937\"), \"important\");\r\n            }\r\n          }\r\n        };\r\n        const processNode = (node) => {\r\n          if (!(node instanceof Element)) return;\r\n          const style = window.getComputedStyle(node);\r\n          colorProps.forEach((prop) => {\r\n            const val = style.getPropertyValue(prop);\r\n            if (hasModernColor(val)) {\r\n              const prev = node.style.getPropertyValue(prop);\r\n              restores.push(() => node.style.setProperty(prop, prev || \"\", style.getPropertyPriority(prop)));\r\n              node.style.setProperty(prop, normalizeToRGB(val, prop.includes(\"background\") ? \"#ffffff\" : \"#1f2937\"), \"important\");\r\n            }\r\n          });\r\n          [...extraProps].forEach((prop) => {\r\n            const val = style.getPropertyValue(prop);\r\n            normalizeOrStrip(node, prop, val, style.getPropertyPriority(prop));\r\n          });\r\n        };\r\n        processNode(root);\r\n        root.querySelectorAll(\"*\").forEach(processNode);\r\n        return () => restores.reverse().forEach((fn) => fn());\r\n      };\r\n\r\n      for (const chartNode of liveCharts) {\r\n        let restoreFn = null;\r\n        try {\r\n          restoreFn = sanitizeChartNode(chartNode);\r\n          chartRestorers.push(restoreFn);\r\n          const rect = chartNode.getBoundingClientRect();\r\n          const chartCanvas = await html2canvas(chartNode, {\r\n            scale: 2,\r\n            useCORS: true,\r\n            backgroundColor: \"#ffffff\",\r\n          });\r\n          chartSnapshots.push({\r\n            dataUrl: chartCanvas.toDataURL(\"image/png\"),\r\n            width: rect.width,\r\n            height: rect.height,\r\n          });\r\n        } catch (e) {\r\n          console.warn(\"Chart capture failed, falling back to default capture\", e);\r\n          chartSnapshots.push(null);\r\n        } finally {\r\n          if (restoreFn) restoreFn();\r\n        }\r\n      }\r\n\r\n      // Replace chart containers in the cloned DOM with static images\r\n      const cloneCharts = Array.from(clone.querySelectorAll(\".chart-export-container\"));\r\n      cloneCharts.forEach((chartNode, idx) => {\r\n        const snapshot = chartSnapshots[idx];\r\n        if (!snapshot || !snapshot.dataUrl) return;\r\n        chartNode.innerHTML = \"\";\r\n        const img = document.createElement(\"img\");\r\n        img.src = snapshot.dataUrl;\r\n        img.style.width = `${snapshot.width}px`;\r\n        img.style.height = `${snapshot.height}px`;\r\n        img.style.objectFit = \"contain\";\r\n        img.style.display = \"block\";\r\n        img.setAttribute(\"alt\", \"Chart snapshot\");\r\n        chartNode.appendChild(img);\r\n      });\r\n\r\n      // Add a small delay to ensure all styles are applied\r\n      await new Promise(resolve => setTimeout(resolve, 200));\r\n\r\n      const canvas = await html2canvas(clone, {\r\n        scale: 2,\r\n        useCORS: true,\r\n        logging: false,\r\n        backgroundColor: '#ffffff',\r\n        removeContainer: true,\r\n        onclone: (clonedDoc) => {\r\n          document.fonts.ready.then(() => {});\r\n        }\r\n      });\r\n\r\n      // Remove the clone\r\n      document.body.removeChild(clone);\r\n\r\n      const imgData = canvas.toDataURL('image/png');\r\n      const pdf = new jsPDF('p', 'mm', 'a4');\r\n      const imgProps = pdf.getImageProperties(imgData);\r\n      const pdfWidth = pdf.internal.pageSize.getWidth() - 20;\r\n      const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;\r\n      \r\n      // Add the image to PDF\r\n      pdf.addImage(imgData, 'PNG', 10, 10, pdfWidth, pdfHeight);\r\n      \r\n      // Set PDF metadata\r\n      const fileName = `eKahera-Report-${dateRange.rangeType}-${dayjs().format('YYYY-MM-DD')}.pdf`;\r\n      pdf.setProperties({\r\n        title: `eKahera Business Report - ${dateRange.rangeType} (${dateRangeText})`,\r\n        subject: `Business Performance Report - ${dateRangeText}`,\r\n        author: 'eKahera Business Intelligence',\r\n        creator: 'eKahera System',\r\n        keywords: 'business,report,sales,metrics,performance'\r\n      });\r\n      \r\n      // Add a watermark (optional)\r\n      pdf.setFontSize(60);\r\n      pdf.setTextColor(240, 240, 240);\r\n      pdf.text('eKahera', 35, 150, { angle: 45 });\r\n      \r\n      // Reset text color\r\n      pdf.setTextColor(0, 0, 0);\r\n      \r\n      // Save the PDF\r\n      pdf.save(fileName);\r\n      \r\n    } catch (error) {\r\n      console.error('Error exporting PDF:', error);\r\n      alert('Failed to generate PDF report. Please try again or contact support.');\r\n    } finally {\r\n      setExportingPDF(false);\r\n    }\r\n  };\r\n\r\n  // Fetch filtered data when dateRange changes\r\n  useEffect(() => {\r\n    fetchData();\r\n    fetchNotifications();\r\n  }, [dateRange]);\r\n\r\n  // Helper function to format currency values\r\n  const formatCurrency = (value) => {\r\n    return new Intl.NumberFormat(\"en-PH\", {\r\n      style: \"currency\",\r\n      currency: \"PHP\",\r\n      minimumFractionDigits: 2,\r\n      maximumFractionDigits: 2,\r\n    }).format(value);\r\n  };\r\n\r\n  // New handler to receive selected dates from modal\r\n  const handleDateRangeApply = (newRange) => {\r\n    setDateRange(newRange);\r\n  };\r\n\r\n  const headerDateDisplay = useMemo(() => {\r\n    if (!dateRange.startDate || !dateRange.endDate) return \"Select Range\";\r\n\r\n    const finalStart = dayjs.min(dateRange.startDate, dateRange.endDate);\r\n    const finalEnd = dayjs.max(dateRange.startDate, dateRange.endDate);\r\n\r\n    return `${finalStart.format(\"MMM D\")} - ${finalEnd.format(\"MMM D, YYYY\")}`;\r\n  }, [dateRange]);\r\n\r\n  // Header actions - REMOVED SELECT DROPDOWN\r\n  const headerActions = (\r\n    <div className=\"flex items-center gap-2\">\r\n      <button\r\n        onClick={fetchData}\r\n        disabled={loading}\r\n        title=\"Refresh Data\"\r\n        className=\"bg-white/80 backdrop-blur-sm hover:bg-white text-gray-700 p-1.5 sm:p-2 rounded-lg border border-gray-200/80 text-sm font-medium transition-all duration-200 hover:shadow-md hover:scale-[1.02] shrink-0\"\r\n      >\r\n        <BiRefresh\r\n          className={`w-4 h-4 sm:w-5 sm:h-5 ${loading ? \"animate-spin\" : \"\"}`}\r\n        />\r\n      </button>\r\n\r\n      {/* NEW CALENDAR BUTTON */}\r\n      <button\r\n        onClick={() => setShowFilterModal(true)}\r\n        disabled={loading}\r\n        title=\"Select Date Range\"\r\n        className=\"flex items-center gap-1 sm:gap-2 bg-white/80 backdrop-blur-sm hover:bg-white text-gray-700 px-1.5 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-gray-200/80 text-xs sm:text-sm font-medium transition-all duration-200 outline-none cursor-pointer hover:shadow-md hover:scale-[1.02] shrink-0\"\r\n      >\r\n        <BiCalendarAlt className=\"w-4 h-4 sm:w-5 sm:h-5\" />\r\n        <span className=\"hidden sm:inline\">{headerDateDisplay}</span>\r\n      </button>\r\n\r\n      <div className=\"py-2 flex justify-end gap-2\">\r\n        <Button\r\n          onClick={exportSalesToPDF}\r\n          disabled={exportingSales || loading}\r\n          size=\"sm\"\r\n          variant=\"primary\"\r\n          className=\"flex items-center gap-2 w-full sm:w-auto shrink-0\"\r\n        >\r\n          {exportingSales ? (\r\n            <>\r\n              <BiRefresh className=\"w-5 h-5 animate-spin\" />\r\n              <span className=\"hidden sm:inline\">Exporting...</span>\r\n              <span className=\"sm:hidden\">...</span>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <svg\r\n                className=\"w-5 h-5\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\r\n                />\r\n              </svg>\r\n              <span className=\"hidden sm:inline\">Export Sales</span>\r\n              <span className=\"sm:hidden\">Sales</span>\r\n            </>\r\n          )}\r\n        </Button>\r\n        <Button\r\n          onClick={exportToPDF}\r\n          disabled={exportingPDF || loading}\r\n          size=\"sm\"\r\n          variant=\"primary\"\r\n          className=\"flex items-center gap-2 w-full sm:w-auto shrink-0\"\r\n        >\r\n          {exportingPDF ? (\r\n            <>\r\n              <BiRefresh className=\"w-5 h-5 animate-spin\" />\r\n              <span className=\"hidden sm:inline\">Exporting...</span>\r\n              <span className=\"sm:hidden\">...</span>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <svg\r\n                className=\"w-5 h-5\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z\"\r\n                />\r\n              </svg>\r\n              <span className=\"hidden sm:inline\">Export PDF</span>\r\n              <span className=\"sm:hidden\">PDF</span>\r\n            </>\r\n          )}\r\n        </Button>\r\n      </div>\r\n\r\n      <div className=\"relative\" ref={notificationRef}>\r\n        <NotificationDropdown\r\n          notifications={notifications}\r\n          unreadCount={unreadCount}\r\n          onMarkAsRead={handleMarkAsRead}\r\n          onMarkAsUnread={handleMarkAsUnread}\r\n          onDelete={handleDeleteNotification}\r\n          isOpen={showNotifications}\r\n          onToggle={() => setShowNotifications(!showNotifications)}\r\n          containerRef={notificationRef}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <PageLayout\r\n      title=\"DASHBOARD\"\r\n      subtitle=\"\"\r\n      sidebar={<NavAdmin />}\r\n      headerActions={headerActions}\r\n      isSidebarOpen={isSidebarOpen}\r\n      setSidebarOpen={setSidebarOpen}\r\n      className=\"bg-gray-50 min-h-screen\"\r\n    >\r\n      {/* Wrap dashboard content in a stable wrapper we can capture */}\r\n      <div id=\"pdf-wrapper\" ref={dashboardRef}>\r\n        {/* Low Stock Products - Mobile View (Added padding class p-6-safe) */}\r\n        <div className=\"p-4 lg:hidden\">\r\n          {loading ? (\r\n            <div className=\"bg-white p-6 rounded-xl shadow-md border border-gray-200 animate-pulse\">\r\n              <div className=\"h-6 bg-gray-200 rounded w-1/2 mb-6\"></div>\r\n              <div className=\"h-4 bg-gray-200 rounded w-full mb-3\"></div>\r\n              <div className=\"h-4 bg-gray-200 rounded w-full mb-3\"></div>\r\n              <div className=\"h-4 bg-gray-200 rounded w-4/5\"></div>\r\n            </div>\r\n          ) : (\r\n            <div className=\"bg-white p-6 rounded-xl shadow-md\">\r\n              <div className=\"flex justify-between items-center mb-4\">\r\n                <h3 className=\"text-lg font-bold text-gray-800\">\r\n                  Low Stock Products\r\n                </h3>\r\n              </div>\r\n              <LowStockList lowStockProducts={lowStockProducts} />\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Key Metrics Cards - Optimized for all screens */}\r\n        <div ref={keyMetricsRef} className=\"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 w-full px-4 sm:px-6 md:px-8 py-2\">\r\n          {/* Card 1: Total Revenue */}\r\n          <div className=\"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n            <p className=\"text-xs font-medium text-gray-500 uppercase mb-1\">\r\n              Total Revenue\r\n            </p>\r\n            <p className=\"text-2xl font-bold text-gray-900\">\r\n              {formatCurrency(keyMetrics.revenue)}\r\n            </p>\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              For selected range\r\n            </p>\r\n          </div>\r\n          {/* Card 2: Operating Expenses */}\r\n          <div className=\"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n            <p className=\"text-xs font-medium text-gray-500 uppercase mb-1\">\r\n              Operating Expenses\r\n            </p>\r\n            <p className=\"text-2xl font-bold text-gray-900\">\r\n              {formatCurrency(keyMetrics.expenses)}\r\n            </p>\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              For selected range\r\n            </p>\r\n          </div>\r\n          {/* Card 3: Net Profit */}\r\n          <div className=\"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n            <p className=\"text-xs font-medium text-gray-500 uppercase mb-1\">\r\n              Net Profit\r\n            </p>\r\n            <p\r\n              className={`text-2xl font-bold ${\r\n                keyMetrics.netProfit >= 0 ? \"text-green-600\" : \"text-red-600\"\r\n              }`}\r\n            >\r\n              {formatCurrency(Math.abs(keyMetrics.netProfit))}\r\n              {keyMetrics.netProfit < 0 && (\r\n                <span className=\"text-sm text-red-500 ml-1\">(Loss)</span>\r\n              )}\r\n            </p>\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              For selected range\r\n            </p>\r\n          </div>\r\n          {/* Card 4: Gross Margin */}\r\n          <div className=\"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n            <p className=\"text-xs font-medium text-gray-500 uppercase mb-1\">\r\n              Gross Margin\r\n            </p>\r\n            <p\r\n              className={`text-2xl font-bold ${\r\n                keyMetrics.grossMargin >= 0 ? \"text-green-600\" : \"text-red-600\"\r\n              }`}\r\n            >\r\n              {keyMetrics.grossMargin.toFixed(1)}%\r\n            </p>\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              For selected range\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Main Content Area - Optimized for large screen side-by-side layout */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-6 p-4 sm:p-6 md:p-8 pt-0\">\r\n          {/* Main Chart Area (8/12 width on large screens) */}\r\n          <div className=\"lg:col-span-8 flex flex-col gap-6\">\r\n            {loading ? (\r\n              <>\r\n                <div className=\"bg-white p-6 rounded-xl shadow-md border border-gray-200 h-[336px] animate-pulse flex items-center justify-center\">\r\n                  <div className=\"w-full h-64 bg-gray-200 rounded-lg\"></div>\r\n                </div>\r\n                <div className=\"bg-white p-6 rounded-xl shadow-md border border-gray-200 h-[336px] animate-pulse flex items-center justify-center\">\r\n                  <div className=\"w-64 h-64 bg-gray-200 rounded-full\"></div>\r\n                </div>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <div\r\n                  ref={visitorsChartRef}\r\n                  className=\"chart-export-container\"\r\n                  data-export-chart=\"visitors\"\r\n                >\r\n                  <VisitorsChart data={chartData} rangeType={dateRange.rangeType} />\r\n                </div>\r\n                <div\r\n                  ref={pieChartRef}\r\n                  className=\"chart-export-container\"\r\n                  data-export-chart=\"sales-pie\"\r\n                >\r\n                  <SalesPieChart data={pieData} />\r\n                </div>\r\n              </>\r\n            )}\r\n          </div>\r\n\r\n          {/* Sidebar with Stats and Low Stock (4/12 width on large screens) */}\r\n          <div className=\"lg:col-span-4 flex flex-col gap-6\">\r\n            {loading ? (\r\n              <div className=\"bg-white p-6 rounded-xl shadow-md border border-gray-200 animate-pulse\">\r\n                <div className=\"h-6 bg-gray-200 rounded w-1/3 mb-4\"></div>\r\n                <div className=\"h-8 bg-gray-300 rounded w-1/2 mb-6\"></div>\r\n                <div className=\"h-6 bg-gray-200 rounded w-1/3 mb-4\"></div>\r\n                <div className=\"h-8 bg-gray-300 rounded w-1/2 mb-6\"></div>\r\n                <div className=\"h-6 bg-gray-200 rounded w-1/3 mb-4\"></div>\r\n                <div className=\"h-8 bg-gray-300 rounded w-1/2\"></div>\r\n              </div>\r\n            ) : (\r\n              <DashboardStatsCard \r\n                  stats={todayHighlight}\r\n                  formatCurrency={formatCurrency}\r\n                  rangeType=\"Today\"\r\n                  currentTime={currentTime}\r\n              />\r\n            )}\r\n\r\n            {/* Low Stock Products - Desktop View */}\r\n            {loading ? (\r\n              <div className=\"bg-white p-6 rounded-xl shadow-md border border-gray-200 animate-pulse hidden lg:block\">\r\n                <div className=\"h-6 bg-gray-200 rounded w-1/2 mb-6\"></div>\r\n                <div className=\"h-4 bg-gray-200 rounded w-full mb-3\"></div>\r\n                <div className=\"h-4 bg-gray-200 rounded w-full mb-3\"></div>\r\n                <div className=\"h-4 bg-gray-200 rounded w-4/5\"></div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"bg-white p-6 rounded-lg shadow-md hidden lg:block\">\r\n                <div className=\"flex justify-between items-center mb-4\">\r\n                  <h3 className=\"text-lg font-bold text-gray-800\">\r\n                    Low Stock Products\r\n                  </h3>\r\n                </div>\r\n                <LowStockList lowStockProducts={lowStockProducts} />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Business Report Component - Ensure it uses the full content width */}\r\n        <div ref={businessReportRef} className=\"w-full px-4 sm:px-6 md:px-8 pb-8\">\r\n          <DashboardBusinessReport dateRange={dateRange} />\r\n        </div>\r\n\r\n        \r\n        {/* NEW DATE RANGE FILTER MODAL */}\r\n        <DateRangeFilterModal\r\n          isOpen={showFilterModal}\r\n          onClose={() => setShowFilterModal(false)}\r\n          onDateRangeApply={handleDateRangeApply}\r\n        />\r\n      </div>\r\n    </PageLayout>\r\n  );\r\n}\r\n\r\n// LowStockList is kept as a separate component for clean code, as in the original\r\nfunction LowStockList({ lowStockProducts }) {\r\n  if (lowStockProducts.length === 0) {\r\n    return <p className=\"text-sm text-gray-500\">No products with low stock.</p>;\r\n  }\r\n\r\n  return (\r\n    <ul className=\"divide-y divide-gray-200\">\r\n      <li className=\"py-2 text-sm font-semibold text-gray-600 flex justify-between\">\r\n          <span>Product</span>\r\n          <span>Quantity</span>\r\n      </li>\r\n      {lowStockProducts.map((product) => (\r\n        <li\r\n          key={product.product_id}\r\n          className=\"py-3 flex justify-between items-center\"\r\n        >\r\n          <span className=\"text-sm font-medium text-gray-800\">\r\n            {product.product_name}\r\n          </span>\r\n          <span className=\"text-sm font-bold text-red-600\">\r\n            {product.quantity_in_stock} left\r\n          </span>\r\n        </li>\r\n      ))}\r\n    </ul>\r\n  );\r\n}\r\n"],"names":["dayjs","extend","minMax","SOFT_BLUE","VisitorsChart","data","className","rangeType","jsx","ChartCard","title","getChartTitle","children","ResponsiveContainer","width","height","jsxs","LineChart","margin","top","right","left","bottom","CartesianGrid","strokeDasharray","stroke","XAxis","dataKey","tick","fill","fontSize","YAxis","Tooltip","contentStyle","background","borderColor","borderRadius","Line","type","strokeWidth","dot","r","isAnimationActive","SalesPieChart","BarChart","interval","angle","textAnchor","formatter","value","name","props","Number","toLocaleString","payload","Legend","Bar","radius","Dashboard","keyMetrics","setKeyMetrics","useState","revenue","expenses","netProfit","grossMargin","totalTransactions","totalItemsSold","averageTransactionValue","stats","setStats","dateRange","setDateRange","startDate","startOf","endDate","endOf","loading","setLoading","chartData","setChartData","pieData","setPieData","lowStockProducts","setLowStockProducts","showFilterModal","setShowFilterModal","notifications","setNotifications","unreadCount","setUnreadCount","showNotifications","setShowNotifications","notificationRef","React","useRef","useAuth","isSidebarOpen","setSidebarOpen","todayHighlight","setTodayHighlight","sales","transactions","topProduct","exportingPDF","setExportingPDF","exportingSales","setExportingSales","currentTime","setCurrentTime","dashboardRef","visitorsChartRef","pieChartRef","keyMetricsRef","businessReportRef","useEffect","timer","updateTime","document","visibilityState","setInterval","handleVisibilityChange","addEventListener","clearInterval","removeEventListener","hasModernColor","val","lower","toLowerCase","includes","normalizeToRGB","canvas","ctx","createElement","getContext","fallback","fillStyle","_","async","token","sessionStorage","getItem","todayStr","format","overview","api","headers","authHeaders","params","totalSales","topProducts","product_name","err","error","fetchTodayData","useMemo","JSON","parse","e","handleClickOutside","event","current","contains","target","fetchData","formatDate","date","finalStart","min","finalEnd","max","startDateStr","endDateStr","console","log","formattedStart","formattedEnd","timeseries","pie","oldLowStock","Promise","all","derived","map","d","customers","total","pieTotal","reduce","s","p","piePercent","percent","totalExpenses","avgTxValue","dateRangeText","transactionsLabel","label","undefined","minimumFractionDigits","maximumFractionDigits","subtext","total_sold","resp","readIds","Set","deletedIds","mapped","filter","has","log_id","id","action","message","username","role","time","date_time","isRead","n","length","fetchNotifications","formatCurrency","Intl","NumberFormat","style","currency","headerDateDisplay","headerActions","onClick","disabled","BiRefresh","BiCalendarAlt","Button","salesData","profileData","business","storeName","business_name","address","house_number","barangay","city","province","Boolean","join","contact","mobile","email","alert","sum","item","subtotal","pdf","jsPDF","pageWidth","internal","pageSize","getWidth","contentWidth","yPos","checkPageBreak","requiredHeight","getHeight","addPage","setFontSize","setFont","storeNameWidth","getTextWidth","text","addressWidth","contactWidth","colWidths","colX","i","push","headerY","setLineWidth","line","forEach","productId","String","product_id","productName","soldItems","number_of_sold_items","toFixed","unit","price","maxNameWidth","displayName","slice","fileName","save","size","variant","Fragment","viewBox","strokeLinecap","strokeLinejoin","element","getElementById","Error","clone","cloneNode","position","body","appendChild","header","padding","backgroundColor","color","borderBottom","businessInfo","innerHTML","summarySection","marginBottom","insertBefore","firstChild","footer","borderTop","textAlign","innerText","Date","querySelectorAll","el","window","getComputedStyle","prop","getPropertyValue","setProperty","warn","liveCharts","Array","from","chartSnapshots","chartRestorers","sanitizeChartNode","root","colorProps","extraProps","restores","processNode","node","Element","prev","getPropertyPriority","normalizeOrStrip","priority","isGradient","reverse","fn","chartNode","restoreFn","rect","getBoundingClientRect","chartCanvas","html2canvas","scale","useCORS","dataUrl","toDataURL","idx","snapshot","img","src","objectFit","display","setAttribute","resolve","setTimeout","logging","removeContainer","onclone","clonedDoc","fonts","ready","then","removeChild","imgData","imgProps","getImageProperties","pdfWidth","pdfHeight","addImage","setProperties","subject","author","creator","keywords","setTextColor","ref","NotificationDropdown","onMarkAsRead","setItem","stringify","notifs","Math","c","onMarkAsUnread","filtered","rid","onDelete","notif","find","isOpen","onToggle","containerRef","PageLayout","subtitle","sidebar","NavAdmin","LowStockList","abs","DashboardStatsCard","DashboardBusinessReport","DateRangeFilterModal","onClose","onDateRangeApply","newRange","product","quantity_in_stock"],"mappings":"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"}