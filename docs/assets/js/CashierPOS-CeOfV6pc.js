import{j as e}from"./utils-L0j39QIW.js";import{a as t,u as s,R as a}from"./vendor-DPJ7iNYg.js";import{S as n}from"./ScannerCard-D_DUdZEG.js";import{S as r,C as o,D as i,P as c,a as l,b as d,c as u,d as m}from"./ScanCustomerCartModal-CPcYVW_0.js";import{b as p,a as h,d as x,e as g}from"./index-C3oyeyrQ.js";import{P as f}from"./ProfileModal-CxynDHFl.js";import{B as b}from"./BaseModal-BJkFAYW_.js";import{f as y,g as w}from"./index-BXEzUCnW.js";import"./qr-Dta_7pGb.js";import"./Card-Cru2VKQZ.js";function v({isOpen:s,onClose:a}){const[n,r]=t.useState([]),[o,i]=t.useState(!1),[c,l]=t.useState("");t.useEffect(()=>{if(!s)return;(async()=>{i(!0),l("");try{const e=sessionStorage.getItem("auth_token"),t=await h("/api/sales/cashier/recent",{headers:{Authorization:`Bearer ${e}`}});r(Array.isArray(t)?t:[])}catch(e){l("Failed to load receipts")}finally{i(!1)}})()},[s]);return e.jsxs(b,{isOpen:s,onClose:a,title:"Recent Receipts",subtitle:"Latest transactions handled by you",size:"lg",footer:e.jsx(p,{label:"Close",variant:"secondary",onClick:a,className:"w-full"}),children:[o&&e.jsx("div",{className:"text-sm text-gray-600 py-4 text-center",children:"Loading receipts..."}),c&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 border border-red-100 rounded-lg px-3 py-2 mb-2",children:c}),!o&&!c&&0===n.length&&e.jsx("div",{className:"text-sm text-gray-500 py-6 text-center",children:"No receipts found."}),e.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:n.map(t=>e.jsxs("button",{onClick:()=>(e=>{const t=new URL(window.location.origin+"/receipt");e.transaction_number&&t.searchParams.set("tn",e.transaction_number),e.transaction_id&&t.searchParams.set("tid",String(e.transaction_id)),window.open(t.toString(),"_blank")})(t),className:"w-full text-left border border-gray-200 rounded-xl px-3 py-2 hover:border-blue-300 hover:bg-blue-50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.transaction_number||"Txn"}),e.jsx("p",{className:"text-xs text-gray-600",children:new Date(t.updated_at||t.created_at).toLocaleString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-blue-700",children:["₱",Number(t.total_amount||t.total||0).toFixed(2)]}),e.jsx("p",{className:"text-[11px] text-gray-600 uppercase",children:t.payment?.method||t.payment_type||"cash"})]})]}),(t.discount_percentage||t.discount_amount)&&e.jsxs("p",{className:"text-[11px] text-emerald-700 mt-1",children:["Discount applied"," ",t.discount_percentage?`${t.discount_percentage}%`:`₱${Number(t.discount_amount||0).toFixed(2)}`]})]},`${t.transaction_id}-${t.transaction_number}`))})]})}function j(){const b=s(),[j,k]=t.useState(""),[_,N]=t.useState(""),[S,C]=t.useState(1),[L,M]=t.useState([]),[I,D]=t.useState(null),[P,R]=t.useState(!1),[O,q]=t.useState(!1),[$,A]=t.useState(!1),[z,U]=t.useState(!1),[B,E]=t.useState(!1),[F,K]=t.useState(null),[T,H]=t.useState(!1),[W,J]=t.useState(!1),[Q,V]=t.useState(!1),[Z,G]=t.useState(""),[Y,X]=t.useState(!1),[ee,te]=t.useState(""),[se,ae]=t.useState(null),[ne,re]=t.useState(!1),[oe,ie]=t.useState(!1);t.useRef(null);const[ce,le]=t.useState(!1);t.useRef(null),t.useRef(!1);const[de,ue]=t.useState(0),me=t.useRef(null),pe=t.useRef(null),he=sessionStorage.getItem("auth_token"),xe=JSON.parse(sessionStorage.getItem("user")||"{}"),ge=a.useRef(!1);t.useEffect(()=>{const e=e=>{if(!e.repeat)switch(e.key){case"F4":e.preventDefault(),U(!0);break;case"F5":e.preventDefault(),R(!0);break;case"F6":e.preventDefault(),q(!0);break;case"F7":e.preventDefault(),A(!0);break;case"F8":e.preventDefault(),L.length>0&&E(!0);break;case"Delete":e.preventDefault(),M(e=>{if(0===e.length)return e;const t=[...e];return t.splice(de??0,1),t}),ue(e=>Math.max(0,e-1));break;case"ArrowDown":L.length>0&&(e.preventDefault(),ue(e=>Math.min(L.length-1,(e??0)+1)));break;case"ArrowUp":L.length>0&&(e.preventDefault(),ue(e=>Math.max(0,(e??0)-1)));break;case"Enter":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),E(!0));break;case"d":case"D":e.altKey&&(e.preventDefault(),R(!0));break;case"l":case"L":e.altKey&&(e.preventDefault(),U(!0));break;case"p":case"P":e.altKey&&(e.preventDefault(),q(!0));break;case"r":case"R":e.altKey&&(e.preventDefault(),re(!0));break;case"q":case"Q":e.altKey&&(e.preventDefault(),A(!0));break;case"s":case"S":e.ctrlKey&&e.shiftKey&&(e.preventDefault(),me.current?.focus());break;case"k":case"K":e.ctrlKey&&e.shiftKey&&(e.preventDefault(),pe.current?.focus())}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[L.length,de]),t.useEffect(()=>{if(!ee){const e=xe?.businessId||xe?.business_id||"BIZ",t=(new Date).toISOString().replace(/[-:T.Z]/g,"").slice(0,14),s=Math.floor(1e3+9e3*Math.random());te(`T-${e.toString().padStart(2,"0")}-${t}-${s}`)}},[]),t.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("payment"),t=window.opener&&!window.opener.closed,s=async(s,a)=>{const n=localStorage.getItem(s);if("success"===e&&n)try{const e=JSON.parse(n);(async()=>{if(ge.current)return;const n=`${a.toLowerCase()}_finalize_done`;if("1"!==sessionStorage.getItem(n)){ge.current=!0,sessionStorage.setItem(n,"1");try{G("");const s={items:e.items||[],payment_type:a.toLowerCase(),money_received:e.total||null,transaction_id:e.transactionId||null,transaction_number:e.transactionNumber||null},n=await h("/api/sales/checkout",{method:"POST",headers:{Authorization:`Bearer ${he}`},body:JSON.stringify(s)});n?.transaction_number&&te(n.transaction_number),n?.transaction_id&&ae(n.transaction_id),M([]);try{const e=new URL(window.location.origin+"/receipt");n?.transaction_number&&e.searchParams.set("tn",n.transaction_number),n?.transaction_id&&e.searchParams.set("tid",String(n.transaction_id)),null!=n?.total&&e.searchParams.set("total",String(n.total)),t&&window.opener?(window.opener.location.href=e.toString(),window.close()):b(e.pathname+e.search)}catch(r){}}catch(o){G(`Failed to record ${a} payment`)}finally{if(localStorage.removeItem(s),!t){const e=new URL(window.location.href);e.searchParams.delete("payment"),window.history.replaceState({},"",e.toString())}}}})()}catch(r){localStorage.removeItem(s)}else if("cancel"===e&&n)if(localStorage.removeItem(s),t&&window.opener)window.close();else{const e=new URL(window.location.href);e.searchParams.delete("payment"),window.history.replaceState({},"",e.toString())}};s("pending_gcash_cart","GCash"),s("pending_maya_cart","Maya")},[]);const fe=async(e,t=1)=>{if(e&&!(t<1)){G("");try{const s=xe?.businessId||xe?.business_id||null,a=s?`/api/products/sku/${encodeURIComponent(e)}?business_id=${s}`:`/api/products/sku/${encodeURIComponent(e)}`,n=await h(a,{headers:{Authorization:`Bearer ${he}`}}),r=Number(n.selling_price||0),o=Number(n.stock_quantity??0);if(o<=0)return void G(`Stock for ${n.product_name} (SKU ${n.sku}) is 0.`);if(t>o)return void G(`Insufficient stock. Available: ${o}, requested: ${t}.`);M(e=>{const s=e.findIndex(e=>e.product_id===n.product_id);if(s>=0){const a=[...e],n=a[s].quantity+t;return n>o?(G(`Insufficient stock. Available: ${o}, requested: ${n}.`),e):(a[s]={...a[s],quantity:n},a)}return[...e,{product_id:n.product_id,sku:n.sku,name:n.product_name,quantity:t,price:r}]}),k(""),C(1),V(!1)}catch(s){G("Product not found")}}};t.useEffect(()=>{0===L.length?ue(0):ue(e=>Math.min(e??0,L.length-1))},[L.length]);const be=L.reduce((e,t)=>e+t.price*t.quantity,0),ye="percentage"===I?.type?Math.max(0,be-be*(Number(I.value||0)/100)):"amount"===I?.type?Math.max(0,be-Number(I.value||0)):be,we=async(e="cash",t=ye)=>{if(0!==L.length){G("");try{const a={transaction_id:se||null,transaction_number:ee||null,items:L.map(e=>({product_id:e.product_id,quantity:e.quantity})),payment_type:e,money_received:t,...I?.discount_id?{discount_id:I.discount_id}:"percentage"===I?.type?{discount_percentage:Number(I.value)}:"amount"===I?.type?{discount_amount:Number(I.value)}:{}},n=await h("/api/sales/checkout",{method:"POST",headers:{Authorization:`Bearer ${he}`},body:JSON.stringify(a)});n?.transaction_number&&te(n.transaction_number),n?.transaction_id&&ae(n.transaction_id),M([]);try{const e=new URL(window.location.origin+"/receipt");n?.transaction_number&&e.searchParams.set("tn",n.transaction_number),n?.transaction_id&&e.searchParams.set("tid",String(n.transaction_id)),null!=n?.total&&e.searchParams.set("total",String(n.total)),b(e.pathname+e.search)}catch(s){}const r=xe?.businessId||xe?.business_id||"BIZ",o=(new Date).toISOString().replace(/[-:T.Z]/g,"").slice(0,14),i=Math.floor(1e3+9e3*Math.random());te(`T-${r.toString().padStart(2,"0")}-${o}-${i}`),D(null),ae(null)}catch(a){G("Checkout failed")}}},ve=()=>{X(!1)},je=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>re(!0),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Recent Receipts (Alt+R)",children:e.jsx(y,{className:"w-5 h-5 text-gray-600"})}),e.jsx("button",{onClick:()=>ie(!0),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Profile",children:e.jsx(w,{className:"w-5 h-5 text-gray-600"})}),e.jsx("button",{onClick:()=>{X(!0)},className:"p-2 rounded-lg hover:bg-red-50 transition-colors",title:"Logout",children:e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h6a2 2 0 012 2v1"})})})]});return e.jsx("div",{className:"bg-white min-h-screen",children:e.jsxs("div",{className:"flex-1 flex flex-col min-h-screen",children:[e.jsxs("header",{className:"flex items-center gap-2 px-4 sm:px-6 py-3 bg-white/90 backdrop-blur-md shadow-md border-b border-gray-200/50 h-[64px] min-h-[64px] max-h-[64px] sticky top-0 z-30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl sm:text-2xl font-bold text-gray-900 tracking-tight",children:"POS"}),e.jsxs("span",{className:"text-xs sm:text-sm font-semibold text-blue-700 bg-blue-50 border border-blue-200 px-2 py-1 rounded-lg",children:["Cashier ID: ",xe?.userId||xe?.user_id||xe?.id||"N/A"]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-2",children:e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(xe.store_name)},title:"Copy store name",className:"inline-flex items-center gap-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg px-2.5 py-1.5 shadow-sm hover:bg-blue-100 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2M8 16h8a2 2 0 002-2v-6m-10 8l-2 2m2-2l2 2"})}),e.jsx("span",{className:"font-mono text-xs sm:text-sm md:text-base font-bold tracking-wider truncate max-w-[50vw]",children:xe.store_name})]})}),e.jsx("div",{className:"ml-auto",children:je})]}),e.jsxs("main",{className:"flex-1 bg-gradient-to-br from-gray-50/50 via-blue-50/30 to-indigo-50/50 overflow-y-auto p-2 sm:p-3 md:p-4 pb-55 lg:pb-4",children:[e.jsxs("div",{className:"grid gap-2 sm:gap-3 md:gap-4 h-full grid-cols-1 lg:grid-cols-12",children:[e.jsxs("div",{className:"lg:col-span-4 flex flex-col gap-2 sm:gap-3 md:gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(n,{onScan:async e=>{const t=e?.[0]?.rawValue;if(t)if(V(!0),O)N(t);else try{let e;try{e=JSON.parse(t)}catch(s){e=null}if(e&&"cart"===e.t&&Array.isArray(e.items)){e.transaction_id&&ae(e.transaction_id),e.transaction_number&&te(e.transaction_number);const t=e.items.map(e=>({product_id:e.p,quantity:e.q,sku:e.sku||""}));try{const e=await Promise.all(t.map(async e=>{const t=await h(`/api/products/${e.product_id}`,{headers:{Authorization:`Bearer ${he}`}});return{product_id:e.product_id,sku:t.sku||e.sku||"",name:t.product_name||"",price:Number(t.selling_price)||0,quantity:e.quantity}}));return void M(t=>{const s=new Map(t.map(e=>[e.product_id,e]));for(const a of e){const e=s.get(a.product_id);e?e.quantity+=a.quantity:s.set(a.product_id,{...a})}return Array.from(s.values())})}catch(a){return console.error("Error fetching product details for scanned cart:",a),void M(e=>{const s=new Map(e.map(e=>[e.product_id,e]));for(const a of t){const e=s.get(a.product_id);e?e.quantity+=a.quantity:s.set(a.product_id,{...a,name:"",price:0})}return Array.from(s.values())})}}await fe(t,1)}catch(a){console.error("Error processing scanned code:",a),await fe(t,1)}},paused:Q,onResume:()=>V(!1),textMain:"text-blue-700"})}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx(r,{ref:me,sku:j,setSku:k,quantity:S,setQuantity:C,handleAddToCart:async()=>{await fe(j,S)},quantityInputRef:pe}),Z&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-3 flex items-start gap-2 mt-3",children:[e.jsx("svg",{className:"w-4 h-4 text-red-500 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("p",{className:"text-sm font-medium text-red-700",children:(()=>{try{const e=JSON.parse(Z);return e.error||e.message||Z}catch{return Z}})()})]})]})]}),e.jsxs("div",{className:"lg:col-span-8 flex flex-col gap-2 sm:gap-3 min-h-0",children:[e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx(o,{cart:L,handleRemove:e=>M(L.filter((t,s)=>s!==e)),handleEditQuantity:(e,t)=>{M(s=>s.map((s,a)=>a===e?{...s,quantity:Math.max(1,t)}:s))},total:ye,subtotal:be,appliedDiscount:I,selectedIdx:de,onSelectRow:ue,className:"flex-1 h-full"})}),e.jsxs("div",{className:"grid grid-cols-12 gap-2 sm:gap-3 flex-shrink-0",children:[I&&e.jsxs("div",{className:"col-span-12 flex items-center justify-between bg-emerald-50 border border-emerald-200 text-emerald-800 rounded-lg px-3 py-2",children:[e.jsxs("span",{className:"text-sm font-semibold",children:["Discount applied: ",I.label]}),e.jsx("button",{className:"text-xs font-bold underline",onClick:()=>D(null),children:"Remove"})]}),e.jsx("div",{className:"col-span-8",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3",children:[e.jsx(p,{label:"CASH LEDGER (F4)",size:"md",className:"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold",variant:"secondary",microinteraction:!0,onClick:()=>U(!0),icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),iconPosition:"left"}),e.jsx(p,{label:"DISCOUNT (F5)",size:"md",className:"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold",onClick:()=>R(!0),variant:"secondary",microinteraction:!0,icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),iconPosition:"left"}),e.jsx(p,{label:"PRICE CHECK (F6)",size:"md",className:"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold",onClick:()=>q(!0),variant:"secondary",microinteraction:!0,icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),iconPosition:"left"}),e.jsx(p,{label:"SCAN CUSTOMER QR (F7)",size:"md",className:"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold",onClick:()=>A(!0),variant:"secondary",microinteraction:!0,icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),iconPosition:"left"})]})}),e.jsx("div",{className:"col-span-4",children:e.jsx(p,{label:"CHECKOUT (F8)",size:"md",className:"w-full h-full text-sm sm:text-base font-bold",variant:"primary",microinteraction:!0,onClick:()=>E(!0),disabled:0===L.length,icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),iconPosition:"left"})})]})]})]}),e.jsxs("div",{className:"mt-3 bg-white/80 border border-gray-200 rounded-xl shadow-sm px-3 py-2 text-[11px] sm:text-xs text-gray-700 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 sticky bottom-0",children:[e.jsx("span",{className:"font-semibold text-blue-700",children:"Keyboard Shortcuts"}),e.jsx("span",{children:"Ctrl+Shift+S: Focus SKU"}),e.jsx("span",{children:"Ctrl+Shift+K: Focus Qty"}),e.jsx("span",{children:"Alt+D: Discount"}),e.jsx("span",{children:"Alt+P: Price Check"}),e.jsx("span",{children:"Alt+L: Cash Ledger"}),e.jsx("span",{children:"Alt+Q: Scan Customer QR"}),e.jsx("span",{children:"Alt+R: Recent Receipts"}),e.jsx("span",{children:"Ctrl+Enter: Checkout"}),e.jsx("span",{children:"Delete: Remove selected item"}),e.jsx("span",{children:"Arrow Up/Down: Move selection"})]})]}),Y&&e.jsxs("div",{className:"fixed inset-0 z-90 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 z-90",onClick:ve}),e.jsxs("div",{className:"relative bg-white rounded-xl shadow-xl w-[92%] max-w-md z-100 p-0",children:[e.jsx("div",{className:"bg-gradient-to-r from-red-50 via-red-50/80 to-orange-50/50 border-b border-red-100 px-6 py-5 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"white",viewBox:"0 0 24 24",children:e.jsx("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"Confirm Logout"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Are you sure you want to log out?"})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-6",children:"You will be redirected to the login page and your session will end."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:ve,className:"px-5 py-2.5 rounded-lg text-sm font-semibold text-gray-700 bg-white border-2 border-gray-300 hover:bg-gray-50 hover:border-gray-400 transition-all duration-200",children:"Cancel"}),e.jsxs("button",{onClick:()=>{sessionStorage.removeItem("auth_token"),sessionStorage.removeItem("user"),X(!1),b("/")},className:"px-5 py-2.5 rounded-lg text-sm font-semibold text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 shadow-md hover:shadow-lg transition-all duration-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Logout"]})]})]})]})]}),e.jsx(i,{isOpen:P,onClose:()=>R(!1),onApplyDiscount:e=>{D(e),R(!1)}}),e.jsx(c,{isOpen:O,onClose:()=>q(!1),sku:_,setSku:N}),e.jsx(l,{isOpen:z,onClose:()=>U(!1)}),e.jsx(d,{isOpen:B,onClose:()=>E(!1),total:ye,onSelectPayment:e=>{K(e),E(!1),"cash"===e?H(!0):"gcash"===e?(async()=>{try{const e=window.location.origin+"/pos?payment=success",t=window.location.origin+"/pos?payment=cancel";localStorage.setItem("pending_gcash_cart",JSON.stringify({items:L.map(e=>({product_id:e.product_id,quantity:e.quantity})),total:ye,transactionId:se,transactionNumber:ee}));const{checkoutUrl:s}=await x({amount:Number(ye||0),description:"POS Order",referenceNumber:ee||`POS-${Date.now()}`,cancelUrl:t,successUrl:e});window.open(s,"_blank")}catch(e){G("Failed to init GCash"),localStorage.removeItem("pending_gcash_cart")}})():"maya"===e?(async()=>{try{const e=window.location.origin+"/pos?payment=success",t=window.location.origin+"/pos?payment=cancel";localStorage.setItem("pending_maya_cart",JSON.stringify({items:L.map(e=>({product_id:e.product_id,quantity:e.quantity})),total:ye,transactionId:se,transactionNumber:ee}));const{checkoutUrl:s}=await g({amount:Number(ye||0),description:"POS Order",referenceNumber:ee||`POS-${Date.now()}`,cancelUrl:t,successUrl:e});window.open(s,"_blank")}catch(e){G("Failed to init Maya"),localStorage.removeItem("pending_maya_cart")}})():we(e)}}),e.jsx(u,{isOpen:T,onClose:()=>H(!1),total:ye,onConfirm:e=>{we("cash",e),H(!1)}}),e.jsx(m,{isOpen:$,onClose:()=>A(!1),onImport:async(e,t,s)=>{try{if(s&&t)return M([]),ae(null),te(null),G(""),A(!1),void(window.location.href=`/receipt?tn=${s.transaction_number||t}`);if(!e||0===e.length)return void G("No items found in QR code");console.log("Scanned items:",e);const a=await Promise.all(e.map(async e=>{const t=await h(`/api/products/${e.product_id}`,{headers:{Authorization:`Bearer ${he}`}});return console.log("Fetched product for id",e.product_id,":",t),{product_id:e.product_id,sku:t.sku||e.sku||"",name:t.product_name||"",price:Number(t.selling_price)||0,quantity:e.quantity}}));M(e=>{const t=new Map(e.map(e=>[e.sku,e]));for(const s of a){const e=t.get(s.sku);e?e.quantity+=s.quantity:t.set(s.sku,{...s})}return Array.from(t.values())})}catch(a){console.error("Error fetching products for scanned items:",a),M(t=>{const s=new Map(t.map(e=>[e.sku,e]));for(const a of e){const e=s.get(a.sku);e?e.quantity+=a.quantity:s.set(a.sku,{...a})}return Array.from(s.values())})}}}),e.jsx(v,{isOpen:ne,onClose:()=>re(!1)}),e.jsx(f,{isOpen:oe,onClose:()=>ie(!1)})]})})}export{j as default};
//# sourceMappingURL=CashierPOS-CeOfV6pc.js.map
