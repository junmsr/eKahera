import{j as e}from"./utils-B2FtDWBX.js";import{g as t,a}from"./vendor-mHQTfcnf.js";import{b as r}from"./index-C9q1jg2T.js";import{r as s,k as n}from"./qr-CE9N9WuW.js";const i=t(s());function o({onScan:t,paused:s,onResume:o,textMain:l="text-blue-800",className:c="",modalContext:d=!1,...u}){const[m,f]=a.useState("environment"),[h,x]=a.useState(null),[b,g]=a.useState(""),[v,p]=a.useState(!d),[w,y]=a.useState(!1),[j,S]=a.useState(!1),[N,k]=a.useState([]),[C,_]=a.useState(!1),E=a.useRef(null),[z,T]=a.useState(0),[P,R]=a.useState([]),[A,M]=a.useState(!1),[D,I]=a.useState(""),[V,L]=a.useState(!1),[B,O]=a.useState(!1),U=a.useRef(null),[W,q]=a.useState(!1),[Q,$]=a.useState(""),[F,H]=a.useState(0);a.useEffect(()=>{d&&!W||(async()=>{try{try{const e=await navigator.permissions.query({name:"camera"});if(x("granted"===e.state),"denied"===e.state)return g("Camera access denied. Please enable camera permissions in your browser settings."),void p(!1);e.addEventListener("change",()=>{x("granted"===e.state),"denied"===e.state?g("Camera access denied. Please enable camera permissions in your browser settings."):g("")})}catch(e){console.log("Permissions API not supported, attempting camera access...")}try{const e=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind);if(console.log("Available cameras:",e.length),k(e),_(e.length>1),0===e.length)return g("No camera found. Please connect a camera."),void p(!1)}catch(t){console.log("Could not enumerate devices, will try direct access...")}setTimeout(()=>{p(!1)},500)}catch(a){console.error("Permission check error:",a),p(!1)}})()},[d,W]),a.useEffect(()=>{d&&!W&&q(!0)},[d,W]),a.useEffect(()=>{S(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))},[]),a.useEffect(()=>{E.current=new(window.AudioContext||window.webkitAudioContext)},[]);const K=()=>{if(E.current){const e=E.current.createOscillator(),t=E.current.createGain();e.connect(t),t.connect(E.current.destination),e.frequency.setValueAtTime(800,E.current.currentTime),t.gain.setValueAtTime(.3,E.current.currentTime),e.start(),e.stop(E.current.currentTime+.1)}},G=()=>{j&&"vibrate"in navigator&&navigator.vibrate(100)};a.useEffect(()=>{const e=e=>{if("INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName||s)return;const a=Date.now();if($(a-F>100?e.key:t=>t+e.key),H(a),"Enter"===e.key){e.preventDefault();const a=Q.trim();a&&(console.log("USB Scanner detected:",a),K(),G(),R(e=>[a,...e.filter(e=>e!==a)].slice(0,5)),t([{rawValue:a}])),$("")}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s,F,Q,t,K,G]);a.useEffect(()=>()=>{B&&(i.offDetected(),i.offProcessed(),i.stop())},[B]);return e.jsx("div",{className:`flex-shrink-0 bg-white/80 backdrop-blur-md border border-white/60 shadow-xl hover:shadow-2xl transition-all duration-300 overflow-hidden ${c}`,children:e.jsxs("div",{className:"flex flex-col h-full p-1 sm:p-2",children:[e.jsxs("div",{className:`w-full text-center mb-1 font-bold text-xs tracking-wide ${l} flex items-center justify-center gap-1`,children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),"SCAN QR & BARCODE"]}),e.jsxs("div",{className:"w-full flex-1 bg-gradient-to-br from-blue-50/80 via-indigo-50/60 to-blue-100/80 rounded-xl flex items-center justify-center border-2 border-blue-200/50 shadow-inner overflow-hidden relative z-0 group",children:[v?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"Initializing camera..."})]})}):b?e.jsx("div",{className:"flex items-center justify-center h-full text-red-500 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Camera Error"}),e.jsx("p",{className:"text-xs",children:b}),e.jsx(r,{label:"Retry",size:"sm",variant:"secondary",className:"mt-2",onClick:()=>{g(""),T(0),p(!0),f(e=>"user"===e?"environment":"user"),setTimeout(()=>p(!1),1e3)},microinteraction:!0})]})}):V?e.jsxs("div",{className:"w-full h-full relative",children:[e.jsx("div",{ref:U,className:"w-full h-full rounded-xl overflow-hidden"}),!B&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20",children:e.jsx(r,{label:"Start Advanced Scanner",size:"sm",variant:"primary",onClick:async()=>{if(!B)try{await i.init({inputStream:{name:"Live",type:"LiveStream",target:U.current,constraints:{facingMode:"environment"===m?"environment":"user",width:{min:640,ideal:1920},height:{min:480,ideal:1080}}},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:2,decoder:{readers:["code_128_reader","ean_reader","ean_8_reader","code_39_reader","code_39_vin_reader","codabar_reader","upc_reader","upc_e_reader","i2of5_reader","2of5_reader","code_93_reader"]},locate:!0}),i.onDetected(e=>{if(e&&e.codeResult){const a=e.codeResult.code;console.log("Quagga detected:",a),K(),G(),R(e=>[a,...e.filter(e=>e!==a)].slice(0,5)),t([{rawValue:a}])}}),i.onProcessed(e=>{const t=i.canvas.ctx.overlay,a=i.canvas.dom.overlay;e&&(e.boxes&&(t.clearRect(0,0,parseInt(a.getAttribute("width")),parseInt(a.getAttribute("height"))),e.boxes.filter(t=>t!==e.box).forEach(e=>{i.ImageDebug.drawPath(e,{x:0,y:1},t,{color:"green",lineWidth:2})})),e.box&&i.ImageDebug.drawPath(e.box,{x:0,y:1},t,{color:"#00F",lineWidth:2}),e.codeResult&&e.codeResult.code&&i.ImageDebug.drawPath(e.line,{x:"x",y:"y"},t,{color:"red",lineWidth:3}))}),await i.start(),O(!0),console.log("Quagga scanner initialized")}catch(e){console.error("Quagga initialization failed:",e),g("Advanced scanner initialization failed. Using fallback scanner.")}},microinteraction:!0})})]}):e.jsx(n,{onScan:e=>{if(console.log("Scanner result:",e),e&&e.length>0){const a=e[0]?.rawValue;console.log("Detected code:",a),a&&(K(),G(),R(e=>[a,...e.filter(e=>e!==a)].slice(0,5)),t(e))}},onError:e=>{console.error("Scanner error:",e);let t="Scanner error occurred",a=!1;if("NotAllowedError"===e.name)t="Camera access denied. Please allow camera access and refresh the page.",x(!1);else if("NotFoundError"===e.name)t="No camera found. Please connect a camera and refresh the page.";else if("NotReadableError"===e.name)t="Camera is being used by another application.";else if("OverconstrainedError"===e.name){if(z<2){T(e=>e+1);return f("user"===m?"environment":"user"),g(""),p(!0),void setTimeout(()=>p(!1),1e3)}t="Camera constraints not supported. Trying without constraints...",f(null),a=!0}else"SecurityError"===e.name?t="Camera access blocked. Please use HTTPS or localhost.":z<2&&(T(e=>e+1),a=!0);if(a&&z<2)return p(!0),void setTimeout(()=>{p(!1),g("")},1e3);g(t),setTimeout(()=>{g(""),p(!0),setTimeout(()=>p(!1),1e3)},3e3)},paused:s,constraints:null!==m?{facingMode:m,width:{ideal:1920,min:640},height:{ideal:1080,min:480},frameRate:{ideal:30,min:15}}:{width:{ideal:1920,min:640},height:{ideal:1080,min:480},frameRate:{ideal:30,min:15}},scanDelay:50,area:{top:"5%",right:"5%",bottom:"5%",left:"5%"},styles:{container:{width:"100%",height:"100%",borderRadius:"1rem",overflow:"visible"},video:{width:"100%",height:"100%",objectFit:"contain",borderRadius:"1rem",backgroundColor:"black"}},classNames:{container:"w-full h-full"},formats:["qr_code","code_128","code_39","ean_13","ean_8","upc_a","upc_e","itf","codabar","data_matrix","pdf417"],inversionAttempts:"attemptBoth",multiple:"true"}),!b&&!v&&s&&e.jsxs("div",{className:"absolute bottom-2 right-2 z-10 flex gap-2",children:[e.jsx(r,{label:"Resume",size:"sm",variant:"secondary",onClick:o,microinteraction:!0}),j&&C&&e.jsx(r,{label:"user"===m?"ðŸ“·":"ðŸ“±",size:"sm",variant:"secondary",onClick:()=>{f(e=>"user"===e?"environment":"user"),p(!0),setTimeout(()=>p(!1),1e3)},microinteraction:!0,title:"user"===m?"Switch to back camera":"Switch to front camera"}),j&&e.jsx(r,{label:w?"ðŸ”¦":"ðŸ’¡",size:"sm",variant:"secondary",onClick:()=>y(!w),microinteraction:!0,title:w?"Turn off flashlight":"Turn on flashlight"}),e.jsx(r,{label:"âŒ¨ï¸",size:"sm",variant:"secondary",onClick:()=>M(!A),microinteraction:!0,title:"Manual input"}),e.jsx(r,{label:V?"ðŸ”„":"âš¡",size:"sm",variant:"secondary",onClick:()=>{V&&B&&(i.stop(),O(!1)),L(!V),p(!0),setTimeout(()=>p(!1),1e3)},microinteraction:!0,title:V?"Switch to standard scanner":"Switch to advanced scanner"})]}),A&&e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-20",children:e.jsxs("div",{className:"bg-white rounded-xl p-4 w-80 max-w-[90vw]",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-center",children:"Manual SKU Input"}),e.jsx("input",{type:"text",value:D,onChange:e=>I(e.target.value),placeholder:"Enter SKU or barcode",className:"w-full p-3 border border-gray-300 rounded-lg mb-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:e=>{"Enter"===e.key&&D.trim()&&(t([{rawValue:D.trim()}]),I(""),M(!1),K(),G())}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{label:"Cancel",size:"sm",variant:"secondary",onClick:()=>{M(!1),I("")},className:"flex-1"}),e.jsx(r,{label:"Submit",size:"sm",variant:"primary",onClick:()=>{D.trim()&&(t([{rawValue:D.trim()}]),I(""),M(!1),K(),G())},className:"flex-1"})]})]})}),P.length>0&&!b&&!v&&s&&e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg p-2 max-w-32",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"Recent:"}),e.jsx("div",{className:"space-y-1",children:P.slice(0,3).map((a,r)=>e.jsx("button",{onClick:()=>{t([{rawValue:a}]),K(),G()},className:"block w-full text-left text-xs text-blue-600 hover:text-blue-800 truncate",title:`Scan ${a}`,children:a.length>10?`${a.substring(0,10)}...`:a},r))})]})})]})]})})}export{o as S};
//# sourceMappingURL=ScannerCard-CU2Pf-JL.js.map
