{"version":3,"file":"CashierPOS-C-6M6C41.js","sources":["../../../frontend/src/components/modals/RecentReceiptsModal.jsx","../../../frontend/src/pages/CashierPOS.jsx"],"sourcesContent":["import React, { useEffect, useState, useCallback, useRef } from \"react\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport Button from \"../common/Button\";\r\nimport { api } from \"../../lib/api\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nfunction RecentReceiptsModal({ isOpen, onClose }) {\r\n  const [receipts, setReceipts] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [selectedIndex, setSelectedIndex] = useState(0);\r\n  const containerRef = useRef(null);\r\n  const modalContentRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    const fetchReceipts = async () => {\r\n      setLoading(true);\r\n      setError(\"\");\r\n      try {\r\n        const token = sessionStorage.getItem(\"auth_token\");\r\n        const data = await api(\"/api/sales/cashier/recent\", {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        setReceipts(Array.isArray(data) ? data : []);\r\n      } catch (e) {\r\n        setError(\"Failed to load receipts\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchReceipts();\r\n  }, [isOpen]);\r\n\r\n  const openReceipt = (receipt) => {\r\n    const url = new URL(window.location.origin + \"/receipt\");\r\n    if (receipt.transaction_number)\r\n      url.searchParams.set(\"tn\", receipt.transaction_number);\r\n    if (receipt.transaction_id)\r\n      url.searchParams.set(\"tid\", String(receipt.transaction_id));\r\n    window.open(url.toString(), \"_blank\");\r\n  };\r\n\r\n  const openReceiptByIndex = useCallback((index) => {\r\n    if (!receipts[index]) return;\r\n    openReceipt(receipts[index]);\r\n  }, [receipts]);\r\n\r\n  const handleKeyDown = useCallback((e) => {\r\n    if (!isOpen || !receipts.length) return;\r\n    e.preventDefault();\r\n\r\n    switch (e.key) {\r\n      case 'ArrowUp': {\r\n        setSelectedIndex(prev => {\r\n          const newIndex = prev <= 0 ? receipts.length - 1 : prev - 1;\r\n          // Use setTimeout to ensure state update is complete before focusing\r\n          setTimeout(() => {\r\n            const items = containerRef.current?.querySelectorAll('button');\r\n            if (items?.[newIndex]) {\r\n              items[newIndex].focus({ preventScroll: true });\r\n            }\r\n          }, 0);\r\n          return newIndex;\r\n        });\r\n        break;\r\n      }\r\n      case 'ArrowDown': {\r\n        setSelectedIndex(prev => {\r\n          const newIndex = prev >= receipts.length - 1 ? 0 : prev + 1;\r\n          // Use setTimeout to ensure state update is complete before focusing\r\n          setTimeout(() => {\r\n            const items = containerRef.current?.querySelectorAll('button');\r\n            if (items?.[newIndex]) {\r\n              items[newIndex].focus({ preventScroll: true });\r\n            }\r\n          }, 0);\r\n          return newIndex;\r\n        });\r\n        break;\r\n      }\r\n      case 'Enter':\r\n        e.preventDefault();\r\n        if (receipts[selectedIndex]) {\r\n          openReceipt(receipts[selectedIndex]);\r\n        }\r\n        break;\r\n      case 'Escape':\r\n        onClose();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }, [isOpen, receipts, selectedIndex, onClose, openReceipt]);\r\n\r\n  // Reset selected index when modal opens or receipts change\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setSelectedIndex(0);\r\n      // Focus the container when it opens\r\n      if (containerRef.current) {\r\n        containerRef.current.focus({ preventScroll: true });\r\n      }\r\n    }\r\n  }, [isOpen, receipts]);\r\n\r\n  // Scroll to selected item when it changes\r\n  useEffect(() => {\r\n    if (containerRef.current && selectedIndex >= 0) {\r\n      const container = containerRef.current;\r\n      const selectedElement = container.children[selectedIndex];\r\n      \r\n      if (selectedElement) {\r\n        const containerRect = container.getBoundingClientRect();\r\n        const elementRect = selectedElement.getBoundingClientRect();\r\n        \r\n        // Check if element is out of view\r\n        if (elementRect.top < containerRect.top) {\r\n          // Scroll up if element is above viewport\r\n          container.scrollBy(0, elementRect.top - containerRect.top - 10);\r\n        } else if (elementRect.bottom > containerRect.bottom) {\r\n          // Scroll down if element is below viewport\r\n          container.scrollBy(0, elementRect.bottom - containerRect.bottom + 10);\r\n        }\r\n      }\r\n    }\r\n  }, [selectedIndex]);\r\n\r\n  // Use direct event listeners for better reliability\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    \r\n    const handleKeyDownEvent = (e) => {\r\n      if (['ArrowUp', 'ArrowDown', 'Enter', 'Escape'].includes(e.key)) {\r\n        e.preventDefault();\r\n        handleKeyDown(e);\r\n      }\r\n    };\r\n\r\n    const container = containerRef.current;\r\n    if (container) {\r\n      container.addEventListener('keydown', handleKeyDownEvent);\r\n      // Focus the container when modal opens\r\n      container.focus({ preventScroll: true });\r\n      return () => {\r\n        container.removeEventListener('keydown', handleKeyDownEvent);\r\n      };\r\n    }\r\n  }, [isOpen, handleKeyDown]);\r\n\r\n  // Remove useKeyboardShortcuts to prevent duplicate event handling\r\n  // The direct event listener on the container is sufficient\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Recent Receipts\"\r\n      subtitle=\"Latest transactions handled by you\"\r\n      size=\"lg\"\r\n      contentRef={modalContentRef}\r\n      footer={\r\n        <Button\r\n          label=\"Close (Esc)\"\r\n          variant=\"secondary\"\r\n          onClick={onClose}\r\n          className=\"w-full\"\r\n        />\r\n      }\r\n    >\r\n      {loading && (\r\n        <div className=\"text-sm text-gray-600 py-4 text-center\">\r\n          Loading receipts...\r\n        </div>\r\n      )}\r\n      {error && (\r\n        <div className=\"text-sm text-red-600 bg-red-50 border border-red-100 rounded-lg px-3 py-2 mb-2\">\r\n          {error}\r\n        </div>\r\n      )}\r\n      {!loading && !error && receipts.length === 0 && (\r\n        <div className=\"text-sm text-gray-500 py-6 text-center\">\r\n          No receipts found.\r\n        </div>\r\n      )}\r\n      <div \r\n        className=\"space-y-2 max-h-[60vh] overflow-y-auto outline-none focus:outline-none\" \r\n        ref={containerRef}\r\n        tabIndex=\"0\"\r\n        role=\"listbox\"\r\n        aria-label=\"Recent receipts\"\r\n      >\r\n        {receipts.map((r, idx) => (\r\n          <button\r\n            key={`${r.transaction_id}-${r.transaction_number}`}\r\n            onClick={() => openReceipt(r)}\r\n            className={`w-full text-left border rounded-xl px-3 py-2 transition-all duration-200 ${\r\n              selectedIndex === idx \r\n                ? 'border-blue-500 bg-blue-50 ring-2 ring-blue-200 scale-[1.01] shadow-sm' \r\n                : 'border-gray-200 hover:border-blue-300 hover:bg-blue-50'\r\n            }`}\r\n            onFocus={() => setSelectedIndex(idx)}\r\n            role=\"option\"\r\n            aria-selected={selectedIndex === idx}\r\n            tabIndex=\"-1\"\r\n          >\r\n            <div className=\"flex justify-between items-center\">\r\n              <div>\r\n                <p className=\"text-sm font-semibold text-gray-900\">\r\n                  {r.transaction_number || \"Txn\"}\r\n                </p>\r\n                <p className=\"text-xs text-gray-600\">\r\n                  {new Date(r.updated_at || r.created_at).toLocaleString()}\r\n                </p>\r\n              </div>\r\n              <div className=\"text-right\">\r\n                <p className=\"text-sm font-bold text-blue-700\">\r\n                  ₱{Number(r.total_amount || r.total || 0).toFixed(2)}\r\n                </p>\r\n                <p className=\"text-[11px] text-gray-600 uppercase\">\r\n                  {r.payment?.method || r.payment_type || 'cash'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            {(r.discount_percentage || r.discount_amount) && (\r\n              <p className=\"text-[11px] text-emerald-700 mt-1\">\r\n                Discount applied{\" \"}\r\n                {r.discount_percentage\r\n                  ? `${r.discount_percentage}%`\r\n                  : `₱${Number(r.discount_amount || 0).toFixed(2)}`}\r\n              </p>\r\n            )}\r\n          </button>\r\n        ))}\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default RecentReceiptsModal;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import React, { useState, useRef, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport ScannerCard from \"../components/ui/POS/ScannerCard\";\nimport SkuFormCard from \"../components/ui/POS/SkuFormCard\";\nimport CartTableCard from \"../components/ui/POS/CartTableCard\";\nimport Button from \"../components/common/Button\";\nimport { api, createGcashCheckout, createMayaCheckout } from \"../lib/api\";\nimport PriceCheckModal from \"../components/modals/PriceCheckModal\";\nimport DiscountModal from \"../components/modals/DiscountModal\";\nimport CashLedgerModal from \"../components/modals/CashLedgerModal\";\nimport CheckoutModal from \"../components/modals/CheckoutModal\";\nimport CashPaymentModal from \"../components/modals/CashPaymentModal\";\nimport ScanCustomerCartModal from \"../components/modals/ScanCustomerCartModal\";\nimport ChangePasswordModal from \"../components/modals/ChangePasswordModal\";\nimport RecentReceiptsModal from \"../components/modals/RecentReceiptsModal\";\nimport { BiReceipt, BiUser } from \"react-icons/bi\";\nimport { useKeyboardShortcuts } from \"../hooks/useKeyboardShortcuts\";\n\nconst ButtonLabel = ({ text, shortcut, variant = \"secondary\" }) => (\n  <div className=\"flex items-center gap-2\">\n    <span>{text}</span>\n    <span className={`hidden sm:inline-block text-xs font-bold px-1.5 py-0.5 rounded border ${\n      variant === \"primary\" \n        ? \"bg-white/20 border-white/40 text-white\" \n        : \"bg-gray-100 border-gray-300 text-gray-600\"\n    }`}>\n      {shortcut}\n    </span>\n  </div>\n);\n\nfunction CashierPOS() {\n  const navigate = useNavigate();\n\n  const [sku, setSku] = useState(\"\");\n  const [priceCheckSku, setPriceCheckSku] = useState(\"\");\n  const [quantity, setQuantity] = useState(1);\n  const [cart, setCart] = useState([]);\n  const [appliedDiscount, setAppliedDiscount] = useState(null);\n  const [showDiscount, setShowDiscount] = useState(false);\n  const [showPriceCheck, setShowPriceCheck] = useState(false);\n  const [showImportCart, setShowImportCart] = useState(false);\n  const [showCashLedger, setShowCashLedger] = useState(false);\n  const [showCheckout, setShowCheckout] = useState(false);\n  const [selectedPayment, setSelectedPayment] = useState(null);\n  const [showCashModal, setShowCashModal] = useState(false);\n  const [darkMode, setDarkMode] = useState(false);\n  const [scannerPaused, setScannerPaused] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [showLogoutConfirm, setShowLogoutConfirm] = useState(false);\n  const [transactionNumber, setTransactionNumber] = useState(\"\");\n  const [transactionId, setTransactionId] = useState(null);\n  \n  // Auto-clear error message after 5 seconds\n  useEffect(() => {\n    if (error) {\n      const timer = setTimeout(() => {\n        setError(\"\");\n      }, 5000);\n      return () => clearTimeout(timer);\n    }\n  }, [error]);\n  const [showReceipts, setShowReceipts] = useState(false);\n  const [showChangePasswordModal, setShowChangePasswordModal] = useState(false);\n  const notificationRef = useRef(null);\n  const [isMobileNavOpen, setIsMobileNavOpen] = useState(false);\n  const touchStartXRef = useRef(null);\n  const touchActiveRef = useRef(false);\n  const [selectedCartIdx, setSelectedCartIdx] = useState(0);\n  const [editingCartItem, setEditingCartItem] = useState(null);\n  const [editQty, setEditQty] = useState('1');\n  \n  // Set editing cart item and initialize quantity\n  const setSelectedCartItem = (idx) => {\n    setSelectedCartIdx(idx);\n    if (idx >= 0 && idx < cart.length) {\n      setEditQty(String(cart[idx].quantity));\n    }\n  };\n  const skuInputRef = useRef(null);\n  const quantityInputRef = useRef(null);\n  const [currentTime, setCurrentTime] = useState(new Date());\n\n  useEffect(() => {\n    const timer = setInterval(() => setCurrentTime(new Date()), 1000);\n    return () => clearInterval(timer);\n  }, []);\n\n  // Auto-focus SKU input on initial mount\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      skuInputRef.current?.focus();\n    }, 300);\n    return () => clearTimeout(timer);\n  }, []);\n\n  const token = sessionStorage.getItem(\"auth_token\");\n  const user = JSON.parse(sessionStorage.getItem(\"user\") || \"{}\");\n  const hasFinalizedRef = React.useRef(false);\n\n  // Generate a client-side provisional transaction number when POS opens\n  useEffect(() => {\n    if (!transactionNumber) {\n      const businessId = user?.businessId || user?.business_id || \"BIZ\";\n      const timePart = new Date()\n        .toISOString()\n        .replace(/[-:T.Z]/g, \"\")\n        .slice(0, 14);\n      const randPart = Math.floor(1000 + Math.random() * 9000);\n      setTransactionNumber(\n        `T-${businessId.toString().padStart(2, \"0\")}-${timePart}-${randPart}`\n      );\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const status = params.get(\"payment\");\n    \n    // Check if we're in a new tab (opened from payment)\n    const isNewTab = window.opener && !window.opener.closed;\n\n    const finalizeOnlinePayment = async (pendingCartKey, paymentType) => {\n      const pending = localStorage.getItem(pendingCartKey);\n      if (status === \"success\" && pending) {\n        try {\n          const parsed = JSON.parse(pending);\n          // finalize checkout using saved items\n          (async () => {\n            if (hasFinalizedRef.current) return;\n            const guardKey = `${paymentType.toLowerCase()}_finalize_done`;\n            if (sessionStorage.getItem(guardKey) === \"1\") return;\n            hasFinalizedRef.current = true;\n            sessionStorage.setItem(guardKey, \"1\");\n            try {\n              setError(\"\");\n              const body = {\n                items: parsed.items || [],\n                payment_type: paymentType.toLowerCase(),\n                money_received: parsed.total || null,\n                transaction_id: parsed.transactionId || null,\n                transaction_number: parsed.transactionNumber || null,\n                discount_id: parsed.discount_id || null,\n                discount_percentage: parsed.discount_percentage || null,\n                discount_amount: parsed.discount_amount || null,\n              };\n              const resp = await api(\"/api/sales/checkout\", {\n                method: \"POST\",\n                headers: { Authorization: `Bearer ${token}` },\n                body: JSON.stringify(body),\n              });\n              if (resp?.transaction_number)\n                setTransactionNumber(resp.transaction_number);\n              if (resp?.transaction_id) setTransactionId(resp.transaction_id);\n              setCart([]);\n              try {\n                const url = new URL(window.location.origin + \"/receipt\");\n                if (resp?.transaction_number)\n                  url.searchParams.set(\"tn\", resp.transaction_number);\n                if (resp?.transaction_id)\n                  url.searchParams.set(\"tid\", String(resp.transaction_id));\n                if (resp?.total != null)\n                  url.searchParams.set(\"total\", String(resp.total));\n                \n                // If in new tab, redirect opener and close this tab\n                if (isNewTab && window.opener) {\n                  window.opener.location.href = url.toString();\n                  window.close();\n                } else {\n                  navigate(url.pathname + url.search);\n                }\n              } catch (_) {}\n            } catch (e) {\n              setError(`Failed to record ${paymentType} payment`);\n            } finally {\n              localStorage.removeItem(pendingCartKey);\n              if (!isNewTab) {\n                // remove query param\n                const url = new URL(window.location.href);\n                url.searchParams.delete(\"payment\");\n                window.history.replaceState({}, \"\", url.toString());\n              }\n            }\n          })();\n        } catch (_) {\n          localStorage.removeItem(pendingCartKey);\n        }\n      } else if (status === \"cancel\" && pending) {\n        localStorage.removeItem(pendingCartKey);\n        // If in new tab, close it; otherwise just clean up URL\n        if (isNewTab && window.opener) {\n          window.close();\n        } else {\n          const url = new URL(window.location.href);\n          url.searchParams.delete(\"payment\");\n          window.history.replaceState({}, \"\", url.toString());\n        }\n      }\n    };\n\n    finalizeOnlinePayment(\"pending_gcash_cart\", \"GCash\");\n    finalizeOnlinePayment(\"pending_maya_cart\", \"Maya\");\n  }, []);\n\n  const addSkuToCart = async (skuValue, qty = 1) => {\n    if (!skuValue || qty < 1) return;\n    setError(\"\");\n    try {\n      const businessId = user?.businessId || user?.business_id || null;\n      const url = businessId\n        ? `/api/products/sku/${encodeURIComponent(\n            skuValue\n          )}?business_id=${businessId}`\n        : `/api/products/sku/${encodeURIComponent(skuValue)}`;\n\n      const product = await api(url, {\n        headers: { Authorization: `Bearer ${token}` },\n      });\n      const price = Number(product.selling_price || 0);\n      const stockQty = Number(product.stock_quantity ?? 0);\n      if (stockQty <= 0) {\n        setError(\n          `Stock for ${product.product_name} (SKU ${product.sku}) is 0.`\n        );\n        return;\n      }\n      if (qty > stockQty) {\n        setError(\n          `Insufficient stock. Available: ${stockQty}, requested: ${qty}.`\n        );\n        return;\n      }\n      setCart((prev) => {\n        const existingIdx = prev.findIndex(\n          (i) => i.product_id === product.product_id\n        );\n        if (existingIdx >= 0) {\n          const next = [...prev];\n          const newQty = next[existingIdx].quantity + qty;\n          if (newQty > stockQty) {\n            setError(\n              `Insufficient stock. Available: ${stockQty}, requested: ${newQty}.`\n            );\n            return prev;\n          }\n          next[existingIdx] = { ...next[existingIdx], quantity: newQty };\n          return next;\n        }\n        return [\n          ...prev,\n          {\n            product_id: product.product_id,\n            sku: product.sku,\n            name: product.product_name,\n            quantity: qty,\n            price,\n          },\n        ];\n      });\n      setSku(\"\");\n      setQuantity(1);\n      // Auto-focus SKU input after adding item for next scan\n      setTimeout(() => {\n        skuInputRef.current?.focus();\n      }, 50);\n    } catch (err) {\n      setError(\"Product not found\");\n    } finally {\n      // Always resume scanner after processing, even on error\n      setTimeout(() => {\n        setScannerPaused(false);\n      }, 300);\n    }\n  };\n\n  const handleAddToCart = async () => {\n    await addSkuToCart(sku, quantity);\n  };\n\n  const handleRemove = (idx) => {\n    if (idx >= 0 && idx < cart.length) {\n      setCart(cart.filter((_, i) => i !== idx));\n    }\n  };\n  const handleEditQuantity = (idx, qty) => {\n    const newQty = qty === '' ? 1 : Math.max(1, Number(qty) || 1);\n    setCart((prev) =>\n      prev.map((item, i) =>\n        i === idx ? { ...item, quantity: newQty } : item\n      )\n    );\n    setEditQty(newQty); // Keep editQty in sync\n    setEditingCartItem(null);\n  };\n  \n  // Handle edit quantity change\n  const handleEditQtyChange = (value) => {\n    setEditQty(value);\n  };\n\n  // Handler for increment quantity (=)\n  const handleIncrementQuantity = () => {\n    if (cart.length === 0 || selectedCartIdx < 0 || selectedCartIdx >= cart.length) return;\n    const item = cart[selectedCartIdx];\n    if (!item) return;\n    const currentQty = item.quantity;\n    const newQty = currentQty + 1;\n    setCart((prev) =>\n      prev.map((cartItem, i) =>\n        i === selectedCartIdx ? { ...cartItem, quantity: newQty } : cartItem\n      )\n    );\n  };\n\n  // Handler for decrement quantity (-)\n  const handleDecrementQuantity = () => {\n    if (cart.length === 0 || selectedCartIdx < 0 || selectedCartIdx >= cart.length) return;\n    const item = cart[selectedCartIdx];\n    if (!item) return;\n    const currentQty = item.quantity;\n    if (currentQty <= 1) return; // Don't allow going below 1\n    const newQty = currentQty - 1;\n    setCart((prev) =>\n      prev.map((cartItem, i) =>\n        i === selectedCartIdx ? { ...cartItem, quantity: newQty } : cartItem\n      )\n    );\n  };\n\n  // Handle keyboard navigation for cart items\n  useEffect(() => {\n    const handleKeyDown = (e) => {\n      // Don't handle keys when modals are open\n      if (showDiscount || showPriceCheck || showImportCart || showCashLedger || showCheckout || showCashModal || showReceipts || showChangePasswordModal || showLogoutConfirm) {\n        return;\n      }\n\n      // Don't handle if user is typing in an input field (unless it's specific navigation keys)\n      const isInputFocused = e.target && (\n        e.target.tagName === 'INPUT' || \n        e.target.tagName === 'TEXTAREA' ||\n        e.target.isContentEditable\n      );\n\n      // Only handle navigation keys if not in input or if editing cart item\n      const navigationKeys = ['ArrowUp', 'ArrowDown', 'Enter', 'Escape'];\n      const editKeys = ['e', 'E', 'd', 'D'];\n      const quantityKeys = ['=', '-'];\n      \n      if (isInputFocused && editingCartItem === null && !navigationKeys.includes(e.key) && !editKeys.includes(e.key) && !quantityKeys.includes(e.key)) {\n        return;\n      }\n\n      // Handle Escape key for editing state (but let shortcut handler handle modal closing)\n      if (e.key === 'Escape' && editingCartItem !== null) {\n        e.preventDefault();\n        e.stopPropagation();\n        setEditingCartItem(null);\n        return;\n      }\n\n      // Handle Enter key for editing state\n      if (e.key === 'Enter' && editingCartItem !== null) {\n        e.preventDefault();\n        e.stopPropagation();\n        handleEditQuantity(editingCartItem, editQty);\n        setEditingCartItem(null);\n        return;\n      }\n\n      // Handle arrow keys - allow navigation even when SKU input is focused\n      const isSkuInput = e.target === skuInputRef.current;\n      const isArrowKey = e.key === 'ArrowUp' || e.key === 'ArrowDown';\n      const isQuantityKey = e.key === '=' || e.key === '-';\n      \n      if (isArrowKey && (isSkuInput || !isInputFocused || editingCartItem !== null)) {\n        switch (e.key) {\n          case 'ArrowUp':\n          e.preventDefault();\n          e.stopPropagation();\n          setSelectedCartIdx(prev => prev > 0 ? prev - 1 : cart.length - 1);\n          break;\n          case 'ArrowDown':\n          e.preventDefault();\n          e.stopPropagation();\n          setSelectedCartIdx(prev => prev < cart.length - 1 ? prev + 1 : 0);\n          break;\n          // E and D keys removed - now using F1 and F2 instead\n          default:\n            break;\n        }\n      }\n      \n      // Handle quantity keys (= and -) even when SKU input is focused\n      if (isQuantityKey && (isSkuInput || !isInputFocused || editingCartItem !== null)) {\n        if (cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length) {\n          if (e.key === '=') {\n            e.preventDefault();\n            e.stopPropagation();\n            handleIncrementQuantity();\n          } else if (e.key === '-') {\n            e.preventDefault();\n            e.stopPropagation();\n            handleDecrementQuantity();\n          }\n        }\n      }\n    };\n\n    // Use bubble phase (after shortcuts hook which uses capture)\n    window.addEventListener('keydown', handleKeyDown, false);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown, false);\n    };\n  }, [cart.length, selectedCartIdx, editingCartItem, editQty, showDiscount, showPriceCheck, showImportCart, showCashLedger, showCheckout, showCashModal, showReceipts, showChangePasswordModal, showLogoutConfirm, handleIncrementQuantity, handleDecrementQuantity]);\n\n  // Reset selected index when cart changes\n  useEffect(() => {\n    if (cart.length === 0) {\n      setSelectedCartIdx(0);\n    } else {\n      setSelectedCartIdx(prev => Math.min(prev, cart.length - 1));\n    }\n  }, [cart.length]);\n\n\n  // Pause scanner when any modal is open to avoid hardware scanner/keyboard events interfering with shortcuts\n  useEffect(() => {\n    const anyModalOpen =\n      showDiscount ||\n      showPriceCheck ||\n      showImportCart ||\n      showCashLedger ||\n      showCheckout ||\n      showCashModal ||\n      showReceipts ||\n      showChangePasswordModal ||\n      showLogoutConfirm;\n    \n    setScannerPaused(anyModalOpen);\n    \n    // When modals close, refocus SKU input after a delay (but not if user is interacting with other elements)\n    if (!anyModalOpen) {\n      const timer = setTimeout(() => {\n        const activeElement = document.activeElement;\n        const isInputFocused = activeElement && (\n          activeElement.tagName === 'INPUT' || \n          activeElement.tagName === 'TEXTAREA' ||\n          activeElement.isContentEditable ||\n          activeElement.tagName === 'BUTTON'\n        );\n        // Only refocus if user isn't actively clicking buttons or using inputs\n        if (!isInputFocused && document.body === activeElement) {\n          skuInputRef.current?.focus();\n        }\n      }, 300);\n      return () => clearTimeout(timer);\n    }\n  }, [\n    showDiscount,\n    showPriceCheck,\n    showImportCart,\n    showCashLedger,\n    showCheckout,\n    showCashModal,\n    showReceipts,\n    showChangePasswordModal,\n    showLogoutConfirm,\n  ]);\n\n  const subtotal = cart.reduce(\n    (sum, item) => sum + item.price * item.quantity,\n    0\n  );\n  \n  // Calculate total with discount\n  let total = subtotal;\n  if (appliedDiscount) {\n    if (appliedDiscount.type === \"percentage\") {\n      const discountValue = Number(appliedDiscount.value);\n      if (!isNaN(discountValue) && discountValue > 0) {\n        const discountAmount = subtotal * (discountValue / 100);\n        total = Math.max(0, subtotal - discountAmount);\n      } else {\n        console.warn(\"Invalid discount value:\", appliedDiscount.value, \"for discount:\", appliedDiscount);\n      }\n    } else if (appliedDiscount.type === \"amount\") {\n      const discountValue = Number(appliedDiscount.value);\n      if (!isNaN(discountValue) && discountValue > 0) {\n        total = Math.max(0, subtotal - discountValue);\n      } else {\n        console.warn(\"Invalid discount value:\", appliedDiscount.value, \"for discount:\", appliedDiscount);\n      }\n    }\n  }\n\n  const completeTransactionCall = async (transId) => {\n    if (!transId) return;\n    try {\n      const resp = await api(`/api/sales/${transId}/complete`, {\n        method: \"POST\",\n        headers: { Authorization: `Bearer ${token}` },\n      });\n      return resp;\n    } catch (err) {\n      console.error(\"Failed to complete transaction:\", err);\n      setError(\"Failed to complete transaction\");\n      return null;\n    }\n  };\n\n  const handleCheckout = async (\n    paymentType = \"cash\",\n    moneyReceived = total\n  ) => {\n    if (cart.length === 0) return;\n    setError(\"\");\n    try {\n      const body = {\n        transaction_id: transactionId || null,\n        transaction_number: transactionNumber || null,\n        items: cart.map((i) => ({\n          product_id: i.product_id,\n          quantity: i.quantity,\n        })),\n        payment_type: paymentType,\n        money_received: moneyReceived,\n        discount_id: appliedDiscount?.discount_id || null,\n        discount_percentage: appliedDiscount?.type === \"percentage\" ? Number(appliedDiscount.value) : null,\n        discount_amount: appliedDiscount?.type === \"amount\" ? Number(appliedDiscount.value) : null,\n      };\n      const resp = await api(\"/api/sales/checkout\", {\n        method: \"POST\",\n        headers: { Authorization: `Bearer ${token}` },\n        body: JSON.stringify(body),\n      });\n      if (resp?.transaction_number)\n        setTransactionNumber(resp.transaction_number);\n      if (resp?.transaction_id) setTransactionId(resp.transaction_id);\n\n      // Removed redundant call to completeTransaction endpoint as checkout already sets status and cashier_user_id\n      // if (resp?.transaction_id) {\n      //   await completeTransactionCall(resp.transaction_id);\n      // }\n\n      setCart([]);\n      try {\n        const url = new URL(window.location.origin + \"/receipt\");\n        if (resp?.transaction_number)\n          url.searchParams.set(\"tn\", resp.transaction_number);\n        if (resp?.transaction_id)\n          url.searchParams.set(\"tid\", String(resp.transaction_id));\n        if (resp?.total != null)\n          url.searchParams.set(\"total\", String(resp.total));\n        navigate(url.pathname + url.search);\n      } catch (_) {}\n      // Start a fresh provisional transaction number after successful checkout\n      const businessId = user?.businessId || user?.business_id || \"BIZ\";\n      const timePart = new Date()\n        .toISOString()\n        .replace(/[-:T.Z]/g, \"\")\n        .slice(0, 14);\n      const randPart = Math.floor(1000 + Math.random() * 9000);\n      setTransactionNumber(\n        `T-${businessId.toString().padStart(2, \"0\")}-${timePart}-${randPart}`\n      );\n      setAppliedDiscount(null);\n      setTransactionId(null);\n    } catch (err) {\n      setError(\"Checkout failed\");\n    }\n  };\n\n  const handleCopyTn = () => {\n    navigator.clipboard.writeText(user.store_name);\n  };\n\n  const focusSkuInput = () => {\n    skuInputRef.current?.focus();\n    skuInputRef.current?.select?.();\n  };\n\n  const focusQuantityInput = () => {\n    quantityInputRef.current?.focus();\n    quantityInputRef.current?.select?.();\n  };\n\n  const handleNewTransaction = () => {\n    setCart([]);\n    setAppliedDiscount(null);\n    setTransactionId(null);\n    setError(\"\");\n    focusSkuInput();\n  };\n\n  const handleVoidSelected = () => {\n    if (cart.length === 0 || selectedCartIdx == null) return;\n    handleRemove(selectedCartIdx);\n  };\n\n  const handleSetQuantityShortcut = () => {\n    if (cart.length === 0 || selectedCartIdx == null) return;\n    const current = cart[selectedCartIdx];\n    const nextQty = Number(\n      window.prompt(\n        `Set quantity for ${current.name || current.sku}:`,\n        current.quantity\n      )\n    );\n    if (!Number.isNaN(nextQty) && nextQty > 0) {\n      handleEditQuantity(selectedCartIdx, nextQty);\n    }\n  };\n\n  const handleRemoveDiscount = () => {\n    if (appliedDiscount) {\n      setAppliedDiscount(null);\n    }\n  };\n\n  // Handler for edit quantity (F1)\n  const handleEditQuantityShortcut = () => {\n    if (cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length) {\n      setEditingCartItem(selectedCartIdx);\n      setEditQty(String(cart[selectedCartIdx].quantity));\n    }\n  };\n\n  // Handler for discount modal toggle (F6) - open/close discount modal\n  const handleDiscountToggle = () => {\n    setShowDiscount(!showDiscount);\n  };\n\n  const handleUnavailable = (message) => {\n    setError(message);\n    notificationRef.current?.scrollIntoView?.({ behavior: \"smooth\" });\n  };\n\n  useKeyboardShortcuts(\n    [\n      // ` (backtick) - focus SKU field\n      { key: \"`\", action: focusSkuInput },\n      // F1 - edit product quantity\n      {\n        key: \"f1\",\n        action: handleEditQuantityShortcut,\n        enabled: cart.length > 0 && selectedCartIdx >= 0,\n      },\n      // F2 - delete item\n      {\n        key: \"f2\",\n        action: handleVoidSelected,\n        enabled: cart.length > 0,\n      },\n      // F3 - logout\n      {\n        key: \"f3\",\n        description: \"Logout\",\n        action: () => setShowLogoutConfirm(true),\n      },\n      // F4 - add to cart button\n      {\n        key: \"f4\",\n        action: handleAddToCart,\n        enabled: !!sku, // Only enable if there's a SKU value\n      },\n      // F5 - cash ledger\n      { key: \"f5\", action: () => setShowCashLedger(true) },\n      // F6 - open/close discount modal\n      {\n        key: \"f6\",\n        action: handleDiscountToggle,\n      },\n      // F7 - price check\n      {\n        key: \"f7\",\n        description: \"Price Check\",\n        action: () => {\n          setShowPriceCheck(true);\n        },\n      },\n      // F8 - scan customer cart (keep existing)\n      {\n        key: \"f8\",\n        description: \"Scan Customer Cart\",\n        action: () => setShowImportCart(true),\n      },\n      // F9 - receipts\n      {\n        key: \"f9\",\n        description: \"Receipts\",\n        action: () => setShowReceipts(true),\n      },\n      // F10 - change password\n      {\n        key: \"f10\",\n        description: \"Change Password\",\n        action: () => setShowChangePasswordModal(true),\n      },\n      // F11 - remove discount\n      {\n        key: \"f11\",\n        action: handleRemoveDiscount,\n        enabled: !!appliedDiscount,\n      },\n      // F12 - checkout\n      {\n        key: \"f12\",\n        description: \"Checkout\",\n        action: () => setShowCheckout(true),\n        enabled: cart.length > 0,\n      },\n      // = (equals) - increment quantity\n      {\n        key: \"=\",\n        action: handleIncrementQuantity,\n        enabled: cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length,\n      },\n      // - (minus) - decrement quantity\n      {\n        key: \"-\",\n        action: handleDecrementQuantity,\n        enabled: cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length,\n      },\n      {\n        key: \"escape\",\n        description: \"Close Open Modals\",\n        action: () => {\n          // Only close modals, don't interfere with cart editing (handled separately)\n          if (showCheckout) setShowCheckout(false);\n          else if (showDiscount) setShowDiscount(false);\n          else if (showPriceCheck) setShowPriceCheck(false);\n          else if (showImportCart) setShowImportCart(false);\n          else if (showCashModal) setShowCashModal(false);\n          else if (showCashLedger) setShowCashLedger(false);\n          else if (showReceipts) setShowReceipts(false);\n          else if (showChangePasswordModal) setShowChangePasswordModal(false);\n          else if (showLogoutConfirm) setShowLogoutConfirm(false);\n          // Note: Cart item editing escape is handled in the separate keyboard handler\n        },\n        allowWhileTyping: true,\n        stopPropagation: false, // Allow other handlers to process\n      },\n    ],\n    [\n      cart.length,\n      selectedCartIdx,\n      sku,\n      appliedDiscount,\n      showCheckout,\n      showDiscount,\n      showPriceCheck,\n      showImportCart,\n      showCashModal,\n      showCashLedger,\n      showReceipts,\n      showChangePasswordModal,\n      showLogoutConfirm,\n    ]\n  );\n\n  // show confirmation modal first, perform actual logout in confirmLogout\n  const handleLogout = () => {\n    setShowLogoutConfirm(true);\n  };\n\n  const confirmLogout = () => {\n    sessionStorage.removeItem(\"auth_token\");\n    sessionStorage.removeItem(\"user\");\n    // close modal then navigate home\n    setShowLogoutConfirm(false);\n    navigate(\"/\");\n  };\n\n  const handleCloseLogoutModal = () => {\n    setShowLogoutConfirm(false);\n  };\n\n  // Handle keyboard events for logout confirmation\n  useEffect(() => {\n    if (!showLogoutConfirm) return;\n\n    const handleKeyDown = (e) => {\n      // Use stopPropagation to prevent other handlers from interfering\n      e.stopPropagation();\n      \n      if (e.key === 'Escape' || e.key === 'Esc') {\n        e.preventDefault();\n        handleCloseLogoutModal();\n      } else if (e.key === 'Enter') {\n        e.preventDefault();\n        confirmLogout();\n      }\n    };\n\n    // Use capture phase to ensure we get the event first\n    document.addEventListener('keydown', handleKeyDown, { capture: true });\n    return () => document.removeEventListener('keydown', handleKeyDown, { capture: true });\n  }, [showLogoutConfirm]);\n\n  const headerActions = (\n    <div className=\"flex items-center gap-2\">\n      <div className=\"hidden md:block text-right mr-2\">\n        <div className=\"text-xs text-gray-500 font-medium\">\n          {currentTime.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' })}\n        </div>\n        <div className=\"text-sm font-bold text-gray-700\">\n          {currentTime.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}\n        </div>\n      </div>\n      <button\n        onClick={() => setShowReceipts(true)}\n        className=\"flex items-center gap-2 bg-white/80 backdrop-blur-sm p-1.5 sm:px-3 sm:py-2 rounded-lg border border-gray-200/80 hover:bg-gray-50 transition-colors group relative\"\n        title=\"View all receipts (F9)\"\n      >\n        <div className=\"relative\">\n          <BiReceipt className=\"w-5 h-5 text-blue-600\" />\n        </div>\n        <span className=\"text-sm font-medium text-gray-700 hidden sm:inline\">\n          Receipts\n        </span>\n        <span className=\"hidden sm:inline-block bg-blue-50 text-blue-700 border border-blue-200 text-xs font-bold px-1.5 py-0.5 rounded\">\n          F9\n        </span>\n      </button>\n      <button\n        onClick={() => setShowChangePasswordModal(true)}\n        className=\"p-2 rounded-lg hover:bg-gray-100 transition-colors flex items-center gap-2\"\n        title=\"Change Password (F10)\"\n      >\n        <BiUser className=\"w-5 h-5 text-gray-600\" />\n        <span className=\"hidden sm:inline-block bg-gray-100 text-gray-600 border border-gray-200 text-xs font-bold px-1.5 py-0.5 rounded\">F10</span>\n      </button>\n      <button\n        onClick={handleLogout}\n        className=\"flex items-center gap-2 p-1.5 sm:px-3 sm:py-2 rounded-lg hover:bg-red-50 transition-colors\"\n        title=\"Logout (F3)\"\n      >\n        <div className=\"relative\">\n          <svg\n            className=\"w-5 h-5 text-red-600\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h6a2 2 0 012 2v1\"\n            />\n          </svg>\n        </div>\n        <span className=\"text-sm font-medium text-gray-700 hidden sm:inline\">Logout</span>\n        <span className=\"hidden sm:inline-block bg-red-100 text-red-700 border border-red-200 text-[11px] font-bold rounded px-1.5 py-0.5\">\n          F3\n        </span>\n      </button>\n    </div>\n  );\n\n  const cardClass = \"bg-white border border-blue-100 rounded-2xl p-6 shadow-lg\";\n\n  return (\n    <div className=\"bg-white min-h-screen\">\n      {/* Main Content */}\n      <div className=\"flex-1 flex flex-col min-h-screen\">\n        {/* Header */}\n        <header className=\"flex items-center gap-2 px-4 sm:px-6 py-3 bg-white/90 backdrop-blur-md shadow-md border-b border-gray-200/50 h-[64px] min-h-[64px] max-h-[64px] sticky top-0 z-30\">\n          <div className=\"flex items-center gap-3\">\n            <span className=\"text-xl sm:text-2xl font-bold text-gray-900 tracking-tight\">\n              POS\n            </span>\n            <span className=\"text-xs sm:text-sm font-semibold text-blue-700 bg-blue-50 border border-blue-200 px-2 py-1 rounded-lg\">\n              Cashier ID: {user?.userId || user?.user_id || user?.id || \"N/A\"}\n            </span>\n          </div>\n          <div className=\"flex-1 flex items-center justify-center px-2\">\n            <button\n              onClick={handleCopyTn}\n              title=\"Copy store name\"\n              className=\"inline-flex items-center gap-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg px-2.5 py-1.5 shadow-sm hover:bg-blue-100 transition-colors\"\n            >\n              <svg\n                className=\"w-4 h-4\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth={2}\n                  d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2M8 16h8a2 2 0 002-2v-6m-10 8l-2 2m2-2l2 2\"\n                />\n              </svg>\n              <span className=\"font-mono text-xs sm:text-sm md:text-base font-bold tracking-wider truncate max-w-[50vw]\">\n                {user.store_name}\n              </span>\n            </button>\n          </div>\n\n          <div className=\"ml-auto\">{headerActions}</div>\n        </header>\n\n        {/* Main Area */}\n        <main className=\"flex-1 bg-gradient-to-br from-gray-50/50 via-blue-50/30 to-indigo-50/50 overflow-y-auto p-2 sm:p-3 md:p-4 pb-55 lg:pb-4\">\n          <div className=\"grid gap-2 sm:gap-3 md:gap-4 h-full grid-cols-1 lg:grid-cols-12\">\n            {/* Left Column - Scanner, SKU Form, Transaction */}\n            <div className=\"lg:col-span-4 flex flex-col gap-2 sm:gap-3 md:gap-4\">\n              {/* ScannerCard */}\n              <div className=\"flex-shrink-0\">\n                <ScannerCard\n                  onScan={async (result) => {\n                    const code = result?.[0]?.rawValue;\n                    if (!code) return;\n                    setScannerPaused(true);\n                    if (showPriceCheck) {\n                      setPriceCheckSku(code);\n                    } else {\n                      try {\n                        let scannedData;\n                        try {\n                          scannedData = JSON.parse(code);\n                        } catch (e) {\n                          scannedData = null;\n                        }\n                        if (\n                          scannedData &&\n                          scannedData.t === \"cart\" &&\n                          Array.isArray(scannedData.items)\n                        ) {\n                          // set transactionId from scanned data if present\n                          if (scannedData.transaction_id) {\n                            setTransactionId(scannedData.transaction_id);\n                          }\n                          // set transaction_number from scanned data if present\n                          if (scannedData.transaction_number) {\n                            setTransactionNumber(\n                              scannedData.transaction_number\n                            );\n                          }\n                          const items = scannedData.items.map((it) => ({\n                            product_id: it.p,\n                            quantity: it.q,\n                            sku: it.sku || \"\",\n                          }));\n                          try {\n                            const fetchedProducts = await Promise.all(\n                              items.map(async (item) => {\n                                const res = await api(\n                                  `/api/products/${item.product_id}`,\n                                  {\n                                    headers: {\n                                      Authorization: `Bearer ${token}`,\n                                    },\n                                  }\n                                );\n                                return {\n                                  product_id: item.product_id,\n                                  sku: res.sku || item.sku || \"\",\n                                  name: res.product_name || \"\",\n                                  price: Number(res.selling_price) || 0,\n                                  quantity: item.quantity,\n                                };\n                              })\n                            );\n                            setCart((prev) => {\n                              const byProductId = new Map(\n                                prev.map((i) => [i.product_id, i])\n                              );\n                              for (const it of fetchedProducts) {\n                                const existing = byProductId.get(it.product_id);\n                                if (existing) {\n                                  existing.quantity += it.quantity;\n                                } else {\n                                  byProductId.set(it.product_id, { ...it });\n                                }\n                              }\n                              return Array.from(byProductId.values());\n                            });\n                            return;\n                          } catch (err) {\n                            console.error(\n                              \"Error fetching product details for scanned cart:\",\n                              err\n                            );\n                            // fallback to merging raw scanned items without product details\n                            setCart((prev) => {\n                              const byProductId = new Map(\n                                prev.map((i) => [i.product_id, i])\n                              );\n                              for (const it of items) {\n                                const existing = byProductId.get(it.product_id);\n                                if (existing) {\n                                  existing.quantity += it.quantity;\n                                } else {\n                                  byProductId.set(it.product_id, {\n                                    ...it,\n                                    name: \"\",\n                                    price: 0,\n                                  });\n                                }\n                              }\n                              return Array.from(byProductId.values());\n                            });\n                            return;\n                          }\n                        }\n                        await addSkuToCart(code, 1);\n                      } catch (err) {\n                        console.error(\"Error processing scanned code:\", err);\n                        await addSkuToCart(code, 1);\n                      }\n                    }\n                  }}\n                  paused={scannerPaused}\n                  onResume={() => setScannerPaused(false)}\n                  textMain=\"text-blue-700\"\n                />\n              </div>\n\n              {/* SkuFormCard */}\n              <div className=\"flex-shrink-0\">\n                <SkuFormCard\n                  ref={skuInputRef}\n                  sku={sku}\n                  setSku={setSku}\n                  quantity={quantity}\n                  setQuantity={setQuantity}\n                  handleAddToCart={handleAddToCart}\n                quantityInputRef={quantityInputRef}\n                />\n                {error && (\n                  <div className=\"bg-red-50 border-l-4 border-red-500 rounded-lg p-3 flex items-start gap-2 mt-3 relative animate-in slide-in-from-top-2 duration-300\">\n                    <svg\n                      className=\"w-4 h-4 text-red-500 flex-shrink-0 mt-0.5\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"\n                      />\n                    </svg>\n                    <p className=\"text-sm font-medium text-red-700 flex-1\">\n                      {(() => {\n                        try {\n                          const parsed = JSON.parse(error);\n                          return parsed.error || parsed.message || error;\n                        } catch {\n                          return error;\n                        }\n                      })()}\n                    </p>\n                    <button\n                      onClick={() => setError(\"\")}\n                      className=\"text-red-400 hover:text-red-600 transition-colors flex-shrink-0 ml-2\"\n                      aria-label=\"Dismiss error\"\n                    >\n                      <svg\n                        className=\"w-4 h-4\"\n                        fill=\"none\"\n                        stroke=\"currentColor\"\n                        viewBox=\"0 0 24 24\"\n                      >\n                        <path\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                          strokeWidth={2}\n                          d=\"M6 18L18 6M6 6l12 12\"\n                        />\n                      </svg>\n                    </button>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Right Column - Cart and Actions */}\n            <div className=\"lg:col-span-8 flex flex-col gap-2 sm:gap-3 min-h-0\">\n              {/* CartTableCard */}\n              <div className=\"flex-1 overflow-auto\">\n                <CartTableCard\n                  cart={cart}\n                  handleRemove={handleRemove}\n                  handleEditQuantity={(idx, newQuantity) => {\n                    const updatedCart = [...cart];\n                    updatedCart[idx].quantity = newQuantity;\n                    setCart(updatedCart);\n                    setEditingCartItem(null);\n                  }}\n                  total={total}\n                  appliedDiscount={appliedDiscount}\n                  selectedIdx={selectedCartIdx}\n                  onSelectRow={setSelectedCartItem}\n                  editingIdx={editingCartItem}\n                  editQty={editQty}\n                  onEditQtyChange={handleEditQtyChange}\n                  onEditComplete={() => setEditingCartItem(null)}\n                  onStartEdit={(idx) => setEditingCartItem(idx)}\n                  className=\"flex-1 h-full\"\n                />\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"grid grid-cols-12 gap-2 sm:gap-3 flex-shrink-0\">\n                {appliedDiscount && (\n                  <div className=\"col-span-12 flex items-center justify-between bg-emerald-50 border border-emerald-200 text-emerald-800 rounded-lg px-3 py-2\">\n                    <span className=\"text-sm font-semibold\">\n                      Discount applied: {appliedDiscount.label}\n                    </span>\n                    <button\n                      className=\"text-xs font-bold underline flex items-center gap-1\"\n                      onClick={() => setAppliedDiscount(null)}\n                    >\n                      <span className=\"text-yellow-600\">(F11)</span> Remove\n                    </button>\n                  </div>\n                )}\n                {/* Grouped Buttons */}\n                <div className=\"col-span-8\">\n                  <div className=\"grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3\">\n                    <Button\n                      label={<ButtonLabel text=\"CASH LEDGER\" shortcut=\"F5\" />}\n                      size=\"md\"\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\n                      variant=\"secondary\"\n                      microinteraction\n                      onClick={() => setShowCashLedger(true)}\n                      icon={\n                        <svg\n                          className=\"w-4 h-4\"\n                          fill=\"none\"\n                          stroke=\"currentColor\"\n                          viewBox=\"0 0 24 24\"\n                        >\n                          <path\n                            strokeLinecap=\"round\"\n                            strokeLinejoin=\"round\"\n                            strokeWidth={2}\n                            d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n                          />\n                        </svg>\n                      }\n                      iconPosition=\"left\"\n                    />\n                    <div className=\"relative group w-full\">\n                      <Button\n                        label={\n                          appliedDiscount\n                            ? <ButtonLabel text=\"REMOVE DISCOUNT\" shortcut=\"F11\" variant=\"secondary\" />\n                            : <ButtonLabel text=\"DISCOUNT\" shortcut=\"F6\" />\n                        }\n                        size=\"md\"\n                        className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\n                        onClick={() => {\n                          if (appliedDiscount) {\n                            if (window.confirm(`Remove ${appliedDiscount.label || 'discount'}?`)) {\n                              setAppliedDiscount(null);\n                            }\n                          } else {\n                            setShowDiscount(true);\n                          }\n                        }}\n                        variant=\"secondary\"\n                        microinteraction\n                        icon={\n                          appliedDiscount ? (\n                            <svg\n                              className=\"w-5 h-5\"\n                              fill=\"none\"\n                              stroke=\"currentColor\"\n                              viewBox=\"0 0 24 24\"\n                            >\n                              <path\n                                strokeLinecap=\"round\"\n                                strokeLinejoin=\"round\"\n                                strokeWidth={2}\n                                d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"\n                              />\n                            </svg>\n                          ) : (\n                            <svg\n                              className=\"w-4 h-4\"\n                              fill=\"none\"\n                              stroke=\"currentColor\"\n                              viewBox=\"0 0 24 24\"\n                            >\n                              <path\n                                strokeLinecap=\"round\"\n                                strokeLinejoin=\"round\"\n                                strokeWidth={2}\n                                d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n                              />\n                            </svg>\n                          )\n                        }\n                        iconPosition=\"left\"\n                      />\n                      {appliedDiscount && (\n                        <div className=\"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10\">\n                          Click to remove discount\n                          <div className=\"absolute bottom-0 left-1/2 w-2 h-2 bg-gray-800 transform -translate-x-1/2 translate-y-1/2 rotate-45\"></div>\n                        </div>\n                      )}\n                    </div>\n                    <Button\n                      label={<ButtonLabel text=\"PRICE CHECK\" shortcut=\"F7\" />}\n                      size=\"md\"\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\n                      onClick={() => setShowPriceCheck(true)}\n                      variant=\"secondary\"\n                      microinteraction\n                      icon={\n                        <svg\n                          className=\"w-4 h-4\"\n                          fill=\"none\"\n                          stroke=\"currentColor\"\n                          viewBox=\"0 0 24 24\"\n                        >\n                          <path\n                            strokeLinecap=\"round\"\n                            strokeLinejoin=\"round\"\n                            strokeWidth={2}\n                            d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\n                          />\n                        </svg>\n                      }\n                      iconPosition=\"left\"\n                    />\n                    <Button\n                      label={<ButtonLabel text=\"SCAN CUSTOMER QR\" shortcut=\"F8\" />}\n                      size=\"md\"\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\n                      onClick={() => setShowImportCart(true)}\n                      variant=\"secondary\"\n                      microinteraction\n                      icon={\n                        <svg\n                          className=\"w-4 h-4\"\n                          fill=\"none\"\n                          stroke=\"currentColor\"\n                          viewBox=\"0 0 24 24\"\n                        >\n                          <path\n                            strokeLinecap=\"round\"\n                            strokeLinejoin=\"round\"\n                            strokeWidth={2}\n                            d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12\"\n                          />\n                        </svg>\n                      }\n                      iconPosition=\"left\"\n                    />\n                  </div>\n                </div>\n\n                {/* Checkout Button */}\n                <div className=\"col-span-4\">\n                  <Button\n                    label={<ButtonLabel text=\"CHECKOUT\" shortcut=\"F12\" variant=\"primary\" />}\n                    size=\"md\"\n                    className=\"w-full h-full text-sm sm:text-base font-bold\"\n                    variant=\"primary\"\n                    microinteraction\n                    onClick={() => setShowCheckout(true)}\n                    disabled={cart.length === 0}\n                    icon={\n                      <svg\n                        className=\"w-5 h-5\"\n                        fill=\"none\"\n                        stroke=\"currentColor\"\n                        viewBox=\"0 0 24 24\"\n                      >\n                        <path\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                          strokeWidth={2}\n                          d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\n                        />\n                      </svg>\n                    }\n                    iconPosition=\"left\"\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n          \n        </main>\n\n        {/* Modals */}\n        {showLogoutConfirm && (\n          <div className=\"fixed inset-0 z-90 flex items-center justify-center\">\n            <div\n              className=\"absolute inset-0 bg-black/80 z-90\"\n              onClick={handleCloseLogoutModal}\n            />\n            <div \n              className=\"relative bg-white rounded-xl shadow-xl w-[92%] max-w-md z-100 p-0\"\n              onKeyDown={(e) => {\n                // Prevent event from bubbling up to document\n                e.stopPropagation();\n                \n                // Handle Enter key specifically for the modal\n                if (e.key === 'Enter' && !e.isPropagationStopped()) {\n                  e.preventDefault();\n                  confirmLogout();\n                }\n              }}\n            >\n              {/* Header Section */}\n              <div className=\"bg-gradient-to-r from-red-50 via-red-50/80 to-orange-50/50 border-b border-red-100 px-6 py-5 rounded-t-2xl\">\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg\">\n                    <svg\n                      className=\"w-6 h-6 text-white\"\n                      fill=\"none\"\n                      stroke=\"white\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeWidth=\"2\"\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"\n                      />\n                    </svg>\n                  </div>\n                  <div className=\"flex-1\">\n                    <h2 className=\"text-xl font-bold text-gray-900 mb-1\">\n                      Confirm Logout\n                    </h2>\n                    <p className=\"text-sm text-gray-600\">\n                      Are you sure you want to log out? <span className=\"text-xs opacity-70\">(Press Esc to cancel, Enter to confirm)</span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {/* Content Section */}\n              <div className=\"p-6\">\n                <p className=\"text-sm text-gray-700 mb-6\">\n                  You will be redirected to the login page and your session will\n                  end.\n                </p>\n\n                {/* Action Buttons */}\n                <div className=\"flex justify-end gap-3\">\n                  <button\n                    onClick={handleCloseLogoutModal}\n                    className=\"px-5 py-2.5 rounded-lg text-sm font-semibold text-gray-700 bg-white border-2 border-gray-300 hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\n                    autoFocus\n                  >\n                    Cancel (Esc)\n                  </button>\n                  <button\n                    onClick={confirmLogout}\n                    className=\"px-5 py-2.5 rounded-lg text-sm font-semibold text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 shadow-md hover:shadow-lg transition-all duration-200 flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\n                  >\n                    <svg\n                      className=\"w-5 h-5\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeWidth=\"2\"\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"\n                      />\n                    </svg>\n                    Logout (Enter)\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n        <DiscountModal\n          isOpen={showDiscount}\n          onClose={() => setShowDiscount(false)}\n          onApplyDiscount={(discount) => {\n            setAppliedDiscount(discount);\n            setShowDiscount(false);\n          }}\n        />\n        <PriceCheckModal\n          isOpen={showPriceCheck}\n          onClose={() => setShowPriceCheck(false)}\n          sku={priceCheckSku}\n          setSku={setPriceCheckSku}\n        />\n        <CashLedgerModal\n          isOpen={showCashLedger}\n          onClose={() => setShowCashLedger(false)}\n        />\n        <CheckoutModal\n          isOpen={showCheckout}\n          onClose={() => setShowCheckout(false)}\n          total={total}\n          onSelectPayment={(method) => {\n            setSelectedPayment(method);\n            setShowCheckout(false);\n            if (method === \"cash\") {\n              setShowCashModal(true);\n            } else {\n              if (method === \"gcash\") {\n                (async () => {\n                  try {\n                    const successUrl =\n                      window.location.origin + \"/pos?payment=success\";\n                    const cancelUrl =\n                      window.location.origin + \"/pos?payment=cancel\";\n                    // persist cart to finalize after redirect back\n                    localStorage.setItem(\n                      \"pending_gcash_cart\",\n                      JSON.stringify({\n                        items: cart.map((i) => ({\n                          product_id: i.product_id,\n                          quantity: i.quantity,\n                        })),\n                        total,\n                        transactionId: transactionId,\n                        transactionNumber: transactionNumber,\n                        discount_id: appliedDiscount?.discount_id || null,\n                        discount_percentage: appliedDiscount?.type === \"percentage\" ? Number(appliedDiscount.value) : null,\n                        discount_amount: appliedDiscount?.type === \"amount\" ? Number(appliedDiscount.value) : null,\n                      })\n                    );\n                    const { checkoutUrl } = await createGcashCheckout({\n                      amount: Number(total || 0),\n                      description: \"POS Order\",\n                      referenceNumber: transactionNumber || `POS-${Date.now()}`,\n                      cancelUrl,\n                      successUrl,\n                    });\n                    window.open(checkoutUrl, '_blank');\n                  } catch (e) {\n                    setError(\"Failed to init GCash\");\n                    localStorage.removeItem(\"pending_gcash_cart\");\n                  }\n                })();\n              } else if (method === \"maya\") {\n                (async () => {\n                  try {\n                    const successUrl =\n                      window.location.origin + \"/pos?payment=success\";\n                    const cancelUrl =\n                      window.location.origin + \"/pos?payment=cancel\";\n                    // persist cart to finalize after redirect back\n                    localStorage.setItem(\n                      \"pending_maya_cart\",\n                      JSON.stringify({\n                        items: cart.map((i) => ({\n                          product_id: i.product_id,\n                          quantity: i.quantity,\n                        })),\n                        total,\n                        transactionId: transactionId,\n                        transactionNumber: transactionNumber,\n                        discount_id: appliedDiscount?.discount_id || null,\n                        discount_percentage: appliedDiscount?.type === \"percentage\" ? Number(appliedDiscount.value) : null,\n                        discount_amount: appliedDiscount?.type === \"amount\" ? Number(appliedDiscount.value) : null,\n                      })\n                    );\n                    const { checkoutUrl } = await createMayaCheckout({\n                      amount: Number(total || 0),\n                      description: \"POS Order\",\n                      referenceNumber: transactionNumber || `POS-${Date.now()}`,\n                      cancelUrl,\n                      successUrl,\n                    });\n                    window.open(checkoutUrl, '_blank');\n                  } catch (e) {\n                    setError(\"Failed to init Maya\");\n                    localStorage.removeItem(\"pending_maya_cart\");\n                  }\n                })();\n              } else {\n                // For other payment methods, fall back to existing checkout flow\n                handleCheckout(method);\n              }\n            }\n          }}\n        />\n        <CashPaymentModal\n          isOpen={showCashModal}\n          onClose={() => setShowCashModal(false)}\n          total={total}\n          onConfirm={(amountReceived) => {\n            handleCheckout(\"cash\", amountReceived);\n            setShowCashModal(false);\n          }}\n        />\n        <ScanCustomerCartModal\n          isOpen={showImportCart}\n          onClose={() => setShowImportCart(false)}\n          onImport={async (items, transactionId, completionResponse) => {\n            try {\n              // If transaction was completed (completionResponse exists), navigate to receipt\n              if (completionResponse && transactionId) {\n                setCart([]);\n                setTransactionId(null);\n                setTransactionNumber(null);\n                setError(\"\");\n                setShowImportCart(false);\n                // Navigate to receipt page for cashier\n                window.location.href = `/receipt?tn=${completionResponse.transaction_number || transactionId}`;\n                return;\n              }\n              \n              // Otherwise, import items (backward compatibility for old QR format)\n              if (!items || items.length === 0) {\n                setError(\"No items found in QR code\");\n                return;\n              }\n              \n              console.log(\"Scanned items:\", items);\n              // Fetch product details by product_id for all scanned items concurrently\n              const fetchedProducts = await Promise.all(\n                items.map(async (item) => {\n                  const res = await api(`/api/products/${item.product_id}`, {\n                    headers: { Authorization: `Bearer ${token}` },\n                  });\n                  console.log(\n                    \"Fetched product for id\",\n                    item.product_id,\n                    \":\",\n                    res\n                  );\n                  return {\n                    product_id: item.product_id,\n                    sku: res.sku || item.sku || \"\",\n                    name: res.product_name || \"\",\n                    price: Number(res.selling_price) || 0,\n                    quantity: item.quantity,\n                  };\n                })\n              );\n              setCart((prev) => {\n                const bySku = new Map(prev.map((i) => [i.sku, i]));\n                for (const it of fetchedProducts) {\n                  const existing = bySku.get(it.sku);\n                  if (existing) existing.quantity += it.quantity;\n                  else bySku.set(it.sku, { ...it });\n                }\n                return Array.from(bySku.values());\n              });\n            } catch (e) {\n              console.error(\"Error fetching products for scanned items:\", e);\n              // Fallback to use raw items if fetch fails\n              setCart((prev) => {\n                const bySku = new Map(prev.map((i) => [i.sku, i]));\n                for (const it of items) {\n                  const existing = bySku.get(it.sku);\n                  if (existing) existing.quantity += it.quantity;\n                  else bySku.set(it.sku, { ...it });\n                }\n                return Array.from(bySku.values());\n              });\n            }\n          }}\n        />\n        <RecentReceiptsModal\n          isOpen={showReceipts}\n          onClose={() => setShowReceipts(false)}\n        />\n        <ChangePasswordModal\n          isOpen={showChangePasswordModal}\n          onClose={() => setShowChangePasswordModal(false)}\n        />\n      </div>\n    </div>\n  );\n}\n\nexport default CashierPOS;\n"],"names":["RecentReceiptsModal","isOpen","onClose","receipts","setReceipts","useState","loading","setLoading","error","setError","selectedIndex","setSelectedIndex","containerRef","useRef","modalContentRef","useEffect","async","token","sessionStorage","getItem","data","api","headers","Authorization","Array","isArray","e","fetchReceipts","openReceipt","receipt","url","URL","window","location","origin","transaction_number","searchParams","set","transaction_id","String","open","toString","useCallback","index","handleKeyDown","length","preventDefault","key","prev","newIndex","setTimeout","items","current","querySelectorAll","focus","preventScroll","container","selectedElement","children","containerRect","getBoundingClientRect","elementRect","top","scrollBy","bottom","handleKeyDownEvent","includes","addEventListener","removeEventListener","jsxs","BaseModal","title","subtitle","size","contentRef","footer","jsx","Button","label","variant","onClick","className","ref","tabIndex","role","map","r","idx","onFocus","Date","updated_at","created_at","toLocaleString","Number","total_amount","total","toFixed","payment","method","payment_type","discount_percentage","discount_amount","ButtonLabel","text","shortcut","CashierPOS","navigate","useNavigate","sku","setSku","priceCheckSku","setPriceCheckSku","quantity","setQuantity","cart","setCart","appliedDiscount","setAppliedDiscount","showDiscount","setShowDiscount","showPriceCheck","setShowPriceCheck","showImportCart","setShowImportCart","showCashLedger","setShowCashLedger","showCheckout","setShowCheckout","selectedPayment","setSelectedPayment","showCashModal","setShowCashModal","darkMode","setDarkMode","scannerPaused","setScannerPaused","showLogoutConfirm","setShowLogoutConfirm","transactionNumber","setTransactionNumber","transactionId","setTransactionId","timer","clearTimeout","showReceipts","setShowReceipts","showChangePasswordModal","setShowChangePasswordModal","isMobileNavOpen","setIsMobileNavOpen","selectedCartIdx","setSelectedCartIdx","editingCartItem","setEditingCartItem","editQty","setEditQty","skuInputRef","quantityInputRef","currentTime","setCurrentTime","setInterval","clearInterval","user","JSON","parse","hasFinalizedRef","React","businessId","business_id","timePart","toISOString","replace","slice","randPart","Math","floor","random","padStart","status","URLSearchParams","search","get","isNewTab","opener","closed","finalizeOnlinePayment","pendingCartKey","paymentType","pending","localStorage","parsed","guardKey","toLowerCase","setItem","body","money_received","discount_id","resp","stringify","href","close","pathname","_","removeItem","delete","history","replaceState","addSkuToCart","skuValue","qty","encodeURIComponent","product","price","selling_price","stockQty","stock_quantity","product_name","existingIdx","findIndex","i","product_id","next","newQty","name","err","handleAddToCart","handleRemove","filter","handleIncrementQuantity","item","cartItem","handleDecrementQuantity","currentQty","isInputFocused","target","tagName","isContentEditable","stopPropagation","handleEditQuantity","max","isSkuInput","isArrowKey","isQuantityKey","min","anyModalOpen","activeElement","document","subtotal","reduce","sum","type","discountValue","value","isNaN","discountAmount","console","warn","handleCheckout","moneyReceived","useKeyboardShortcuts","action","focusSkuInput","select","handleEditQuantityShortcut","enabled","handleVoidSelected","description","handleDiscountToggle","handleRemoveDiscount","allowWhileTyping","confirmLogout","handleCloseLogoutModal","capture","headerActions","toLocaleDateString","weekday","month","day","year","toLocaleTimeString","hour","minute","BiReceipt","BiUser","handleLogout","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","userId","user_id","id","handleCopyTn","clipboard","writeText","store_name","ScannerCard","onScan","result","code","rawValue","scannedData","t","it","p","q","fetchedProducts","Promise","all","res","byProductId","Map","existing","from","values","paused","onResume","textMain","SkuFormCard","message","CartTableCard","newQuantity","updatedCart","selectedIdx","onSelectRow","editingIdx","onEditQtyChange","onEditComplete","onStartEdit","microinteraction","icon","iconPosition","confirm","disabled","onKeyDown","isPropagationStopped","autoFocus","DiscountModal","onApplyDiscount","discount","PriceCheckModal","CashLedgerModal","CheckoutModal","onSelectPayment","successUrl","cancelUrl","checkoutUrl","createGcashCheckout","amount","referenceNumber","now","createMayaCheckout","CashPaymentModal","onConfirm","amountReceived","ScanCustomerCartModal","onImport","completionResponse","log","bySku","ChangePasswordModal"],"mappings":"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"}