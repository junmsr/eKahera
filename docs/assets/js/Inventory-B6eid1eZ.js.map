{"version":3,"file":"Inventory-B6eid1eZ.js","sources":["../../../frontend/src/pages/Inventory.jsx"],"sourcesContent":["import React, { useState, useMemo, useEffect, useCallback, useRef } from \"react\";\r\nimport PageLayout from \"../components/layout/PageLayout\";\r\nimport NavAdmin from \"../components/layout/Nav-Admin\";\r\nimport Inventory from \"../components/inventory/Inventory\";\r\nimport Modal from \"../components/modals/Modal\";\r\nimport Button from \"../components/common/Button\";\r\nimport jsPDF from \"jspdf\";\r\n\r\nimport ProductFormModal from \"../components/modals/ProductFormModal\";\r\nimport { api, authHeaders } from \"../lib/api\";\r\nimport { useDebounce } from \"../hooks/useDebounce\";\r\n\r\nconst initialProducts = [];\r\nconst initialCategories = [];\r\nconst DEFAULT_LOW_STOCK_LEVEL = 10;\r\n\r\n// Helper function to get unit display string\r\nconst getUnitDisplay = (product) => {\r\n  if (product.display_unit) {\r\n    return product.display_unit;\r\n  }\r\n  if (product.product_type === 'count') {\r\n    return 'pc';\r\n  }\r\n  if (product.product_type === 'weight' || product.product_type === 'volume') {\r\n    if (product.quantity_per_unit && product.base_unit) {\r\n      return `${product.quantity_per_unit} ${product.base_unit}`;\r\n    }\r\n    return product.base_unit || 'pc';\r\n  }\r\n  return 'pc';\r\n};\r\n\r\n\r\n// Helper function to format stock for PDF display (returns just the number with unit)\r\nconst formatStockForPDF = (quantityInBaseUnits, productType, quantityPerUnit, baseUnit) => {\r\n  if (!quantityInBaseUnits || quantityInBaseUnits === 0) return '0';\r\n  \r\n  // For count products, show number of pieces\r\n  if (productType === 'count' || !productType) {\r\n    return `${Math.round(quantityInBaseUnits)}`;\r\n  }\r\n  \r\n  // For volume products with base_unit \"L\", inventory is stored in mL\r\n  // Convert to L for display\r\n  if (productType === 'volume' && baseUnit === 'L') {\r\n    const displayValue = quantityInBaseUnits / 1000; // Convert mL to L\r\n    return displayValue % 1 === 0 ? displayValue.toFixed(0) : displayValue.toFixed(2);\r\n  }\r\n  \r\n  // For weight/volume products, convert to appropriate unit for display\r\n  let displayValue = quantityInBaseUnits;\r\n  let displayUnit = baseUnit || 'g';\r\n  \r\n  // Convert to larger units for better readability\r\n  if (baseUnit === 'g' && quantityInBaseUnits >= 1000) {\r\n    displayValue = quantityInBaseUnits / 1000;\r\n    displayUnit = 'kg';\r\n  } else if (baseUnit === 'mL' && quantityInBaseUnits >= 1000) {\r\n    displayValue = quantityInBaseUnits / 1000;\r\n    displayUnit = 'L';\r\n  }\r\n  \r\n  // Format the number (no decimals if whole number, 2 decimals otherwise)\r\n  const formattedValue = displayValue % 1 === 0 \r\n    ? displayValue.toFixed(0) \r\n    : displayValue.toFixed(2);\r\n  \r\n  return `${formattedValue} ${displayUnit}`;\r\n};\r\n\r\n// Function to get predefined categories based on business type\r\nfunction getCategoriesByBusinessType(businessType) {\r\n  const categoryMap = {\r\n    \"Grocery Store\": [\r\n      \"Fresh Produce\",\r\n      \"Meat & Poultry\",\r\n      \"Seafood\",\r\n      \"Dairy & Eggs\",\r\n      \"Bread & Bakery\",\r\n      \"Snacks & Chips\",\r\n      \"Beverages\",\r\n      \"Canned & Packaged Goods\",\r\n      \"Frozen Food\",\r\n      \"Rice, Pasta & Grains\",\r\n      \"Condiments & Spices\",\r\n      \"Cleaning Supplies\",\r\n      \"Household Essentials\",\r\n      \"Baby Products\",\r\n      \"Pet Supplies\",\r\n    ],\r\n    Pharmacy: [\r\n      \"Prescription Medicines\",\r\n      \"OTC Medicines\",\r\n      \"Vitamins & Supplements\",\r\n      \"First Aid Supplies\",\r\n      \"Medical Devices\",\r\n      \"Personal Care\",\r\n      \"Hygiene Products\",\r\n      \"Beauty & Cosmetics\",\r\n      \"Baby Care\",\r\n      \"Adult Care\",\r\n      \"PPE & Sanitizers\",\r\n    ],\r\n    \"Clothing Store\": [\r\n      \"Men’s Clothing\",\r\n      \"Women’s Clothing\",\r\n      \"Kids’ Clothing\",\r\n      \"Baby Clothing\",\r\n      \"Footwear\",\r\n      \"Bags & Accessories\",\r\n      \"Underwear & Socks\",\r\n    ],\r\n    \"Electronics Store\": [\r\n      \"Mobile Devices\",\r\n      \"Computers & Laptops\",\r\n      \"Computer Accessories\",\r\n      \"Phone Accessories\",\r\n      \"Audio Devices\",\r\n      \"Cameras & Photography\",\r\n      \"Home Appliances\",\r\n      \"Personal Appliances\",\r\n      \"Gaming Consoles & Accessories\",\r\n      \"Cables, Adapters & Chargers\",\r\n    ],\r\n    Bookstore: [\r\n      \"Fiction Books\",\r\n      \"Non-Fiction Books\",\r\n      \"Educational Books\",\r\n      \"Children’s Books\",\r\n      \"Comics & Manga\",\r\n      \"School Supplies\",\r\n      \"Art Materials\",\r\n      \"Office Supplies\",\r\n      \"Stationery & Gifts\",\r\n    ],\r\n    \"Convenience Store\": [\r\n      \"Snacks\",\r\n      \"Beverages\",\r\n      \"Ready-to-Eat Food\",\r\n      \"Instant Noodles / Cup Meals\",\r\n      \"Frozen Food\",\r\n      \"Basic Grocery Items\",\r\n      \"Toiletries\",\r\n      \"Basic OTC Medicines\",\r\n      \"Household Essentials\",\r\n      \"Phone Load\",\r\n      \"Ice Cream & Desserts\",\r\n      \"Tobacco & Lighters\",\r\n    ],\r\n    Others: [\"General\"],\r\n  };\r\n\r\n  return categoryMap[businessType] || categoryMap[\"Others\"];\r\n}\r\n\r\n/**\r\n * Import Success Modal Component\r\n */\r\nfunction ImportSuccessModal({ isOpen, onClose, successCount, errors }) {\r\n  if (!isOpen) return null;\r\n\r\n  const hasErrors = errors && errors.length > 0;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 flex items-center justify-center z-50 p-4\">\r\n      {/* Backdrop */}\r\n      <div\r\n        className=\"absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity\"\r\n        onClick={onClose}\r\n        aria-hidden=\"true\"\r\n      ></div>\r\n      \r\n      {/* Modal content */}\r\n      <div\r\n        className=\"relative bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col z-10\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        {/* Header */}\r\n        <div className={`bg-gradient-to-r ${hasErrors ? 'from-yellow-50 via-yellow-50/80 to-orange-50/50 border-b border-yellow-100' : 'from-green-50 via-green-50/80 to-emerald-50/50 border-b border-green-100'} px-6 py-5 rounded-t-2xl flex items-center justify-between`}>\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className={`w-12 h-12 bg-gradient-to-br ${hasErrors ? 'from-yellow-500 to-orange-600' : 'from-green-500 to-emerald-600'} rounded-xl flex items-center justify-center shadow-lg`}>\r\n              {hasErrors ? (\r\n                <svg\r\n                  className=\"w-6 h-6 text-white\"\r\n                  fill=\"none\"\r\n                  stroke=\"currentColor\"\r\n                  viewBox=\"0 0 24 24\"\r\n                >\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\r\n                  />\r\n                </svg>\r\n              ) : (\r\n                <svg\r\n                  className=\"w-6 h-6 text-white\"\r\n                  fill=\"none\"\r\n                  stroke=\"currentColor\"\r\n                  viewBox=\"0 0 24 24\"\r\n                >\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M5 13l4 4L19 7\"\r\n                  />\r\n                </svg>\r\n              )}\r\n            </div>\r\n            <div>\r\n              <h2 className=\"text-xl font-bold text-gray-900\">\r\n                {hasErrors ? 'Import Completed with Warnings' : 'Import Successful'}\r\n              </h2>\r\n              <p className=\"text-sm text-gray-600\">\r\n                {hasErrors ? 'Some products were imported with errors' : 'All products imported successfully'}\r\n              </p>\r\n            </div>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-all duration-200 p-2 rounded-xl\"\r\n            type=\"button\"\r\n            aria-label=\"Close modal\"\r\n          >\r\n            <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div className=\"overflow-y-auto flex-1 px-6 py-6\">\r\n          <div className=\"space-y-4\">\r\n            {/* Success message */}\r\n            <div className={`bg-gradient-to-r ${hasErrors ? 'from-yellow-50 to-orange-50' : 'from-green-50 to-emerald-50'} border-l-4 ${hasErrors ? 'border-yellow-500' : 'border-green-500'} rounded-lg p-4`}>\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className={`flex-shrink-0 w-10 h-10 ${hasErrors ? 'bg-yellow-100' : 'bg-green-100'} rounded-full flex items-center justify-center`}>\r\n                  <span className={`text-lg font-bold ${hasErrors ? 'text-yellow-700' : 'text-green-700'}`}>\r\n                    {successCount}\r\n                  </span>\r\n                </div>\r\n                <div>\r\n                  <p className={`text-sm font-semibold ${hasErrors ? 'text-yellow-800' : 'text-green-800'}`}>\r\n                    {successCount} {successCount === 1 ? 'product' : 'products'} imported successfully\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Errors section */}\r\n            {hasErrors && (\r\n              <div className=\"bg-red-50 border-l-4 border-red-500 rounded-lg p-4\">\r\n                <h3 className=\"text-sm font-semibold text-red-800 mb-2\">\r\n                  {errors.length} {errors.length === 1 ? 'error' : 'errors'} encountered:\r\n                </h3>\r\n                <div className=\"max-h-64 overflow-y-auto space-y-1\">\r\n                  {errors.slice(0, 10).map((error, index) => (\r\n                    <p key={index} className=\"text-xs text-red-700 font-mono bg-red-100 px-2 py-1 rounded\">\r\n                      {error}\r\n                    </p>\r\n                  ))}\r\n                  {errors.length > 10 && (\r\n                    <p className=\"text-xs text-red-600 italic mt-2\">\r\n                      ... and {errors.length - 10} more error{errors.length - 10 > 1 ? 's' : ''}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"sticky bottom-0 px-6 py-4 bg-gradient-to-t from-slate-50 via-white to-transparent border-t border-slate-200/10 flex justify-end gap-3 backdrop-blur-sm\">\r\n          <Button\r\n            onClick={onClose}\r\n            variant=\"primary\"\r\n          >\r\n            OK\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * CSV Import Modal Component\r\n */\r\nfunction CSVImportModal({ isOpen, onClose, onImport, loading, error }) {\r\n  const [selectedFile, setSelectedFile] = useState(null);\r\n  const [showWarning, setShowWarning] = useState(false);\r\n  const [csvContent, setCsvContent] = useState(null);\r\n  const fileInputRef = useRef(null);\r\n\r\n  const handleFileSelect = (e) => {\r\n    const file = e.target.files[0];\r\n    if (!file) return;\r\n\r\n    // Check if file is CSV\r\n    if (!file.name.toLowerCase().endsWith('.csv') && file.type !== 'text/csv') {\r\n      alert('Please select a CSV file');\r\n      return;\r\n    }\r\n\r\n    setSelectedFile(file);\r\n    setShowWarning(false);\r\n    setCsvContent(null);\r\n\r\n    // Read file content\r\n    const reader = new FileReader();\r\n    reader.onload = (event) => {\r\n      setCsvContent(event.target.result);\r\n    };\r\n    reader.onerror = () => {\r\n      alert('Failed to read file');\r\n      setSelectedFile(null);\r\n    };\r\n    reader.readAsText(file);\r\n  };\r\n\r\n  const handleImportClick = () => {\r\n    if (!selectedFile || !csvContent) {\r\n      alert('Please select a CSV file first');\r\n      return;\r\n    }\r\n    setShowWarning(true);\r\n  };\r\n\r\n  const handleProceed = () => {\r\n    if (csvContent) {\r\n      onImport(csvContent);\r\n      setShowWarning(false);\r\n      setSelectedFile(null);\r\n      setCsvContent(null);\r\n      if (fileInputRef.current) {\r\n        fileInputRef.current.value = '';\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    setShowWarning(false);\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 flex items-center justify-center z-50 p-4\">\r\n      {/* Backdrop */}\r\n      <div\r\n        className=\"absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity\"\r\n        onClick={onClose}\r\n        aria-hidden=\"true\"\r\n      ></div>\r\n      \r\n      {/* Modal content */}\r\n      <div\r\n        className=\"relative bg-white rounded-2xl shadow-2xl w-full max-w-xl max-h-[90vh] overflow-hidden flex flex-col z-10\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        {/* Header */}\r\n        <div className=\"bg-gradient-to-r from-blue-50 via-blue-50/80 to-indigo-50/50 border-b border-blue-100 px-6 py-5 rounded-t-2xl flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg\">\r\n              <svg\r\n                className=\"w-6 h-6 text-white\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\"\r\n                />\r\n              </svg>\r\n            </div>\r\n            <div>\r\n              <h2 className=\"text-xl font-bold text-gray-900\">Import Products from CSV</h2>\r\n              <p className=\"text-sm text-gray-600\">Upload a CSV file to import products</p>\r\n            </div>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-all duration-200 p-2 rounded-xl\"\r\n            type=\"button\"\r\n            disabled={loading}\r\n            aria-label=\"Close modal\"\r\n          >\r\n            <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div className=\"overflow-y-auto flex-1 px-6 py-6\">\r\n          {!showWarning ? (\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-gray-700 mb-2\">\r\n                  Select CSV File\r\n                </label>\r\n                <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors\">\r\n                  <input\r\n                    ref={fileInputRef}\r\n                    type=\"file\"\r\n                    accept=\".csv,text/csv\"\r\n                    onChange={handleFileSelect}\r\n                    className=\"hidden\"\r\n                    id=\"csv-file-input\"\r\n                    disabled={loading}\r\n                  />\r\n                  <label\r\n                    htmlFor=\"csv-file-input\"\r\n                    className=\"cursor-pointer flex flex-col items-center gap-2\"\r\n                  >\r\n                    <svg\r\n                      className=\"w-12 h-12 text-gray-400\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\"\r\n                      />\r\n                    </svg>\r\n                    <span className=\"text-sm text-gray-600\">\r\n                      {selectedFile ? selectedFile.name : 'Click to browse or drag and drop'}\r\n                    </span>\r\n                    <span className=\"text-xs text-gray-500\">Only CSV files are accepted</span>\r\n                  </label>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4\">\r\n                <h3 className=\"text-sm font-semibold text-blue-800 mb-2\">Required CSV Columns:</h3>\r\n                <ul className=\"text-xs text-blue-700 space-y-1\">\r\n                  <li>• sku</li>\r\n                  <li>• name</li>\r\n                  <li>• category</li>\r\n                  <li>• description</li>\r\n                  <li>• product sold by</li>\r\n                  <li>• unit size</li>\r\n                  <li>• unit</li>\r\n                  <li>• quantity</li>\r\n                  <li>• cost price</li>\r\n                  <li>• selling price</li>\r\n                  <li>• low stock alert</li>\r\n                </ul>\r\n              </div>\r\n\r\n              {error && (\r\n                <div className=\"bg-red-50 border-l-4 border-red-500 rounded-lg p-4\">\r\n                  <p className=\"text-sm text-red-700\">{error}</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-4\">\r\n              <div className=\"bg-gradient-to-r from-red-50 via-red-50/80 to-orange-50/50 border-l-4 border-red-500 rounded-lg p-6\">\r\n                <div className=\"flex items-start gap-4\">\r\n                  <div className=\"w-10 h-10 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0\">\r\n                    <svg\r\n                      className=\"w-6 h-6 text-white\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"\r\n                      />\r\n                    </svg>\r\n                  </div>\r\n                  <div className=\"flex-1\">\r\n                    <h3 className=\"text-lg font-bold text-gray-900 mb-2\">Warning</h3>\r\n                    <p className=\"text-sm text-gray-700 mb-2\">\r\n                      This action cannot be undone. Importing products will add them to your inventory.\r\n                    </p>\r\n                    <p className=\"text-sm text-gray-600\">\r\n                      Are you sure you want to proceed with importing <strong>{selectedFile?.name}</strong>?\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"sticky bottom-0 px-6 py-4 bg-gradient-to-t from-slate-50 via-white to-transparent border-t border-slate-200/10 flex justify-end gap-3 backdrop-blur-sm\">\r\n          {!showWarning ? (\r\n            <>\r\n              <Button\r\n                onClick={onClose}\r\n                variant=\"secondary\"\r\n                disabled={loading}\r\n              >\r\n                Cancel\r\n              </Button>\r\n              <Button\r\n                onClick={handleImportClick}\r\n                variant=\"primary\"\r\n                disabled={!selectedFile || loading}\r\n                loading={loading}\r\n              >\r\n                Import\r\n              </Button>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Button\r\n                onClick={handleCancel}\r\n                variant=\"secondary\"\r\n                disabled={loading}\r\n              >\r\n                Cancel\r\n              </Button>\r\n              <Button\r\n                onClick={handleProceed}\r\n                variant=\"danger\"\r\n                disabled={loading}\r\n                loading={loading}\r\n              >\r\n                Proceed\r\n              </Button>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function InventoryPage() {\r\n  // State\r\n  const [products, setProducts] = useState(initialProducts);\r\n  const [categories, setCategories] = useState(() => {\r\n    try {\r\n      let storedType = null;\r\n      try {\r\n        storedType =\r\n          (typeof window !== \"undefined\" &&\r\n            sessionStorage.getItem(\"business_type\")) ||\r\n          null;\r\n      } catch (e) {\r\n        storedType = null;\r\n      }\r\n      // Fallback: try `user` object saved at login\r\n      if (!storedType && typeof window !== \"undefined\") {\r\n        try {\r\n          const raw =\r\n            sessionStorage.getItem(\"user\") || localStorage.getItem(\"user\");\r\n          if (raw) {\r\n            const parsed = JSON.parse(raw);\r\n            storedType =\r\n              parsed?.business?.business_type || parsed?.business_type || null;\r\n            if (storedType) {\r\n              try {\r\n                sessionStorage.setItem(\"business_type\", storedType);\r\n              } catch (e) {\r\n                /* ignore */\r\n              }\r\n            }\r\n          }\r\n        } catch (e) {\r\n          storedType = null;\r\n        }\r\n      }\r\n      storedType = storedType || \"Others\";\r\n      const list = getCategoriesByBusinessType(storedType) || [];\r\n      return list.map((name, index) => ({ id: index + 1, name }));\r\n    } catch {\r\n      return initialCategories;\r\n    }\r\n  });\r\n  const [showProductModal, setShowProductModal] = useState(false);\r\n  const [showStockModal, setShowStockModal] = useState(false);\r\n  const [editingProduct, setEditingProduct] = useState(null);\r\n  const [productForm, setProductForm] = useState({\r\n    sku: \"\",\r\n    name: \"\",\r\n    category: \"\",\r\n    customCategory: \"\",\r\n    description: \"\",\r\n    quantity: \"\",\r\n    cost_price: \"\",\r\n    selling_price: \"\",\r\n    low_stock_level: DEFAULT_LOW_STOCK_LEVEL,\r\n  });\r\n  const [stockForm, setStockForm] = useState({ sku: \"\", quantity: \"\" });\r\n  const [loading, setLoading] = useState(false);\r\n  const [search, setSearch] = useState(\"\");\r\n  const debouncedSearch = useDebounce(search, 400);\r\n  const [entriesPerPage, setEntriesPerPage] = useState(10);\r\n  const [page, setPage] = useState(1);\r\n  const [apiError, setApiError] = useState(\"\");\r\n  const [isSidebarOpen, setSidebarOpen] = useState(false);\r\n  const [deleteTarget, setDeleteTarget] = useState(null);\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [productToDelete, setProductToDelete] = useState(null);\r\n  const [exportingInventory, setExportingInventory] = useState(false);\r\n  const [showImportModal, setShowImportModal] = useState(false);\r\n  const [importingProducts, setImportingProducts] = useState(false);\r\n  const [showImportSuccessModal, setShowImportSuccessModal] = useState(false);\r\n  const [importResults, setImportResults] = useState({ successCount: 0, errors: [] });\r\n  // Load inventory and business type from API\r\n  useEffect(() => {\r\n    const fetchInventory = async () => {\r\n      try {\r\n        setLoading(true);\r\n        setApiError(\"\");\r\n        const token = sessionStorage.getItem(\"auth_token\");\r\n\r\n        // Fetch business type\r\n        const userData = await api(\"/api/auth/profile\", {\r\n          headers: authHeaders(token),\r\n        });\r\n        const businessType = userData?.business?.business_type || \"Others\";\r\n        // persist business type so modals can use it before API completes\r\n        try {\r\n          if (typeof window !== \"undefined\")\r\n            sessionStorage.setItem(\"business_type\", businessType);\r\n        } catch (storageErr) {\r\n          // ignore storage errors (e.g. private mode)\r\n\r\n          console.debug(\"Could not persist business_type\", storageErr);\r\n        }\r\n\r\n        // Set predefined categories based on business type\r\n        const predefinedCategories = getCategoriesByBusinessType(businessType);\r\n        setCategories(\r\n          predefinedCategories.map((name, index) => ({\r\n            id: index + 1,\r\n            name: name,\r\n          }))\r\n        );\r\n\r\n        // Fetch inventory with pagination support\r\n        const data = await api(\"/api/inventory\", {\r\n          headers: authHeaders(token),\r\n          params: { limit: 1000, offset: 0 }, // Fetch all for now, can be optimized later\r\n        });\r\n\r\n        // Handle both old array format and new paginated format\r\n        const productsData = data?.products || data || [];\r\n\r\n        // Map backend rows to UI shape with correct column mapping\r\n        // Include product_type and quantity_per_unit for unit conversion\r\n        const mapped = (productsData || []).map((row) => ({\r\n          id: String(row.id || \"\"),\r\n          name: row.name || \"-\",\r\n          category: row.category || \"-\",\r\n          quantity: Number(row.quantity || 0), // This is quantity_in_stock (base units)\r\n          cost_price: Number(row.cost_price || 0),\r\n          selling_price: Number(row.selling_price || 0),\r\n          sku: row.sku || \"\",\r\n          description: row.description || \"\",\r\n          low_stock_level: Number(\r\n            row.low_stock_level ?? DEFAULT_LOW_STOCK_LEVEL\r\n          ),\r\n          product_type: row.product_type || \"count\",\r\n          quantity_per_unit: Number(row.quantity_per_unit || 1),\r\n          base_unit: row.base_unit || \"pc\",\r\n          display_unit: row.display_unit || null,\r\n        }));\r\n        setProducts(mapped);\r\n      } catch (err) {\r\n        setApiError(\"Failed to load inventory\");\r\n        setProducts([]);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchInventory();\r\n  }, []);\r\n\r\n  // Helper function to convert base units to display units\r\n  const convertToDisplayUnits = (quantityInBaseUnits, productType, quantityPerUnit, baseUnit) => {\r\n    if (!quantityInBaseUnits || quantityInBaseUnits === 0) return 0;\r\n    if (productType === 'count' || !productType) {\r\n      return quantityInBaseUnits;\r\n    }\r\n    // For volume products with base_unit \"L\", inventory is stored in mL\r\n    // Convert mL to L first, then divide by quantity_per_unit (which is in L per display unit)\r\n    // Example: 50,000 mL stored → 50 L → 50 L / 1 L per bottle = 50 bottles\r\n    if (productType === 'volume' && baseUnit === 'L') {\r\n      const quantityInLiters = quantityInBaseUnits / 1000; // Convert mL to L\r\n      if (quantityPerUnit && quantityPerUnit > 0) {\r\n        const displayQty = quantityInLiters / quantityPerUnit;\r\n        // Safety check: if the calculated display quantity is unreasonably large (> 100,000), \r\n        // it's likely a data entry error - log a warning\r\n        if (displayQty > 100000) {\r\n          console.error(`[Inventory Conversion Error] Unusually large display quantity calculated: ${displayQty.toFixed(2)}. quantityInBaseUnits: ${quantityInBaseUnits}, quantityPerUnit: ${quantityPerUnit}, baseUnit: ${baseUnit}. This suggests incorrect data storage.`);\r\n        }\r\n        return displayQty;\r\n      }\r\n      return quantityInLiters;\r\n    }\r\n    if (quantityPerUnit && quantityPerUnit > 0) {\r\n      return quantityInBaseUnits / quantityPerUnit;\r\n    }\r\n    return quantityInBaseUnits;\r\n  };\r\n\r\n  // Check for duplicate products (by ID) - this could cause calculation errors\r\n  const productIds = products.map(p => p.id);\r\n  const duplicateIds = productIds.filter((id, index) => productIds.indexOf(id) !== index);\r\n  if (duplicateIds.length > 0) {\r\n    console.warn(`⚠️ Found duplicate products in array:`, duplicateIds);\r\n  }\r\n\r\n  // Stats - use display units for calculations\r\n  // Inventory value should be based on cost_price (what you paid), not selling_price (what you sell it for)\r\n  const totalInventoryValue = products.reduce((sum, p) => {\r\n    const displayQty = convertToDisplayUnits(p.quantity, p.product_type, p.quantity_per_unit, p.base_unit);\r\n    const costPrice = Number(p.cost_price || 0);\r\n    const itemValue = costPrice * displayQty;\r\n    \r\n    // Debug logging for volume products with base_unit \"L\" to catch conversion issues\r\n    if (p.product_type === 'volume' && p.base_unit === 'L') {\r\n      console.log(`[Inventory Value Debug] Product: ${p.name} (ID: ${p.id})`, {\r\n        quantity_in_stock_base_units: p.quantity,\r\n        quantity_per_unit: p.quantity_per_unit,\r\n        base_unit: p.base_unit,\r\n        display_qty_calculated: displayQty,\r\n        cost_price: costPrice,\r\n        item_value: itemValue\r\n      });\r\n    }\r\n    \r\n    // Add validation to catch unrealistic values (likely data entry errors)\r\n    // If a single item's value exceeds 1 million, log a detailed warning\r\n    if (itemValue > 1000000) {\r\n      console.error(`❌ CRITICAL: Unusually high inventory value for product \"${p.name}\" (ID: ${p.id}): ₱${itemValue.toLocaleString()}`);\r\n      console.error(`   Details: quantity=${p.quantity}, cost_price=${costPrice}, displayQty=${displayQty.toFixed(2)}, quantity_per_unit=${p.quantity_per_unit}, base_unit=${p.base_unit}`);\r\n      console.error(`   This suggests incorrect data. Please check the product's quantity_in_stock in the database.`);\r\n    }\r\n    \r\n    return sum + itemValue;\r\n  }, 0);\r\n  \r\n  // Always log the total and breakdown for debugging (remove the condition temporarily)\r\n  console.log(`[Inventory Total Debug] Total inventory value: ₱${totalInventoryValue.toLocaleString()}`);\r\n  console.log(`[Inventory Total Debug] Number of products: ${products.length}`);\r\n  \r\n  const productBreakdown = products.map(p => {\r\n    const dq = convertToDisplayUnits(p.quantity, p.product_type, p.quantity_per_unit, p.base_unit);\r\n    const val = dq * (p.cost_price || 0);\r\n    return {\r\n      id: p.id,\r\n      name: p.name,\r\n      quantity: p.quantity,\r\n      displayQty: parseFloat(dq.toFixed(2)),\r\n      costPrice: p.cost_price,\r\n      value: val,\r\n      product_type: p.product_type,\r\n      base_unit: p.base_unit,\r\n      quantity_per_unit: p.quantity_per_unit\r\n    };\r\n  }).sort((a, b) => b.value - a.value); // Sort by value descending\r\n  \r\n  console.log(`[Inventory Total Debug] Breakdown by product (sorted by value):`, productBreakdown);\r\n  \r\n  const sumVerification = products.reduce((sum, p) => {\r\n    const dq = convertToDisplayUnits(p.quantity, p.product_type, p.quantity_per_unit, p.base_unit);\r\n    return sum + (dq * (p.cost_price || 0));\r\n  }, 0);\r\n  \r\n  console.log(`[Inventory Total Debug] Sum verification: ₱${sumVerification.toLocaleString()}`);\r\n  \r\n  // Check if there's a discrepancy\r\n  if (Math.abs(totalInventoryValue - sumVerification) > 0.01) {\r\n    console.error(`❌ DISCREPANCY DETECTED: Calculated total (${totalInventoryValue}) doesn't match sum verification (${sumVerification})`);\r\n  }\r\n  \r\n  // Final validation: if total is unreasonably high, log a warning\r\n  if (totalInventoryValue > 1000000) {\r\n    console.warn(`⚠️ WARNING: Total inventory value is unusually high: ₱${totalInventoryValue.toLocaleString()}`);\r\n    console.warn(`   Top 3 products by value:`, productBreakdown.slice(0, 3));\r\n  }\r\n  \r\n  const lowStockItems = products.filter((p) => {\r\n    const displayQty = convertToDisplayUnits(p.quantity, p.product_type, p.quantity_per_unit, p.base_unit);\r\n    const threshold = Number(p.low_stock_level ?? DEFAULT_LOW_STOCK_LEVEL);\r\n    return displayQty < threshold;\r\n  }).length;\r\n\r\n  const stats = [\r\n    {\r\n      label: \"TOTAL ITEMS\",\r\n      value: products.length,\r\n      icon: (\r\n        <svg\r\n          width=\"32\"\r\n          height=\"32\"\r\n          fill=\"none\"\r\n          stroke=\"#2563eb\"\r\n          strokeWidth=\"2\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\" />\r\n        </svg>\r\n      ),\r\n      color: \"text-blue-800\",\r\n      sub: \"Total products in inventory\",\r\n    },\r\n    {\r\n      label: \"INVENTORY VALUE\",\r\n      value: totalInventoryValue,\r\n      icon: (\r\n        <svg\r\n          width=\"32\"\r\n          height=\"32\"\r\n          fill=\"none\"\r\n          stroke=\"#2563eb\"\r\n          strokeWidth=\"2\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n        </svg>\r\n      ),\r\n      color: \"text-green-700\",\r\n      formatValue: (val) => {\r\n        console.log(`[Format Value] Formatting inventory value: ${val} -> ₱${val.toLocaleString(undefined, { minimumFractionDigits: 2 })}`);\r\n        return `₱${val.toLocaleString(undefined, { minimumFractionDigits: 2 })}`;\r\n      },\r\n      sub: \"Total value of all stock\",\r\n    },\r\n    {\r\n      label: \"AVAILABLE CATEGORIES\",\r\n      value: categories.length,\r\n      icon: (\r\n        <svg\r\n          width=\"32\"\r\n          height=\"32\"\r\n          fill=\"none\"\r\n          stroke=\"#2563eb\"\r\n          strokeWidth=\"2\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path d=\"M4 7h16M4 12h16M4 17h16\" />\r\n        </svg>\r\n      ),\r\n      color: \"text-blue-500\",\r\n      sub: \"Product categories\",\r\n    },\r\n    {\r\n      label: \"LOW STOCK ALERTS\",\r\n      value: lowStockItems,\r\n      icon: (\r\n        <svg\r\n          width=\"32\"\r\n          height=\"32\"\r\n          fill=\"none\"\r\n          stroke=\"#2563eb\"\r\n          strokeWidth=\"2\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n        </svg>\r\n      ),\r\n      color: \"text-orange-600\",\r\n      sub: \"Items needing restock\",\r\n    },\r\n  ];\r\n\r\n  // Additional filter states (will be handled by Inventory component)\r\n  const [sortBy, setSortBy] = useState(\"name\");\r\n  const [sortOrder, setSortOrder] = useState(\"asc\");\r\n  const [selectedCategory, setSelectedCategory] = useState(null);\r\n  const [stockFilter, setStockFilter] = useState(null);\r\n\r\n  // Filtering, sorting and pagination - use debounced search\r\n  const filteredProducts = useMemo(() => {\r\n    let filtered = products.filter(\r\n      (p) =>\r\n        p.name.toLowerCase().includes(debouncedSearch.toLowerCase()) ||\r\n        p.category.toLowerCase().includes(debouncedSearch.toLowerCase()) ||\r\n        p.description.toLowerCase().includes(debouncedSearch.toLowerCase())\r\n    );\r\n\r\n    // Apply category filter\r\n    if (selectedCategory) {\r\n      filtered = filtered.filter((p) => p.category === selectedCategory);\r\n    }\r\n\r\n    // Apply stock filter - use display units for comparison\r\n    if (stockFilter) {\r\n      if (stockFilter === \"out_of_stock\") {\r\n        filtered = filtered.filter((p) => {\r\n          const displayQty = convertToDisplayUnits(p.quantity, p.product_type, p.quantity_per_unit, p.base_unit);\r\n          return displayQty === 0;\r\n        });\r\n      } else if (stockFilter === \"low_stock\") {\r\n        filtered = filtered.filter((p) => {\r\n          const displayQty = convertToDisplayUnits(p.quantity, p.product_type, p.quantity_per_unit, p.base_unit);\r\n          const threshold = Number(\r\n            p.low_stock_level ?? DEFAULT_LOW_STOCK_LEVEL\r\n          );\r\n          return displayQty > 0 && displayQty < threshold;\r\n        });\r\n      } else if (stockFilter === \"in_stock\") {\r\n        filtered = filtered.filter((p) => {\r\n          const displayQty = convertToDisplayUnits(p.quantity, p.product_type, p.quantity_per_unit, p.base_unit);\r\n          const threshold = Number(\r\n            p.low_stock_level ?? DEFAULT_LOW_STOCK_LEVEL\r\n          );\r\n          return displayQty >= threshold;\r\n        });\r\n      }\r\n    }\r\n\r\n    // Apply sorting\r\n    filtered.sort((a, b) => {\r\n      let aVal, bVal;\r\n      if (sortBy === \"name\") {\r\n        aVal = (a.name || \"\").toLowerCase();\r\n        bVal = (b.name || \"\").toLowerCase();\r\n      } else if (sortBy === \"category\") {\r\n        aVal = (a.category || \"\").toLowerCase();\r\n        bVal = (b.category || \"\").toLowerCase();\r\n      } else if (sortBy === \"quantity\") {\r\n        // Sort by display units for consistent sorting across product types\r\n        aVal = convertToDisplayUnits(a.quantity, a.product_type, a.quantity_per_unit, a.base_unit);\r\n        bVal = convertToDisplayUnits(b.quantity, b.product_type, b.quantity_per_unit, b.base_unit);\r\n      } else if (sortBy === \"selling_price\") {\r\n        aVal = Number(a.selling_price || 0);\r\n        bVal = Number(b.selling_price || 0);\r\n      } else {\r\n        return 0;\r\n      }\r\n\r\n      if (aVal < bVal) return sortOrder === \"asc\" ? -1 : 1;\r\n      if (aVal > bVal) return sortOrder === \"asc\" ? 1 : -1;\r\n      return 0;\r\n    });\r\n\r\n    return filtered;\r\n  }, [products, debouncedSearch, selectedCategory, stockFilter, sortBy, sortOrder]);\r\n\r\n  const totalPages = Math.ceil(filteredProducts.length / entriesPerPage) || 1;\r\n  const paginatedProducts = filteredProducts.slice(\r\n    (page - 1) * entriesPerPage,\r\n    page * entriesPerPage\r\n  );\r\n\r\n  // Handlers - memoized with useCallback\r\n  const openAddProduct = useCallback(() => {\r\n    setEditingProduct(null);\r\n    setProductForm({\r\n      sku: \"\",\r\n      name: \"\",\r\n      category: \"\",\r\n      customCategory: \"\",\r\n      description: \"\",\r\n      quantity: \"\",\r\n      cost_price: \"\",\r\n      selling_price: \"\",\r\n      low_stock_level: DEFAULT_LOW_STOCK_LEVEL,\r\n      product_sold_by: \"Per Piece\",\r\n      unit_size: \"\",\r\n      unit: \"\",\r\n    });\r\n    setShowProductModal(true);\r\n  }, []);\r\n\r\n  const openEditProduct = useCallback((product) => {\r\n    setEditingProduct(product);\r\n    \r\n    // Map product_type to product_sold_by for the form\r\n    let productSoldBy = \"Per Piece\";\r\n    if (product.product_type === 'weight') {\r\n      productSoldBy = \"By Weight\";\r\n    } else if (product.product_type === 'volume') {\r\n      productSoldBy = \"By Volume\";\r\n    }\r\n    \r\n    setProductForm({\r\n      ...product,\r\n      name: product.name || \"\",\r\n      sku: product.sku || \"\",\r\n      category: product.category || \"\",\r\n      description: product.description || \"\",\r\n      cost_price: product.cost_price || \"\",\r\n      selling_price: product.selling_price || \"\",\r\n      low_stock_level:\r\n        typeof product.low_stock_level === \"number\"\r\n          ? product.low_stock_level\r\n          : DEFAULT_LOW_STOCK_LEVEL,\r\n      product_sold_by: productSoldBy,\r\n      unit_size: product.quantity_per_unit ? String(product.quantity_per_unit) : \"\",\r\n      unit: product.base_unit && product.base_unit !== 'pc' ? product.base_unit : (product.product_type === 'weight' ? 'g' : product.product_type === 'volume' ? 'mL' : ''),\r\n    });\r\n    setShowProductModal(true);\r\n  }, []);\r\n\r\n  const openStockEntry = useCallback((product) => {\r\n    setStockForm({ sku: product?.sku || \"\", quantity: \"\" });\r\n    setShowStockModal(true);\r\n  }, []);\r\n\r\n  const handleProductFormChange = useCallback((e) => {\r\n    const { name, value } = e.target;\r\n    // Clear error if user explicitly clears it or starts typing in form fields\r\n    if (name === 'clearError') {\r\n      setApiError(\"\");\r\n    } else if (apiError && name !== 'clearError') {\r\n      // Only clear error when user modifies form fields (not on initial render)\r\n      setApiError(\"\");\r\n    }\r\n    if (name !== 'clearError') {\r\n      setProductForm((prev) => {\r\n        const updated = { ...prev, [name]: value };\r\n        \r\n        // When product_sold_by changes, set default values for unit_size and unit if empty\r\n        if (name === 'product_sold_by') {\r\n          if (value === 'By Weight' || value === 'By Volume') {\r\n            // Set default unit if empty\r\n            if (!updated.unit || updated.unit === '') {\r\n              updated.unit = value === 'By Weight' ? 'g' : 'mL';\r\n            }\r\n            // For editing: if unit_size is empty, try to use existing quantity_per_unit, otherwise set a default\r\n            if (!updated.unit_size || updated.unit_size === '') {\r\n              // If editing and product has quantity_per_unit, use it; otherwise set default\r\n              if (editingProduct && editingProduct.quantity_per_unit) {\r\n                updated.unit_size = String(editingProduct.quantity_per_unit);\r\n              } else {\r\n                // Set a default value to pass validation (user can change it)\r\n                updated.unit_size = value === 'By Weight' ? '100' : '250';\r\n              }\r\n            }\r\n          } else if (value === 'Per Piece') {\r\n            // Clear unit fields when switching back to Per Piece\r\n            updated.unit_size = '';\r\n            updated.unit = '';\r\n          }\r\n        }\r\n        \r\n        return updated;\r\n      });\r\n    }\r\n  }, [apiError, editingProduct]);\r\n\r\n  const handleProductSubmit = useCallback(async (e) => {\r\n    e.preventDefault();\r\n    try {\r\n      setLoading(true);\r\n      setApiError(\"\");\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n\r\n      if (editingProduct) {\r\n        // Update existing product\r\n        await api(`/api/inventory/${editingProduct.id}`, {\r\n          method: \"PUT\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            ...authHeaders(token),\r\n          },\r\n          body: JSON.stringify({\r\n            product_name: (productForm.name || \"\").trim(),\r\n            cost_price: Number(productForm.cost_price) || 0,\r\n            selling_price: Number(productForm.selling_price) || 0,\r\n            sku: (productForm.sku || \"\").trim(),\r\n            low_stock_level:\r\n              Number(productForm.low_stock_level) || DEFAULT_LOW_STOCK_LEVEL,\r\n            category:\r\n              productForm.category === \"Others\"\r\n                ? (productForm.customCategory || \"\").trim()\r\n                : (productForm.category || \"\").trim(),\r\n            description: (productForm.description || \"\").trim(),\r\n            product_sold_by: productForm.product_sold_by || \"Per Piece\",\r\n            unit_size: productForm.unit_size ? Number(productForm.unit_size) : undefined,\r\n            unit: productForm.unit || undefined,\r\n          }),\r\n        });\r\n      } else {\r\n        // Create new product\r\n        await api(\"/api/products\", {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            ...authHeaders(token),\r\n          },\r\n          body: JSON.stringify({\r\n            product_category_id: null,\r\n            category:\r\n              productForm.category === \"Others\"\r\n                ? (productForm.customCategory || \"\").trim()\r\n                : (productForm.category || \"\").trim(),\r\n            product_name: (productForm.name || \"\").trim(),\r\n            name: (productForm.name || \"\").trim(),\r\n            description: (productForm.description || \"\").trim(),\r\n            cost_price: Number(productForm.cost_price) || 0,\r\n            selling_price: Number(productForm.selling_price) || 0,\r\n            price: Number(productForm.selling_price) || 0,\r\n            sku: (productForm.sku || \"\").trim() || `SKU-${Date.now()}`,\r\n            quantity: Number(productForm.quantity) || 0,\r\n            low_stock_level:\r\n              Number(productForm.low_stock_level) || DEFAULT_LOW_STOCK_LEVEL,\r\n            product_sold_by: productForm.product_sold_by || \"Per Piece\",\r\n            unit_size: productForm.unit_size ? Number(productForm.unit_size) : undefined,\r\n            unit: productForm.unit || undefined,\r\n          }),\r\n        });\r\n      }\r\n\r\n      // Refresh inventory list after creation/update\r\n      const data = await api(\"/api/inventory\", { \r\n        headers: authHeaders(token),\r\n        params: { limit: 1000, offset: 0 }\r\n      });\r\n      const productsData = data?.products || data || [];\r\n      const mapped = (productsData || []).map((row) => ({\r\n        id: String(row.id || \"\"),\r\n        name: row.name || \"-\",\r\n        category: row.category || \"-\",\r\n        quantity: Number(row.quantity || 0),\r\n        cost_price: Number(row.cost_price || 0),\r\n        selling_price: Number(row.selling_price || 0),\r\n        sku: row.sku || \"\",\r\n        description: row.description || \"\",\r\n        low_stock_level: Number(row.low_stock_level ?? DEFAULT_LOW_STOCK_LEVEL),\r\n        product_type: row.product_type || \"count\",\r\n        quantity_per_unit: Number(row.quantity_per_unit || 1),\r\n        base_unit: row.base_unit || \"pc\",\r\n        display_unit: row.display_unit || null,\r\n      }));\r\n      setProducts(mapped);\r\n      setShowProductModal(false);\r\n    } catch (err) {\r\n      // Handle duplicate SKU error and other errors\r\n      let errorMessage = \"Failed to save product\";\r\n      try {\r\n        // Check if error has response data (from api.js)\r\n        const errorData = err.response?.data || err.data || {};\r\n        const errorStatus = err.response?.status;\r\n        \r\n        if (errorStatus === 409 || errorData.error === 'Product with this SKU already exists') {\r\n          // Duplicate SKU error - provide clear message\r\n          errorMessage = errorData.message || `A product with SKU \"${productForm.sku?.trim() || 'this SKU'}\" already exists. Please use a different SKU.`;\r\n          if (errorData.existingProduct) {\r\n            errorMessage = `SKU \"${productForm.sku?.trim()}\" is already in use by \"${errorData.existingProduct.product_name}\". Please use a different SKU code.`;\r\n          }\r\n        } else if (errorData.error || errorData.message) {\r\n          // Other API errors\r\n          errorMessage = errorData.message || errorData.error;\r\n        } else if (err.message) {\r\n          // Error from api.js wrapper\r\n          errorMessage = err.message;\r\n        }\r\n      } catch (parseErr) {\r\n        // If parsing fails, use error message if available\r\n        errorMessage = err.message || \"Failed to save product\";\r\n        console.error(\"Error parsing error response:\", parseErr);\r\n      }\r\n      setApiError(errorMessage);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [editingProduct, productForm]);\r\n\r\n  const handleStockSubmit = useCallback(async (e) => {\r\n    e.preventDefault();\r\n    try {\r\n      setLoading(true);\r\n      setApiError(\"\");\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n      await api(\"/api/products/add-stock-by-sku\", {\r\n        method: \"POST\",\r\n        headers: authHeaders(token),\r\n        body: JSON.stringify({\r\n          sku: stockForm.sku,\r\n          quantity: Number(stockForm.quantity),\r\n        }),\r\n      });\r\n      const data = await api(\"/api/inventory\", { \r\n        headers: authHeaders(token),\r\n        params: { limit: 1000, offset: 0 }\r\n      });\r\n      const productsData = data?.products || data || [];\r\n      const mapped = (productsData || []).map((row) => ({\r\n        id: String(row.id || \"\"),\r\n        name: row.name || \"-\",\r\n        category: row.category || \"-\",\r\n        quantity: Number(row.quantity || 0),\r\n        cost_price: Number(row.cost_price || 0),\r\n        selling_price: Number(row.selling_price || 0),\r\n        sku: row.sku || \"\",\r\n        description: row.description || \"\",\r\n        low_stock_level: Number(row.low_stock_level ?? DEFAULT_LOW_STOCK_LEVEL),\r\n        product_type: row.product_type || \"count\",\r\n        quantity_per_unit: Number(row.quantity_per_unit || 1),\r\n        base_unit: row.base_unit || \"pc\",\r\n        display_unit: row.display_unit || null,\r\n      }));\r\n      setProducts(mapped);\r\n      setShowStockModal(false);\r\n    } catch (err) {\r\n      setApiError(\"Failed to add stock\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [stockForm]);\r\n\r\n  const handleDeleteProduct = useCallback((id) => {\r\n    const product = products.find((p) => String(p.id) === String(id));\r\n    if (product) {\r\n      setProductToDelete(product);\r\n      setShowDeleteModal(true);\r\n    }\r\n  }, [products]);\r\n\r\n  const confirmDeleteProduct = useCallback(async () => {\r\n    if (!productToDelete) return;\r\n    try {\r\n      setLoading(true);\r\n      setApiError(\"\");\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n      \r\n      // First try the new API endpoint\r\n      try {\r\n        await api(`/api/products/${productToDelete.id}`, {\r\n          method: \"DELETE\",\r\n          headers: authHeaders(token),\r\n        });\r\n      } catch (err) {\r\n        // Fallback to the old endpoint if the first one fails\r\n        console.log('Trying fallback delete endpoint...');\r\n        await api(`/api/inventory/${productToDelete.id}`, {\r\n          method: \"DELETE\",\r\n          headers: authHeaders(token),\r\n        });\r\n      }\r\n\r\n      // Update the UI by removing the deleted product\r\n      setProducts(prev => prev.filter(p => p.id !== productToDelete.id));\r\n      setShowDeleteModal(false);\r\n      setProductToDelete(null);\r\n    } catch (err) {\r\n      console.error('Error deleting product:', err);\r\n      setApiError(err.response?.data?.error || \"Failed to delete product. Please try again.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [productToDelete]);\r\n\r\n  const handlePageChange = useCallback((newPage) => {\r\n    if (newPage < 1 || newPage > totalPages) return;\r\n    setPage(newPage);\r\n  }, [totalPages]);\r\n\r\n  const handleEntriesChange = useCallback((e) => {\r\n    setEntriesPerPage(Number(e.target.value));\r\n    setPage(1);\r\n  }, []);\r\n\r\n  const handleSearchChange = useCallback((e) => {\r\n    setSearch(e.target.value);\r\n    setPage(1);\r\n  }, []);\r\n\r\n  // CSV Import handler\r\n  const handleCSVImport = useCallback(async (csvData) => {\r\n    try {\r\n      setImportingProducts(true);\r\n      setApiError(\"\");\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n\r\n      // Parse CSV data - filter out completely empty lines\r\n      const lines = csvData.split('\\n').filter(line => line.trim().length > 0);\r\n      if (lines.length < 2) {\r\n        throw new Error('CSV file must contain at least a header row and one data row');\r\n      }\r\n\r\n      // Parse header row\r\n      const headers = lines[0].split(',').map(h => h.trim().toLowerCase());\r\n      const requiredColumns = ['sku', 'name', 'category', 'description', 'product sold by', 'unit size', 'unit', 'quantity', 'cost price', 'selling price', 'low stock alert'];\r\n      \r\n      // Check if all required columns are present\r\n      const missingColumns = requiredColumns.filter(col => !headers.includes(col));\r\n      if (missingColumns.length > 0) {\r\n        throw new Error(`Missing required columns: ${missingColumns.join(', ')}`);\r\n      }\r\n\r\n      // Parse data rows\r\n      const products = [];\r\n      const errors = [];\r\n      \r\n      for (let i = 1; i < lines.length; i++) {\r\n        const line = lines[i].trim();\r\n        // Skip completely empty lines\r\n        if (!line) continue;\r\n\r\n        try {\r\n          // Simple CSV parsing (handles quoted values)\r\n          const values = [];\r\n          let current = '';\r\n          let inQuotes = false;\r\n          \r\n          for (let j = 0; j < line.length; j++) {\r\n            const char = line[j];\r\n            if (char === '\"') {\r\n              inQuotes = !inQuotes;\r\n            } else if (char === ',' && !inQuotes) {\r\n              values.push(current.trim());\r\n              current = '';\r\n            } else {\r\n              current += char;\r\n            }\r\n          }\r\n          values.push(current.trim());\r\n\r\n          if (values.length !== headers.length) {\r\n            errors.push(`Row ${i + 1}: Column count mismatch`);\r\n            continue;\r\n          }\r\n\r\n          // Check if row is empty (all values are empty or just commas)\r\n          const hasData = values.some(val => val && val.trim().length > 0);\r\n          if (!hasData) {\r\n            // Skip completely empty rows\r\n            continue;\r\n          }\r\n\r\n          // Map values to object\r\n          const product = {};\r\n          headers.forEach((header, index) => {\r\n            product[header] = values[index] || '';\r\n          });\r\n\r\n          // Validate and transform product data\r\n          const sku = product['sku']?.trim() || `SKU-${Date.now()}-${i}`;\r\n          const name = product['name']?.trim();\r\n          if (!name) {\r\n            errors.push(`Row ${i + 1}: Name is required`);\r\n            continue;\r\n          }\r\n\r\n          const category = product['category']?.trim() || '';\r\n          const description = product['description']?.trim() || '';\r\n          \r\n          // Normalize \"product sold by\" value (case-insensitive, handle variations)\r\n          let productSoldByRaw = product['product sold by']?.trim() || 'Per Piece';\r\n          let productSoldBy = 'Per Piece'; // default\r\n          \r\n          // Normalize to match backend expectations\r\n          const soldByLower = productSoldByRaw.toLowerCase();\r\n          if (soldByLower === 'per piece' || soldByLower === 'per_piece' || soldByLower === 'count' || soldByLower === 'piece') {\r\n            productSoldBy = 'Per Piece';\r\n          } else if (soldByLower === 'by weight' || soldByLower === 'by_weight' || soldByLower === 'weight' || soldByLower === 'per weight') {\r\n            productSoldBy = 'By Weight';\r\n          } else if (soldByLower === 'by volume' || soldByLower === 'by_volume' || soldByLower === 'volume' || soldByLower === 'per volume') {\r\n            productSoldBy = 'By Volume';\r\n          } else {\r\n            // Try to match with common variations\r\n            productSoldBy = productSoldByRaw; // Pass through, backend will validate\r\n          }\r\n          \r\n          // Parse unit size - handle cases where it contains both number and unit (e.g., \"1 L\")\r\n          let unitSizeRaw = product['unit size']?.trim() || '';\r\n          let unitFromColumn = product['unit']?.trim() || '';\r\n          let unitSize = '';\r\n          let unit = '';\r\n          \r\n          if (unitSizeRaw) {\r\n            // Check if unit size contains both number and unit (e.g., \"1 L\", \"250 mL\", \"500 g\")\r\n            const unitSizeMatch = unitSizeRaw.match(/^([\\d.]+)\\s*(kg|g|L|mL|liter|liters|litre|litres|kilogram|kilograms)$/i);\r\n            if (unitSizeMatch) {\r\n              // Extract number and unit from unit size field\r\n              unitSize = unitSizeMatch[1];\r\n              const extractedUnit = unitSizeMatch[2].toLowerCase();\r\n              \r\n              // Normalize unit from unit size field\r\n              if (extractedUnit === 'kg' || extractedUnit === 'kilogram' || extractedUnit === 'kilograms') {\r\n                unit = 'kg';\r\n              } else if (extractedUnit === 'g' || extractedUnit === 'gram' || extractedUnit === 'grams') {\r\n                unit = 'g';\r\n              } else if (extractedUnit === 'l' || extractedUnit === 'liter' || extractedUnit === 'liters' || extractedUnit === 'litre' || extractedUnit === 'litres') {\r\n                unit = 'L';\r\n              } else if (extractedUnit === 'ml' || extractedUnit === 'milliliter' || extractedUnit === 'milliliters' || extractedUnit === 'millilitre' || extractedUnit === 'millilitres') {\r\n                unit = 'mL';\r\n              }\r\n            } else {\r\n              // Just a number, use it as-is\r\n              unitSize = unitSizeRaw;\r\n              // Use unit from separate unit column if provided\r\n              if (unitFromColumn) {\r\n                const unitLower = unitFromColumn.toLowerCase();\r\n                if (unitLower === 'kg' || unitLower === 'kilogram' || unitLower === 'kilograms') {\r\n                  unit = 'kg';\r\n                } else if (unitLower === 'g' || unitLower === 'gram' || unitLower === 'grams') {\r\n                  unit = 'g';\r\n                } else if (unitLower === 'l' || unitLower === 'liter' || unitLower === 'liters' || unitLower === 'litre' || unitLower === 'litres') {\r\n                  unit = 'L';\r\n                } else if (unitLower === 'ml' || unitLower === 'milliliter' || unitLower === 'milliliters' || unitLower === 'millilitre' || unitLower === 'millilitres') {\r\n                  unit = 'mL';\r\n                } else {\r\n                  unit = unitFromColumn; // Pass through\r\n                }\r\n              }\r\n            }\r\n          } else if (unitFromColumn) {\r\n            // Unit size is empty but unit is provided\r\n            const unitLower = unitFromColumn.toLowerCase();\r\n            if (unitLower === 'kg' || unitLower === 'kilogram' || unitLower === 'kilograms') {\r\n              unit = 'kg';\r\n            } else if (unitLower === 'g' || unitLower === 'gram' || unitLower === 'grams') {\r\n              unit = 'g';\r\n            } else if (unitLower === 'l' || unitLower === 'liter' || unitLower === 'liters' || unitLower === 'litre' || unitLower === 'litres') {\r\n              unit = 'L';\r\n            } else if (unitLower === 'ml' || unitLower === 'milliliter' || unitLower === 'milliliters' || unitLower === 'millilitre' || unitLower === 'millilitres') {\r\n              unit = 'mL';\r\n            } else {\r\n              unit = unitFromColumn; // Pass through\r\n            }\r\n          }\r\n          \r\n          // For \"Per Piece\" products, unit size and unit should be empty/undefined\r\n          if (productSoldBy === 'Per Piece') {\r\n            unitSize = '';\r\n            unit = '';\r\n          }\r\n          \r\n          const quantity = Number(product['quantity']?.trim() || 0);\r\n          const costPrice = Number(product['cost price']?.trim() || 0);\r\n          const sellingPrice = Number(product['selling price']?.trim() || 0);\r\n          const lowStockAlert = Number(product['low stock alert']?.trim() || DEFAULT_LOW_STOCK_LEVEL);\r\n\r\n          if (quantity <= 0) {\r\n            errors.push(`Row ${i + 1}: Quantity must be greater than 0`);\r\n            continue;\r\n          }\r\n\r\n          if (sellingPrice < costPrice) {\r\n            errors.push(`Row ${i + 1}: Selling price must be greater than or equal to cost price`);\r\n            continue;\r\n          }\r\n\r\n          products.push({\r\n            sku,\r\n            name,\r\n            category,\r\n            description,\r\n            product_sold_by: productSoldBy,\r\n            unit_size: unitSize ? Number(unitSize) : undefined,\r\n            unit: unit || undefined,\r\n            quantity,\r\n            cost_price: costPrice,\r\n            selling_price: sellingPrice,\r\n            low_stock_level: lowStockAlert,\r\n          });\r\n        } catch (err) {\r\n          errors.push(`Row ${i + 1}: ${err.message || 'Invalid data'}`);\r\n        }\r\n      }\r\n\r\n      if (errors.length > 0 && products.length === 0) {\r\n        throw new Error(`Import failed:\\n${errors.join('\\n')}`);\r\n      }\r\n\r\n      if (products.length === 0) {\r\n        throw new Error('No valid products found in CSV file');\r\n      }\r\n\r\n      // Call bulk import endpoint\r\n      const response = await api(\"/api/products/bulk-import\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          ...authHeaders(token),\r\n        },\r\n        body: JSON.stringify({ products }),\r\n      });\r\n\r\n      // Refresh inventory list\r\n      const data = await api(\"/api/inventory\", {\r\n        headers: authHeaders(token),\r\n        params: { limit: 1000, offset: 0 }\r\n      });\r\n      const productsData = data?.products || data || [];\r\n      const mapped = (productsData || []).map((row) => ({\r\n        id: String(row.id || \"\"),\r\n        name: row.name || \"-\",\r\n        category: row.category || \"-\",\r\n        quantity: Number(row.quantity || 0),\r\n        cost_price: Number(row.cost_price || 0),\r\n        selling_price: Number(row.selling_price || 0),\r\n        sku: row.sku || \"\",\r\n        description: row.description || \"\",\r\n        low_stock_level: Number(row.low_stock_level ?? DEFAULT_LOW_STOCK_LEVEL),\r\n        product_type: row.product_type || \"count\",\r\n        quantity_per_unit: Number(row.quantity_per_unit || 1),\r\n        base_unit: row.base_unit || \"pc\",\r\n        display_unit: row.display_unit || null,\r\n      }));\r\n      setProducts(mapped);\r\n      setShowImportModal(false);\r\n\r\n      // Prepare success modal data\r\n      const apiErrors = response?.errors || [];\r\n      const allErrors = [...errors, ...(apiErrors.map(e => `Row ${e.index + 1}: ${e.error}`))];\r\n      const successCount = response?.success?.length || products.length;\r\n      \r\n      setImportResults({\r\n        successCount,\r\n        errors: allErrors\r\n      });\r\n      setShowImportSuccessModal(true);\r\n    } catch (err) {\r\n      const errorMessage = err.response?.data?.error || err.message || \"Failed to import products\";\r\n      setApiError(errorMessage);\r\n      console.error(\"CSV import error:\", err);\r\n    } finally {\r\n      setImportingProducts(false);\r\n    }\r\n  }, []);\r\n\r\n  const handleExport = useCallback(async () => {\r\n    setExportingInventory(true);\r\n    try {\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n\r\n      // Fetch store information\r\n      const profileData = await api(\"/auth/profile\", {\r\n        headers: authHeaders(token),\r\n      });\r\n\r\n      const business = profileData?.business || {};\r\n      const storeName = business.business_name || \"Store\";\r\n      const addressParts = [\r\n        business.house_number,\r\n        business.barangay,\r\n        business.city,\r\n        business.province,\r\n      ].filter(Boolean);\r\n      const address = addressParts.join(\", \") || \"N/A\";\r\n      const contact = business.mobile || business.email || \"N/A\";\r\n\r\n      // Check if there's any inventory data\r\n      if (!filteredProducts || filteredProducts.length === 0) {\r\n        alert(\"No inventory data found to export.\");\r\n        return;\r\n      }\r\n\r\n      // Calculate totals\r\n      const totalInventoryValue = filteredProducts.reduce((sum, p) => {\r\n        const displayQty = convertToDisplayUnits(\r\n          p.quantity,\r\n          p.product_type,\r\n          p.quantity_per_unit,\r\n          p.base_unit\r\n        );\r\n        const costPrice = Number(p.cost_price || 0);\r\n        return sum + costPrice * displayQty;\r\n      }, 0);\r\n\r\n      // Create PDF\r\n      const pdf = new jsPDF(\"p\", \"mm\", \"a4\");\r\n      const pageWidth = pdf.internal.pageSize.getWidth();\r\n      const margin = 20;\r\n      const contentWidth = pageWidth - 2 * margin;\r\n      let yPos = margin;\r\n\r\n      // Helper function to add a new page if needed\r\n      const checkPageBreak = (requiredHeight) => {\r\n        if (yPos + requiredHeight > pdf.internal.pageSize.getHeight() - margin) {\r\n          pdf.addPage();\r\n          yPos = margin;\r\n          return true;\r\n        }\r\n        return false;\r\n      };\r\n\r\n      // Store name (centered, top middle)\r\n      pdf.setFontSize(20);\r\n      pdf.setFont(\"helvetica\", \"bold\");\r\n      const storeNameWidth = pdf.getTextWidth(storeName);\r\n      pdf.text(storeName, (pageWidth - storeNameWidth) / 2, yPos);\r\n      yPos += 10;\r\n\r\n      // Address (centered, under store name)\r\n      pdf.setFontSize(12);\r\n      pdf.setFont(\"helvetica\", \"normal\");\r\n      const addressWidth = pdf.getTextWidth(address);\r\n      pdf.text(address, (pageWidth - addressWidth) / 2, yPos);\r\n      yPos += 7;\r\n\r\n      // Contact information (centered, under address)\r\n      const contactWidth = pdf.getTextWidth(contact);\r\n      pdf.text(contact, (pageWidth - contactWidth) / 2, yPos);\r\n      yPos += 15;\r\n\r\n      // Inventory Report heading\r\n      pdf.setFontSize(16);\r\n      pdf.setFont(\"helvetica\", \"bold\");\r\n      pdf.text(\"Inventory Report\", margin, yPos);\r\n      yPos += 8;\r\n\r\n      // Export date\r\n      pdf.setFontSize(12);\r\n      pdf.setFont(\"helvetica\", \"normal\");\r\n      const exportDate = new Date().toLocaleDateString(\"en-US\", {\r\n        year: \"numeric\",\r\n        month: \"short\",\r\n        day: \"numeric\",\r\n      });\r\n      pdf.text(`Date: ${exportDate}`, margin, yPos);\r\n      yPos += 10;\r\n\r\n      // Table header - adjusted widths to prevent overlap\r\n      const colWidths = [\r\n        contentWidth * 0.24, // Product\r\n        contentWidth * 0.14, // Category\r\n        contentWidth * 0.16, // Cost Price\r\n        contentWidth * 0.16, // Selling Price\r\n        contentWidth * 0.15, // Unit\r\n        contentWidth * 0.15, // Stock\r\n      ];\r\n      const colX = [margin];\r\n      for (let i = 1; i < colWidths.length; i++) {\r\n        colX.push(colX[i - 1] + colWidths[i - 1]);\r\n      }\r\n\r\n      pdf.setFontSize(10);\r\n      pdf.setFont(\"helvetica\", \"bold\");\r\n      const headerY = yPos;\r\n      pdf.text(\"Product\", colX[0], headerY);\r\n      pdf.text(\"Category\", colX[1], headerY);\r\n      pdf.text(\"Cost Price\", colX[2], headerY);\r\n      pdf.text(\"Selling Price\", colX[3], headerY);\r\n      pdf.text(\"Unit\", colX[4], headerY);\r\n      pdf.text(\"Stock\", colX[5], headerY);\r\n      yPos += 8;\r\n\r\n      // Draw header line\r\n      pdf.setLineWidth(0.5);\r\n      pdf.line(margin, yPos - 2, pageWidth - margin, yPos - 2);\r\n      yPos += 3;\r\n\r\n      // Table rows\r\n      pdf.setFont(\"helvetica\", \"normal\");\r\n      pdf.setFontSize(9);\r\n\r\n      filteredProducts.forEach((item) => {\r\n        checkPageBreak(10);\r\n\r\n        const productName = item.name || \"\";\r\n        const category = item.category || \"\";\r\n        const costPrice = `PHP ${Number(item.cost_price || 0).toFixed(2)}`;\r\n        const sellingPrice = `PHP ${Number(item.selling_price || 0).toFixed(2)}`;\r\n        const unitDisplay = getUnitDisplay(item);\r\n        const stockDisplay = formatStockForPDF(\r\n          item.quantity,\r\n          item.product_type,\r\n          item.quantity_per_unit,\r\n          item.base_unit\r\n        );\r\n\r\n        // Truncate product name if too long\r\n        const maxNameWidth = colWidths[0] - 5;\r\n        let displayName = productName;\r\n        if (pdf.getTextWidth(displayName) > maxNameWidth) {\r\n          while (\r\n            pdf.getTextWidth(displayName + \"...\") > maxNameWidth &&\r\n            displayName.length > 0\r\n          ) {\r\n            displayName = displayName.slice(0, -1);\r\n          }\r\n          displayName += \"...\";\r\n        }\r\n\r\n        // Truncate category if too long\r\n        const maxCategoryWidth = colWidths[1] - 5;\r\n        let displayCategory = category;\r\n        if (pdf.getTextWidth(displayCategory) > maxCategoryWidth) {\r\n          while (\r\n            pdf.getTextWidth(displayCategory + \"...\") > maxCategoryWidth &&\r\n            displayCategory.length > 0\r\n          ) {\r\n            displayCategory = displayCategory.slice(0, -1);\r\n          }\r\n          displayCategory += \"...\";\r\n        }\r\n\r\n        pdf.text(displayName, colX[0], yPos);\r\n        pdf.text(displayCategory, colX[1], yPos);\r\n        pdf.text(costPrice, colX[2], yPos);\r\n        pdf.text(sellingPrice, colX[3], yPos);\r\n        pdf.text(unitDisplay, colX[4], yPos);\r\n        pdf.text(stockDisplay, colX[5], yPos);\r\n        yPos += 7;\r\n      });\r\n\r\n      // Total row\r\n      checkPageBreak(10);\r\n      yPos += 3;\r\n      pdf.setLineWidth(0.5);\r\n      pdf.line(margin, yPos, pageWidth - margin, yPos);\r\n      yPos += 5;\r\n\r\n      pdf.setFont(\"helvetica\", \"bold\");\r\n      pdf.setFontSize(10);\r\n      // Place total in the last two columns to avoid overlap\r\n      pdf.text(\"Total Value:\", colX[4], yPos);\r\n      pdf.text(`PHP ${totalInventoryValue.toFixed(2)}`, colX[5], yPos);\r\n\r\n      // Save PDF\r\n      const timestamp = new Date().toISOString().split(\"T\")[0];\r\n      const fileName = `Inventory-Report-${timestamp}.pdf`;\r\n      pdf.save(fileName);\r\n    } catch (error) {\r\n      console.error(\"Error exporting inventory PDF:\", error);\r\n      alert(\"Failed to generate inventory report. Please try again or contact support.\");\r\n    } finally {\r\n      setExportingInventory(false);\r\n    }\r\n  }, [filteredProducts]);\r\n\r\n  const headerActions = (\r\n    <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-end gap-3 sm:gap-4 mb-4 sm:mb-0 w-full\">\r\n      <div className=\"flex items-center justify-end gap-2 sm:gap-3 w-auto\">\r\n        {/* ADD PRODUCT Button: 'Add' on Mobile, 'Add Product' on Desktop */}\r\n        <Button\r\n          onClick={openAddProduct}\r\n          variant=\"primary\"\r\n          microinteraction={true}\r\n          // Same width logic as Export button\r\n          className=\"bg-blue-600 text-md text-white font-semibold rounded-lg shadow hover:bg-blue-700 transition gap-1 sm:gap-2 flex items-center justify-center sm:justify-start !py-2 !px-2 sm:!px-2 shrink-0 min-w-[40px] sm:min-w-[40px] lg:min-w-0\"\r\n        >\r\n          <svg\r\n            className=\"w-4 h-4\"\r\n            fill=\"none\"\r\n            stroke=\"currentColor\"\r\n            viewBox=\"0 0 24 24\"\r\n          >\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              d=\"M12 4v16m8-8H4\"\r\n            />\r\n          </svg>\r\n          {/* Full text is hidden on mobile, short text shown on mobile */}\r\n          <span className=\"hidden sm:block\">Add Product</span>\r\n          <span className=\"sm:inline\"></span>\r\n        </Button>\r\n        \r\n        {/* IMPORT Button: ICON ONLY on Mobile, ICON + TEXT on Desktop */}\r\n        <Button\r\n          onClick={() => setShowImportModal(true)}\r\n          variant=\"secondary\"\r\n          disabled={importingProducts || loading}\r\n          className=\"text-sm flex items-center justify-center sm:justify-start gap-1 sm:gap-2 shrink-0 !py-2 !px-2 sm:!px-2 min-w-[40px] sm:min-w-[40px] lg:min-w-0\"\r\n        >\r\n          {importingProducts ? (\r\n            <>\r\n              <svg\r\n                className=\"animate-spin w-5 h-5\"\r\n                fill=\"none\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <circle\r\n                  className=\"opacity-25\"\r\n                  cx=\"12\"\r\n                  cy=\"12\"\r\n                  r=\"10\"\r\n                  stroke=\"currentColor\"\r\n                  strokeWidth=\"4\"\r\n                />\r\n                <path\r\n                  className=\"opacity-75\"\r\n                  fill=\"currentColor\"\r\n                  d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\r\n                />\r\n              </svg>\r\n              <span className=\"hidden sm:inline\">Importing...</span>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <svg\r\n                className=\"w-5 h-5\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\"\r\n                />\r\n              </svg>\r\n              <span className=\"hidden sm:inline\">Import</span>\r\n            </>\r\n          )}\r\n        </Button>\r\n        \r\n        {/* EXPORT Button: ICON ONLY on Mobile, ICON + TEXT on Desktop */}\r\n        <Button\r\n          onClick={handleExport}\r\n          variant=\"secondary\"\r\n          disabled={exportingInventory || loading}\r\n          // Ensure fixed width on mobile for icon, then auto width on desktop\r\n          className=\"text-sm flex items-center justify-center sm:justify-start gap-1 sm:gap-2 shrink-0 !py-2 !px-2 sm:!px-2 min-w-[40px] sm:min-w-[40px] lg:min-w-0\"\r\n        >\r\n          {exportingInventory ? (\r\n            <>\r\n              <svg\r\n                className=\"animate-spin w-5 h-5\"\r\n                fill=\"none\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <circle\r\n                  className=\"opacity-25\"\r\n                  cx=\"12\"\r\n                  cy=\"12\"\r\n                  r=\"10\"\r\n                  stroke=\"currentColor\"\r\n                  strokeWidth=\"4\"\r\n                />\r\n                <path\r\n                  className=\"opacity-75\"\r\n                  fill=\"currentColor\"\r\n                  d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\r\n                />\r\n              </svg>\r\n              <span className=\"hidden sm:inline\">Exporting...</span>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <svg\r\n                className=\"w-5 h-5\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\r\n                />\r\n              </svg>\r\n              {/* Text is hidden on mobile (default) and shown from 'sm' breakpoint up */}\r\n              <span className=\"hidden sm:inline\">Export</span>\r\n            </>\r\n          )}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <PageLayout\r\n      title=\"INVENTORY\"\r\n      sidebar={<NavAdmin />}\r\n      isSidebarOpen={isSidebarOpen}\r\n      headerActions={headerActions}\r\n      setSidebarOpen={setSidebarOpen}\r\n      showHeader={true}\r\n      showNavbar={false}\r\n      showFooter={false}\r\n    >\r\n      <Inventory\r\n        products={paginatedProducts}\r\n        allProducts={filteredProducts}\r\n        stats={stats}\r\n        page={page}\r\n        entriesPerPage={entriesPerPage}\r\n        totalPages={totalPages}\r\n        onPageChange={handlePageChange}\r\n        onEntriesChange={handleEntriesChange}\r\n        search={search}\r\n        onSearchChange={handleSearchChange}\r\n        onEdit={openEditProduct}\r\n        onDelete={handleDeleteProduct}\r\n        onAddProduct={openAddProduct}\r\n        onStockEntry={openStockEntry}\r\n        categories={categories}\r\n        selectedCategory={selectedCategory}\r\n        onCategoryFilter={(category) => {\r\n          setSelectedCategory(category);\r\n          setPage(1); // Reset to first page on filter change\r\n        }}\r\n        stockFilter={stockFilter}\r\n        onStockFilter={(filter) => {\r\n          setStockFilter(filter);\r\n          setPage(1); // Reset to first page on filter change\r\n        }}\r\n        sortBy={sortBy}\r\n        sortOrder={sortOrder}\r\n        onSort={(field, order) => {\r\n          setSortBy(field);\r\n          setSortOrder(order);\r\n          setPage(1); // Reset to first page on sort\r\n        }}\r\n      />\r\n      {apiError && !showProductModal && (\r\n        <div className=\"bg-red-50 border-l-4 border-red-500 rounded-lg p-4 flex items-start gap-3 mt-4 shadow-sm\">\r\n          <div className=\"flex-shrink-0\">\r\n            <svg\r\n              className=\"w-5 h-5 text-red-500\"\r\n              fill=\"none\"\r\n              stroke=\"currentColor\"\r\n              viewBox=\"0 0 24 24\"\r\n            >\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth={2}\r\n                d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"\r\n              />\r\n            </svg>\r\n          </div>\r\n          <div className=\"flex-1\">\r\n            <h3 className=\"text-sm font-semibold text-red-800 mb-1\">\r\n              {apiError.includes(\"already exists\") || apiError.includes(\"SKU\") \r\n                ? \"Duplicate Product\" \r\n                : \"Error\"}\r\n            </h3>\r\n            <p className=\"text-sm text-red-700\">\r\n              {(() => {\r\n                try {\r\n                  const parsed = JSON.parse(apiError);\r\n                  return parsed.error || parsed.message || apiError;\r\n                } catch {\r\n                  return apiError;\r\n                }\r\n              })()}\r\n            </p>\r\n            {apiError.includes(\"already exists\") && (\r\n              <p className=\"text-xs text-red-600 mt-2 italic\">\r\n                Please use a different SKU code or update the existing product instead.\r\n              </p>\r\n            )}\r\n          </div>\r\n          <button\r\n            onClick={() => setApiError(\"\")}\r\n            className=\"flex-shrink-0 text-red-400 hover:text-red-600 transition-colors\"\r\n            aria-label=\"Close error\"\r\n          >\r\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      )}\r\n      <Modal\r\n        isOpen={showProductModal}\r\n        onClose={() => {\r\n          setShowProductModal(false);\r\n          setApiError(\"\"); // Clear error when closing modal\r\n        }}\r\n        variant=\"product\"\r\n        title={editingProduct ? \"Edit Product\" : \"Add New Product\"}\r\n        editingProduct={editingProduct}\r\n        productForm={productForm}\r\n        onChange={handleProductFormChange}\r\n        categories={categories}\r\n        onSubmit={handleProductSubmit}\r\n        loading={loading}\r\n        error={apiError}\r\n      />\r\n      {/* Stock Entry Modal */}\r\n      <Modal\r\n        isOpen={showStockModal}\r\n        onClose={() => setShowStockModal(false)}\r\n        title={\"Stock Entry\"}\r\n        variant=\"stock\"\r\n        editingProduct={null}\r\n        stockForm={stockForm}\r\n        onChange={(e) =>\r\n          setStockForm({ ...stockForm, [e.target.name]: e.target.value })\r\n        }\r\n        onSubmit={handleStockSubmit}\r\n        loading={loading}\r\n      />\r\n      {/* Delete Confirmation Modal */}\r\n      <Modal\r\n        isOpen={showDeleteModal}\r\n        onClose={() => setShowDeleteModal(false)}\r\n        title=\"\"\r\n        size=\"sm\"\r\n      >\r\n        <div className=\"p-0\">\r\n          <div className=\"bg-gradient-to-r from-red-50 via-red-50/80 to-orange-50/50 border-b border-red-100 px-6 py-5 rounded-t-2xl\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg\">\r\n                <svg\r\n                  className=\"w-6 h-6 text-white\"\r\n                  fill=\"none\"\r\n                  stroke=\"currentColor\"\r\n                  viewBox=\"0 0 24 24\"\r\n                >\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"\r\n                  />\r\n                </svg>\r\n              </div>\r\n              <div className=\"flex-1\">\r\n                <h2 className=\"text-xl font-bold text-gray-900 mb-1\">\r\n                  Confirm Deletion\r\n                </h2>\r\n                <p className=\"text-sm text-gray-600\">\r\n                  Are you sure you want to delete this product?\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"p-6\">\r\n            <p className=\"text-sm text-gray-700 mb-2\">\r\n              You are about to delete:{\" \"}\r\n              <strong className=\"text-red-700\">{productToDelete?.name}</strong>\r\n            </p>\r\n            <p className=\"text-sm text-gray-700 mb-6\">\r\n              This action cannot be undone.\r\n            </p>\r\n            <div className=\"flex justify-end gap-3\">\r\n              <Button\r\n                onClick={() => setShowDeleteModal(false)}\r\n                variant=\"secondary\"\r\n                disabled={loading}\r\n              >\r\n                Cancel\r\n              </Button>\r\n              <Button onClick={confirmDeleteProduct} variant=\"danger\" loading={loading}>\r\n                Delete\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Modal>\r\n      {/* CSV Import Modal */}\r\n      <CSVImportModal\r\n        isOpen={showImportModal}\r\n        onClose={() => {\r\n          setShowImportModal(false);\r\n          setApiError(\"\");\r\n        }}\r\n        onImport={handleCSVImport}\r\n        loading={importingProducts}\r\n        error={apiError}\r\n      />\r\n      {/* Import Success Modal */}\r\n      <ImportSuccessModal\r\n        isOpen={showImportSuccessModal}\r\n        onClose={() => setShowImportSuccessModal(false)}\r\n        successCount={importResults.successCount}\r\n        errors={importResults.errors}\r\n      />\r\n    </PageLayout>\r\n  );\r\n}\r\n"],"names":["initialProducts","initialCategories","DEFAULT_LOW_STOCK_LEVEL","getCategoriesByBusinessType","businessType","categoryMap","Pharmacy","Bookstore","Others","ImportSuccessModal","isOpen","onClose","successCount","errors","hasErrors","length","jsxs","className","children","jsx","onClick","e","stopPropagation","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","type","slice","map","error","index","Button","variant","CSVImportModal","onImport","loading","selectedFile","setSelectedFile","useState","showWarning","setShowWarning","csvContent","setCsvContent","fileInputRef","useRef","disabled","name","ref","accept","onChange","file","target","files","toLowerCase","endsWith","alert","reader","FileReader","onload","event","result","onerror","readAsText","id","htmlFor","Fragment","handleCancel","handleProceed","current","value","handleImportClick","InventoryPage","products","setProducts","categories","setCategories","storedType","window","sessionStorage","getItem","raw","localStorage","parsed","JSON","parse","business","business_type","setItem","showProductModal","setShowProductModal","showStockModal","setShowStockModal","editingProduct","setEditingProduct","productForm","setProductForm","sku","category","customCategory","description","quantity","cost_price","selling_price","low_stock_level","stockForm","setStockForm","setLoading","search","setSearch","debouncedSearch","useDebounce","entriesPerPage","setEntriesPerPage","page","setPage","apiError","setApiError","isSidebarOpen","setSidebarOpen","deleteTarget","setDeleteTarget","showDeleteModal","setShowDeleteModal","productToDelete","setProductToDelete","exportingInventory","setExportingInventory","showImportModal","setShowImportModal","importingProducts","setImportingProducts","showImportSuccessModal","setShowImportSuccessModal","importResults","setImportResults","useEffect","async","token","userData","api","headers","authHeaders","storageErr","debug","predefinedCategories","data","params","limit","offset","mapped","row","String","Number","product_type","quantity_per_unit","base_unit","display_unit","err","fetchInventory","convertToDisplayUnits","quantityInBaseUnits","productType","quantityPerUnit","baseUnit","quantityInLiters","displayQty","console","toFixed","productIds","p","duplicateIds","filter","indexOf","warn","totalInventoryValue","reduce","sum","costPrice","itemValue","log","quantity_in_stock_base_units","display_qty_calculated","item_value","toLocaleString","productBreakdown","dq","val","parseFloat","sort","a","b","sumVerification","Math","abs","lowStockItems","stats","label","icon","width","height","color","sub","formatValue","undefined","minimumFractionDigits","sortBy","setSortBy","sortOrder","setSortOrder","selectedCategory","setSelectedCategory","stockFilter","setStockFilter","filteredProducts","useMemo","filtered","includes","threshold","aVal","bVal","totalPages","ceil","paginatedProducts","openAddProduct","useCallback","product_sold_by","unit_size","unit","openEditProduct","product","productSoldBy","openStockEntry","handleProductFormChange","prev","updated","handleProductSubmit","preventDefault","method","body","stringify","product_name","trim","product_category_id","price","Date","now","errorMessage","errorData","response","errorStatus","status","message","existingProduct","parseErr","handleStockSubmit","handleDeleteProduct","find","confirmDeleteProduct","handlePageChange","newPage","handleEntriesChange","handleSearchChange","handleCSVImport","csvData","lines","split","line","Error","h","missingColumns","col","join","i","values","inQuotes","j","char","push","some","forEach","header","productSoldByRaw","soldByLower","unitSizeRaw","unitFromColumn","unitSize","unitSizeMatch","match","extractedUnit","unitLower","sellingPrice","lowStockAlert","apiErrors","allErrors","success","handleExport","profileData","storeName","business_name","address","house_number","barangay","city","province","Boolean","contact","mobile","email","pdf","jsPDF","pageWidth","internal","pageSize","getWidth","margin","contentWidth","yPos","checkPageBreak","requiredHeight","getHeight","addPage","setFontSize","setFont","storeNameWidth","getTextWidth","text","addressWidth","contactWidth","exportDate","toLocaleDateString","year","month","day","colWidths","colX","headerY","setLineWidth","item","productName","unitDisplay","stockDisplay","formatStockForPDF","round","displayValue","displayUnit","maxNameWidth","displayName","maxCategoryWidth","displayCategory","timestamp","fileName","toISOString","save","headerActions","microinteraction","cx","cy","r","PageLayout","title","sidebar","NavAdmin","showHeader","showNavbar","showFooter","Inventory","allProducts","onPageChange","onEntriesChange","onSearchChange","onEdit","onDelete","onAddProduct","onStockEntry","onCategoryFilter","onStockFilter","onSort","field","order","Modal","onSubmit","size"],"mappings":"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"}