import{j as e}from"./utils-BnCj7yKo.js";import{a as t,R as s}from"./vendor-BZrj58oz.js";import{u as a,a as o,c as r,b as n}from"./index-CP1yjQpk.js";import{d as i}from"./dayjs.min-DVXthx_5.js";import{D as l,m as d}from"./DateRangeFilterModal-egUf8ujD.js";import c from"./html2canvas.esm-CTiZndrd.js";import{E as m}from"./jspdf.es.min-Wvgu5jKg.js";import{P as h}from"./PageLayout-CkJYYtyb.js";import{N as x}from"./Nav-Admin-CZcnDp-4.js";import{D as u,a as g,N as p,C as f}from"./NotificationDropdown-B49WFrua.js";import{f as y,g as b}from"./index-BH1lzTR7.js";import{R as v,L as S,C as w,X as j,Y as N,T,a as D,B as M,b as k,c as P}from"./charts-DpvQ0yPn.js";import"./Navbar-CNuomWVW.js";import"./Logo-CfEe9b41.js";import"./PrivacyPolicyModal-BkNPUOAt.js";import"./BaseModal-C-8Qp-dk.js";import"./Card-fMjg4IWJ.js";import"./SectionHeader-DKrtjj68.js";i.extend(d);const F="#3b82f6";function C({data:t,className:s="",rangeType:a="Custom"}){return e.jsx(f,{title:e.jsx("span",{className:"text-blue-700",children:(e=>{switch(e){case"Day":return"Customer's Transactions for Today";case"Week":return"Customer's Transactions for 7 days";case"Month":return"Customer's Transactions for Month";default:return"Customer's Transactions for the selected range"}})(a)}),className:`bg-white/80 backdrop-blur-md border border-white/60 shadow-xl ${s}`,children:e.jsx("div",{className:"h-72 w-full",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(S,{data:t,margin:{top:20,right:20,left:0,bottom:5},children:[e.jsx(w,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(j,{dataKey:"name",tick:{fill:"#374151",fontSize:10}}),e.jsx(N,{tick:{fill:"#374151",fontSize:10}}),e.jsx(T,{contentStyle:{background:"#fff",borderColor:"#e5e7eb",borderRadius:8}}),e.jsx(D,{type:"monotone",dataKey:"value",stroke:F,strokeWidth:3,dot:{r:5,fill:F},isAnimationActive:!1})]})})})})}function _({data:t,className:s=""}){return e.jsx(f,{title:e.jsx("span",{className:"text-blue-700",children:"Sales by Product Category"}),className:`bg-white/80 backdrop-blur-md border border-white/60 shadow-xl ${s}`,children:e.jsx("div",{className:"h-72 w-full",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(M,{data:t,margin:{top:20,right:20,left:0,bottom:5},children:[e.jsx(w,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(j,{dataKey:"name",tick:{fill:"#374151",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(N,{tick:{fill:"#374151",fontSize:12}}),e.jsx(T,{formatter:(e,t,s)=>[Number(e).toLocaleString(),s?.payload?.name],contentStyle:{background:"#fafafa",borderColor:"#8b5cf6",borderRadius:8}}),e.jsx(k,{}),e.jsx(P,{dataKey:"value",fill:F,radius:[8,8,0,0],isAnimationActive:!1})]})})})})}function Y(){const[d,f]=t.useState({revenue:0,expenses:0,netProfit:0,grossMargin:0,totalTransactions:0,totalItemsSold:0,averageTransactionValue:0}),[v,S]=t.useState([]),[w,j]=t.useState({startDate:i().startOf("month"),endDate:i().endOf("day"),rangeType:"Month"}),[N,T]=t.useState(!1),[D,M]=t.useState([]),[k,P]=t.useState([]),[F,Y]=t.useState([]),[E,$]=t.useState(!1),[R,A]=t.useState([]),[L,I]=t.useState(0),[B,O]=t.useState(!1),W=s.useRef(null);a();const[U,K]=t.useState(!1),[V,H]=t.useState({sales:0,transactions:0,topProduct:"-",totalItemsSold:0,averageTransactionValue:0}),[J,G]=t.useState(!1),[q,Q]=t.useState(!1),[X,Z]=t.useState(i()),[ee,te]=t.useState([]),[se,ae]=t.useState([]),oe=t.useRef(null),re=t.useRef(null),ne=t.useRef(null),ie=t.useRef(null),le=t.useRef(null);t.useEffect(()=>{let e;const t=()=>{"visible"===document.visibilityState&&Z(i())};t(),e=setInterval(t,1e4);const s=()=>{"visible"===document.visibilityState&&t()};return document.addEventListener("visibilitychange",s),()=>{clearInterval(e),document.removeEventListener("visibilitychange",s)}},[]);const de=(e="")=>{if(!e)return!1;const t=e.toLowerCase();return t.includes("oklab")||t.includes("oklch")||t.includes("color(")||t.includes("color-mix")||t.includes("lab(")||t.includes("lch(")||t.includes("hwb(")},ce=(()=>{const e=document.createElement("canvas").getContext("2d");return(t,s="#ffffff")=>{if(!t)return s;try{return e.fillStyle=t,e.fillStyle||s}catch(a){return s}}})();t.useEffect(()=>{(async()=>{try{const e=sessionStorage.getItem("auth_token"),t=i().format("YYYY-MM-DD"),s=await o("/api/dashboard/overview",{headers:r(e),params:{startDate:t,endDate:t}});s&&H({sales:s.totalSales||0,transactions:s.totalTransactions||0,totalItemsSold:s.totalItemsSold||0,averageTransactionValue:s.averageTransactionValue||0,topProduct:s.topProducts?.[0]?.product_name||"-"})}catch(e){console.error("Failed to fetch today's data",e)}})()},[]),t.useMemo(()=>{try{return JSON.parse(sessionStorage.getItem("user")||"{}")}catch(e){return{}}},[]),t.useEffect(()=>{const e=e=>{W.current&&!W.current.contains(e.target)&&O(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const me=async()=>{try{T(!0);const e=sessionStorage.getItem("auth_token"),{startDate:t,endDate:s,rangeType:a}=w,n=e=>i(e).format("YYYY-MM-DD"),l=i.min(t,s),d=i.max(t,s),c=n(l),m=n(d);console.log("Fetching data for date range:",{rangeType:a,formattedStart:c,formattedEnd:m});const[h,x,u,g,p]=await Promise.all([o("/api/dashboard/overview",{headers:r(e),params:{startDate:c,endDate:m}}),o("/api/stats/customers-timeseries",{headers:r(e),params:{startDate:c,endDate:m}}),o("/api/stats/sales-by-category",{headers:r(e),params:{startDate:c,endDate:m}}),o("/api/products/low-stock",{headers:r(e)}),o("/api/stats/payment-methods",{headers:r(e),params:{startDate:c,endDate:m}})]),y=(x||[]).map(e=>({...e,name:e.date||e.name,value:Number(e.customers||e.total||e.value||0)})),b=(u||[]).reduce((e,t)=>e+Number(t.value||0),0)||1,v=(u||[]).map(e=>({...e,percent:Number(e.value||0)/b*100}));if(h){const e=Number(h.totalSales||0),t=Number(h.totalExpenses||0),s=e-t,o=e>0?(e-t)/e*100:0,r=Number(h.totalTransactions||0),n=Number(h.totalItemsSold||0),i=Number(h.averageTransactionValue||e/(r||1)),c=h.topProducts?.[0]?.product_name||"-";f({revenue:e,expenses:t,netProfit:s,grossMargin:o,totalTransactions:r,totalItemsSold:n,averageTransactionValue:i});const m="Day"===a?l.format("MMM D, YYYY"):`${l.format("MMM D")} - ${d.format("MMM D, YYYY")}`,x="Day"===a?"Daily Transactions":"Week"===a?"7-Day Transactions":"Month"===a?"Monthly Transactions":"Total Transactions";S([{label:"Day"===a?"Daily Sales":"Week"===a?"7-Day Sales":"Month"===a?"Monthly Sales":"Total Sales",value:`₱${e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`,subtext:m},{label:x,value:r,subtext:`${m}`},{label:"Top Product",value:c,subtext:`Total: ${h.topProducts?.[0]?.total_sold||0} sold`},{label:"Items Sold",value:n,subtext:`${r} transactions`}])}M(y),P(v);Y(g||[]),h&&h.topProducts&&te(h.topProducts||[]),ae(p||[])}catch(e){console.error("Failed to fetch dashboard data",e)}finally{T(!1)}};t.useEffect(()=>{me(),(async()=>{try{const e=sessionStorage.getItem("auth_token"),t=await o("/api/logs",{headers:r(e)}),s=new Set(JSON.parse(sessionStorage.getItem("read_notif_ids")||"[]")),a=new Set(JSON.parse(sessionStorage.getItem("deleted_notif_ids")||"[]")),n=(t||[]).filter(e=>!a.has(e.log_id)).map(e=>({id:e.log_id,title:e.action,message:`${e.username} (${e.role}) did an action: ${e.action}`,time:i(e.date_time).format("MMM D, h:mm A"),isRead:s.has(e.log_id)}));A(n),I(n.filter(e=>!e.isRead).length)}catch(e){console.error("Failed to fetch notifications",e)}})()},[w]);const he=e=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2,maximumFractionDigits:2}).format(e),xe=t.useMemo(()=>{if(!w.startDate||!w.endDate)return"Select Range";const e=i.min(w.startDate,w.endDate),t=i.max(w.startDate,w.endDate);return`${e.format("MMM D")} - ${t.format("MMM D, YYYY")}`},[w]),ue=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:me,disabled:N,title:"Refresh Data",className:"bg-white/80 backdrop-blur-sm hover:bg-white text-gray-700 p-1.5 sm:p-2 rounded-lg border border-gray-200/80 text-sm font-medium transition-all duration-200 hover:shadow-md hover:scale-[1.02] shrink-0",children:e.jsx(y,{className:"w-4 h-4 sm:w-5 sm:h-5 "+(N?"animate-spin":"")})}),e.jsxs("button",{onClick:()=>$(!0),disabled:N,title:"Select Date Range",className:"flex items-center gap-1 sm:gap-2 bg-white/80 backdrop-blur-sm hover:bg-white text-gray-700 px-1.5 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-gray-200/80 text-xs sm:text-sm font-medium transition-all duration-200 outline-none cursor-pointer hover:shadow-md hover:scale-[1.02] shrink-0",children:[e.jsx(b,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden sm:inline",children:xe})]}),e.jsxs("div",{className:"py-2 flex justify-end gap-2",children:[e.jsx(n,{onClick:async()=>{Q(!0);try{const e=sessionStorage.getItem("auth_token"),{startDate:t,endDate:s,rangeType:a}=w,n=e=>i(e).format("YYYY-MM-DD"),l=i.min(t,s),d=i.max(t,s),c=n(l),h=n(d),x=await o("/api/dashboard/sales-data",{headers:r(e),params:{startDate:c,endDate:h}});console.log("Sales report data received:",x);const u=await o("/auth/profile",{headers:r(e)}),g=u?.business||{},p=g.business_name||"Business",f=g.business_name||"Store",y=[g.house_number,g.barangay,g.city,g.province].filter(Boolean).join(", ")||"N/A",b="Day"===a?l.format("MMM D, YYYY"):`${l.format("MMM D")} - ${d.format("MMM D, YYYY")}`;if(!x||!x.salesByProduct||0===x.salesByProduct.length)return void alert("No sales data found for the selected date range.");const{salesByProduct:v=[],summary:S={},paymentMethods:j=[],bestSellingProducts:N=[],salesByCategory:T=[],transactions:D=[]}=x,M=new m("p","mm","a4"),k=M.internal.pageSize.getWidth(),P=M.internal.pageSize.getHeight(),F=15,C=k-2*F;let _=F,Y=1;const z=e=>_+e>P-F-10&&(E(),M.addPage(),Y++,_=F,!0),E=()=>{const e=P-8;M.setFontSize(8),M.setFont("helvetica","normal"),M.setTextColor(128,128,128),M.text(`Page ${Y} | Generated by eKahera POS System | ${i().format("MMM D, YYYY h:mm A")}`,k/2,e,{align:"center"}),M.text("System-generated report. This is an automated document.",k/2,e+4,{align:"center"}),M.setTextColor(0,0,0)},$=e=>`PHP ${Number(e||0).toFixed(2)}`,R=(e,t=12)=>{z(15),_+=5,M.setFontSize(t),M.setFont("helvetica","bold"),M.text(e,F,_),_+=8};M.setFontSize(18),M.setFont("helvetica","bold");const A=M.getTextWidth(p);if(M.text(p,(k-A)/2,_),_+=8,M.setFontSize(11),M.setFont("helvetica","normal"),f!==p){const e=M.getTextWidth(`Store/Branch: ${f}`);M.text(`Store/Branch: ${f}`,(k-e)/2,_),_+=6}M.setFontSize(10),M.setTextColor(100,100,100);const L=M.getTextWidth(y);M.text(y,(k-L)/2,_),_+=8,M.setFontSize(12),M.setFont("helvetica","bold"),M.setTextColor(0,0,0);const I=`${a} Sales Report`,B=M.getTextWidth(I);M.text(I,(k-B)/2,_),_+=6,M.setFontSize(10),M.setFont("helvetica","normal");const O=M.getTextWidth(`Date Range: ${b}`);M.text(`Date Range: ${b}`,(k-O)/2,_),_+=5,M.setFontSize(9),M.setTextColor(100,100,100);const W=`Generated: ${i().format("MMM D, YYYY h:mm A")}`,U=M.getTextWidth(W);M.text(W,(k-U)/2,_),_+=4;const K="System: eKahera POS",V=M.getTextWidth(K);M.text(K,(k-V)/2,_),_+=10,M.setLineWidth(.5),M.setDrawColor(200,200,200),M.line(F,_,k-F,_),_+=8,R("SALES SUMMARY",14);const H=[["Total Sales (Net)",$(S.net_sales||0)],["Gross Sales",$(S.gross_sales||0)],["Total Transactions",String(S.total_transactions||0)],["Total Items Sold",String(S.total_items_sold||0)],["Total Discounts",$(S.total_discounts||0)],["Average Transaction Value",$(S.average_transaction_value||0)]];M.setFontSize(9),M.setFont("helvetica","normal"),M.setTextColor(0,0,0);const J=F,G=k-F-60;if(H.forEach(([e,t])=>{z(8),M.setFont("helvetica","normal"),M.text(e+":",J,_),M.setFont("helvetica","bold"),M.text(t,G,_),_+=7}),_+=5,R("PAYMENT METHOD BREAKDOWN",14),j.length>0){z(15),M.setFontSize(9),M.setFont("helvetica","bold"),M.text("Payment Method",F,_),M.text("Total Amount",k-F-50,_),_+=6,M.setLineWidth(.3),M.line(F,_-2,k-F,_-2),_+=4,M.setFont("helvetica","normal"),j.forEach(e=>{z(8);const t=e.payment_type||"Unknown",s=$(e.total_amount||0);M.text(t,F+5,_),M.setFont("helvetica","bold"),M.text(s,k-F-50,_),M.setFont("helvetica","normal"),_+=6}),z(8),_+=2,M.setLineWidth(.3),M.line(F,_,k-F,_),_+=5,M.setFont("helvetica","bold");const e=j.reduce((e,t)=>e+(t.total_amount||0),0);M.text("Total:",F+5,_),M.text($(e),k-F-50,_),_+=8}else M.setFontSize(9),M.setTextColor(150,150,150),M.text("No payment method data available",F,_),_+=8,M.setTextColor(0,0,0);if(R("SALES BY PRODUCT",14),v.length>0){z(20),M.setFontSize(8),M.setFont("helvetica","bold");const e=[.2*C,.15*C,.15*C,.12*C,.15*C,.23*C],t=[F];for(let a=1;a<e.length;a++)t.push(t[a-1]+e[a-1]);M.text("Product Name",t[0],_),M.text("SKU",t[1],_),M.text("Category",t[2],_),M.text("Qty Sold",t[3],_),M.text("Price",t[4],_),M.text("Total Sales",t[5],_),_+=5,M.setLineWidth(.5),M.line(F,_-2,k-F,_-2),_+=4,M.setFont("helvetica","normal"),M.setFontSize(7),v.forEach(e=>{z(8);const s=(e.product_name||"").substring(0,20),a=(e.sku||"N/A").substring(0,12),o=(e.category||"N/A").substring(0,12),r=Number(e.quantity_sold||0).toFixed(2),n=$(e.selling_price||0),i=$(e.total_sales||0);M.text(s,t[0],_),M.text(a,t[1],_),M.text(o,t[2],_),M.text(r,t[3],_),M.text(n,t[4],_),M.text(i,t[5],_),_+=6}),z(10),_+=2,M.setLineWidth(.5),M.line(F,_,k-F,_),_+=5,M.setFont("helvetica","bold"),M.setFontSize(8);const s=v.reduce((e,t)=>e+(t.total_sales||0),0);M.text("Total:",t[4],_),M.text($(s),t[5],_),_+=8}else M.setFontSize(9),M.setTextColor(150,150,150),M.text("No product sales data available",F,_),_+=8,M.setTextColor(0,0,0);if(R("BEST-SELLING PRODUCTS (Top 5)",14),N.length>0?(z(15),M.setFontSize(9),M.setFont("helvetica","bold"),M.text("Rank",F,_),M.text("Product Name",F+15,_),M.text("SKU",F+80,_),M.text("Quantity Sold",k-F-40,_),_+=6,M.setLineWidth(.3),M.line(F,_-2,k-F,_-2),_+=4,M.setFont("helvetica","normal"),N.forEach((e,t)=>{z(8),M.text(`${t+1}.`,F,_),M.text((e.product_name||"").substring(0,30),F+15,_),M.text((e.sku||"N/A").substring(0,15),F+80,_),M.text(String(e.quantity_sold||0),k-F-40,_),_+=6}),_+=5):(M.setFontSize(9),M.setTextColor(150,150,150),M.text("No best-selling products data available",F,_),_+=8,M.setTextColor(0,0,0)),R("SALES BY CATEGORY",14),T.length>0){z(15),M.setFontSize(9),M.setFont("helvetica","bold"),M.text("Category",F,_),M.text("Items Sold",F+80,_),M.text("Total Sales",k-F-50,_),_+=6,M.setLineWidth(.3),M.line(F,_-2,k-F,_-2),_+=4,M.setFont("helvetica","normal"),T.forEach(e=>{z(8),M.text((e.category_name||"Uncategorized").substring(0,25),F,_),M.text(String(e.total_items_sold||0),F+80,_),M.setFont("helvetica","bold"),M.text($(e.total_sales_amount||0),k-F-50,_),M.setFont("helvetica","normal"),_+=6}),z(8),_+=2,M.setLineWidth(.3),M.line(F,_,k-F,_),_+=5,M.setFont("helvetica","bold");const e=T.reduce((e,t)=>e+(t.total_sales_amount||0),0);M.text("Total:",F,_),M.text($(e),k-F-50,_),_+=8}else M.setFontSize(9),M.setTextColor(150,150,150),M.text("No category sales data available",F,_),_+=8,M.setTextColor(0,0,0);if(R("TRANSACTION DETAILS",14),D.length>0){z(20);const e=D;M.setFontSize(6),M.setFont("helvetica","bold");const t=[.09*C,.11*C,.09*C,.07*C,.18*C,.08*C,.07*C,.09*C,.11*C],s=[F];for(let o=1;o<t.length;o++)s.push(s[o-1]+t[o-1]);M.text("Txn ID",s[0],_),M.text("Date & Time",s[1],_),M.text("Cashier",s[2],_),M.text("Payment",s[3],_),M.text("Product",s[4],_),M.text("Price",s[5],_),M.text("Qty",s[6],_),M.text("Discount",s[7],_),M.text("Amount",s[8],_),_+=4,M.setLineWidth(.5),M.line(F,_-2,k-F,_-2),_+=3,M.setFont("helvetica","normal"),M.setFontSize(5.5);let a=null;e.forEach(e=>{z(6);const t=(e.transaction_number||`TXN-${e.transaction_id}`).substring(0,12),o=i(e.date_time).format("MMM D, YYYY h:mm A"),r=(e.cashier_name||"N/A").substring(0,10),n=(e.payment_method||"Unknown").substring(0,8),l=(e.product_name||"Unknown").substring(0,18),d=$(e.price||0),c=`${Number(e.quantity||0).toFixed(2)} ${e.unit||"pc"}`.substring(0,10),m=$(e.item_discount||0),h=$(e.item_amount||0);a!==e.transaction_id?(M.text(t,s[0],_),M.text(o,s[1],_),M.text(r,s[2],_),M.text(n,s[3],_),a=e.transaction_id):(M.text("",s[0],_),M.text("",s[1],_),M.text("",s[2],_),M.text("",s[3],_)),M.text(l,s[4],_),M.text(d,s[5],_),M.text(c,s[6],_),M.text(m,s[7],_),M.text(h,s[8],_),_+=5}),_+=5}else M.setFontSize(9),M.setTextColor(150,150,150),M.text("No transaction details available",F,_),_+=8,M.setTextColor(0,0,0);E();const q=`Sales-Report-${a}-${i().format("YYYY-MM-DD")}.pdf`;M.save(q)}catch(e){console.error("Error exporting sales PDF:",e),console.error("Error details:",{message:e.message,stack:e.stack,name:e.name});const t=e.message||"Unknown error occurred";alert(`Failed to generate sales report: ${t}\n\nPlease check the console for more details.`)}finally{Q(!1)}},disabled:q||N,size:"sm",variant:"primary",className:"flex items-center gap-2 w-full sm:w-auto shrink-0",children:q?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:"Exporting..."}),e.jsx("span",{className:"sm:hidden",children:"..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"hidden sm:inline",children:"Export Sales"}),e.jsx("span",{className:"sm:hidden",children:"Sales"})]})}),e.jsx(n,{onClick:async()=>{G(!0);try{const t=document.getElementById("pdf-wrapper");if(!t)throw new Error("Dashboard content not found");const s=t.cloneNode(!0);s.style.position="absolute",s.style.left="-9999px",document.body.appendChild(s);const a=document.createElement("div");a.style.padding="15px 20px",a.style.backgroundColor="#1a365d",a.style.color="white",a.style.borderBottom="2px solid #2c5282";const{startDate:o,endDate:r,rangeType:n}=w,l=e=>i(e).format("MMM D, YYYY"),h="Day"===n?l(o):`${l(o)} - ${l(r)}`,x={name:"eKahera Business",address:"Bicol University, West (Main Campus) Legazpi City, Albay, Philippines",contact:"ekahera.business@gmail.com | +63 970 846 8324"};a.innerHTML=`\n        <div style="max-width: 100%; color: white;">\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">\n            <h1 style="margin: 0; font-size: 24px; font-weight: 600; color: white;">${x.name}</h1>\n            <div style="text-align: right;">\n              <div style="font-size: 14px; color: #a0aec0;">Report Period</div>\n              <div style="font-weight: 600; font-size: 16px;">${h}</div>\n            </div>\n          </div>\n          <div style="display: flex; justify-content: space-between; font-size: 12px; color: #cbd5e0;">\n            <div>${x.address}</div>\n            <div>${x.contact}</div>\n          </div>\n        </div>\n      `;const u=document.createElement("div");u.style.padding="15px",u.style.backgroundColor="#f7fafc",u.style.borderBottom="1px solid #e2e8f0",u.style.marginBottom="20px",u.innerHTML=`\n        <h3 style="margin: 0 0 10px 0; color: #2d3748; font-size: 18px;">Key Metrics Summary</h3>\n        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">\n          <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">\n            <div style="font-size: 12px; color: #718096;">Total Revenue</div>\n            <div style="font-size: 20px; font-weight: 600; color: #2b6cb0;">${he(d.revenue)}</div>\n          </div>\n          <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">\n            <div style="font-size: 12px; color: #718096;">Total Transactions</div>\n            <div style="font-size: 20px; font-weight: 600; color: #2f855a;">${d.totalTransactions}</div>\n          </div>\n          <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">\n            <div style="font-size: 12px; color: #718096;">Items Sold</div>\n            <div style="font-size: 20px; font-weight: 600; color: #b7791f;">${d.totalItemsSold}</div>\n          </div>\n          <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">\n            <div style="font-size: 12px; color: #718096;">Net Profit</div>\n            <div style="font-size: 20px; font-weight: 600; color: #2c5282;">${he(d.netProfit)}</div>\n          </div>\n        </div>\n      `,s.insertBefore(u,s.firstChild),s.insertBefore(a,s.firstChild);const g=document.createElement("div");g.style.padding="10px",g.style.backgroundColor="#f7fafc",g.style.borderTop="1px solid #e2e8f0",g.style.textAlign="center",g.style.fontSize="10px",g.style.color="#718096",g.innerText=`Page 1 of 1 • Generated on ${(new Date).toLocaleString()}`,s.appendChild(g);s.querySelectorAll("*").forEach(e=>{const t=window.getComputedStyle(e);["background","background-color","color","border","border-color"].forEach(s=>{try{const a=t.getPropertyValue(s);a&&de(a)&&e.style.setProperty(s,"transparent","important")}catch(a){console.warn(`Error processing ${s}:`,a)}})});const p=Array.from(document.querySelectorAll(".chart-export-container")),f=[],y=[],b=e=>{const t=["color","background-color","border-color","outline-color","text-decoration-color","column-rule-color","caret-color","accent-color","fill","stroke"],s=["background","background-image","border","border-top-color","border-right-color","border-bottom-color","border-left-color","box-shadow","text-shadow","outline-color"],a=[],o=e=>{if(!(e instanceof Element))return;const o=window.getComputedStyle(e);t.forEach(t=>{const s=o.getPropertyValue(t);if(de(s)){const r=e.style.getPropertyValue(t);a.push(()=>e.style.setProperty(t,r||"",o.getPropertyPriority(t))),e.style.setProperty(t,ce(s,t.includes("background")?"#ffffff":"#1f2937"),"important")}}),[...s].forEach(t=>{const s=o.getPropertyValue(t);((e,t,s,o)=>{if(!s)return;const r=s.toLowerCase(),n=r.includes("gradient")||r.includes("image-set");if(de(r)||n){const r=e.style.getPropertyValue(t);a.push(()=>e.style.setProperty(t,r||"",o)),t.includes("background")||t.includes("shadow")?e.style.setProperty(t,"none","important"):t.includes("border")?e.style.setProperty(t,ce(s,"#e5e7eb"),"important"):e.style.setProperty(t,ce(s,"#1f2937"),"important")}})(e,t,s,o.getPropertyPriority(t))})};return o(e),e.querySelectorAll("*").forEach(o),()=>a.reverse().forEach(e=>e())};for(const i of p){let t=null;try{t=b(i),y.push(t);const e=i.getBoundingClientRect(),s=await c(i,{scale:2,useCORS:!0,backgroundColor:"#ffffff"});f.push({dataUrl:s.toDataURL("image/png"),width:e.width,height:e.height})}catch(e){console.warn("Chart capture failed, falling back to default capture",e),f.push(null)}finally{t&&t()}}Array.from(s.querySelectorAll(".chart-export-container")).forEach((e,t)=>{const s=f[t];if(!s||!s.dataUrl)return;e.innerHTML="";const a=document.createElement("img");a.src=s.dataUrl,a.style.width=`${s.width}px`,a.style.height=`${s.height}px`,a.style.objectFit="contain",a.style.display="block",a.setAttribute("alt","Chart snapshot"),e.appendChild(a)}),await new Promise(e=>setTimeout(e,200));const v=await c(s,{scale:2,useCORS:!0,logging:!1,backgroundColor:"#ffffff",removeContainer:!0,onclone:e=>{document.fonts.ready.then(()=>{})}});document.body.removeChild(s);const S=v.toDataURL("image/png"),j=new m("p","mm","a4"),N=j.getImageProperties(S),T=j.internal.pageSize.getWidth()-20,D=N.height*T/N.width;j.addImage(S,"PNG",10,10,T,D);const M=`eKahera-Report-${w.rangeType}-${i().format("YYYY-MM-DD")}.pdf`;j.setProperties({title:`eKahera Business Report - ${w.rangeType} (${h})`,subject:`Business Performance Report - ${h}`,author:"eKahera Business Intelligence",creator:"eKahera System",keywords:"business,report,sales,metrics,performance"}),j.setFontSize(60),j.setTextColor(240,240,240),j.text("eKahera",35,150,{angle:45}),j.setTextColor(0,0,0),j.save(M)}catch(t){console.error("Error exporting PDF:",t),alert("Failed to generate PDF report. Please try again or contact support.")}finally{G(!1)}},disabled:J||N,size:"sm",variant:"primary",className:"flex items-center gap-2 w-full sm:w-auto shrink-0",children:J?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:"Exporting..."}),e.jsx("span",{className:"sm:hidden",children:"..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),e.jsx("span",{className:"hidden sm:inline",children:"Export Dashboard"}),e.jsx("span",{className:"sm:hidden",children:"PDF"})]})})]}),e.jsx("div",{className:"relative",ref:W,children:e.jsx(p,{notifications:R,unreadCount:L,onMarkAsRead:e=>{const t=JSON.parse(sessionStorage.getItem("read_notif_ids")||"[]");t.includes(e)||sessionStorage.setItem("read_notif_ids",JSON.stringify([...t,e])),A(t=>t.map(t=>t.id===e?{...t,isRead:!0}:t)),I(e=>Math.max(0,e-1))},onMarkAsUnread:e=>{const t=JSON.parse(sessionStorage.getItem("read_notif_ids")||"[]").filter(t=>t!==e);sessionStorage.setItem("read_notif_ids",JSON.stringify(t)),A(t=>t.map(t=>t.id===e?{...t,isRead:!1}:t)),I(e=>e+1)},onDelete:e=>{const t=JSON.parse(sessionStorage.getItem("deleted_notif_ids")||"[]");sessionStorage.setItem("deleted_notif_ids",JSON.stringify([...t,e])),A(t=>t.filter(t=>t.id!==e));const s=R.find(t=>t.id===e);s&&!s.isRead&&I(e=>Math.max(0,e-1))},isOpen:B,onToggle:()=>O(!B),containerRef:W})})]});return e.jsx(h,{title:"DASHBOARD",subtitle:"",sidebar:e.jsx(x,{}),headerActions:ue,isSidebarOpen:U,setSidebarOpen:K,className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{id:"pdf-wrapper",ref:oe,children:[e.jsx("div",{className:"p-4 lg:hidden",children:N?e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md border border-gray-200 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/2 mb-6"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full mb-3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full mb-3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-4/5"})]}):e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Low Stock Products"})}),e.jsx(z,{lowStockProducts:F})]})}),e.jsxs("div",{ref:ie,className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 w-full px-4 sm:px-6 md:px-8 py-2",children:[e.jsxs("div",{className:"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase mb-1",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:he(d.revenue)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"For selected range"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase mb-1",children:"Operating Expenses"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:he(d.expenses)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"For selected range"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-2xl font-bold "+(d.netProfit>=0?"text-green-600":"text-red-600"),children:[he(Math.abs(d.netProfit)),d.netProfit<0&&e.jsx("span",{className:"text-sm text-red-500 ml-1",children:"(Loss)"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"For selected range"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase mb-1",children:"Gross Margin"}),e.jsxs("p",{className:"text-2xl font-bold "+(d.grossMargin>=0?"text-green-600":"text-red-600"),children:[d.grossMargin.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"For selected range"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 p-4 sm:p-6 md:p-8 pt-0",children:[e.jsx("div",{className:"lg:col-span-8 flex flex-col gap-6",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-md border border-gray-200 h-[336px] animate-pulse flex items-center justify-center",children:e.jsx("div",{className:"w-full h-64 bg-gray-200 rounded-lg"})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-md border border-gray-200 h-[336px] animate-pulse flex items-center justify-center",children:e.jsx("div",{className:"w-64 h-64 bg-gray-200 rounded-full"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:re,className:"chart-export-container","data-export-chart":"visitors",children:e.jsx(C,{data:D,rangeType:w.rangeType})}),e.jsx("div",{ref:ne,className:"chart-export-container","data-export-chart":"sales-pie",children:e.jsx(_,{data:k})})]})}),e.jsxs("div",{className:"lg:col-span-4 flex flex-col gap-6",children:[N?e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md border border-gray-200 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-8 bg-gray-300 rounded w-1/2 mb-6"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-8 bg-gray-300 rounded w-1/2 mb-6"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-8 bg-gray-300 rounded w-1/2"})]}):e.jsx(u,{stats:V,formatCurrency:he,rangeType:"Today",currentTime:X}),N?e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md border border-gray-200 animate-pulse hidden lg:block",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/2 mb-6"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full mb-3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full mb-3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-4/5"})]}):e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md hidden lg:block",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Low Stock Products"})}),e.jsx(z,{lowStockProducts:F})]})]})]}),e.jsx("div",{ref:le,className:"w-full px-4 sm:px-6 md:px-8 pb-8",children:e.jsx(g,{dateRange:w,topProducts:ee,paymentMethods:se})}),e.jsx(l,{isOpen:E,onClose:()=>$(!1),onDateRangeApply:e=>{j(e)}})]})})}function z({lowStockProducts:t}){return 0===t.length?e.jsx("p",{className:"text-sm text-gray-500",children:"No products with low stock."}):e.jsxs("ul",{className:"divide-y divide-gray-200",children:[e.jsxs("li",{className:"py-2 text-sm font-semibold text-gray-600 flex justify-between",children:[e.jsx("span",{children:"Product"}),e.jsx("span",{children:"Quantity"})]}),t.map(t=>e.jsxs("li",{className:"py-3 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-800",children:t.product_name}),e.jsxs("span",{className:"text-sm font-bold text-red-600",children:[t.quantity_in_stock," left"]})]},t.product_id))]})}i().startOf("day"),i().endOf("day");export{Y as default};
//# sourceMappingURL=Dashboard-CkpMXYks.js.map
