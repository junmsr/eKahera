{"version":3,"file":"CustomerWaitingPage-DdIHJg8J.js","sources":["../../../frontend/src/pages/CustomerWaitingPage.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { api } from '../lib/api';\r\nimport Background from '../components/layout/Background';\r\nimport Card from '../components/common/Card';\r\nimport Loader from '../components/common/Loader';\r\n\r\nconst CustomerWaitingPage = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { transactionId, tn } = location.state || {};\r\n  const [status, setStatus] = useState('pending');\r\n  const [error, setError] = useState('');\r\n\r\n  useEffect(() => {\r\n    if (!transactionId) {\r\n      setError('No transaction ID found. Please try checking out again.');\r\n      return;\r\n    }\r\n\r\n    const interval = setInterval(async () => {\r\n      try {\r\n        const response = await api(`/sales/public/transaction/${transactionId}`);\r\n        \r\n        // Check if response has data property (from the API wrapper)\r\n        const responseData = response.data || response;\r\n        \r\n        if (responseData.status === 'completed') {\r\n          setStatus('completed');\r\n          clearInterval(interval);\r\n          // Redirect to the receipt page with the transaction number\r\n          navigate(`/receipt?tn=${responseData.tn || ''}&from=customer`);\r\n        } else if (responseData.status) {\r\n          // Update status if it exists in the response\r\n          setStatus(responseData.status);\r\n        }\r\n      } catch (err) {\r\n        console.error('Error fetching transaction status:', err);\r\n        // More specific error message based on error response\r\n        const errorMessage = err.response?.data?.error || \r\n                           'Could not fetch transaction status. Please check your connection.';\r\n        setError(errorMessage);\r\n        // Don't clear the interval on error, keep trying\r\n        // clearInterval(interval);\r\n      }\r\n    }, 3000); // Poll every 3 seconds\r\n\r\n    return () => clearInterval(interval); // Cleanup on component unmount\r\n  }, [transactionId, navigate, tn]);\r\n\r\n  return (\r\n    <Background>\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <Card className=\"p-8 max-w-md mx-auto text-center\">\r\n          <h1 className=\"text-2xl font-bold text-blue-900 mb-4\">\r\n            Waiting for Cashier\r\n          </h1>\r\n          <p className=\"text-gray-600 mb-6\">\r\n            Please present your QR code to the cashier to complete your payment. This page will automatically update once your transaction is complete.\r\n          </p>\r\n          <Loader />\r\n          <p className=\"text-sm text-gray-500 mt-4\">\r\n            Status: <span className=\"font-semibold\">{status}</span>\r\n          </p>\r\n          {error && <p className=\"text-red-500 mt-4\">{error}</p>}\r\n        </Card>\r\n      </div>\r\n    </Background>\r\n  );\r\n};\r\n\r\nexport default CustomerWaitingPage;\r\n"],"names":["CustomerWaitingPage","navigate","useNavigate","location","useLocation","transactionId","tn","state","status","setStatus","useState","error","setError","useEffect","interval","setInterval","async","response","api","responseData","data","clearInterval","err","errorMessage","jsx","Background","children","className","jsxs","Card","Loader"],"mappings":"uLAOA,MAAMA,EAAsBA,KAC1B,MAAMC,EAAWC,IACXC,EAAWC,KACXC,cAAEA,EAAAA,GAAeC,GAAOH,EAASI,OAAS,CAAC,GAC1CC,EAAQC,GAAaC,EAAAA,SAAS,YAC9BC,EAAOC,GAAYF,EAAAA,SAAS,IAuCjC,OArCFG,EAAAA,UAAU,KACR,IAAKR,EAEH,YADAO,EAAS,2DAILE,MAAAA,EAAWC,YAAYC,UACvB,IACF,MAAMC,QAAiBC,EAAI,6BAA6Bb,KAGlDc,EAAeF,EAASG,MAAQH,EAEV,cAAxBE,EAAaX,QACfC,EAAU,aACVY,cAAcP,GAEdb,EAAS,eAAekB,EAAab,IAAM,qBAClCa,EAAaX,QAEtBC,EAAUU,EAAaX,cAElBc,GACCX,QAAAA,MAAM,qCAAsCW,GAEpD,MAAMC,EAAeD,EAAIL,UAAUG,MAAMT,OACtB,oEACnBC,EAASW,EAAY,GAItB,KAEI,MAAA,IAAMF,cAAcP,IAC1B,CAACT,EAAeJ,EAAUK,IAG3BkB,EAAAA,IAACC,GACCC,SAACF,EAAAA,IAAA,MAAA,CAAIG,UAAU,gDACbD,SAAAE,EAAAA,KAACC,EAAK,CAAAF,UAAU,mCACdD,SAAA,CAACF,EAAAA,IAAA,KAAA,CAAGG,UAAU,wCAAwCD,SAEtD,wBACCF,EAAAA,IAAA,IAAA,CAAEG,UAAU,qBAAqBD,SAElC,sJACCI,EAAS,IACVF,EAAAA,KAAC,IAAE,CAAAD,UAAU,6BAA6BD,SAAA,CAAA,WAC/BF,EAAAA,IAAA,OAAA,CAAKG,UAAU,gBAAiBnB,SAAOA,OAEjDG,GAASa,EAAAA,IAAC,IAAE,CAAAG,UAAU,oBAAqBhB,SAAMA"}