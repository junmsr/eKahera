import{j as e}from"./utils-BnCj7yKo.js";import{a as t,R as s}from"./vendor-BZrj58oz.js";import{C as n}from"./Card-fMjg4IWJ.js";import"./Input-D3kbgyHK.js";import{b as a,a as r}from"./index-DcYnMLXP.js";import{B as l,e as i,f as o,g as c,h as d}from"./BaseModal-C-8Qp-dk.js";import{S as x}from"./ScannerCard-B24VW-sX.js";import{u}from"./useKeyboardShortcuts-C3XQk2oo.js";const m=s.forwardRef(({sku:s,setSku:r,quantity:l,setQuantity:i,handleAddToCart:o,quantityInputRef:c,className:d=""},x)=>{const u=t.useRef(!1);return function(e,s={}){const{maxDelay:n=100,inputSelector:a}=s,r=t.useRef(0),l=t.useRef("");t.useEffect(()=>{if(!e||"function"!=typeof e)return;const t=t=>{const s=t.target;if("INPUT"!==s.tagName&&"TEXTAREA"!==s.tagName)return;if(a&&!s.matches(a))return;const n=Date.now(),i=n-r.current;if(l.current=s.value||"","Enter"===t.key){const n=s.value?.trim()||"";if(n&&i<200)return t.preventDefault(),t.stopPropagation(),r.current=0,l.current="",void e(n)}1!==t.key.length||t.ctrlKey||t.metaKey||t.altKey||(r.current=n)};return document.addEventListener("keydown",t,!0),()=>{document.removeEventListener("keydown",t,!0)}},[e,n,a])}(e=>{e&&e.trim()&&(u.current=!0,r(e.trim()),setTimeout(()=>{o(),setTimeout(()=>{u.current=!1},200)},100))},{inputSelector:'input[name="sku"]'}),e.jsx(n,{className:`flex-shrink-0 bg-white/80 backdrop-blur-md border border-white/60 shadow-xl hover:shadow-2xl transition-all duration-300 ${d}`,variant:"glass",children:e.jsxs("div",{className:"flex flex-col gap-1 p-1 sm:p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"})})}),e.jsx("span",{className:"font-bold text-sm text-gray-900",children:"Enter SKU Code"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-semibold text-gray-700 mb-1",children:[e.jsx("span",{children:"SKU Code"}),e.jsx("span",{className:"hidden sm:inline-block text-xs font-bold px-1.5 py-0.5 rounded border bg-gray-100 border-gray-300 text-gray-600",children:"`"})]}),e.jsx("div",{className:"relative",children:e.jsx("input",{ref:x,type:"text",name:"sku",value:s,onChange:e=>r(e.target.value),onKeyPress:e=>{"Enter"===e.key&&s.trim()&&!u.current&&o()},autoComplete:"off",autoFocus:!1,placeholder:"Scan or enter SKU code (Press ` to focus)",className:"w-full pl-3 pr-3 py-2 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 placeholder-gray-400 font-medium"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 whitespace-nowrap",children:"Quantity:"}),e.jsxs("div",{className:"flex items-center gap-1 flex-1",children:[e.jsx("button",{onClick:()=>i(Math.max(1,l-1)),className:"w-8 h-8 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold transition-colors duration-200 flex items-center justify-center",children:"−"}),e.jsx("input",{type:"number",name:"quantity",value:l,min:1,ref:c,onChange:e=>i(Math.max(1,Number(e.target.value)||1)),className:"w-16 px-2 py-1 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-xl text-center text-sm font-semibold focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"}),e.jsx("button",{onClick:()=>i(l+1),className:"w-8 h-8 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold transition-colors duration-200 flex items-center justify-center",children:"+"})]}),e.jsx(a,{label:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Add to Cart"}),e.jsx("span",{className:"hidden sm:inline-block text-xs font-bold px-1.5 py-0.5 rounded border bg-white/20 border-white/40 text-white",children:"F4"})]}),onClick:o,variant:"primary",size:"sm",microinteraction:!0,icon:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),iconPosition:"left"})]})]})]})})});function p({cart:t,handleRemove:s,handleEditQuantity:a,total:r,className:l="",selectedIdx:i=-1,onSelectRow:o,appliedDiscount:c,editingIdx:d=null,editQty:x=1,onEditQtyChange:u,onEditComplete:m,onStartEdit:p}){const h=e=>{if("weight"===e?.product_type||"volume"===e?.product_type){const t=Number(e.quantity_per_unit||1),s=Number(e.quantity||0);if(t>0&&s>0){const e=s/t;return e<1?s:e}return s||0}return Number(e.quantity||0)},b=e=>{if("weight"===e?.product_type||"volume"===e?.product_type){const t=Number(e.quantity_per_unit||1),s=Number(e.quantity||0),n=e.base_unit||"";if(t>0&&s>0){return s/t<1?n:`${t}${n}`}return n}return"pcs"},g=e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&u?.(""===t?"":t.includes(".")?parseFloat(t):parseInt(t,10))},y=e=>{const s=t[e],n="weight"===s?.product_type||"volume"===s?.product_type,r=n?.01:1;let l=""===x?r:Math.max(r,Number(x)||r);if(n&&s.quantity_per_unit){const e=Number(s.quantity_per_unit);h(s)<1||(l*=e)}a(e,l),m?.()},f=()=>e.jsx("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M15.232 5.232l3.536 3.536M9 13l6.586-6.586a2 2 0 1 1 2.828 2.828L11.828 15.828a4 4 0 0 1-1.414.828l-4.243 1.414 1.414-4.243a4 4 0 0 1 .828-1.414z"})}),j=()=>e.jsx("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})}),N=()=>e.jsx("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5 13l4 4L19 7"})}),v=()=>e.jsx("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})});return e.jsx(n,{className:`flex-1 flex flex-col bg-white/80 backdrop-blur-md border border-white/60 shadow-xl transition-all duration-300 h-full min-h-0 overflow-hidden ${l}`,variant:"glass",children:e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col p-2 sm:p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 pb-2 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsx("h3",{className:"text-sm sm:text-base font-bold text-gray-900",children:"Shopping Cart"})]}),e.jsxs("span",{className:"text-xs font-semibold text-gray-600 bg-gray-100 px-2 py-0.5 rounded-full",children:[t.length," ",1===t.length?"item":"items"]})]}),e.jsx("div",{className:"flex-1 overflow-auto min-h-0 rounded-lg",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-gradient-to-r from-blue-50/90 to-indigo-50/90 backdrop-blur-sm border-b border-blue-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-1.5 px-2 text-left text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"py-1.5 px-2 text-center text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"py-1.5 px-2 text-center text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider hidden sm:table-cell",children:"Unit"}),e.jsx("th",{className:"py-1.5 px-2 text-right text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"py-1.5 px-2 text-right text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"py-1.5 px-2 text-center text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:0===t.length?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-2",children:e.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsx("p",{className:"text-gray-500 text-sm font-semibold",children:"Cart is empty"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Scan or enter products"})]})})}):t.map((n,a)=>e.jsxs("tr",{className:"hover:bg-blue-50/50 transition-colors duration-200 group "+(i===a?"bg-blue-100/70 ring-2 ring-blue-300":""),onClick:e=>((e,t)=>{"INPUT"!==t.target.tagName&&o?.(e)})(a,e),children:[e.jsx("td",{className:"py-1.5 px-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-gray-900 group-hover:text-blue-600 transition-colors truncate",children:n.name}),e.jsxs("span",{className:"text-[10px] text-gray-500 truncate",children:["SKU: ",n.sku||"N/A"]})]})}),e.jsx("td",{className:"py-1.5 px-2 text-center",children:d===a?e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("input",{type:"number",inputMode:"decimal",step:"weight"===t[a]?.product_type||"volume"===t[a]?.product_type?"0.01":"1",min:"weight"===t[a]?.product_type||"volume"===t[a]?.product_type?"0.01":"1",value:x,onChange:g,onKeyDown:e=>{"Enter"===e.key?y(a):"Escape"===e.key&&m?.()},onBlur:()=>y(a),className:"w-16 h-7 text-center text-xs font-bold border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0,onFocus:e=>e.target.select()}),e.jsx("button",{type:"button",onClick:()=>y(a),className:"p-1 text-green-600 hover:bg-green-100 rounded",title:"Save",children:e.jsx(N,{})}),e.jsx("button",{onClick:()=>m(),className:"p-1 text-red-600 hover:bg-red-100 rounded",title:"Cancel",children:e.jsx(v,{})})]}):e.jsx("div",{className:"flex flex-col items-center justify-center gap-0.5",children:e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2rem] px-1.5 py-0.5 rounded-md bg-blue-100 text-blue-700 font-bold text-xs",children:(()=>{const e=h(n);return e%1==0?e:e<.01?e.toFixed(4):Number(e).toFixed(2)})()})})}),e.jsx("td",{className:"py-1.5 px-2 text-center hidden sm:table-cell",children:e.jsx("span",{className:"text-[10px] sm:text-xs font-medium text-gray-600",children:b(n)})}),e.jsxs("td",{className:"py-1.5 px-2 text-right",children:[e.jsxs("span",{className:"text-xs sm:text-sm font-medium text-gray-700",children:["₱",n.price.toFixed(2)]}),n.base_unit&&e.jsxs("span",{className:"block text-[10px] text-gray-500",children:["per ",n.base_unit]})]}),e.jsx("td",{className:"py-1.5 px-2 text-right",children:e.jsxs("span",{className:"text-xs sm:text-sm font-bold text-blue-600",children:["₱",(n.price*(d===a?x:n.quantity)).toFixed(2)]})}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),o?.(a);const t=h(n);u?.(t),p?.(a)},className:`p-1.5 rounded-md transition-all duration-200 ${i===a?"bg-blue-100 text-blue-700 border-blue-200":"bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200"} border`,title:"Edit (F1)",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"hidden sm:inline-block text-[10px] font-bold text-blue-700 bg-blue-100 border border-blue-200 px-1.5 py-0.5 rounded",children:"F1"}),e.jsx(f,{})]})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),o?.(a),s(a)},className:`p-1.5 rounded-md transition-all duration-200 ${i===a?"bg-red-100 text-red-700 border-red-200":"bg-red-50 text-red-600 hover:bg-red-100 border-red-200"} border`,title:"Delete (F2)",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"hidden sm:inline-block text-[10px] font-bold text-red-700 bg-red-100 border border-red-200 px-1.5 py-0.5 rounded",children:"F2"}),e.jsx(j,{})]})})]})})]},a))})]})}),e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[c&&e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"line-through",children:["₱",t.reduce((e,t,s)=>e+t.price*(d===s?x:t.quantity),0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Total:"}),e.jsxs("span",{className:"text-lg sm:text-xl font-extrabold text-blue-600",children:["₱",r.toFixed(2)]})]})]})})]})})}function h({isOpen:n,onClose:i,sku:o,setSku:c}){const[d,m]=t.useState(null),p=async()=>{if(o)try{const e=localStorage.getItem("business_id"),t=e?`?business_id=${encodeURIComponent(e)}`:"",s=await r(`/api/products/public/sku/${encodeURIComponent(o)}${t}`);m(s?{name:s.product_name,price:Number(s.selling_price||0),sku:s.sku}:null)}catch(e){m(null)}};s.useEffect(()=>{if(!o)return void m(null);const e=setTimeout(()=>{p()},200);return()=>clearTimeout(e)},[o]);const h=e.jsx(a,{label:"Close (Esc)",variant:"secondary",onClick:i,className:"w-full"});return u([{key:"escape",action:i,enabled:n,allowWhileTyping:!0},{key:"enter",action:p,enabled:n,allowWhileTyping:!0}],[n,o]),e.jsxs(l,{isOpen:n,onClose:i,title:"Price Check",subtitle:"Scan or enter SKU/barcode",icon:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),footer:h,size:"md",contentClassName:"space-y-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(x,{onScan:e=>{const t=e?.[0]?.rawValue;t&&c(t)},paused:!1,onResume:()=>{},className:"w-full",textMain:"text-blue-700"})}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter SKU or Barcode"}),e.jsx("input",{type:"text",value:o,onChange:e=>c(e.target.value),className:"w-full border border-gray-300 rounded-lg px-4 py-2 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter SKU or scan barcode"})]}),e.jsxs("div",{className:"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Check price:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Enter"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Close:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Esc"})]})]}),d?e.jsxs("div",{className:"w-full bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200/50",children:[e.jsx("div",{className:"text-lg font-semibold text-blue-900 mb-1",children:d.name}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:["₱",d.price.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["SKU: ",d.sku]})]}):o?e.jsx("div",{className:"text-red-500 text-sm text-center py-4",children:"No product found."}):null]})}function b({isOpen:n,onClose:i,onApplyDiscount:o}){const[c,d]=t.useState(!1),[x,m]=t.useState([]),[p,h]=t.useState(""),[b,g]=t.useState(""),[y,f]=t.useState(null),[j,N]=t.useState(0),[v,w]=t.useState(!1),[k,C]=t.useState(""),[S,E]=t.useState(!1),[M,T]=t.useState("PERCENTAGE"),[D,_]=t.useState({isOpen:!1,id:null,label:""}),A=s.useRef(null),P=s.useRef(null),L=s.useRef(null),F=e=>{if(!e)return!1;const t=e.tagName?.toLowerCase();return e.isContentEditable||"input"===t||"textarea"===t||"textbox"===e.getAttribute?.("role")},O=(e,t)=>{if("Escape"===e.key)return e.preventDefault(),e.stopPropagation(),void e.target.blur();if("Enter"===e.key&&c&&p&&b)return e.preventDefault(),e.stopPropagation(),void W();if("value"===t){if([8,9,27,13,37,38,39,40,35,36,46].includes(e.keyCode)||e.ctrlKey&&[65,67,88,86,90,89].includes(e.keyCode)||e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105)return;(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}};t.useEffect(()=>{n&&c&&requestAnimationFrame(()=>{A.current?.focus(),A.current?.select?.()})},[n,c]),t.useEffect(()=>{if(!n)return;(async()=>{w(!0),C("");try{const e=sessionStorage.getItem("auth_token"),t=(await r("/api/discounts",{headers:{Authorization:`Bearer ${e}`}})||[]).map(e=>({label:e.discount_name||`${e.discount_percentage}% off`,value:e.discount_percentage,discount_id:e.discount_id,type:"percentage"}));m(t)}catch(e){C("Failed to load discounts")}finally{w(!1)}})()},[n]);const W=async()=>{if(p&&b){E(!0);try{const e=sessionStorage.getItem("auth_token"),t={discount_name:p,discount_percentage:Number(b)},s=await r("/api/discounts",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t)});m(e=>[...e,{label:s.discount_name||p,value:s.discount_percentage,discount_id:s.discount_id,type:"percentage"}]),h(""),g("")}catch(e){console.error("Failed to add discount:",e),C("Failed to add discount. Please try again.")}finally{E(!1)}}},R=async e=>{if(!e)return;const t=Number(e);if(isNaN(t))return void C("Invalid discount ID");const s=x.find(e=>Number(e.discount_id)===t);s?_({isOpen:!0,id:t,label:s.label}):C("Discount not found in the list")},z=t.useCallback(()=>{_({isOpen:!1,id:null,label:""})},[]),$=async()=>{const e=D.id;if(e)try{E(!0),C(""),await r(`/api/discounts/${e}`,{method:"DELETE"}),m(t=>{const s=t.findIndex(t=>Number(t.discount_id)===e),n=t.filter(t=>Number(t.discount_id)!==e);return-1!==s&&(f(e=>e===s?Math.max(0,s-1):e>s?e-1:e),N(e=>e===s?Math.max(0,s-1):e>s?e-1:e)),n}),z()}catch(t){if(console.error("Failed to remove discount:",t),t.message&&t.message.includes("not found"))try{const e=sessionStorage.getItem("auth_token"),t=await r("/api/discounts",{headers:{Authorization:`Bearer ${e}`}});m((t||[]).map(e=>({label:e.discount_name||`${e.discount_percentage}% off`,value:e.discount_percentage,discount_id:e.discount_id,type:"percentage"}))),C("Discount not found. List has been refreshed."),z()}catch(s){console.error("Failed to refresh discounts:",s),C("Discount not found. Could not refresh list.")}else C(t.message||"Failed to remove discount. Please try again.")}finally{E(!1)}},B=()=>{d(!1)},I=()=>{if(null==y)return;const e=x[y];e&&(o({type:e.type,value:e.value,label:e.label,discount_id:e.discount_id}),i())},U=e.jsx(a,{label:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsx("span",{children:"Save Settings"}),e.jsx("span",{className:"text-xs font-mono bg-white/20 px-2 py-0.5 rounded",children:"Enter"})]}),variant:"primary",onClick:B,className:"w-full"}),K=e.jsxs("div",{className:"w-full space-y-2",children:[e.jsx(a,{label:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsx("span",{children:"Apply Discount"}),e.jsx("span",{className:"text-xs font-mono bg-white/20 px-2 py-0.5 rounded",children:"Enter"})]}),variant:"primary",onClick:I,disabled:null===y,className:"w-full"}),e.jsx(a,{label:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsx("span",{children:"Manage Discounts"}),e.jsx("span",{className:"text-xs font-mono bg-gray-100 px-2 py-0.5 rounded text-gray-700",children:"M"})]}),variant:"secondary",onClick:()=>d(!0),className:"w-full"})]});t.useEffect(()=>{if(c&&L.current&&null!==j){const e=L.current.querySelector(`[data-discount-idx="${j}"]`);e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}},[j,c]),t.useEffect(()=>{if(k){const e=setTimeout(()=>C(""),5e3);return()=>clearTimeout(e)}},[k]),u([{key:"escape",action:e=>{D.isOpen?z():F(e?.target)?e.target.blur?.():i()},enabled:n,allowWhileTyping:!0,stopPropagation:!0,preventDefault:!0},{key:"enter",action:e=>D.isOpen?(e.preventDefault(),void $()):F(e?.target)?void(c&&p&&b&&(e.preventDefault(),W())):c?(e.preventDefault(),void B()):void I(),enabled:n,allowWhileTyping:!0,stopPropagation:!0,preventDefault:!0},{key:"m",action:e=>{F(e?.target)||D.isOpen||d(e=>!e)},enabled:n,allowWhileTyping:!1,stopPropagation:!0,preventDefault:!0},...Array.from({length:9}).map((e,t)=>({key:String(t+1),action:e=>{F(e?.target)||D.isOpen||!c&&x[t]&&(e=>{const t=x[e];t&&(f(e),o({type:t.type,value:t.value,label:t.label,discount_id:t.discount_id}),i())})(t)},enabled:n&&!c&&x[t],allowWhileTyping:!1,stopPropagation:!0,preventDefault:!0})),{key:"arrowup",action:e=>{F(e?.target)||D.isOpen||c||0===x.length||f(e=>null==e?0:e>0?e-1:0)},enabled:n&&!c,allowWhileTyping:!1,stopPropagation:!0,preventDefault:!0},{key:"arrowdown",action:e=>{F(e?.target)||D.isOpen||c||0===x.length||f(e=>null==e?0:Math.min(e+1,x.length-1))},enabled:n&&!c,allowWhileTyping:!1,stopPropagation:!0,preventDefault:!0},{key:"n",action:e=>{F(e?.target)&&e.target!==A.current||c&&!D.isOpen&&setTimeout(()=>{A.current?.focus(),A.current?.select?.()},0)},enabled:n&&c,allowWhileTyping:!0,stopPropagation:!1,preventDefault:!1},{key:"v",action:e=>{F(e?.target)&&e.target!==P.current||c&&!D.isOpen&&setTimeout(()=>{P.current?.focus(),P.current?.select?.()},0)},enabled:n&&c,allowWhileTyping:!0,stopPropagation:!1,preventDefault:!1},{key:"arrowup",action:e=>{F(e?.target)||D.isOpen||c&&0!==x.length&&N(e=>Math.max(0,e-1))},enabled:n&&c,allowWhileTyping:!1,stopPropagation:!0,preventDefault:!0},{key:"arrowdown",action:e=>{F(e?.target)||D.isOpen||c&&0!==x.length&&N(e=>Math.min(x.length-1,(e??0)+1))},enabled:n&&c,allowWhileTyping:!1,stopPropagation:!0,preventDefault:!0},{key:"delete",action:e=>{if(F(e?.target)||D.isOpen)return;if(!c||0===x.length)return;const t=x[j];t?.discount_id&&R(t.discount_id)},enabled:n&&c,allowWhileTyping:!1,stopPropagation:!0,preventDefault:!0}],[n,c,x,y,I,B,i,j,W,D.isOpen,$,z]);return e.jsxs(e.Fragment,{children:[e.jsxs(l,{isOpen:n&&!D.isOpen,onClose:i,title:c?"Manage Discounts":"Select Discount",subtitle:c?"Add or remove discount options":"Choose a discount to apply",icon:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),footer:c?U:K,size:"md",contentClassName:"space-y-4",children:[k&&e.jsx("div",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg px-3 py-2",children:k}),c?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{className:"flex-1 px-4 py-2 rounded-lg font-semibold text-sm transition-all "+("PERCENTAGE"===M?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),onClick:()=>T("PERCENTAGE"),children:"Percentage"})}),e.jsx("div",{ref:L,className:"space-y-2 max-h-60 overflow-y-auto pr-2 -mr-2",children:x.map((t,s)=>e.jsxs("div",{"data-discount-idx":s,className:"flex gap-2 items-center bg-gray-50 p-3 rounded-lg transition-all "+(j===s?"ring-2 ring-blue-400 bg-blue-50":"hover:bg-gray-100"),children:[e.jsx("input",{className:"flex-1 bg-transparent outline-none text-sm font-medium",value:t.label,readOnly:!0}),e.jsx("input",{className:"w-20 bg-transparent text-center outline-none text-sm font-medium",value:t.value,readOnly:!0}),e.jsx("button",{className:"text-red-500 hover:text-red-700 transition-colors p-1",onClick:()=>R(t.discount_id),title:"Remove (Del)",type:"button",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},s))}),e.jsxs("div",{className:"space-y-2 p-4 bg-blue-50 rounded-lg border border-blue-200",onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),W())},children:[e.jsx("div",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Add New Discount (N=Name, V=Value, Enter=Add)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Description",value:p,ref:A,onKeyDown:e=>O(e,"desc"),onFocus:()=>d(!0),onChange:e=>h(e.target.value)}),e.jsx("input",{className:"w-24 border border-gray-300 rounded-lg px-3 py-2 text-sm text-center focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"PERCENTAGE"===M?"0%":"0.00",inputMode:"PERCENTAGE"===M?"numeric":"decimal",value:b,ref:P,onKeyDown:e=>O(e,"value"),onFocus:()=>d(!0),onChange:e=>g(e.target.value),type:"number",min:"0"}),e.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-bold",onClick:W,title:"Add (Enter)",type:"button",disabled:S,children:S?"...":"+"})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-medium",children:"Select Discount"})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Note:"})," Discounts (PWD/Senior Citizen) only apply to basic necessities as per Philippine law."]})}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-4 max-h-64 overflow-y-auto",children:x.map((t,s)=>e.jsxs("button",{className:`p-3 border rounded text-center ${y===s?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"} relative group`,onClick:()=>f(s),children:[e.jsx("div",{className:"font-medium",children:t.label}),e.jsxs("div",{className:"text-sm text-gray-500",children:[t.value,"%"]})]},`${t.type}-${s}`))})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Move selection:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"↑ ↓"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Delete selected:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"Del"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Focus name / value:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"N / V"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Add/Save:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"Enter"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Select discount:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"1-9 / ↑↓"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Apply selected:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"Enter"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Manage discounts:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"M"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-1 border-t border-gray-100 mt-1",children:[e.jsx("span",{children:"Close modal:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"Esc"})]})]})})]}),e.jsx(l,{isOpen:D.isOpen,onClose:z,title:"Confirm Discount Deletion",subtitle:"This action cannot be undone.",size:"sm",footer:e.jsxs("div",{className:"flex justify-end space-x-2 w-full",children:[e.jsx(a,{label:"Cancel",variant:"secondary",onClick:z,disabled:S}),e.jsx(a,{label:S?"Deleting...":"Delete Discount",variant:"danger",onClick:$,disabled:S})]}),children:e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-700",children:["Are you sure you want to permanently delete the discount:",e.jsx("strong",{className:"block mt-1 text-base font-semibold",children:D.label})]})})})]})}function g({isOpen:s,onClose:n}){const[a,x]=t.useState("SUMMARY"),[m,p]=t.useState(null),[h,b]=t.useState([]),[g,y]=t.useState([]),[f,j]=t.useState(!1),[N,v]=t.useState(!1),[w,k]=t.useState(""),C=async(e=null)=>{v(!0);try{k("");const t=e?`/stats/cash-transactions?payment_type=${encodeURIComponent(e)}&limit=100`:"/stats/cash-transactions?limit=100",s=await r(t);y(Array.isArray(s)?s:[])}catch(t){k(t.message||"Failed to load transactions")}finally{v(!1)}};t.useEffect(()=>{s&&((async()=>{j(!0);try{k("");const e=await r("/stats/cash-ledger");b(Array.isArray(e)?e:[])}catch(e){k(e.message||"Failed to load cash ledger")}finally{j(!1)}})(),C())},[s]),u([{key:"escape",action:n,enabled:s,allowWhileTyping:!0},{key:"1",action:()=>{x("SUMMARY"),p(null)},enabled:s},{key:"2",action:()=>{x("TRANSACTIONS"),p(null)},enabled:s}],[s,a]);const S=e.jsxs("div",{className:"flex gap-2 border-t border-gray-200/50 pt-4 mt-4",children:[e.jsxs("button",{onClick:()=>{x("SUMMARY"),p(null)},className:"flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-semibold transition-all "+("SUMMARY"===a?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(c,{className:"w-5 h-5"}),e.jsx("span",{children:"Summary (1)"})]}),e.jsxs("button",{onClick:()=>{x("TRANSACTIONS"),p(null)},className:"flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-semibold transition-all "+("TRANSACTIONS"===a?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(d,{className:"w-5 h-5"}),e.jsx("span",{children:"Transactions (2)"})]})]});return e.jsx(l,{isOpen:s,onClose:n,title:"Cash Ledger",subtitle:"View cash balance and payment methods",icon:e.jsx(i,{className:"w-6 h-6 text-white"}),size:"lg",contentClassName:"space-y-4",children:e.jsxs("div",{className:"space-y-6",children:["SUMMARY"===a?(()=>{const t=h.reduce((e,t)=>e+(Number(t.balance)||0),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-700 text-white rounded-lg shadow-xl px-8 py-8 text-center",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-100 mb-2",children:"Total Cash on Hand"}),e.jsxs("div",{className:"text-5xl font-bold flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-4xl",children:"₱"}),t.toFixed(2)]}),e.jsx("p",{className:"text-blue-100 text-sm mt-3",children:(new Date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center",children:e.jsx(i,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Payment Methods"})]}),e.jsx("div",{className:"space-y-3",children:f?e.jsx("div",{className:"text-sm text-gray-500",children:"Loading..."}):0===h.length?e.jsx("div",{className:"text-sm text-gray-500",children:"No balances available"}):h.map(t=>e.jsx("button",{onClick:async()=>{p(t.name),x("TRANSACTIONS"),await C(t.name)},className:"w-full bg-gradient-to-r from-gray-50 to-gray-100/50 hover:from-blue-50 hover:to-indigo-50/50 rounded-2xl p-4 border border-gray-200/50 hover:border-blue-300 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-lg flex items-center justify-center border border-gray-200 group-hover:border-blue-300 group-hover:bg-blue-50 transition-all",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600 group-hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500",children:"View transactions"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["₱",(Number(t.balance)||0).toFixed(2)]})}),e.jsx(o,{className:"w-5 h-5 text-gray-400 group-hover:text-blue-600 transition-colors"})]})]})},t.name))})]}),w&&e.jsx("div",{className:"text-sm text-red-600",children:w.includes("Server returned an HTML error page")||w.includes("Cannot GET")?"Unable to reach backend API. Check backend server and proxy configuration.":w})]})})():e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 rounded-2xl p-4 border border-indigo-100/50",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-900",children:m?`${m} Transactions`:"All Transactions"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:N?"Loading...":`${g.length} transaction${1!==g.length?"s":""} found`})]}),e.jsx("div",{className:"bg-white rounded-2xl border border-gray-200/50 overflow-hidden",children:N?e.jsx("div",{className:"text-center py-12 text-sm text-gray-500",children:"Loading transactions..."}):0===g.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-300 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No transactions found"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200/50",children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Date & Time"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Amount"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:g.map(t=>e.jsxs("tr",{className:"hover:bg-blue-50/50 transition-colors duration-150",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 font-medium",children:new Date(t.created_at).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 border border-blue-200",children:t.payment_type})}),e.jsxs("td",{className:"px-6 py-4 text-sm text-right font-bold text-green-600",children:["₱",(Number(t.total)||0).toFixed(2)]})]},String(t.transaction_id)))})]})})})]}),S,e.jsxs("div",{className:"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Summary view:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"1"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Transactions view:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"2"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Close:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Esc"})]})]})]})})}function y({isOpen:t,onClose:s,total:n,onSelectPayment:r}){u([{key:"1",action:()=>r("cash"),enabled:t},{key:"2",action:()=>r("gcash"),enabled:t},{key:"3",action:()=>r("maya"),enabled:t},{key:"enter",action:()=>r("cash"),enabled:t},{key:"escape",action:s,enabled:t}],[t]);const i=e.jsxs("div",{className:"w-full flex flex-col gap-3",children:[e.jsx(a,{label:"CASH (1 / Enter)",className:"w-full h-12 text-base font-bold",onClick:()=>r("cash")}),e.jsx(a,{label:"GCASH (2)",className:"w-full h-12 text-base font-bold",onClick:()=>r("gcash")}),e.jsx(a,{label:"MAYA (3)",className:"w-full h-12 text-base font-bold",onClick:()=>r("maya")})]});return e.jsxs(l,{isOpen:t,onClose:s,title:"Checkout",subtitle:"Select payment method",icon:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),footer:i,size:"sm",contentClassName:"text-center",children:[e.jsxs("div",{className:"bg-blue-500 text-white rounded-2xl py-6 px-4 text-center mb-4",children:[e.jsx("div",{className:"text-sm opacity-90 mb-2",children:"Total Amount"}),e.jsxs("div",{className:"text-4xl font-bold",children:["₱",n.toFixed(2)]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Choose your preferred payment method"}),e.jsxs("div",{className:"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Cash:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"1 / Enter"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"GCash:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"2"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Maya:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"3"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Close:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Esc"})]})]})]})}function f({isOpen:t,onClose:s,change:n=0,payable:r=0,onReceipt:i,onNewEntry:o}){u([{key:"escape",action:s,enabled:t,allowWhileTyping:!0},{key:"enter",action:()=>{i&&i()},enabled:t,allowWhileTyping:!0}],[t]);const c=e.jsx("div",{className:"w-full flex flex-col gap-3",children:e.jsx(a,{label:"RECEIPT (Enter)",className:"w-full h-11 text-sm font-semibold bg-blue-700 hover:bg-blue-800 text-white",onClick:()=>{i?i():alert("Receipt")}})});return e.jsxs(l,{isOpen:t,onClose:s,title:"Payment Complete",icon:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),footer:c,size:"sm",contentClassName:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx("div",{className:"w-14 h-14 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-7 w-7 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-400 to-indigo-500 rounded-2xl p-5 text-white",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide opacity-90 mb-2",children:"Change"}),e.jsxs("div",{className:"inline-flex items-baseline gap-2 bg-white text-blue-700 rounded-lg px-4 py-3 shadow-md",children:[e.jsx("span",{className:"text-lg font-bold",children:"₱"}),e.jsx("span",{className:"text-2xl font-bold",children:Number(n).toFixed(2)})]}),e.jsx("div",{className:"mt-4 text-sm opacity-90",children:"Payable"}),e.jsxs("div",{className:"text-sm font-semibold",children:["₱",Number(r).toFixed(2)]})]}),e.jsxs("div",{className:"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Print / open receipt:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Enter"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Close:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Esc"})]})]})]})}function j({isOpen:s,onClose:n,total:r,onConfirm:i}){const[o,c]=t.useState(""),[d,x]=t.useState(!1),[m,p]=t.useState(null),[h,b]=t.useState(!1),[g,y]=t.useState(""),j=t.useRef(null),N=t.useRef(!1),v=e=>{e&&(e.preventDefault(),e.stopPropagation());const t=Number(r).toFixed(2);c(t),N.current=!0,setTimeout(()=>{N.current=!1},200)},w=e=>{e&&(e.preventDefault(),e.stopPropagation());let t=j.current?.value||o;N.current&&(t=Number(r).toFixed(2));const s=(t?.toString()||"").trim();if(!s)return void alert("Please enter an amount.");const n=Number(s);if(isNaN(n)||n<=0)return void alert("Please enter a valid amount.");const a=Math.round(100*n)/100,l=Math.round(100*r)/100;if(a<l)return y(`Amount received (₱${a.toFixed(2)}) must be greater than or equal to total (₱${l.toFixed(2)}).`),void b(!0);const i=Math.max(0,a-l);p({change:i,payable:l,received:a}),x(!0)},k=()=>{x(!1),n&&n()},C=()=>{x(!1),c(""),n&&n()},S=()=>{i&&null!=m?.received&&i(Number(m.received))};if(u([{key:"escape",action:()=>b(!1),enabled:h,allowWhileTyping:!0},{key:"enter",action:e=>{e.preventDefault(),e.stopPropagation(),b(!1)},enabled:h,allowWhileTyping:!0}],[h]),u([{key:"escape",action:n,enabled:s&&!d&&!h,allowWhileTyping:!0},{key:"enter",action:e=>{e.preventDefault(),e.stopPropagation(),w(e)},enabled:s&&!d&&!h,allowWhileTyping:!0},{key:"e",action:v,enabled:s&&!d&&!h,allowWhileTyping:!0}],[s,o,r,d,h]),!s&&!d)return null;if(d)return e.jsx(f,{isOpen:d,onClose:k,change:m?.change,payable:m?.payable,onNewEntry:C,onReceipt:S});const E=e.jsxs(e.Fragment,{children:[e.jsx(a,{label:"Cancel (Esc)",variant:"secondary",onClick:n,type:"button",className:"flex-1"}),e.jsx(a,{label:"Proceed (Enter)",variant:"primary",type:"button",onClick:w,className:"flex-1"})]});return e.jsxs(e.Fragment,{children:[e.jsxs(l,{isOpen:s,onClose:n,title:"Cash Payment",subtitle:"Enter amount received",icon:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),footer:E,size:"md",contentClassName:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-2xl py-6 px-4 text-center",children:[e.jsx("div",{className:"text-sm opacity-90 mb-2",children:"Total Amount"}),e.jsxs("div",{className:"text-4xl font-bold",children:["₱",r.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount Received"}),e.jsx("input",{ref:j,type:"number",step:"0.01",className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-center text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"₱0.00",value:o,onChange:e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&c(t)}})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Quick amounts:"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[100,200,300,400,500,600,700,800,900].map(t=>e.jsx("button",{className:"bg-blue-100 hover:bg-blue-200 text-blue-700 font-bold py-2 rounded-lg transition-colors text-sm",onClick:()=>(e=>c(Number(e).toString()))(t),children:t},t))})]}),e.jsx(a,{label:"Use Exact Amount (E)",className:"w-full h-10 text-sm font-bold bg-slate-600 hover:bg-slate-700 text-white",onClick:v}),e.jsxs("div",{className:"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Use exact total:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"E"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Proceed:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Enter"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Close:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Esc"})]})]})]}),e.jsx(l,{isOpen:h,onClose:()=>b(!1),title:"Insufficient Amount",size:"sm",headerIconBgClassName:"bg-red-500",icon:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),footer:e.jsx(a,{label:"OK (Enter)",variant:"primary",onClick:()=>b(!1),className:"w-full bg-red-600 hover:bg-red-700"}),children:e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-gray-700 text-lg font-medium",children:g}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Please enter a valid amount."})]})})]})}export{p as C,b as D,h as P,m as S,g as a,y as b,j as c};
//# sourceMappingURL=CashPaymentModal-Bxw9Dxw2.js.map
