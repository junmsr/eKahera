{"version":3,"file":"useKeyboardShortcuts-C3XQk2oo.js","sources":["../../../frontend/src/hooks/useKeyboardShortcuts.js"],"sourcesContent":["import { useEffect, useMemo } from \"react\";\r\n\r\nconst isTextInput = (target) => {\r\n  if (!target) return false;\r\n  const tag = target.tagName?.toLowerCase();\r\n  const editable =\r\n    target.isContentEditable ||\r\n    [\"input\", \"textarea\", \"select\"].includes(tag) ||\r\n    target.getAttribute?.(\"role\") === \"textbox\";\r\n  return editable;\r\n};\r\n\r\n// Check if a key is a special key that should work even when typing\r\nconst isSpecialKey = (event, normalizedKey) => {\r\n  const key = event.key?.toLowerCase() || \"\";\r\n  \r\n  // Function keys (F1-F12)\r\n  if (/^f\\d+$/.test(normalizedKey)) return true;\r\n  // Escape key\r\n  if (normalizedKey === \"escape\" || key === \"escape\") return true;\r\n  // Backtick key\r\n  if (normalizedKey === \"`\" || key === \"`\" || key === \"backquote\") return true;\r\n  // Modifier key combinations (Ctrl, Alt, Meta + any key)\r\n  if (event.ctrlKey || event.altKey || event.metaKey) return true;\r\n  // Arrow keys (check both event.key and normalized key)\r\n  if (key.startsWith(\"arrow\") || normalizedKey === \"up\" || normalizedKey === \"down\" || normalizedKey === \"left\" || normalizedKey === \"right\") return true;\r\n  return false;\r\n};\r\n\r\nconst normalizeKeyString = (key = \"\") =>\r\n  key\r\n    .toLowerCase()\r\n    .trim()\r\n    .replace(/\\s+/g, \"\")\r\n    .replace(\"arrow\", \"\")\r\n    .replace(\"backquote\", \"`\") // Normalize Backquote to backtick\r\n    .replace(/^`$/, \"`\"); // Ensure backtick stays as backtick\r\n\r\nconst buildKey = (event) => {\r\n  const parts = [];\r\n  if (event.ctrlKey) parts.push(\"ctrl\");\r\n  if (event.altKey) parts.push(\"alt\");\r\n  if (event.shiftKey) parts.push(\"shift\");\r\n  const key = event.key?.toLowerCase();\r\n  if (key) parts.push(key);\r\n  return parts.join(\"+\");\r\n};\r\n\r\n/**\r\n * useKeyboardShortcuts\r\n * Centralized keyboard shortcut handler with cleanup and enable/disable support.\r\n *\r\n * @param {Array} shortcuts [{ key: 'f1', action: fn, enabled: true, preventDefault: true, allowWhileTyping: false }]\r\n * @param {Array} deps extra dependencies to re-register listener\r\n */\r\n/**\r\n * useKeyboardShortcuts - A hook to handle keyboard shortcuts with proper event handling\r\n * @param {Array} shortcuts - Array of shortcut configurations\r\n * @param {string} shortcuts[].key - The key or key combination (e.g., 'esc', 'ctrl+s')\r\n * @param {Function} shortcuts[].action - The function to execute when the shortcut is triggered\r\n * @param {boolean} [shortcuts[].enabled=true] - Whether the shortcut is enabled\r\n * @param {boolean} [shortcuts[].preventDefault=true] - Whether to prevent default browser behavior\r\n * @param {boolean} [shortcuts[].stopPropagation=true] - Whether to stop event propagation\r\n * @param {boolean} [shortcuts[].allowWhileTyping=false] - Whether to allow the shortcut while typing in an input field\r\n * @param {Array} deps - Dependencies to re-register the shortcuts\r\n */\r\nexport function useKeyboardShortcuts(shortcuts = [], deps = []) {\r\n  const prepared = useMemo(\r\n    () =>\r\n      shortcuts\r\n        .filter(Boolean)\r\n        .map((s) => ({\r\n          ...s,\r\n          key: normalizeKeyString(s.key),\r\n        })),\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    [JSON.stringify(shortcuts)]\r\n  );\r\n\r\n  useEffect(() => {\r\n    const handler = (event) => {\r\n      const currentKey = normalizeKeyString(buildKey(event));\r\n      // Find exact match - only compare the normalized key string, not event.key directly\r\n      const match = prepared.find(\r\n        (s) =>\r\n          s.enabled !== false &&\r\n          currentKey === s.key\r\n      );\r\n      if (!match) return;\r\n\r\n      // Skip if typing in an input field and not explicitly allowed\r\n      // BUT allow special keys (function keys, modifiers, escape) to always work\r\n      const isSpecial = isSpecialKey(event, currentKey);\r\n      if (isTextInput(event.target) && match.allowWhileTyping !== true && !isSpecial) {\r\n        return;\r\n      }\r\n\r\n      // Prevent default behavior if not explicitly disabled\r\n      // Always prevent default for special keys when matched\r\n      if (match.preventDefault !== false || isSpecial) {\r\n        event.preventDefault();\r\n      }\r\n\r\n      // Stop propagation by default to prevent conflicts with other handlers\r\n      // This can be overridden by setting stopPropagation: false\r\n      if (match.stopPropagation !== false) {\r\n        event.stopPropagation();\r\n      }\r\n\r\n      // Execute the action if provided\r\n      match.action?.(event);\r\n    };\r\n\r\n    // Use capture phase for better priority handling\r\n    window.addEventListener(\"keydown\", handler, true);\r\n    return () => window.removeEventListener(\"keydown\", handler, true);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [prepared, ...deps]);\r\n}\r\n\r\nexport default useKeyboardShortcuts;\r\n\r\n"],"names":["normalizeKeyString","key","toLowerCase","trim","replace","useKeyboardShortcuts","shortcuts","deps","prepared","useMemo","filter","Boolean","map","s","JSON","stringify","useEffect","handler","event","currentKey","parts","ctrlKey","push","altKey","shiftKey","join","buildKey","match","find","enabled","isSpecial","isSpecialKey","normalizedKey","test","metaKey","startsWith","target","tag","tagName","isContentEditable","includes","getAttribute","isTextInput","allowWhileTyping","preventDefault","stopPropagation","action","window","addEventListener","removeEventListener"],"mappings":"yCAEA,MA2BMA,EAAqBA,CAACC,EAAM,KAChCA,EACGC,cACAC,OACAC,QAAQ,OAAQ,IAChBA,QAAQ,QAAS,IACjBA,QAAQ,YAAa,KACrBA,QAAQ,MAAO,KA8Bb,SAASC,EAAqBC,EAAY,GAAIC,EAAO,IAC1D,MAAMC,EAAWC,EAAOA,QACtB,IACEH,EACGI,OAAOC,SACPC,IAAKC,IAAO,IACRA,EACHZ,IAAKD,EAAmBa,EAAEZ,QAGhC,CAACa,KAAKC,UAAUT,KAGlBU,EAAAA,UAAU,KACR,MAAMC,EAAWC,IACf,MAAMC,EAAanB,EA3CPkB,KAChB,MAAME,EAAQ,GACVF,EAAMG,SAASD,EAAME,KAAK,QAC1BJ,EAAMK,QAAQH,EAAME,KAAK,OACzBJ,EAAMM,UAAUJ,EAAME,KAAK,SAC/B,MAAMrB,EAAMiB,EAAMjB,KAAKC,cAEvB,OADID,GAAKmB,EAAME,KAAKrB,GACbmB,EAAMK,KAAK,MAoCwBC,CAASR,IAEzCS,EAAQnB,EAASoB,KACpBf,IACe,IAAdA,EAAEgB,SACFV,IAAeN,EAAEZ,KAErB,IAAK0B,EAAO,OAIZ,MAAMG,EA/ESC,EAACb,EAAOc,KAC3B,MAAM/B,EAAMiB,EAAMjB,KAAKC,eAAiB,GAGxC,QAAI,SAAS+B,KAAKD,IAEI,WAAlBA,GAAsC,WAAR/B,GAEZ,MAAlB+B,GAAiC,MAAR/B,GAAuB,cAARA,MAExCiB,EAAMG,SAAWH,EAAMK,QAAUL,EAAMgB,aAEvCjC,EAAIkC,WAAW,UAA8B,OAAlBH,GAA4C,SAAlBA,GAA8C,SAAlBA,GAA8C,UAAlBA,IAmE3FD,CAAab,EAAOC,GA1FvBiB,KACnB,IAAKA,EAAQ,OAAO,EACpB,MAAMC,EAAMD,EAAOE,SAASpC,cAK5B,OAHEkC,EAAOG,mBACP,CAAC,QAAS,WAAY,UAAUC,SAASH,IACP,YAAlCD,EAAOK,eAAe,SAqFhBC,CAAYxB,EAAMkB,UAAsC,IAA3BT,EAAMgB,mBAA8Bb,MAMxC,IAAzBH,EAAMiB,gBAA4Bd,IACpCZ,EAAM0B,kBAKsB,IAA1BjB,EAAMkB,iBACR3B,EAAM2B,kBAIRlB,EAAMmB,SAAS5B,KAKjB,OADA6B,OAAOC,iBAAiB,UAAW/B,GAAS,GACrC,IAAM8B,OAAOE,oBAAoB,UAAWhC,GAAS,IAE3D,CAACT,KAAaD,GACnB"}