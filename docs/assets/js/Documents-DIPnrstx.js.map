{"version":3,"file":"Documents-DIPnrstx.js","sources":["../../../frontend/src/pages/Documents.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport PageLayout from \"../components/layout/PageLayout\";\r\nimport NavAdmin from \"../components/layout/Nav-Admin\";\r\nimport Card from \"../components/common/Card\";\r\nimport Loader from \"../components/common/Loader\";\r\nimport { api, authHeaders } from \"../lib/api\";\r\nimport Button from \"../components/common/Button\";\r\n\r\n/**\r\n * Documents Page Component\r\n * Displays and manages business documents for the logged-in user\r\n */\r\nconst Documents = () => {\r\n  const [documents, setDocuments] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(\"\");\r\n  const [downloading, setDownloading] = useState(null);\r\n\r\n  useEffect(() => {\r\n    fetchDocuments();\r\n  }, []);\r\n\r\n  const fetchDocuments = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(\"\");\r\n\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n      const user = JSON.parse(sessionStorage.getItem(\"user\") || \"{}\");\r\n      const businessId = user.businessId || user.business_id;\r\n\r\n      if (!token) {\r\n        throw new Error(\"No authentication token found\");\r\n      }\r\n\r\n      if (!businessId) {\r\n        throw new Error(\"Business ID not found\");\r\n      }\r\n\r\n      const data = await api(`/documents/business/${businessId}`, {\r\n        headers: authHeaders(token),\r\n      });\r\n\r\n      setDocuments(Array.isArray(data.documents) ? data.documents : []);\r\n    } catch (err) {\r\n      console.error(\"Failed to fetch documents:\", err);\r\n      setError(\r\n        err.message || \"Failed to load documents. Please check your connection and try again.\"\r\n      );\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const downloadDocument = async (documentId, fileName) => {\r\n    setDownloading(documentId);\r\n    try {\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n      const response = await api(\r\n        `/documents/download/${documentId}`,\r\n        {\r\n          headers: authHeaders(token),\r\n        },\r\n        true // returnRawResponse = true\r\n      );\r\n      const blob = await response.blob();\r\n      const url = window.URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.style.display = 'none';\r\n      a.href = url;\r\n      a.download = fileName;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      window.URL.revokeObjectURL(url);\r\n    } catch (error) {\r\n      console.error('Error downloading document:', error);\r\n      alert('Error downloading document');\r\n    } finally {\r\n      setDownloading(null);\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status) => {\r\n    switch (status) {\r\n      case 'approved': return 'text-green-600 bg-green-100';\r\n      case 'rejected': return 'text-red-600 bg-red-100';\r\n      default: return 'text-yellow-600 bg-yellow-100';\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString) => {\r\n    if (!dateString) return \"N/A\";\r\n    return new Date(dateString).toLocaleDateString(\"en-US\", {\r\n      year: \"numeric\",\r\n      month: \"long\",\r\n      day: \"numeric\",\r\n      hour: \"2-digit\",\r\n      minute: \"2-digit\",\r\n    });\r\n  };\r\n\r\n  // Header actions\r\n  const headerActions = (\r\n    <div className=\"flex flex-wrap gap-3\">\r\n      <button\r\n        onClick={fetchDocuments}\r\n        className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors\"\r\n      >\r\n        Refresh Documents\r\n      </button>\r\n    </div>\r\n  );\r\n\r\n  if (loading) {\r\n    return (\r\n      <PageLayout\r\n        title=\"DOCUMENTS\"\r\n        subtitle=\"View and manage your business documents\"\r\n        sidebar={<NavAdmin />}\r\n        className=\"bg-gray-50\"\r\n      >\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <Loader />\r\n        </div>\r\n      </PageLayout>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <PageLayout\r\n      title=\"DOCUMENTS\"\r\n      subtitle=\"View and manage your business documents\"\r\n      sidebar={<NavAdmin />}\r\n      headerActions={headerActions}\r\n      className=\"bg-gray-50\"\r\n    >\r\n      <div className=\"p-6 space-y-6\">\r\n        {error && (\r\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\r\n            <div className=\"flex items-center\">\r\n              <svg\r\n                className=\"w-5 h-5 text-red-400 mr-2\"\r\n                fill=\"currentColor\"\r\n                viewBox=\"0 0 20 20\"\r\n              >\r\n                <path\r\n                  fillRule=\"evenodd\"\r\n                  d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\"\r\n                  clipRule=\"evenodd\"\r\n                />\r\n              </svg>\r\n              <p className=\"text-red-800 text-sm\">{error}</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {!loading && !error && documents.length === 0 && (\r\n          <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-8 text-center\">\r\n            <div className=\"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n              <svg\r\n                className=\"w-8 h-8 text-gray-400\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth=\"2\"\r\n                  d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\r\n                />\r\n              </svg>\r\n            </div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\r\n              No Documents Available\r\n            </h3>\r\n            <p className=\"text-gray-600 mb-4\">\r\n              You haven't uploaded any business documents yet.\r\n            </p>\r\n            <button\r\n              onClick={fetchDocuments}\r\n              className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors\"\r\n            >\r\n              Refresh\r\n            </button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Documents List */}\r\n        {documents.length > 0 && (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n            {documents.map((document) => (\r\n              <Card key={document.document_id} className=\"bg-white shadow-sm hover:shadow-md transition-shadow\">\r\n                <div className=\"p-6\">\r\n                  <div className=\"flex items-start justify-between mb-4\">\r\n                    <div className=\"flex-1\">\r\n                      <h3 className=\"font-semibold text-gray-900 mb-1\">\r\n                        {document.document_type}\r\n                      </h3>\r\n                      <p className=\"text-sm text-gray-600 truncate\">\r\n                        {document.document_name}\r\n                      </p>\r\n                    </div>\r\n                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(document.verification_status)}`}>\r\n                      {document.verification_status}\r\n                    </span>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2 text-sm text-gray-600 mb-4\">\r\n                    <div>\r\n                      <span className=\"font-medium\">Uploaded:</span>\r\n                      <div className=\"text-gray-900\">\r\n                        {formatDate(document.uploaded_at)}\r\n                      </div>\r\n                    </div>\r\n                    {document.verification_notes && (\r\n                      <div>\r\n                        <span className=\"font-medium\">Notes:</span>\r\n                        <div className=\"text-gray-900 mt-1\">\r\n                          {document.verification_notes}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  <Button\r\n                    onClick={() => downloadDocument(document.document_id, document.document_name)}\r\n                    disabled={downloading === document.document_id}\r\n                    className=\"w-full\"\r\n                    size=\"sm\"\r\n                  >\r\n                    {downloading === document.document_id ? \"Downloading...\" : \"Download\"}\r\n                  </Button>\r\n                </div>\r\n              </Card>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </PageLayout>\r\n  );\r\n};\r\n\r\nexport default Documents;\r\n"],"names":["Documents","documents","setDocuments","useState","loading","setLoading","error","setError","downloading","setDownloading","useEffect","fetchDocuments","async","token","sessionStorage","getItem","user","JSON","parse","businessId","business_id","Error","data","api","headers","authHeaders","Array","isArray","err","message","getStatusColor","status","headerActions","jsx","className","children","onClick","PageLayout","title","subtitle","sidebar","NavAdmin","Loader","jsxs","fill","viewBox","fillRule","d","clipRule","length","stroke","strokeLinecap","strokeLinejoin","strokeWidth","map","document","Card","document_type","document_name","verification_status","formatDate","dateString","uploaded_at","Date","toLocaleDateString","year","month","day","hour","minute","verification_notes","Button","documentId","fileName","response","blob","url","window","URL","createObjectURL","a","createElement","style","display","href","download","body","appendChild","click","revokeObjectURL","alert","downloadDocument","document_id","disabled","size"],"mappings":"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"}