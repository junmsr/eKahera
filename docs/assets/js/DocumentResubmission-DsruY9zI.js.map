{"version":3,"file":"DocumentResubmission-DsruY9zI.js","sources":["../../../frontend/src/pages/DocumentResubmission.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport PageLayout from \"../components/layout/PageLayout\";\r\nimport NavAdmin from \"../components/layout/Nav-Admin\";\r\nimport Button from \"../components/common/Button\";\r\nimport { api, authHeaders } from \"../lib/api\";\r\nimport Loader from \"../components/common/Loader\";\r\n\r\n/**\r\n * Document Resubmission Page\r\n * Allows users to resubmit rejected documents\r\n */\r\nconst DocumentResubmission = () => {\r\n  const [documents, setDocuments] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(\"\");\r\n  const [uploading, setUploading] = useState({});\r\n  const [selectedFiles, setSelectedFiles] = useState({});\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    fetchDocuments();\r\n  }, []);\r\n\r\n  const fetchDocuments = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n      const user = JSON.parse(sessionStorage.getItem(\"user\") || \"{}\");\r\n      const businessId = user.businessId || user.business_id;\r\n\r\n      if (!token) {\r\n        throw new Error(\"No authentication token found\");\r\n      }\r\n\r\n      const data = await api(`/documents/business/${businessId}`, {\r\n        headers: authHeaders(token),\r\n      });\r\n\r\n      // Filter for rejected documents\r\n      const rejectedDocs = Array.isArray(data.documents) \r\n        ? data.documents.filter(doc => doc.verification_status === 'rejected')\r\n        : [];\r\n\r\n      setDocuments(rejectedDocs);\r\n    } catch (err) {\r\n      console.error(\"Failed to fetch documents:\", err);\r\n      setError(\"Failed to load documents. Please try again later.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleFileChange = (documentId, file) => {\r\n    setSelectedFiles(prev => ({\r\n      ...prev,\r\n      [documentId]: file\r\n    }));\r\n  };\r\n\r\n  const handleResubmit = async (documentId) => {\r\n    if (!selectedFiles[documentId]) {\r\n      setError(\"Please select a file to upload\");\r\n      return;\r\n    }\r\n\r\n    const formData = new FormData();\r\n    formData.append('document', selectedFiles[documentId]);\r\n    formData.append('document_id', documentId);\r\n\r\n    try {\r\n      setUploading(prev => ({ ...prev, [documentId]: true }));\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n      \r\n      await api(`/documents/resubmit`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n        },\r\n        body: formData,\r\n      });\r\n\r\n      // Refresh the documents list\r\n      await fetchDocuments();\r\n      setSelectedFiles(prev => {\r\n        const newFiles = { ...prev };\r\n        delete newFiles[documentId];\r\n        return newFiles;\r\n      });\r\n      \r\n    } catch (error) {\r\n      console.error(\"Failed to resubmit document:\", error);\r\n      setError(error.message || \"Failed to resubmit document. Please try again.\");\r\n    } finally {\r\n      setUploading(prev => ({ ...prev, [documentId]: false }));\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status) => {\r\n    switch (status) {\r\n      case 'approved': return 'text-green-600 bg-green-100';\r\n      case 'rejected': return 'text-red-600 bg-red-100';\r\n      default: return 'text-yellow-600 bg-yellow-100';\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString) => {\r\n    if (!dateString) return \"N/A\";\r\n    return new Date(dateString).toLocaleDateString(\"en-US\", {\r\n      year: \"numeric\",\r\n      month: \"long\",\r\n      day: \"numeric\",\r\n      hour: \"2-digit\",\r\n      minute: \"2-digit\",\r\n    });\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <PageLayout\r\n        title=\"RESUBMIT DOCUMENTS\"\r\n        subtitle=\"Resubmit your rejected documents\"\r\n        sidebar={<NavAdmin />}\r\n      >\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <Loader />\r\n        </div>\r\n      </PageLayout>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <PageLayout\r\n      title=\"RESUBMIT DOCUMENTS\"\r\n      subtitle=\"Resubmit your rejected documents\"\r\n      sidebar={<NavAdmin />}\r\n    >\r\n      <div className=\"p-6 max-w-4xl mx-auto\">\r\n        {error && (\r\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-6\">\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n        )}\r\n\r\n        {documents.length === 0 ? (\r\n          <div className=\"text-center py-12\">\r\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\r\n              No documents require resubmission\r\n            </h3>\r\n            <p className=\"text-gray-600 mb-6\">\r\n              All your documents are up to date.\r\n            </p>\r\n            <Button onClick={() => navigate('/documents')}>\r\n              View All Documents\r\n            </Button>\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-6\">\r\n            <div className=\"bg-blue-50 border-l-4 border-blue-400 p-4\">\r\n              <div className=\"flex\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <svg className=\"h-5 w-5 text-blue-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                    <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h2a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\r\n                  </svg>\r\n                </div>\r\n                <div className=\"ml-3\">\r\n                  <p className=\"text-sm text-blue-700\">\r\n                    Please upload new versions of your rejected documents. Make sure all documents are clear and up to date.\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {documents.map((doc) => (\r\n              <div key={doc.document_id} className=\"bg-white shadow overflow-hidden rounded-lg\">\r\n                <div className=\"px-4 py-5 sm:px-6 border-b border-gray-200\">\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <div>\r\n                      <h3 className=\"text-lg leading-6 font-medium text-gray-900\">\r\n                        {doc.document_type}\r\n                      </h3>\r\n                      <p className=\"mt-1 max-w-2xl text-sm text-gray-500\">\r\n                        {doc.document_name}\r\n                      </p>\r\n                    </div>\r\n                    <span className={`px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(doc.verification_status)}`}>\r\n                      {doc.verification_status}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n                <div className=\"px-4 py-5 sm:p-6\">\r\n                  {doc.verification_notes && (\r\n                    <div className=\"mb-4\">\r\n                      <h4 className=\"text-sm font-medium text-gray-700\">Rejection Reason:</h4>\r\n                      <p className=\"mt-1 text-sm text-gray-600\">{doc.verification_notes}</p>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  <div className=\"mt-4\">\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                      Upload new version\r\n                    </label>\r\n                    <div className=\"flex items-center\">\r\n                      <input\r\n                        type=\"file\"\r\n                        onChange={(e) => handleFileChange(doc.document_id, e.target.files[0])}\r\n                        className=\"block w-full text-sm text-gray-500\r\n                          file:mr-4 file:py-2 file:px-4\r\n                          file:rounded-md file:border-0\r\n                          file:text-sm file:font-semibold\r\n                          file:bg-blue-50 file:text-blue-700\r\n                          hover:file:bg-blue-100\"\r\n                        accept=\".pdf,.jpg,.jpeg,.png\"\r\n                      />\r\n                      <Button\r\n                        onClick={() => handleResubmit(doc.document_id)}\r\n                        disabled={!selectedFiles[doc.document_id] || uploading[doc.document_id]}\r\n                        className=\"ml-4 whitespace-nowrap\"\r\n                        loading={uploading[doc.document_id]}\r\n                      >\r\n                        {uploading[doc.document_id] ? 'Uploading...' : 'Resubmit'}\r\n                      </Button>\r\n                    </div>\r\n                    {selectedFiles[doc.document_id] && (\r\n                      <p className=\"mt-2 text-sm text-gray-500\">\r\n                        Selected: {selectedFiles[doc.document_id].name}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </PageLayout>\r\n  );\r\n};\r\n\r\nexport default DocumentResubmission;\r\n"],"names":["DocumentResubmission","documents","setDocuments","useState","loading","setLoading","error","setError","uploading","setUploading","selectedFiles","setSelectedFiles","navigate","useNavigate","useEffect","fetchDocuments","async","token","sessionStorage","getItem","user","JSON","parse","businessId","business_id","Error","data","api","headers","authHeaders","rejectedDocs","Array","isArray","filter","doc","verification_status","err","getStatusColor","status","PageLayout","title","subtitle","sidebar","jsx","NavAdmin","children","className","Loader","jsxs","length","Button","onClick","viewBox","fill","fillRule","d","clipRule","map","document_type","document_name","verification_notes","type","onChange","e","handleFileChange","documentId","document_id","file","target","files","prev","accept","formData","FormData","append","method","Authorization","body","newFiles","message","handleResubmit","disabled","name"],"mappings":"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"}