import{j as e}from"./utils-L0j39QIW.js";import{a as s}from"./vendor-DPJ7iNYg.js";import{a,b as r}from"./index-C3oyeyrQ.js";import{B as t}from"./BaseModal-BJkFAYW_.js";const d=({isOpen:d,onClose:n,userData:o})=>{const[l,i]=s.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[c,u]=s.useState(!1),[m,x]=s.useState(""),[p,b]=s.useState(""),[g,w]=s.useState({status:"none"}),[y,h]=s.useState(""),[f,j]=s.useState(""),[P,v]=s.useState(!1),[N,C]=s.useState(!1),[S,k]=s.useState("");if(s.useEffect(()=>{d&&(i({currentPassword:"",newPassword:"",confirmPassword:""}),x(""),b(""),j(""),h(""),k(""),T())},[d]),!d)return null;const E=e=>e?"cancelled"===e.status?{status:"none"}:e:{status:"none"},T=async()=>{try{v(!0);const e=await a("/api/business/delete-request"),s=E(e?.deletion);w(s),h("pending"===s.status&&e?.message||"")}catch(e){j(e?.message||"Could not load deletion status. Please try again.")}finally{v(!1)}},D=e=>{if(!e)return"-";try{return new Date(e).toLocaleString()}catch{return e}},L=o?.store_name||o?.storeName||o?.businessName||"your store";return e.jsxs(t,{isOpen:d,onClose:n,title:"Update Password",subtitle:"Cashiers can only change their password here",footer:e.jsxs("div",{className:"w-full flex gap-2 justify-end",children:[e.jsx(r,{label:"Cancel",variant:"secondary",onClick:n,disabled:c}),e.jsx(r,{label:c?"Saving...":"Save Password",variant:"primary",onClick:async()=>{if(b(""),x(""),l.currentPassword&&l.newPassword&&l.confirmPassword)if(l.newPassword===l.confirmPassword){u(!0);try{const e=sessionStorage.getItem("auth_token");await a("/api/auth/password",{method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({currentPassword:l.currentPassword,newPassword:l.newPassword})}),x("Password updated successfully."),i({currentPassword:"",newPassword:"",confirmPassword:""})}catch(e){b(e?.error||e?.message||"Failed to update password. Please check your current password.")}finally{u(!1)}}else b("New password and confirmation do not match.");else b("Please fill in all password fields.")},disabled:c})]}),children:[m&&e.jsx("div",{className:"text-sm text-emerald-700 bg-emerald-50 border border-emerald-200 rounded-lg px-3 py-2 mb-3",children:m}),p&&e.jsx("div",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg px-3 py-2 mb-3",children:p}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-1",children:"Current Password"}),e.jsx("input",{type:"password",className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:l.currentPassword,onChange:e=>i(s=>({...s,currentPassword:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-1",children:"New Password"}),e.jsx("input",{type:"password",className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:l.newPassword,onChange:e=>i(s=>({...s,newPassword:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-1",children:"Confirm New Password"}),e.jsx("input",{type:"password",className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:l.confirmPassword,onChange:e=>i(s=>({...s,confirmPassword:e.target.value}))})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg px-3 py-2 text-xs text-blue-800",children:"Password must be at least 12 characters and include upper, lower, number, and special characters."}),e.jsxs("div",{className:"mt-6 border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["Delete ",L]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Download all transactions then schedule deletion with a 30-day recovery window."})]}),P&&e.jsx("span",{className:"text-xs text-blue-600",children:"Workingâ€¦"})]}),y&&e.jsx("div",{className:"text-sm text-emerald-700 bg-emerald-50 border border-emerald-200 rounded-lg px-3 py-2 mb-3",children:y}),f&&e.jsx("div",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg px-3 py-2 mb-3",children:f}),"pending"===g.status&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-xs text-gray-700 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Status:"}),e.jsx("span",{className:"px-2 py-1 rounded-full border text-xs",children:g.status||"none"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Scheduled:"})," ",D(g.scheduledFor)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Requested:"})," ",D(g.requestedAt)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Export ready:"})," ",D(g.exportReadyAt)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-800",children:'Type "DELETE" to confirm'}),e.jsx("input",{type:"text",className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500",placeholder:"DELETE",value:S,onChange:e=>k(e.target.value)})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx(r,{label:N?"Preparing...":"Download transactions",variant:"secondary",onClick:async()=>{j(""),C(!0);try{const e=await a("/api/business/delete-request/export",{method:"GET"},!0),s=await e.blob(),r=window.URL.createObjectURL(s),t=document.createElement("a");t.href=r,t.download="transactions-export."+(s.type.includes("gzip")?"gz":"json"),document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(r)}catch(e){j(e?.message||"Failed to download export. Please try again.")}finally{C(!1)}},disabled:N}),e.jsx(r,{label:P?"Scheduling...":"Schedule deletion",variant:"danger",onClick:async()=>{if(j(""),h(""),"delete"===S.trim().toLowerCase()){v(!0);try{const e=await a("/api/business/delete-request",{method:"POST"});w(e?.deletion||{status:"pending"}),h(e?.message||"Deletion request recorded with a 30-day grace period.")}catch(e){j(e?.message||"Could not request deletion. Please try again.")}finally{v(!1)}}else j('Type "DELETE" to confirm.')},disabled:P}),"pending"===g.status&&e.jsx(r,{label:"Cancel deletion",variant:"secondary",onClick:async()=>{j(""),h(""),v(!0);try{const e=await a("/api/business/delete-request/cancel",{method:"POST"}),s=E(e?.deletion);w(s),h(""),k("")}catch(e){j(e?.message||"Could not cancel deletion. Please try again.")}finally{v(!1)}},disabled:P})]}),e.jsx("p",{className:"text-[11px] text-gray-500 mt-2",children:"You can recover the account within 30 days. After that, the store is permanently removed."})]})]})]})};export{d as P};
//# sourceMappingURL=ProfileModal-CxynDHFl.js.map
