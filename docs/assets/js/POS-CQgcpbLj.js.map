{"version":3,"file":"POS-CQgcpbLj.js","sources":["../../../frontend/src/pages/POS.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport ScannerCard from \"../components/ui/POS/ScannerCard\";\r\nimport PageLayout from \"../components/layout/PageLayout\";\r\nimport SkuFormCard from \"../components/ui/POS/SkuFormCard\";\r\nimport CartTableCard from \"../components/ui/POS/CartTableCard\";\r\nimport Button from \"../components/common/Button\";\r\nimport NavAdmin from \"../components/layout/Nav-Admin\";\r\n// Background gradient removed for a neutral look\r\nimport { api, createGcashCheckout, createMayaCheckout } from \"../lib/api\";\r\nimport PriceCheckModal from \"../components/modals/PriceCheckModal\";\r\nimport DiscountModal from \"../components/modals/DiscountModal\";\r\nimport CashLedgerModal from \"../components/modals/CashLedgerModal\";\r\nimport CheckoutModal from \"../components/modals/CheckoutModal\";\r\nimport CashPaymentModal from \"../components/modals/CashPaymentModal\";\r\nimport ScanCustomerCartModal from \"../components/modals/ScanCustomerCartModal\";\r\nimport QuantityInputModal from \"../components/modals/QuantityInputModal\";\r\nimport { BiReceipt, BiSync } from \"react-icons/bi\";\r\nimport AdminReceiptsModal from \"../components/modals/AdminReceiptsModal\";\r\nimport { MdClose } from \"react-icons/md\";\r\nimport { useKeyboardShortcuts } from \"../hooks/useKeyboardShortcuts\";\r\n\r\nconst ButtonLabel = ({ text, shortcut, variant = \"secondary\" }) => (\r\n  <div className=\"flex items-center gap-2\">\r\n    <span>{text}</span>\r\n    <span className={`hidden sm:inline-block text-xs font-bold px-1.5 py-0.5 rounded border ${\r\n      variant === \"primary\" \r\n        ? \"bg-white/20 border-white/40 text-white\" \r\n        : \"bg-gray-100 border-gray-300 text-gray-600\"\r\n    }`}>\r\n      {shortcut}\r\n    </span>\r\n  </div>\r\n);\r\n\r\nfunction POS() {\r\n  const navigate = useNavigate();\r\n\r\n  // States\r\n  const [sku, setSku] = useState(\"\");\r\n  const [quantity, setQuantity] = useState(1);\r\n  const [cart, setCart] = useState([]);\r\n  const [showDiscount, setShowDiscount] = useState(false);\r\n  const [showPriceCheck, setShowPriceCheck] = useState(false);\r\n  const [priceCheckSku, setPriceCheckSku] = useState(\"\");\r\n  const [showImportCart, setShowImportCart] = useState(false);\r\n  const [showCashLedger, setShowCashLedger] = useState(false);\r\n  const [showCheckout, setShowCheckout] = useState(false);\r\n  const [showCashModal, setShowCashModal] = useState(false);\r\n  const [selectedPayment, setSelectedPayment] = useState(null);\r\n  const [darkMode, setDarkMode] = useState(false);\r\n  const [scannerPaused, setScannerPaused] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [transactionNumber, setTransactionNumber] = useState(\"\");\r\n  const [transactionId, setTransactionId] = useState(null);\r\n  \r\n  // Auto-clear error message after 5 seconds\r\n  useEffect(() => {\r\n    if (error) {\r\n      const timer = setTimeout(() => {\r\n        setError(\"\");\r\n      }, 5000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [error]);\r\n  const [showReceipts, setShowReceipts] = useState(false);\r\n  const skuInputRef = useRef(null);\r\n  const [isSidebarOpen, setSidebarOpen] = useState(false);\r\n  const [selectedItemIdx, setSelectedItemIdx] = useState(-1);\r\n  const [editingIdx, setEditingIdx] = useState(null);\r\n  const token = sessionStorage.getItem(\"auth_token\");\r\n  const user = JSON.parse(sessionStorage.getItem(\"user\") || \"{}\");\r\n  const hasFinalizedRef = React.useRef(false);\r\n  const [businessName, setBusinessName] = useState(\"\");\r\n  const [selectedCartIdx, setSelectedCartIdx] = useState(0);\r\n  const [editingCartItem, setEditingCartItem] = useState(null);\r\n  const [editQty, setEditQty] = useState('1');\r\n  const [showLogoutConfirm, setShowLogoutConfirm] = useState(false);\r\n  const [appliedDiscount, setAppliedDiscount] = useState(null);\r\n  const quantityInputRef = useRef(null);\r\n  const [showQuantityModal, setShowQuantityModal] = useState(false);\r\n  const [pendingProduct, setPendingProduct] = useState(null);\r\n\r\n  // Set editing cart item and initialize quantity\r\n  const setSelectedCartItem = (idx) => {\r\n    setSelectedCartIdx(idx);\r\n    if (idx >= 0 && idx < cart.length) {\r\n      setEditQty(String(cart[idx].quantity));\r\n    }\r\n  };\r\n\r\n  // Generate a client-side provisional transaction number when POS opens\r\n  useEffect(() => {\r\n    if (!transactionNumber) {\r\n      const businessId = user?.businessId || user?.business_id || \"BIZ\";\r\n      const timePart = new Date()\r\n        .toISOString()\r\n        .replace(/[-:T.Z]/g, \"\")\r\n        .slice(0, 14);\r\n      const randPart = Math.floor(1000 + Math.random() * 9000);\r\n      setTransactionNumber(\r\n        `T-${businessId.toString().padStart(2, \"0\")}-${timePart}-${randPart}`\r\n      );\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  // Auto-focus SKU input on initial mount\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      skuInputRef.current?.focus();\r\n    }, 300);\r\n    return () => clearTimeout(timer);\r\n  }, []);\r\n\r\n  // On mount, if returned from PayMongo success/cancel, finalize or cleanup\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(window.location.search);\r\n    const status = params.get(\"payment\");\r\n    const businessId = user?.businessId || user?.business_id;\r\n\r\n    // Check if we're in a new tab (opened from payment)\r\n    const isNewTab = window.opener && !window.opener.closed;\r\n\r\n    const finalizeOnlinePayment = async (pendingCartKey, paymentType) => {\r\n      const pending = localStorage.getItem(pendingCartKey);\r\n      if (status === \"success\" && pending && businessId) {\r\n        try {\r\n          const parsed = JSON.parse(pending);\r\n          if (hasFinalizedRef.current) return;\r\n          const guardKey = `${paymentType}_finalize_done`;\r\n          if (sessionStorage.getItem(guardKey) === \"1\") return;\r\n          hasFinalizedRef.current = true;\r\n          sessionStorage.setItem(guardKey, \"1\");\r\n          try {\r\n            setError(\"\");\r\n            const body = {\r\n              items: parsed.items || [],\r\n              payment_type: paymentType.toLowerCase(),\r\n              money_received: parsed.total || null,\r\n              discount_id: parsed.discount_id || null,\r\n              discount_percentage: parsed.discount_percentage || null,\r\n              discount_amount: parsed.discount_amount || null,\r\n            };\r\n            const resp = await api(\"/api/sales/checkout\", {\r\n              method: \"POST\",\r\n              headers: { Authorization: `Bearer ${token}` },\r\n              body: JSON.stringify(body),\r\n            });\r\n            if (resp?.transaction_number)\r\n              setTransactionNumber(resp.transaction_number);\r\n            if (resp?.transaction_id) setTransactionId(resp.transaction_id);\r\n            setCart([]);\r\n            try {\r\n              const url = new URL(window.location.origin + \"/receipt\");\r\n              if (resp?.transaction_number)\r\n                url.searchParams.set(\"tn\", resp.transaction_number);\r\n              if (resp?.transaction_id)\r\n                url.searchParams.set(\"tid\", String(resp.transaction_id));\r\n              if (resp?.total != null)\r\n                url.searchParams.set(\"total\", String(resp.total));\r\n\r\n              // If in new tab, redirect opener and close this tab\r\n              if (isNewTab && window.opener) {\r\n                window.opener.location.href = url.toString();\r\n                window.close();\r\n              } else {\r\n                window.location.href = url.toString();\r\n              }\r\n            } catch (_) {}\r\n          } catch (e) {\r\n            setError(`Failed to record ${paymentType} payment`);\r\n          } finally {\r\n            localStorage.removeItem(pendingCartKey);\r\n            if (!isNewTab) {\r\n              const url = new URL(window.location.href);\r\n              url.searchParams.delete(\"payment\");\r\n              window.history.replaceState({}, \"\", url.toString());\r\n            }\r\n          }\r\n        } catch (_) {\r\n          localStorage.removeItem(pendingCartKey);\r\n        }\r\n      } else if (status === \"cancel\" && pending) {\r\n        localStorage.removeItem(pendingCartKey);\r\n        // If in new tab, close it; otherwise just clean up URL\r\n        if (isNewTab && window.opener) {\r\n          window.close();\r\n        } else {\r\n          const url = new URL(window.location.href);\r\n          url.searchParams.delete(\"payment\");\r\n          window.history.replaceState({}, \"\", url.toString());\r\n        }\r\n      }\r\n    };\r\n\r\n    finalizeOnlinePayment(\"pending_gcash_cart\", \"GCash\");\r\n    finalizeOnlinePayment(\"pending_maya_cart\", \"Maya\");\r\n  }, []);\r\n\r\n  const addSkuToCart = async (skuValue, qty = 1) => {\r\n    if (!skuValue || qty < 1) return;\r\n    setError(\"\");\r\n    try {\r\n      const product = await api(\r\n        `/api/products/sku/${encodeURIComponent(skuValue)}`,\r\n        {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        }\r\n      );\r\n      const price = Number(product.selling_price || 0);\r\n      const stockQty = Number(product.stock_quantity ?? 0);\r\n      if (stockQty <= 0) {\r\n        setError(\r\n          `Stock for ${product.product_name} (SKU ${product.sku}) is 0.`\r\n        );\r\n        return;\r\n      }\r\n\r\n      // Check if product is weight or volume based - show modal for quantity input\r\n      if (product.product_type === 'weight' || product.product_type === 'volume') {\r\n        setPendingProduct(product);\r\n        setShowQuantityModal(true);\r\n        return;\r\n      }\r\n\r\n      // For count-based products, proceed with normal flow\r\n      if (qty > stockQty) {\r\n        setError(\r\n          `Insufficient stock. Available: ${stockQty}, requested: ${qty}.`\r\n        );\r\n        return;\r\n      }\r\n      setCart((prev) => {\r\n        const existingIdx = prev.findIndex(\r\n          (i) => i.product_id === product.product_id\r\n        );\r\n        if (existingIdx >= 0) {\r\n          const next = [...prev];\r\n          const newQty = next[existingIdx].quantity + qty;\r\n          if (newQty > stockQty) {\r\n            setError(\r\n              `Insufficient stock. Available: ${stockQty}, requested: ${newQty}.`\r\n            );\r\n            return prev;\r\n          }\r\n          next[existingIdx] = { ...next[existingIdx], quantity: newQty };\r\n          return next;\r\n        }\r\n        return [\r\n          ...prev,\r\n          {\r\n            product_id: product.product_id,\r\n            sku: product.sku,\r\n            name: product.product_name,\r\n            quantity: qty,\r\n            price,\r\n            is_basic_necessity: product.is_basic_necessity || false,\r\n          },\r\n        ];\r\n      });\r\n      setSku(\"\");\r\n      setQuantity(1);\r\n      // Auto-focus SKU input after adding item for next scan\r\n      setTimeout(() => {\r\n        skuInputRef.current?.focus();\r\n      }, 50);\r\n    } catch (err) {\r\n      setError(\"Product not found\");\r\n    } finally {\r\n      // Always resume scanner after processing, even on error\r\n      setTimeout(() => {\r\n        setScannerPaused(false);\r\n      }, 300);\r\n    }\r\n  };\r\n\r\n  // Handle quantity confirmation from modal\r\n  const handleQuantityConfirm = (quantityInBaseUnits) => {\r\n    if (!pendingProduct) return;\r\n    \r\n    const product = pendingProduct;\r\n    const stockQty = Number(product.stock_quantity ?? 0);\r\n    \r\n    // Check stock\r\n    if (quantityInBaseUnits > stockQty) {\r\n      setError(\r\n        `Insufficient stock. Available: ${stockQty} ${product.base_unit || ''}, requested: ${quantityInBaseUnits} ${product.base_unit || ''}.`\r\n      );\r\n      setShowQuantityModal(false);\r\n      setPendingProduct(null);\r\n      return;\r\n    }\r\n\r\n    // Calculate price per base unit for weight/volume products\r\n    let pricePerUnit = Number(product.selling_price || 0);\r\n    if (product.product_type !== 'count' && product.quantity_per_unit && product.quantity_per_unit > 0) {\r\n      // Price per base unit = price per package / quantity per package\r\n      pricePerUnit = pricePerUnit / Number(product.quantity_per_unit);\r\n    }\r\n\r\n    // For weight/volume products, quantity is stored in base units\r\n    // Price is stored as price per base unit\r\n    setCart((prev) => {\r\n      const existingIdx = prev.findIndex(\r\n        (i) => i.product_id === product.product_id\r\n      );\r\n      if (existingIdx >= 0) {\r\n        const next = [...prev];\r\n        const existingQty = next[existingIdx].quantity;\r\n        const newQty = existingQty + quantityInBaseUnits;\r\n        if (newQty > stockQty) {\r\n          setError(\r\n            `Insufficient stock. Available: ${stockQty} ${product.base_unit || ''}, requested: ${newQty} ${product.base_unit || ''}.`\r\n          );\r\n          return prev;\r\n        }\r\n        next[existingIdx] = { ...next[existingIdx], quantity: newQty };\r\n        return next;\r\n      }\r\n        return [\r\n          ...prev,\r\n          {\r\n            product_id: product.product_id,\r\n            sku: product.sku,\r\n            name: product.product_name,\r\n            quantity: quantityInBaseUnits,\r\n            price: pricePerUnit,\r\n            product_type: product.product_type,\r\n            base_unit: product.base_unit,\r\n            quantity_per_unit: product.quantity_per_unit || 1,\r\n            is_basic_necessity: product.is_basic_necessity || false,\r\n          },\r\n        ];\r\n    });\r\n    \r\n    setSku(\"\");\r\n    setQuantity(1);\r\n    setShowQuantityModal(false);\r\n    setPendingProduct(null);\r\n    \r\n    // Auto-focus SKU input after adding item for next scan\r\n    setTimeout(() => {\r\n      skuInputRef.current?.focus();\r\n    }, 50);\r\n  };\r\n\r\n  const handleAddToCart = async () => {\r\n    await addSkuToCart(sku, quantity);\r\n  };\r\n\r\n  const handleRemove = (idx) => {\r\n    if (idx >= 0 && idx < cart.length) {\r\n      setCart(cart.filter((_, i) => i !== idx));\r\n    }\r\n  };\r\n\r\n  const handleEditQuantity = async (idx, qty) => {\r\n    const newQty = qty === '' ? 1 : Math.max(1, Number(qty) || 1);\r\n    const item = cart[idx];\r\n    if (!item) return;\r\n    setError(\"\");\r\n    try {\r\n      const product = await api(\r\n        `/api/products/sku/${encodeURIComponent(item.sku)}`,\r\n        {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        }\r\n      );\r\n      const stockQty = Number(product.stock_quantity ?? 0);\r\n      if (newQty > stockQty) {\r\n        setError(\r\n          `Insufficient stock. Available: ${stockQty}, requested: ${newQty}.`\r\n        );\r\n        return;\r\n      }\r\n      setCart((prev) =>\r\n        prev.map((item, i) =>\r\n          i === idx ? { ...item, quantity: newQty } : item\r\n        )\r\n      );\r\n      setEditQty(newQty); // Keep editQty in sync\r\n      setEditingCartItem(null);\r\n    } catch (err) {\r\n      setError(err.message || \"Failed to update quantity\");\r\n    }\r\n  };\r\n  \r\n  // Handle edit quantity change\r\n  const handleEditQtyChange = (value) => {\r\n    setEditQty(value);\r\n  };\r\n\r\n  // Handler for increment quantity (=)\r\n  const handleIncrementQuantity = async () => {\r\n    if (cart.length === 0 || selectedCartIdx < 0 || selectedCartIdx >= cart.length) return;\r\n    const item = cart[selectedCartIdx];\r\n    if (!item) return;\r\n    const currentQty = item.quantity;\r\n    const newQty = currentQty + 1;\r\n    setError(\"\");\r\n    try {\r\n      const product = await api(\r\n        `/api/products/sku/${encodeURIComponent(item.sku)}`,\r\n        {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        }\r\n      );\r\n      const stockQty = Number(product.stock_quantity ?? 0);\r\n      if (newQty > stockQty) {\r\n        setError(\r\n          `Insufficient stock. Available: ${stockQty}, requested: ${newQty}.`\r\n        );\r\n        return;\r\n      }\r\n      setCart((prev) =>\r\n        prev.map((cartItem, i) =>\r\n          i === selectedCartIdx ? { ...cartItem, quantity: newQty } : cartItem\r\n        )\r\n      );\r\n    } catch (err) {\r\n      setError(err.message || \"Failed to update quantity\");\r\n    }\r\n  };\r\n\r\n  // Handler for decrement quantity (-)\r\n  const handleDecrementQuantity = () => {\r\n    if (cart.length === 0 || selectedCartIdx < 0 || selectedCartIdx >= cart.length) return;\r\n    const item = cart[selectedCartIdx];\r\n    if (!item) return;\r\n    const currentQty = item.quantity;\r\n    if (currentQty <= 1) return; // Don't allow going below 1\r\n    const newQty = currentQty - 1;\r\n    setCart((prev) =>\r\n      prev.map((cartItem, i) =>\r\n        i === selectedCartIdx ? { ...cartItem, quantity: newQty } : cartItem\r\n      )\r\n    );\r\n  };\r\n\r\n  const subtotal = cart.reduce(\r\n    (sum, item) => sum + item.price * item.quantity,\r\n    0\r\n  );\r\n\r\n  // Calculate total with discount\r\n  // IMPORTANT: In the Philippines, PWD/Senior Citizen discounts only apply to basic necessities\r\n  // Calculate subtotals separately for basic necessities and other items\r\n  const basicNecessitySubtotal = cart\r\n    .filter(item => item.is_basic_necessity === true)\r\n    .reduce((sum, item) => sum + item.price * item.quantity, 0);\r\n  const otherItemsSubtotal = subtotal - basicNecessitySubtotal;\r\n  \r\n  let total = subtotal;\r\n  if (appliedDiscount) {\r\n    if (appliedDiscount.type === \"percentage\") {\r\n      const discountValue = Number(appliedDiscount.value);\r\n      if (!isNaN(discountValue) && discountValue > 0) {\r\n        // Apply discount only to basic necessity items\r\n        const discountAmount = basicNecessitySubtotal * (discountValue / 100);\r\n        total = Math.max(0, basicNecessitySubtotal - discountAmount + otherItemsSubtotal);\r\n      }\r\n    } else if (appliedDiscount.type === \"amount\") {\r\n      const discountValue = Number(appliedDiscount.value);\r\n      if (!isNaN(discountValue) && discountValue > 0) {\r\n        // Apply discount only to basic necessity items (capped at basic necessity subtotal)\r\n        const discountAmount = Math.min(discountValue, basicNecessitySubtotal);\r\n        total = Math.max(0, basicNecessitySubtotal - discountAmount + otherItemsSubtotal);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Handle keyboard navigation for cart items\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      // Don't handle keys when modals are open\r\n      if (showDiscount || showPriceCheck || showImportCart || showCashLedger || showCheckout || showCashModal || showReceipts || showLogoutConfirm) {\r\n        return;\r\n      }\r\n\r\n      // Don't handle if user is typing in an input field (unless it's specific navigation keys)\r\n      const isInputFocused = e.target && (\r\n        e.target.tagName === 'INPUT' || \r\n        e.target.tagName === 'TEXTAREA' ||\r\n        e.target.isContentEditable\r\n      );\r\n\r\n      // Only handle navigation keys if not in input or if editing cart item\r\n      const navigationKeys = ['ArrowUp', 'ArrowDown', 'Enter', 'Escape'];\r\n      const editKeys = ['e', 'E', 'd', 'D'];\r\n      const quantityKeys = ['=', '-'];\r\n      \r\n      if (isInputFocused && editingCartItem === null && !navigationKeys.includes(e.key) && !editKeys.includes(e.key) && !quantityKeys.includes(e.key)) {\r\n        return;\r\n      }\r\n\r\n      // Handle Escape key for editing state (but let shortcut handler handle modal closing)\r\n      if (e.key === 'Escape' && editingCartItem !== null) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        setEditingCartItem(null);\r\n        return;\r\n      }\r\n\r\n      // Handle Enter key for editing state\r\n      if (e.key === 'Enter' && editingCartItem !== null) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        handleEditQuantity(editingCartItem, editQty);\r\n        setEditingCartItem(null);\r\n        return;\r\n      }\r\n\r\n      // Handle arrow keys - allow navigation even when SKU input is focused\r\n      const isSkuInput = e.target === skuInputRef.current;\r\n      const isArrowKey = e.key === 'ArrowUp' || e.key === 'ArrowDown';\r\n      const isQuantityKey = e.key === '=' || e.key === '-';\r\n      \r\n      if (isArrowKey && (isSkuInput || !isInputFocused || editingCartItem !== null)) {\r\n        switch (e.key) {\r\n          case 'ArrowUp':\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          setSelectedCartIdx(prev => prev > 0 ? prev - 1 : cart.length - 1);\r\n          break;\r\n          case 'ArrowDown':\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          setSelectedCartIdx(prev => prev < cart.length - 1 ? prev + 1 : 0);\r\n          break;\r\n          // E and D keys removed - now using F1 and F2 instead\r\n          default:\r\n            break;\r\n        }\r\n      }\r\n      \r\n      // Handle quantity keys (= and -) even when SKU input is focused\r\n      if (isQuantityKey && (isSkuInput || !isInputFocused || editingCartItem !== null)) {\r\n        if (cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length) {\r\n          if (e.key === '=') {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            handleIncrementQuantity();\r\n          } else if (e.key === '-') {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            handleDecrementQuantity();\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    // Use bubble phase (after shortcuts hook which uses capture)\r\n    window.addEventListener('keydown', handleKeyDown, false);\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyDown, false);\r\n    };\r\n  }, [cart.length, selectedCartIdx, editingCartItem, editQty, showDiscount, showPriceCheck, showImportCart, showCashLedger, showCheckout, showCashModal, showReceipts, showLogoutConfirm, handleIncrementQuantity, handleDecrementQuantity]);\r\n\r\n  // Reset selected index when cart changes\r\n  useEffect(() => {\r\n    if (cart.length === 0) {\r\n      setSelectedCartIdx(0);\r\n    } else {\r\n      setSelectedCartIdx(prev => Math.min(prev, cart.length - 1));\r\n    }\r\n  }, [cart.length]);\r\n\r\n\r\n  // Pause scanner when any modal is open to avoid hardware scanner/keyboard events interfering with shortcuts\r\n  useEffect(() => {\r\n    const anyModalOpen =\r\n      showDiscount ||\r\n      showPriceCheck ||\r\n      showImportCart ||\r\n      showCashLedger ||\r\n      showCheckout ||\r\n      showCashModal ||\r\n      showReceipts ||\r\n      showLogoutConfirm;\r\n    \r\n    setScannerPaused(anyModalOpen);\r\n    \r\n    // When modals close, refocus SKU input after a delay (but not if user is interacting with other elements)\r\n    if (!anyModalOpen) {\r\n      const timer = setTimeout(() => {\r\n        const activeElement = document.activeElement;\r\n        const isInputFocused = activeElement && (\r\n          activeElement.tagName === 'INPUT' || \r\n          activeElement.tagName === 'TEXTAREA' ||\r\n          activeElement.isContentEditable ||\r\n          activeElement.tagName === 'BUTTON'\r\n        );\r\n        // Only refocus if user isn't actively clicking buttons or using inputs\r\n        if (!isInputFocused && document.body === activeElement) {\r\n          skuInputRef.current?.focus();\r\n        }\r\n      }, 300);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [\r\n    showDiscount,\r\n    showPriceCheck,\r\n    showImportCart,\r\n    showCashLedger,\r\n    showCheckout,\r\n    showCashModal,\r\n    showReceipts,\r\n    showLogoutConfirm,\r\n  ]);\r\n\r\n  const focusSkuInput = () => {\r\n    skuInputRef.current?.focus();\r\n    skuInputRef.current?.select?.();\r\n  };\r\n\r\n  const handleNewTransaction = () => {\r\n    setCart([]);\r\n    setAppliedDiscount(null);\r\n    setTransactionId(null);\r\n    setError(\"\");\r\n    focusSkuInput();\r\n  };\r\n\r\n  const handleVoidSelected = () => {\r\n    if (cart.length === 0 || selectedCartIdx == null) return;\r\n    handleRemove(selectedCartIdx);\r\n  };\r\n\r\n  const handleSetQuantityShortcut = () => {\r\n    if (cart.length === 0 || selectedCartIdx == null) return;\r\n    const current = cart[selectedCartIdx];\r\n    const nextQty = Number(\r\n      window.prompt(\r\n        `Set quantity for ${current.name || current.sku}:`,\r\n        current.quantity\r\n      )\r\n    );\r\n    if (!Number.isNaN(nextQty) && nextQty > 0) {\r\n      handleEditQuantity(selectedCartIdx, nextQty);\r\n    }\r\n  };\r\n\r\n  const handleRemoveDiscount = () => {\r\n    if (appliedDiscount) {\r\n      setAppliedDiscount(null);\r\n    }\r\n  };\r\n\r\n  // Handler for edit quantity (F1)\r\n  const handleEditQuantityShortcut = () => {\r\n    if (cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length) {\r\n      setEditingCartItem(selectedCartIdx);\r\n      setEditQty(String(cart[selectedCartIdx].quantity));\r\n    }\r\n  };\r\n\r\n  // Handler for discount modal toggle (F6) - open/close discount modal\r\n  const handleDiscountToggle = () => {\r\n    setShowDiscount(!showDiscount);\r\n  };\r\n\r\n  useKeyboardShortcuts(\r\n    [\r\n      // ` (backtick) - focus SKU field\r\n      { key: \"`\", action: focusSkuInput },\r\n      // F1 - edit product quantity\r\n      {\r\n        key: \"f1\",\r\n        action: handleEditQuantityShortcut,\r\n        enabled: cart.length > 0 && selectedCartIdx >= 0,\r\n      },\r\n      // F2 - delete item\r\n      {\r\n        key: \"f2\",\r\n        action: handleVoidSelected,\r\n        enabled: cart.length > 0,\r\n      },\r\n      // F3 - logout\r\n      {\r\n        key: \"f3\",\r\n        description: \"Logout\",\r\n        action: () => setShowLogoutConfirm(true),\r\n      },\r\n      // F4 - add to cart button\r\n      {\r\n        key: \"f4\",\r\n        action: handleAddToCart,\r\n        enabled: !!sku, // Only enable if there's a SKU value\r\n      },\r\n      // F5 - cash ledger\r\n      { key: \"f5\", action: () => setShowCashLedger(true) },\r\n      // F6 - open/close discount modal\r\n      {\r\n        key: \"f6\",\r\n        action: handleDiscountToggle,\r\n      },\r\n      // F7 - price check\r\n      {\r\n        key: \"f7\",\r\n        action: () => {\r\n          setShowPriceCheck(true);\r\n        },\r\n      },\r\n      // F8 - scan customer cart (keep existing)\r\n      {\r\n        key: \"f8\",\r\n        action: () => setShowImportCart(true),\r\n      },\r\n      // F9 - receipts\r\n      { key: \"f9\", action: () => setShowReceipts(true) },\r\n      // F10 - (reserved, no action specified)\r\n      // F11 - remove discount\r\n      {\r\n        key: \"f11\",\r\n        action: handleRemoveDiscount,\r\n        enabled: !!appliedDiscount,\r\n      },\r\n      // F12 - checkout\r\n      {\r\n        key: \"f12\",\r\n        action: () => setShowCheckout(true),\r\n        enabled: cart.length > 0,\r\n      },\r\n      // = (equals) - increment quantity\r\n      {\r\n        key: \"=\",\r\n        action: handleIncrementQuantity,\r\n        enabled: cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length,\r\n      },\r\n      // - (minus) - decrement quantity\r\n      {\r\n        key: \"-\",\r\n        action: handleDecrementQuantity,\r\n        enabled: cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length,\r\n      },\r\n      {\r\n        key: \"escape\",\r\n        action: () => {\r\n          // Only close modals, don't interfere with cart editing (handled separately)\r\n          if (showCheckout) setShowCheckout(false);\r\n          else if (showDiscount) setShowDiscount(false);\r\n          else if (showPriceCheck) setShowPriceCheck(false);\r\n          else if (showImportCart) setShowImportCart(false);\r\n          else if (showCashModal) setShowCashModal(false);\r\n          else if (showCashLedger) setShowCashLedger(false);\r\n          else if (showReceipts) setShowReceipts(false);\r\n          else if (showLogoutConfirm) setShowLogoutConfirm(false);\r\n          // Note: Cart item editing escape is handled in the separate keyboard handler\r\n        },\r\n        allowWhileTyping: true,\r\n        stopPropagation: false, // Allow other handlers to process\r\n      },\r\n    ],\r\n    [\r\n      cart.length,\r\n      selectedCartIdx,\r\n      sku,\r\n      appliedDiscount,\r\n      showCheckout,\r\n      showDiscount,\r\n      showPriceCheck,\r\n      showImportCart,\r\n      showCashModal,\r\n      showCashLedger,\r\n      showReceipts,\r\n      showLogoutConfirm,\r\n    ]\r\n  );\r\n\r\n  // show confirmation modal first, perform actual logout in confirmLogout\r\n  const handleLogout = () => {\r\n    setShowLogoutConfirm(true);\r\n  };\r\n\r\n  const confirmLogout = () => {\r\n    sessionStorage.removeItem(\"auth_token\");\r\n    sessionStorage.removeItem(\"user\");\r\n    // close modal then navigate home\r\n    setShowLogoutConfirm(false);\r\n    navigate(\"/\");\r\n  };\r\n\r\n  const handleCloseLogoutModal = () => {\r\n    setShowLogoutConfirm(false);\r\n  };\r\n\r\n  // Handle keyboard events for logout confirmation\r\n  useEffect(() => {\r\n    if (!showLogoutConfirm) return;\r\n\r\n    const handleKeyDown = (e) => {\r\n      // Use stopPropagation to prevent other handlers from interfering\r\n      e.stopPropagation();\r\n      \r\n      if (e.key === 'Escape' || e.key === 'Esc') {\r\n        e.preventDefault();\r\n        handleCloseLogoutModal();\r\n      } else if (e.key === 'Enter') {\r\n        e.preventDefault();\r\n        confirmLogout();\r\n      }\r\n    };\r\n\r\n    // Use capture phase to ensure we get the event first\r\n    document.addEventListener('keydown', handleKeyDown, { capture: true });\r\n    return () => document.removeEventListener('keydown', handleKeyDown, { capture: true });\r\n  }, [showLogoutConfirm]);\r\n\r\n  const handleCheckout = async (paymentMethod, amountReceived = null) => {\r\n    if (cart.length === 0) return;\r\n    setError(\"\");\r\n    try {\r\n      // Prepare the checkout payload\r\n      const payload = {\r\n        items: cart.map((item) => ({\r\n          product_id: item.product_id,\r\n          quantity: item.quantity,\r\n          price: item.price,\r\n        })),\r\n        payment_type: paymentMethod,\r\n        money_received: amountReceived,\r\n        transaction_id: transactionId, // Include the transaction ID if it exists\r\n        transaction_number: transactionNumber,\r\n        discount_id: appliedDiscount?.discount_id || null,\r\n        discount_percentage: appliedDiscount?.type === 'percentage' ? appliedDiscount.value : null,\r\n        discount_amount: appliedDiscount?.type === 'amount' ? appliedDiscount.value : null,\r\n      };\r\n\r\n      const resp = await api(\"/api/sales/checkout\", {\r\n        method: \"POST\",\r\n        headers: { Authorization: `Bearer ${token}` },\r\n        body: JSON.stringify(payload),\r\n      });\r\n      if (resp?.transaction_number)\r\n        setTransactionNumber(resp.transaction_number);\r\n      if (resp?.transaction_id) setTransactionId(resp.transaction_id);\r\n      setCart([]);\r\n      try {\r\n        const url = new URL(window.location.origin + \"/receipt\");\r\n        if (resp?.transaction_number)\r\n          url.searchParams.set(\"tn\", resp.transaction_number);\r\n        if (resp?.transaction_id)\r\n          url.searchParams.set(\"tid\", String(resp.transaction_id));\r\n        if (resp?.total != null)\r\n          url.searchParams.set(\"total\", String(resp.total));\r\n        navigate(url.pathname + url.search);\r\n      } catch (_) {}\r\n      // Reset transaction state after successful checkout\r\n      setTransactionId(null);\r\n      // Start a fresh provisional transaction number after successful checkout\r\n      const businessId = user?.businessId || user?.business_id || \"BIZ\";\r\n      const timePart = new Date()\r\n        .toISOString()\r\n        .replace(/[-:T.Z]/g, \"\")\r\n        .slice(0, 14);\r\n      const randPart = Math.floor(1000 + Math.random() * 9000);\r\n      setTransactionNumber(\r\n        `T-${businessId.toString().padStart(2, \"0\")}-${timePart}-${randPart}`\r\n      );\r\n      setAppliedDiscount(null); // Reset discount after successful checkout\r\n    } catch (err) {\r\n      console.error(\"Checkout error:\", err);\r\n      // Extract error message from response if available\r\n      const errorMessage = err?.response?.data?.error || err?.data?.error || err?.message || \"Checkout failed\";\r\n      setError(errorMessage);\r\n    }\r\n  };\r\n\r\n  const [showRecentReceiptsModal, setShowRecentReceiptsModal] = useState(false);\r\n\r\n  const handleCopyTn = async () => {\r\n    try {\r\n      if (!user.store_name) return;\r\n      await navigator.clipboard.writeText(user.store_name);\r\n    } catch (_) {}\r\n  };\r\n\r\n  const headerActions = (\r\n    <div className=\"flex items-center gap-1 sm:gap-4 mr-3\">\r\n      {/* Transaction Number display */}\r\n      <div className=\"space-y-2\">\r\n        {appliedDiscount && (\r\n          <div className=\"flex items-center justify-between text-sm text-green-600\">\r\n            <span>Discount Applied:</span>\r\n            <span className=\"font-medium\">\r\n              {appliedDiscount.type === 'percentage' \r\n                ? `${appliedDiscount.value}%` \r\n                : `₱${Number(appliedDiscount.value).toFixed(2)}`}\r\n            </span>\r\n          </div>\r\n        )}\r\n        <div className=\"flex items-center justify-between text-lg font-semibold\">\r\n          <span>Total:</span>\r\n          <div className=\"flex items-center gap-2\">\r\n            {appliedDiscount && (\r\n              <span className=\"text-sm text-gray-500 line-through\">\r\n                ₱{subtotal.toFixed(2)}\r\n              </span>\r\n            )}\r\n            <span>₱{total.toFixed(2)}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {/* Transaction Number display */}\r\n      <div className=\"flex-1 flex items-center justify-center\">\r\n        <button\r\n          onClick={handleCopyTn}\r\n          title=\"Copy store name\"\r\n          className=\"inline-flex items-center gap-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg px-2 py-1.5 sm:px-2.5 shadow-sm\"\r\n        >\r\n          <svg\r\n            className=\"w-3 h-3 sm:w-4 sm:h-4\"\r\n            fill=\"none\"\r\n            stroke=\"currentColor\"\r\n            viewBox=\"0 0 24 24\"\r\n          >\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2M8 16h8a2 2 0 002-2v-6m-10 8l-2 2m2-2l2 2\"\r\n            />\r\n          </svg>\r\n          <span className=\"font-mono text-xs sm:text-sm font-bold tracking-wider truncate max-w-[30vw] sm:max-w-[50vw]\">\r\n            {user.store_name}\r\n          </span>\r\n        </button>\r\n      </div>\r\n      {/* View All Receipts Button */}\r\n      <button\r\n        onClick={() => setShowReceipts(true)}\r\n        className=\"flex items-center gap-2 bg-white/80 backdrop-blur-sm p-1.5 sm:px-3 sm:py-2 rounded-lg border border-gray-200/80 hover:bg-gray-50 transition-colors\"\r\n        title=\"View all receipts (F9)\"\r\n      >\r\n        <div className=\"relative\">\r\n          <BiReceipt className=\"w-5 h-5 text-blue-600\" />\r\n        </div>\r\n        <span className=\"text-sm font-medium text-gray-700 hidden sm:inline\">\r\n          Receipts\r\n        </span>\r\n        <span className=\"hidden sm:inline-block bg-blue-50 text-blue-700 border border-blue-200 text-xs font-bold px-1.5 py-0.5 rounded\">\r\n          F9\r\n        </span>\r\n      </button>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <PageLayout\r\n      title=\"POS\"\r\n      sidebar={<NavAdmin />}\r\n      headerActions={headerActions}\r\n      isSidebarOpen={isSidebarOpen}\r\n      setSidebarOpen={setSidebarOpen}\r\n    >\r\n      <div className=\"flex-1 flex flex-col min-h-screen\">\r\n        <main className=\"flex-1 bg-gradient-to-br from-gray-50/50 via-blue-50/30 to-indigo-50/50 overflow-hidden p-2 sm:p-3 md:p-4 pb-10 lg:pb-4\">\r\n          <div className=\"grid gap-2 sm:gap-3 md:gap-4 h-full grid-cols-1 lg:grid-cols-12\">\r\n            {/* Left Column - Scanner, SKU Form, Transaction */}\r\n            <div className=\"lg:col-span-4 flex flex-col gap-2 sm:gap-3 md:gap-4\">\r\n              {/* ScannerCard */}\r\n              <div className=\"flex-shrink-0\">\r\n                <ScannerCard\r\n                  onScan={async (result) => {\r\n                    const code = result?.[0]?.rawValue;\r\n                    if (!code) return;\r\n                    setScannerPaused(true);\r\n                    if (showPriceCheck) {\r\n                      setPriceCheckSku(code);\r\n                    } else {\r\n                      try {\r\n                        let scannedData;\r\n                        try {\r\n                          scannedData = JSON.parse(code);\r\n                        } catch (e) {\r\n                          scannedData = null;\r\n                        }\r\n                        if (\r\n                          scannedData &&\r\n                          scannedData.t === \"cart\" &&\r\n                          Array.isArray(scannedData.items)\r\n                        ) {\r\n                          // set transactionId from scanned data if present\r\n                          if (scannedData.transaction_id) {\r\n                            setTransactionId(scannedData.transaction_id);\r\n                          }\r\n                          // set transaction_number from scanned data if present\r\n                          if (scannedData.transaction_number) {\r\n                            setTransactionNumber(\r\n                              scannedData.transaction_number\r\n                            );\r\n                          }\r\n                          const items = scannedData.items.map((it) => ({\r\n                            product_id: it.p,\r\n                            quantity: it.q,\r\n                            sku: it.sku || \"\",\r\n                          }));\r\n                          try {\r\n                            const fetchedProducts = await Promise.all(\r\n                              items.map(async (item) => {\r\n                                const res = await api(\r\n                                  `/api/products/${item.product_id}`,\r\n                                  {\r\n                                    headers: {\r\n                                      Authorization: `Bearer ${token}`,\r\n                                    },\r\n                                  }\r\n                                );\r\n                                return {\r\n                                  product_id: item.product_id,\r\n                                  sku: res.sku || item.sku || \"\",\r\n                                  name: res.product_name || \"\",\r\n                                  price: Number(res.selling_price) || 0,\r\n                                  quantity: item.quantity,\r\n                                };\r\n                              })\r\n                            );\r\n                            setCart((prev) => {\r\n                              const byProductId = new Map(\r\n                                prev.map((i) => [i.product_id, i])\r\n                              );\r\n                              for (const it of fetchedProducts) {\r\n                                const existing = byProductId.get(it.product_id);\r\n                                if (existing) {\r\n                                  existing.quantity += it.quantity;\r\n                                } else {\r\n                                  byProductId.set(it.product_id, { ...it });\r\n                                }\r\n                              }\r\n                              return Array.from(byProductId.values());\r\n                            });\r\n                            return;\r\n                          } catch (err) {\r\n                            console.error(\r\n                              \"Error fetching product details for scanned cart:\",\r\n                              err\r\n                            );\r\n                            // fallback to merging raw scanned items without product details\r\n                            setCart((prev) => {\r\n                              const byProductId = new Map(\r\n                                prev.map((i) => [i.product_id, i])\r\n                              );\r\n                              for (const it of items) {\r\n                                const existing = byProductId.get(it.product_id);\r\n                                if (existing) {\r\n                                  existing.quantity += it.quantity;\r\n                                } else {\r\n                                  byProductId.set(it.product_id, {\r\n                                    ...it,\r\n                                    name: \"\",\r\n                                    price: 0,\r\n                                  });\r\n                                }\r\n                              }\r\n                              return Array.from(byProductId.values());\r\n                            });\r\n                            return;\r\n                          }\r\n                        }\r\n                        await addSkuToCart(code, 1);\r\n                      } catch (err) {\r\n                        console.error(\"Error processing scanned code:\", err);\r\n                        await addSkuToCart(code, 1);\r\n                      }\r\n                    }\r\n                  }}\r\n                  paused={scannerPaused}\r\n                  onResume={() => setScannerPaused(false)}\r\n                  textMain=\"text-blue-700\"\r\n                />\r\n              </div>\r\n\r\n              {/* SkuFormCard */}\r\n              <div className=\"flex-shrink-0\">\r\n                <SkuFormCard\r\n                  ref={skuInputRef}\r\n                  sku={sku}\r\n                  setSku={setSku}\r\n                  quantity={quantity}\r\n                  setQuantity={setQuantity}\r\n                  handleAddToCart={handleAddToCart}\r\n                  quantityInputRef={quantityInputRef}\r\n                />\r\n                {error && (\r\n                  <div className=\"bg-red-50 border-l-4 border-red-500 rounded-lg p-3 flex items-start gap-2 mt-3 relative animate-in slide-in-from-top-2 duration-300\">\r\n                    <svg\r\n                      className=\"w-4 h-4 text-red-500 flex-shrink-0 mt-0.5\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"\r\n                      />\r\n                    </svg>\r\n                    <p className=\"text-sm font-medium text-red-700 flex-1\">\r\n                      {(() => {\r\n                        try {\r\n                          const parsed = JSON.parse(error);\r\n                          return parsed.error || parsed.message || error;\r\n                        } catch {\r\n                          return error;\r\n                        }\r\n                      })()}\r\n                    </p>\r\n                    <button\r\n                      onClick={() => setError(\"\")}\r\n                      className=\"text-red-400 hover:text-red-600 transition-colors flex-shrink-0 ml-2\"\r\n                      aria-label=\"Dismiss error\"\r\n                    >\r\n                      <svg\r\n                        className=\"w-4 h-4\"\r\n                        fill=\"none\"\r\n                        stroke=\"currentColor\"\r\n                        viewBox=\"0 0 24 24\"\r\n                      >\r\n                        <path\r\n                          strokeLinecap=\"round\"\r\n                          strokeLinejoin=\"round\"\r\n                          strokeWidth={2}\r\n                          d=\"M6 18L18 6M6 6l12 12\"\r\n                        />\r\n                      </svg>\r\n                    </button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* TransactionCard */}\r\n              {/* Removed card display; transaction number now shown in header */}\r\n              {/* <div className=\"flex-shrink-0\">\r\n                  <TransactionCard\r\n                    transactionNumber={transactionNumber}\r\n                    transactionId={transactionId}\r\n                  />\r\n                </div> */}\r\n            </div>\r\n\r\n            {/* Right Column - Cart and Actions */}\r\n            <div className=\"lg:col-span-8 flex flex-col gap-2 sm:gap-3 min-h-0\">\r\n              {/* Transaction Number Display (when loading customer cart) */}\r\n              {transactionId && transactionNumber && (\r\n                <div className=\"bg-blue-50 border border-blue-200 rounded-lg px-4 py-2 flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <svg\r\n                      className=\"w-5 h-5 text-blue-600\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\r\n                      />\r\n                    </svg>\r\n                    <div>\r\n                      <div className=\"text-xs text-blue-600 font-medium\">Customer Transaction</div>\r\n                      <div className=\"text-sm font-bold text-blue-800 font-mono\">{transactionNumber}</div>\r\n                    </div>\r\n                  </div>\r\n                  <button\r\n                    onClick={() => {\r\n                      setTransactionId(null);\r\n                      setTransactionNumber(\"\");\r\n                      setCart([]);\r\n                      setAppliedDiscount(null);\r\n                    }}\r\n                    className=\"text-xs text-blue-600 hover:text-blue-800 underline\"\r\n                    title=\"Start new transaction\"\r\n                  >\r\n                    Clear\r\n                  </button>\r\n                </div>\r\n              )}\r\n              {/* CartTableCard */}\r\n              <div className=\"flex-1 min-h-0 max-h-[calc(100vh-280px)]\">\r\n                <CartTableCard\r\n                cart={cart}\r\n                handleRemove={handleRemove}\r\n                handleEditQuantity={(idx, newQuantity) => {\r\n                  handleEditQuantity(idx, newQuantity);\r\n                  setEditingCartItem(null);\r\n                }}\r\n                total={total}\r\n                appliedDiscount={appliedDiscount}\r\n                selectedIdx={selectedCartIdx}\r\n                onSelectRow={setSelectedCartItem}\r\n                editingIdx={editingCartItem}\r\n                editQty={editQty}\r\n                onEditQtyChange={handleEditQtyChange}\r\n                onEditComplete={() => setEditingCartItem(null)}\r\n                onStartEdit={(idx) => setEditingCartItem(idx)}\r\n                className=\"flex-1 h-full\"\r\n              />\r\n              </div>\r\n\r\n              {/* Action Buttons */}\r\n              <div className=\"grid grid-cols-12 gap-2 sm:gap-3 flex-shrink-0\">\r\n                {appliedDiscount && (\r\n                  <div className=\"col-span-12 flex items-center justify-between bg-emerald-50 border border-emerald-200 text-emerald-800 rounded-lg px-3 py-2\">\r\n                    <span className=\"text-sm font-semibold\">\r\n                      Discount applied: {appliedDiscount.label}\r\n                    </span>\r\n                    <button\r\n                      className=\"text-xs font-bold underline flex items-center gap-1\"\r\n                      onClick={() => setAppliedDiscount(null)}\r\n                    >\r\n                      <span className=\"text-yellow-600\">(F11)</span> Remove\r\n                    </button>\r\n                  </div>\r\n                )}\r\n                {/* Grouped Buttons */}\r\n                <div className=\"col-span-8\">\r\n                  <div className=\"grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3\">\r\n                    <Button\r\n                      label={<ButtonLabel text=\"CASH LEDGER\" shortcut=\"F5\" />}\r\n                      size=\"md\"\r\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\r\n                      variant=\"secondary\"\r\n                      microinteraction\r\n                      onClick={() => setShowCashLedger(true)}\r\n                      icon={\r\n                        <svg\r\n                          className=\"w-4 h-4\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                          />\r\n                        </svg>\r\n                      }\r\n                      iconPosition=\"left\"\r\n                    />\r\n                    <div className=\"relative group flex-1\">\r\n                      <Button\r\n                        label={\r\n                          appliedDiscount\r\n                            ? <ButtonLabel text=\"REMOVE DISCOUNT\" shortcut=\"F11\" variant=\"secondary\" />\r\n                            : <ButtonLabel text=\"ADD DISCOUNT\" shortcut=\"F6\" />\r\n                        }\r\n                        variant=\"secondary\"\r\n                        onClick={() => {\r\n                          if (appliedDiscount) {\r\n                            if (window.confirm(`Remove ${appliedDiscount.label || 'discount'}?`)) {\r\n                              setAppliedDiscount(null);\r\n                            }\r\n                          } else {\r\n                            setShowDiscount(true);\r\n                          }\r\n                        }}\r\n                        icon={\r\n                          appliedDiscount ? (\r\n                            <svg\r\n                              className=\"w-5 h-5\"\r\n                              fill=\"none\"\r\n                              stroke=\"currentColor\"\r\n                              viewBox=\"0 0 24 24\"\r\n                            >\r\n                              <path\r\n                                strokeLinecap=\"round\"\r\n                                strokeLinejoin=\"round\"\r\n                                strokeWidth={2}\r\n                                d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"\r\n                              />\r\n                            </svg>\r\n                          ) : (\r\n                            <svg\r\n                              className=\"w-5 h-5\"\r\n                              fill=\"none\"\r\n                              stroke=\"currentColor\"\r\n                              viewBox=\"0 0 24 24\"\r\n                            >\r\n                              <path\r\n                                strokeLinecap=\"round\"\r\n                                strokeLinejoin=\"round\"\r\n                                strokeWidth={2}\r\n                                d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                              />\r\n                            </svg>\r\n                          )\r\n                        }\r\n                        className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\r\n                      />\r\n                      {appliedDiscount && (\r\n                        <div className=\"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none\">\r\n                          Click to remove discount\r\n                          <div className=\"absolute bottom-0 left-1/2 w-2 h-2 bg-gray-800 transform -translate-x-1/2 translate-y-1/2 rotate-45\"></div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <Button\r\n                      label={<ButtonLabel text=\"PRICE CHECK\" shortcut=\"F7\" />}\r\n                      size=\"md\"\r\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\r\n                      onClick={() => setShowPriceCheck(true)}\r\n                      variant=\"secondary\"\r\n                      microinteraction\r\n                      icon={\r\n                        <svg\r\n                          className=\"w-4 h-4\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                          />\r\n                        </svg>\r\n                      }\r\n                      iconPosition=\"left\"\r\n                    />\r\n                    <Button\r\n                      label={<ButtonLabel text=\"SCAN CUSTOMER QR\" shortcut=\"F8\" />}\r\n                      size=\"md\"\r\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\r\n                      onClick={() => setShowImportCart(true)}\r\n                      variant=\"secondary\"\r\n                      microinteraction\r\n                      icon={\r\n                        <svg\r\n                          className=\"w-4 h-4\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12\"\r\n                          />\r\n                        </svg>\r\n                      }\r\n                      iconPosition=\"left\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Checkout Button */}\r\n                <div className=\"col-span-4\">\r\n                  <Button\r\n                    label={<ButtonLabel text=\"CHECKOUT\" shortcut=\"F12\" variant=\"primary\" />}\r\n                    size=\"md\"\r\n                    className=\"w-full h-full text-sm sm:text-base font-bold\"\r\n                    variant=\"primary\"\r\n                    microinteraction\r\n                    onClick={() => setShowCheckout(true)}\r\n                    disabled={cart.length === 0}\r\n                    icon={\r\n                      <svg\r\n                        className=\"w-5 h-5\"\r\n                        fill=\"none\"\r\n                        stroke=\"currentColor\"\r\n                        viewBox=\"0 0 24 24\"\r\n                      >\r\n                        <path\r\n                          strokeLinecap=\"round\"\r\n                          strokeLinejoin=\"round\"\r\n                          strokeWidth={2}\r\n                          d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                        />\r\n                      </svg>\r\n                    }\r\n                    iconPosition=\"left\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </main>\r\n      </div>\r\n      {/* Modals */}\r\n      <DiscountModal\r\n        isOpen={showDiscount}\r\n        onClose={() => setShowDiscount(false)}\r\n        onApplyDiscount={(discount) => {\r\n          setAppliedDiscount(discount);\r\n          setShowDiscount(false);\r\n        }}\r\n      />\r\n      <PriceCheckModal\r\n        isOpen={showPriceCheck}\r\n        onClose={() => setShowPriceCheck(false)}\r\n        sku={priceCheckSku}\r\n        setSku={setPriceCheckSku}\r\n      />\r\n      <CashLedgerModal\r\n        isOpen={showCashLedger}\r\n        onClose={() => setShowCashLedger(false)}\r\n      />\r\n      <AdminReceiptsModal\r\n        isOpen={showReceipts}\r\n        onClose={() => setShowReceipts(false)}\r\n      />\r\n      <CheckoutModal\r\n        isOpen={showCheckout}\r\n        onClose={() => setShowCheckout(false)}\r\n        total={total}\r\n        onSelectPayment={(method) => {\r\n          setSelectedPayment(method);\r\n          setShowCheckout(false);\r\n\r\n          if (method === \"cash\") {\r\n            setShowCashModal(true);\r\n          } else if (method === \"gcash\") {\r\n            (async () => {\r\n              try {\r\n                const successUrl =\r\n                  window.location.origin + \"/pos?payment=success\";\r\n                const cancelUrl =\r\n                  window.location.origin + \"/pos?payment=cancel\";\r\n                // persist cart to finalize after redirect back\r\n                localStorage.setItem(\r\n                  \"pending_gcash_cart\",\r\n                  JSON.stringify({\r\n                    items: cart.map((i) => ({\r\n                      product_id: i.product_id,\r\n                      quantity: i.quantity,\r\n                    })),\r\n                    total,\r\n                    discount_id: appliedDiscount?.discount_id || null,\r\n                    discount_percentage: appliedDiscount?.type === 'percentage' ? Number(appliedDiscount.value) : null,\r\n                    discount_amount: appliedDiscount?.type === 'amount' ? Number(appliedDiscount.value) : null,\r\n                  })\r\n                );\r\n                const { checkoutUrl } = await createGcashCheckout({\r\n                  amount: Number(total || 0),\r\n                  description: \"POS Order\",\r\n                  referenceNumber: transactionNumber || `POS-${Date.now()}`,\r\n                  cancelUrl,\r\n                  successUrl,\r\n                });\r\n                window.open(checkoutUrl, \"_blank\");\r\n              } catch (e) {\r\n                setError(\"Failed to init GCash\");\r\n                localStorage.removeItem(\"pending_gcash_cart\");\r\n              }\r\n            })();\r\n          } else if (method === \"maya\") {\r\n            (async () => {\r\n              try {\r\n                const successUrl =\r\n                  window.location.origin + \"/pos?payment=success\";\r\n                const cancelUrl =\r\n                  window.location.origin + \"/pos?payment=cancel\";\r\n                // persist cart to finalize after redirect back\r\n                localStorage.setItem(\r\n                  \"pending_maya_cart\",\r\n                  JSON.stringify({\r\n                    items: cart.map((i) => ({\r\n                      product_id: i.product_id,\r\n                      quantity: i.quantity,\r\n                    })),\r\n                    total,\r\n                    discount_id: appliedDiscount?.discount_id || null,\r\n                    discount_percentage: appliedDiscount?.type === 'percentage' ? Number(appliedDiscount.value) : null,\r\n                    discount_amount: appliedDiscount?.type === 'amount' ? Number(appliedDiscount.value) : null,\r\n                  })\r\n                );\r\n                const { checkoutUrl } = await createMayaCheckout({\r\n                  amount: Number(total || 0),\r\n                  description: \"POS Order\",\r\n                  referenceNumber: transactionNumber || `POS-${Date.now()}`,\r\n                  cancelUrl,\r\n                  successUrl,\r\n                });\r\n                window.open(checkoutUrl, \"_blank\");\r\n              } catch (e) {\r\n                setError(\"Failed to init Maya\");\r\n                localStorage.removeItem(\"pending_maya_cart\");\r\n              }\r\n            })();\r\n          } else {\r\n            handleCheckout(method);\r\n          }\r\n        }}\r\n      />\r\n      <CashPaymentModal\r\n        isOpen={showCashModal}\r\n        onClose={() => setShowCashModal(false)}\r\n        total={total}\r\n        onConfirm={(amountReceived) => {\r\n          handleCheckout(\"cash\", amountReceived);\r\n          setShowCashModal(false);\r\n        }}\r\n      />\r\n      <QuantityInputModal\r\n        isOpen={showQuantityModal}\r\n        onClose={() => {\r\n          setShowQuantityModal(false);\r\n          setPendingProduct(null);\r\n          // Auto-focus SKU input after closing modal\r\n          setTimeout(() => {\r\n            skuInputRef.current?.focus();\r\n          }, 50);\r\n        }}\r\n        product={pendingProduct}\r\n        onConfirm={handleQuantityConfirm}\r\n        existingQuantity={\r\n          pendingProduct\r\n            ? cart.find((item) => item.product_id === pendingProduct.product_id)\r\n                ?.quantity || 0\r\n            : 0\r\n        }\r\n      />\r\n      {showLogoutConfirm && (\r\n        <div className=\"fixed inset-0 z-90 flex items-center justify-center\">\r\n          <div\r\n            className=\"absolute inset-0 bg-black/80 z-90\"\r\n            onClick={handleCloseLogoutModal}\r\n          />\r\n          <div \r\n            className=\"relative bg-white rounded-xl shadow-xl w-[92%] max-w-md z-100 p-0\"\r\n            onKeyDown={(e) => {\r\n              // Prevent event from bubbling up to document\r\n              e.stopPropagation();\r\n              \r\n              // Handle Enter key specifically for the modal\r\n              if (e.key === 'Enter' && !e.isPropagationStopped()) {\r\n                e.preventDefault();\r\n                confirmLogout();\r\n              }\r\n            }}\r\n          >\r\n            {/* Header Section */}\r\n            <div className=\"bg-gradient-to-r from-red-50 via-red-50/80 to-orange-50/50 border-b border-red-100 px-6 py-5 rounded-t-2xl\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <div className=\"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg\">\r\n                  <svg\r\n                    className=\"w-6 h-6 text-white\"\r\n                    fill=\"none\"\r\n                    stroke=\"white\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeWidth=\"2\"\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"\r\n                    />\r\n                  </svg>\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                  <h2 className=\"text-xl font-bold text-gray-900 mb-1\">\r\n                    Confirm Logout\r\n                  </h2>\r\n                  <p className=\"text-sm text-gray-600\">\r\n                    Are you sure you want to log out? <span className=\"text-xs opacity-70\">(Press Esc to cancel, Enter to confirm)</span>\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Content Section */}\r\n            <div className=\"p-6\">\r\n              <p className=\"text-sm text-gray-700 mb-6\">\r\n                You will be redirected to the login page and your session will\r\n                end.\r\n              </p>\r\n\r\n              {/* Action Buttons */}\r\n              <div className=\"flex justify-end gap-3\">\r\n                <button\r\n                  onClick={handleCloseLogoutModal}\r\n                  className=\"px-5 py-2.5 rounded-lg text-sm font-semibold text-gray-700 bg-white border-2 border-gray-300 hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\r\n                  autoFocus\r\n                >\r\n                  Cancel (Esc)\r\n                </button>\r\n                <button\r\n                  onClick={confirmLogout}\r\n                  className=\"px-5 py-2.5 rounded-lg text-sm font-semibold text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 shadow-md hover:shadow-lg transition-all duration-200 flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\r\n                >\r\n                  <svg\r\n                    className=\"w-5 h-5\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeWidth=\"2\"\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"\r\n                    />\r\n                  </svg>\r\n                  Logout (Enter)\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      <ScanCustomerCartModal\r\n        isOpen={showImportCart}\r\n        onClose={() => setShowImportCart(false)}\r\n        onImport={async (items, transactionId, completionResponse, transactionNumber) => {\r\n          try {\r\n            // If transaction was completed (completionResponse exists), navigate to receipt\r\n            if (completionResponse && transactionId) {\r\n              setCart([]);\r\n              setTransactionId(null);\r\n              setTransactionNumber(\"\");\r\n              setError(\"\");\r\n              setShowImportCart(false);\r\n              // Navigate to receipt page for admin\r\n              window.location.href = `/receipt?tn=${completionResponse.transaction_number || transactionId}`;\r\n              return;\r\n            }\r\n            \r\n            // If transactionId is provided, this is a pending transaction being loaded\r\n            if (transactionId && items && items.length > 0) {\r\n              // Store transaction info\r\n              setTransactionId(transactionId);\r\n              if (transactionNumber) {\r\n                setTransactionNumber(transactionNumber);\r\n              }\r\n              \r\n              // Items from pending transaction already have all product details\r\n              // Replace cart with these items (don't merge, since we're loading a specific transaction)\r\n              setCart(items);\r\n              setError(\"\");\r\n              setShowImportCart(false);\r\n              return;\r\n            }\r\n            \r\n            // Otherwise, import items (backward compatibility for old QR format)\r\n            if (!items || items.length === 0) {\r\n              setError(\"No items found in QR code\");\r\n              return;\r\n            }\r\n            \r\n            console.log(\"Scanned items:\", items);\r\n            // Fetch product details by product_id for all scanned items concurrently\r\n            const fetchedProducts = await Promise.all(\r\n              items.map(async (item) => {\r\n                const res = await api(`/api/products/${item.product_id}`, {\r\n                  headers: { Authorization: `Bearer ${token}` },\r\n                });\r\n                console.log(\r\n                  \"Fetched product for id\",\r\n                  item.product_id,\r\n                  \":\",\r\n                  res\r\n                );\r\n                return {\r\n                  product_id: item.product_id,\r\n                  sku: res.sku || item.sku || \"\",\r\n                  name: res.product_name || \"\",\r\n                  price: Number(res.selling_price) || 0,\r\n                  quantity: item.quantity,\r\n                };\r\n              })\r\n            );\r\n            setCart((prev) => {\r\n              const byProductId = new Map(prev.map((i) => [i.product_id, i]));\r\n              for (const it of fetchedProducts) {\r\n                const existing = byProductId.get(it.product_id);\r\n                if (existing) {\r\n                  existing.quantity += it.quantity;\r\n                } else {\r\n                  byProductId.set(it.product_id, { ...it });\r\n                }\r\n              }\r\n              return Array.from(byProductId.values());\r\n            });\r\n          } catch (e) {\r\n            console.error(\"Error fetching products for scanned items:\", e);\r\n            // Fallback to use raw items if fetch fails\r\n            setCart((prev) => {\r\n              const byProductId = new Map(prev.map((i) => [i.product_id, i]));\r\n              for (const it of items) {\r\n                const existing = byProductId.get(it.product_id);\r\n                if (existing) {\r\n                  existing.quantity += it.quantity;\r\n                } else {\r\n                  byProductId.set(it.product_id, {\r\n                    ...it,\r\n                    name: \"\",\r\n                    price: 0,\r\n                  });\r\n                }\r\n              }\r\n              return Array.from(byProductId.values());\r\n            });\r\n          }\r\n        }}\r\n      />\r\n    </PageLayout>\r\n  );\r\n}\r\n\r\nexport default POS;\r\n"],"names":["ButtonLabel","text","shortcut","variant","jsxs","className","children","jsx","POS","navigate","useNavigate","sku","setSku","useState","quantity","setQuantity","cart","setCart","showDiscount","setShowDiscount","showPriceCheck","setShowPriceCheck","priceCheckSku","setPriceCheckSku","showImportCart","setShowImportCart","showCashLedger","setShowCashLedger","showCheckout","setShowCheckout","showCashModal","setShowCashModal","selectedPayment","setSelectedPayment","darkMode","setDarkMode","scannerPaused","setScannerPaused","error","setError","transactionNumber","setTransactionNumber","transactionId","setTransactionId","useEffect","timer","setTimeout","clearTimeout","showReceipts","setShowReceipts","skuInputRef","useRef","isSidebarOpen","setSidebarOpen","selectedItemIdx","setSelectedItemIdx","editingIdx","setEditingIdx","token","sessionStorage","getItem","user","JSON","parse","hasFinalizedRef","React","businessName","setBusinessName","selectedCartIdx","setSelectedCartIdx","editingCartItem","setEditingCartItem","editQty","setEditQty","showLogoutConfirm","setShowLogoutConfirm","appliedDiscount","setAppliedDiscount","quantityInputRef","showQuantityModal","setShowQuantityModal","pendingProduct","setPendingProduct","businessId","business_id","timePart","Date","toISOString","replace","slice","randPart","Math","floor","random","toString","padStart","current","focus","status","URLSearchParams","window","location","search","get","isNewTab","opener","closed","finalizeOnlinePayment","async","pendingCartKey","paymentType","pending","localStorage","parsed","guardKey","setItem","body","items","payment_type","toLowerCase","money_received","total","discount_id","discount_percentage","discount_amount","resp","api","method","headers","Authorization","stringify","transaction_number","transaction_id","url","URL","origin","searchParams","set","String","href","close","_","e","removeItem","delete","history","replaceState","addSkuToCart","skuValue","qty","product","encodeURIComponent","price","Number","selling_price","stockQty","stock_quantity","product_name","product_type","prev","existingIdx","findIndex","i","product_id","next","newQty","name","is_basic_necessity","err","handleAddToCart","handleRemove","idx","length","filter","handleEditQuantity","max","item","map","message","handleIncrementQuantity","cartItem","handleDecrementQuantity","currentQty","subtotal","reduce","sum","basicNecessitySubtotal","otherItemsSubtotal","type","discountValue","value","isNaN","discountAmount","min","handleKeyDown","isInputFocused","target","tagName","isContentEditable","includes","key","preventDefault","stopPropagation","isSkuInput","isArrowKey","isQuantityKey","addEventListener","removeEventListener","anyModalOpen","activeElement","document","useKeyboardShortcuts","action","focusSkuInput","select","handleEditQuantityShortcut","enabled","handleVoidSelected","description","handleDiscountToggle","handleRemoveDiscount","allowWhileTyping","confirmLogout","handleCloseLogoutModal","capture","handleCheckout","paymentMethod","amountReceived","payload","pathname","response","data","showRecentReceiptsModal","setShowRecentReceiptsModal","headerActions","toFixed","onClick","store_name","navigator","clipboard","writeText","title","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","BiReceipt","PageLayout","sidebar","NavAdmin","ScannerCard","onScan","result","code","rawValue","scannedData","t","Array","isArray","it","p","q","fetchedProducts","Promise","all","res","byProductId","Map","existing","from","values","paused","onResume","textMain","SkuFormCard","ref","CartTableCard","newQuantity","selectedIdx","onSelectRow","onEditQtyChange","onEditComplete","onStartEdit","label","Button","size","microinteraction","icon","iconPosition","confirm","disabled","DiscountModal","isOpen","onClose","onApplyDiscount","discount","PriceCheckModal","CashLedgerModal","AdminReceiptsModal","CheckoutModal","onSelectPayment","successUrl","cancelUrl","checkoutUrl","createGcashCheckout","amount","referenceNumber","now","open","createMayaCheckout","CashPaymentModal","onConfirm","QuantityInputModal","quantityInBaseUnits","base_unit","pricePerUnit","quantity_per_unit","existingQuantity","find","onKeyDown","isPropagationStopped","autoFocus","ScanCustomerCartModal","onImport","completionResponse","log","console"],"mappings":"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"}