{"version":3,"file":"CashierPOS-BQvyv8v_.js","sources":["../../../frontend/src/components/modals/RecentReceiptsModal.jsx","../../../frontend/src/pages/CashierPOS.jsx"],"sourcesContent":["import React, { useEffect, useState, useCallback, useRef } from \"react\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport Button from \"../common/Button\";\r\nimport { api } from \"../../lib/api\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nfunction RecentReceiptsModal({ isOpen, onClose }) {\r\n  const [receipts, setReceipts] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [selectedIndex, setSelectedIndex] = useState(0);\r\n  const containerRef = useRef(null);\r\n  const modalContentRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    const fetchReceipts = async () => {\r\n      setLoading(true);\r\n      setError(\"\");\r\n      try {\r\n        const token = sessionStorage.getItem(\"auth_token\");\r\n        const data = await api(\"/api/sales/cashier/recent\", {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        setReceipts(Array.isArray(data) ? data : []);\r\n      } catch (e) {\r\n        setError(\"Failed to load receipts\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchReceipts();\r\n  }, [isOpen]);\r\n\r\n  const openReceipt = (receipt) => {\r\n    const url = new URL(window.location.origin + \"/receipt\");\r\n    if (receipt.transaction_number)\r\n      url.searchParams.set(\"tn\", receipt.transaction_number);\r\n    if (receipt.transaction_id)\r\n      url.searchParams.set(\"tid\", String(receipt.transaction_id));\r\n    window.open(url.toString(), \"_blank\");\r\n  };\r\n\r\n  const openReceiptByIndex = useCallback((index) => {\r\n    if (!receipts[index]) return;\r\n    openReceipt(receipts[index]);\r\n  }, [receipts]);\r\n\r\n  const handleKeyDown = useCallback((e) => {\r\n    if (!isOpen || !receipts.length) return;\r\n    e.preventDefault();\r\n\r\n    switch (e.key) {\r\n      case 'ArrowUp': {\r\n        setSelectedIndex(prev => {\r\n          const newIndex = prev <= 0 ? receipts.length - 1 : prev - 1;\r\n          // Use setTimeout to ensure state update is complete before focusing\r\n          setTimeout(() => {\r\n            const items = containerRef.current?.querySelectorAll('button');\r\n            if (items?.[newIndex]) {\r\n              items[newIndex].focus({ preventScroll: true });\r\n            }\r\n          }, 0);\r\n          return newIndex;\r\n        });\r\n        break;\r\n      }\r\n      case 'ArrowDown': {\r\n        setSelectedIndex(prev => {\r\n          const newIndex = prev >= receipts.length - 1 ? 0 : prev + 1;\r\n          // Use setTimeout to ensure state update is complete before focusing\r\n          setTimeout(() => {\r\n            const items = containerRef.current?.querySelectorAll('button');\r\n            if (items?.[newIndex]) {\r\n              items[newIndex].focus({ preventScroll: true });\r\n            }\r\n          }, 0);\r\n          return newIndex;\r\n        });\r\n        break;\r\n      }\r\n      case 'Enter':\r\n        e.preventDefault();\r\n        if (receipts[selectedIndex]) {\r\n          openReceipt(receipts[selectedIndex]);\r\n        }\r\n        break;\r\n      case 'Escape':\r\n        onClose();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }, [isOpen, receipts, selectedIndex, onClose, openReceipt]);\r\n\r\n  // Reset selected index when modal opens or receipts change\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setSelectedIndex(0);\r\n      // Focus the container when it opens\r\n      if (containerRef.current) {\r\n        containerRef.current.focus({ preventScroll: true });\r\n      }\r\n    }\r\n  }, [isOpen, receipts]);\r\n\r\n  // Scroll to selected item when it changes\r\n  useEffect(() => {\r\n    if (containerRef.current && selectedIndex >= 0) {\r\n      const container = containerRef.current;\r\n      const selectedElement = container.children[selectedIndex];\r\n      \r\n      if (selectedElement) {\r\n        const containerRect = container.getBoundingClientRect();\r\n        const elementRect = selectedElement.getBoundingClientRect();\r\n        \r\n        // Check if element is out of view\r\n        if (elementRect.top < containerRect.top) {\r\n          // Scroll up if element is above viewport\r\n          container.scrollBy(0, elementRect.top - containerRect.top - 10);\r\n        } else if (elementRect.bottom > containerRect.bottom) {\r\n          // Scroll down if element is below viewport\r\n          container.scrollBy(0, elementRect.bottom - containerRect.bottom + 10);\r\n        }\r\n      }\r\n    }\r\n  }, [selectedIndex]);\r\n\r\n  // Use direct event listeners for better reliability\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    \r\n    const handleKeyDownEvent = (e) => {\r\n      if (['ArrowUp', 'ArrowDown', 'Enter', 'Escape'].includes(e.key)) {\r\n        e.preventDefault();\r\n        handleKeyDown(e);\r\n      }\r\n    };\r\n\r\n    const container = containerRef.current;\r\n    if (container) {\r\n      container.addEventListener('keydown', handleKeyDownEvent);\r\n      // Focus the container when modal opens\r\n      container.focus({ preventScroll: true });\r\n      return () => {\r\n        container.removeEventListener('keydown', handleKeyDownEvent);\r\n      };\r\n    }\r\n  }, [isOpen, handleKeyDown]);\r\n\r\n  // Remove useKeyboardShortcuts to prevent duplicate event handling\r\n  // The direct event listener on the container is sufficient\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Recent Receipts\"\r\n      subtitle=\"Latest transactions handled by you\"\r\n      size=\"lg\"\r\n      contentRef={modalContentRef}\r\n      footer={\r\n        <Button\r\n          label=\"Close (Esc)\"\r\n          variant=\"secondary\"\r\n          onClick={onClose}\r\n          className=\"w-full\"\r\n        />\r\n      }\r\n    >\r\n      {loading && (\r\n        <div className=\"text-sm text-gray-600 py-4 text-center\">\r\n          Loading receipts...\r\n        </div>\r\n      )}\r\n      {error && (\r\n        <div className=\"text-sm text-red-600 bg-red-50 border border-red-100 rounded-lg px-3 py-2 mb-2\">\r\n          {error}\r\n        </div>\r\n      )}\r\n      {!loading && !error && receipts.length === 0 && (\r\n        <div className=\"text-sm text-gray-500 py-6 text-center\">\r\n          No receipts found.\r\n        </div>\r\n      )}\r\n      <div \r\n        className=\"space-y-2 max-h-[60vh] overflow-y-auto outline-none focus:outline-none\" \r\n        ref={containerRef}\r\n        tabIndex=\"0\"\r\n        role=\"listbox\"\r\n        aria-label=\"Recent receipts\"\r\n      >\r\n        {receipts.map((r, idx) => (\r\n          <button\r\n            key={`${r.transaction_id}-${r.transaction_number}`}\r\n            onClick={() => openReceipt(r)}\r\n            className={`w-full text-left border rounded-xl px-3 py-2 transition-all duration-200 ${\r\n              selectedIndex === idx \r\n                ? 'border-blue-500 bg-blue-50 ring-2 ring-blue-200 scale-[1.01] shadow-sm' \r\n                : 'border-gray-200 hover:border-blue-300 hover:bg-blue-50'\r\n            }`}\r\n            onFocus={() => setSelectedIndex(idx)}\r\n            role=\"option\"\r\n            aria-selected={selectedIndex === idx}\r\n            tabIndex=\"-1\"\r\n          >\r\n            <div className=\"flex justify-between items-center\">\r\n              <div>\r\n                <p className=\"text-sm font-semibold text-gray-900\">\r\n                  {r.transaction_number || \"Txn\"}\r\n                </p>\r\n                <p className=\"text-xs text-gray-600\">\r\n                  {new Date(r.updated_at || r.created_at).toLocaleString()}\r\n                </p>\r\n              </div>\r\n              <div className=\"text-right\">\r\n                <p className=\"text-sm font-bold text-blue-700\">\r\n                  ₱{Number(r.total_amount || r.total || 0).toFixed(2)}\r\n                </p>\r\n                <p className=\"text-[11px] text-gray-600 uppercase\">\r\n                  {r.payment?.method || r.payment_type || 'cash'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            {(r.discount_percentage || r.discount_amount) && (\r\n              <p className=\"text-[11px] text-emerald-700 mt-1\">\r\n                Discount applied{\" \"}\r\n                {r.discount_percentage\r\n                  ? `${r.discount_percentage}%`\r\n                  : `₱${Number(r.discount_amount || 0).toFixed(2)}`}\r\n              </p>\r\n            )}\r\n          </button>\r\n        ))}\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default RecentReceiptsModal;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import React, { useState, useRef, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport ScannerCard from \"../components/ui/POS/ScannerCard\";\r\nimport SkuFormCard from \"../components/ui/POS/SkuFormCard\";\r\nimport CartTableCard from \"../components/ui/POS/CartTableCard\";\r\nimport Button from \"../components/common/Button\";\r\nimport { api, createGcashCheckout, createMayaCheckout } from \"../lib/api\";\r\nimport PriceCheckModal from \"../components/modals/PriceCheckModal\";\r\nimport DiscountModal from \"../components/modals/DiscountModal\";\r\nimport CashLedgerModal from \"../components/modals/CashLedgerModal\";\r\nimport CheckoutModal from \"../components/modals/CheckoutModal\";\r\nimport CashPaymentModal from \"../components/modals/CashPaymentModal\";\r\nimport ScanCustomerCartModal from \"../components/modals/ScanCustomerCartModal\";\r\nimport QuantityInputModal from \"../components/modals/QuantityInputModal\";\r\nimport ChangePasswordModal from \"../components/modals/ChangePasswordModal\";\r\nimport RecentReceiptsModal from \"../components/modals/RecentReceiptsModal\";\r\nimport { BiReceipt, BiUser } from \"react-icons/bi\";\r\nimport { useKeyboardShortcuts } from \"../hooks/useKeyboardShortcuts\";\r\n\r\nconst ButtonLabel = ({ text, shortcut, variant = \"secondary\" }) => (\r\n  <div className=\"flex items-center gap-2\">\r\n    <span>{text}</span>\r\n    <span className={`hidden sm:inline-block text-xs font-bold px-1.5 py-0.5 rounded border ${\r\n      variant === \"primary\" \r\n        ? \"bg-white/20 border-white/40 text-white\" \r\n        : \"bg-gray-100 border-gray-300 text-gray-600\"\r\n    }`}>\r\n      {shortcut}\r\n    </span>\r\n  </div>\r\n);\r\n\r\nfunction CashierPOS() {\r\n  const navigate = useNavigate();\r\n\r\n  const [sku, setSku] = useState(\"\");\r\n  const [priceCheckSku, setPriceCheckSku] = useState(\"\");\r\n  const [quantity, setQuantity] = useState(1);\r\n  const [cart, setCart] = useState([]);\r\n  const [appliedDiscount, setAppliedDiscount] = useState(null);\r\n  const [showDiscount, setShowDiscount] = useState(false);\r\n  const [showPriceCheck, setShowPriceCheck] = useState(false);\r\n  const [showImportCart, setShowImportCart] = useState(false);\r\n  const [showCashLedger, setShowCashLedger] = useState(false);\r\n  const [showCheckout, setShowCheckout] = useState(false);\r\n  const [selectedPayment, setSelectedPayment] = useState(null);\r\n  const [showCashModal, setShowCashModal] = useState(false);\r\n  const [darkMode, setDarkMode] = useState(false);\r\n  const [scannerPaused, setScannerPaused] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [showLogoutConfirm, setShowLogoutConfirm] = useState(false);\r\n  const [transactionNumber, setTransactionNumber] = useState(\"\");\r\n  const [transactionId, setTransactionId] = useState(null);\r\n  \r\n  // Auto-clear error message after 5 seconds\r\n  useEffect(() => {\r\n    if (error) {\r\n      const timer = setTimeout(() => {\r\n        setError(\"\");\r\n      }, 5000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [error]);\r\n  const [showReceipts, setShowReceipts] = useState(false);\r\n  const [showChangePasswordModal, setShowChangePasswordModal] = useState(false);\r\n  const notificationRef = useRef(null);\r\n  const [isMobileNavOpen, setIsMobileNavOpen] = useState(false);\r\n  const touchStartXRef = useRef(null);\r\n  const touchActiveRef = useRef(false);\r\n  const [selectedCartIdx, setSelectedCartIdx] = useState(0);\r\n  const [editingCartItem, setEditingCartItem] = useState(null);\r\n  const [editQty, setEditQty] = useState('1');\r\n  const [showQuantityModal, setShowQuantityModal] = useState(false);\r\n  const [pendingProduct, setPendingProduct] = useState(null);\r\n  \r\n  // Set editing cart item and initialize quantity\r\n  const setSelectedCartItem = (idx) => {\r\n    setSelectedCartIdx(idx);\r\n    if (idx >= 0 && idx < cart.length) {\r\n      setEditQty(String(cart[idx].quantity));\r\n    }\r\n  };\r\n  const skuInputRef = useRef(null);\r\n  const quantityInputRef = useRef(null);\r\n  const [currentTime, setCurrentTime] = useState(new Date());\r\n\r\n  useEffect(() => {\r\n    const timer = setInterval(() => setCurrentTime(new Date()), 1000);\r\n    return () => clearInterval(timer);\r\n  }, []);\r\n\r\n  // Auto-focus SKU input on initial mount\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      skuInputRef.current?.focus();\r\n    }, 300);\r\n    return () => clearTimeout(timer);\r\n  }, []);\r\n\r\n  const token = sessionStorage.getItem(\"auth_token\");\r\n  const user = JSON.parse(sessionStorage.getItem(\"user\") || \"{}\");\r\n  const hasFinalizedRef = React.useRef(false);\r\n\r\n  // Generate a client-side provisional transaction number when POS opens\r\n  useEffect(() => {\r\n    if (!transactionNumber) {\r\n      const businessId = user?.businessId || user?.business_id || \"BIZ\";\r\n      const timePart = new Date()\r\n        .toISOString()\r\n        .replace(/[-:T.Z]/g, \"\")\r\n        .slice(0, 14);\r\n      const randPart = Math.floor(1000 + Math.random() * 9000);\r\n      setTransactionNumber(\r\n        `T-${businessId.toString().padStart(2, \"0\")}-${timePart}-${randPart}`\r\n      );\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(window.location.search);\r\n    const status = params.get(\"payment\");\r\n    \r\n    // Check if we're in a new tab (opened from payment)\r\n    const isNewTab = window.opener && !window.opener.closed;\r\n\r\n    const finalizeOnlinePayment = async (pendingCartKey, paymentType) => {\r\n      const pending = localStorage.getItem(pendingCartKey);\r\n      if (status === \"success\" && pending) {\r\n        try {\r\n          const parsed = JSON.parse(pending);\r\n          // finalize checkout using saved items\r\n          (async () => {\r\n            if (hasFinalizedRef.current) return;\r\n            const guardKey = `${paymentType.toLowerCase()}_finalize_done`;\r\n            if (sessionStorage.getItem(guardKey) === \"1\") return;\r\n            hasFinalizedRef.current = true;\r\n            sessionStorage.setItem(guardKey, \"1\");\r\n            try {\r\n              setError(\"\");\r\n              const body = {\r\n                items: parsed.items || [],\r\n                payment_type: paymentType.toLowerCase(),\r\n                money_received: parsed.total || null,\r\n                transaction_id: parsed.transactionId || null,\r\n                transaction_number: parsed.transactionNumber || null,\r\n                discount_id: parsed.discount_id || null,\r\n                discount_percentage: parsed.discount_percentage || null,\r\n                discount_amount: parsed.discount_amount || null,\r\n              };\r\n              const resp = await api(\"/api/sales/checkout\", {\r\n                method: \"POST\",\r\n                headers: { Authorization: `Bearer ${token}` },\r\n                body: JSON.stringify(body),\r\n              });\r\n              if (resp?.transaction_number)\r\n                setTransactionNumber(resp.transaction_number);\r\n              if (resp?.transaction_id) setTransactionId(resp.transaction_id);\r\n              setCart([]);\r\n              try {\r\n                const url = new URL(window.location.origin + \"/receipt\");\r\n                if (resp?.transaction_number)\r\n                  url.searchParams.set(\"tn\", resp.transaction_number);\r\n                if (resp?.transaction_id)\r\n                  url.searchParams.set(\"tid\", String(resp.transaction_id));\r\n                if (resp?.total != null)\r\n                  url.searchParams.set(\"total\", String(resp.total));\r\n                \r\n                // If in new tab, redirect opener and close this tab\r\n                if (isNewTab && window.opener) {\r\n                  window.opener.location.href = url.toString();\r\n                  window.close();\r\n                } else {\r\n                  navigate(url.pathname + url.search);\r\n                }\r\n              } catch (_) {}\r\n            } catch (e) {\r\n              setError(`Failed to record ${paymentType} payment`);\r\n            } finally {\r\n              localStorage.removeItem(pendingCartKey);\r\n              if (!isNewTab) {\r\n                // remove query param\r\n                const url = new URL(window.location.href);\r\n                url.searchParams.delete(\"payment\");\r\n                window.history.replaceState({}, \"\", url.toString());\r\n              }\r\n            }\r\n          })();\r\n        } catch (_) {\r\n          localStorage.removeItem(pendingCartKey);\r\n        }\r\n      } else if (status === \"cancel\" && pending) {\r\n        localStorage.removeItem(pendingCartKey);\r\n        // If in new tab, close it; otherwise just clean up URL\r\n        if (isNewTab && window.opener) {\r\n          window.close();\r\n        } else {\r\n          const url = new URL(window.location.href);\r\n          url.searchParams.delete(\"payment\");\r\n          window.history.replaceState({}, \"\", url.toString());\r\n        }\r\n      }\r\n    };\r\n\r\n    finalizeOnlinePayment(\"pending_gcash_cart\", \"GCash\");\r\n    finalizeOnlinePayment(\"pending_maya_cart\", \"Maya\");\r\n  }, []);\r\n\r\n  const addSkuToCart = async (skuValue, qty = 1) => {\r\n    if (!skuValue || qty < 1) return;\r\n    setError(\"\");\r\n    try {\r\n      const businessId = user?.businessId || user?.business_id || null;\r\n      const url = businessId\r\n        ? `/api/products/sku/${encodeURIComponent(\r\n            skuValue\r\n          )}?business_id=${businessId}`\r\n        : `/api/products/sku/${encodeURIComponent(skuValue)}`;\r\n\r\n      const product = await api(url, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      const price = Number(product.selling_price || 0);\r\n      const stockQty = Number(product.stock_quantity ?? 0);\r\n      if (stockQty <= 0) {\r\n        setError(\r\n          `Stock for ${product.product_name} (SKU ${product.sku}) is 0.`\r\n        );\r\n        return;\r\n      }\r\n\r\n      // Check if product is weight or volume based - show modal for quantity input\r\n      if (product.product_type === 'weight' || product.product_type === 'volume') {\r\n        setPendingProduct(product);\r\n        setShowQuantityModal(true);\r\n        return;\r\n      }\r\n\r\n      // For count-based products, proceed with normal flow\r\n      if (qty > stockQty) {\r\n        setError(\r\n          `Insufficient stock. Available: ${stockQty}, requested: ${qty}.`\r\n        );\r\n        return;\r\n      }\r\n      setCart((prev) => {\r\n        const existingIdx = prev.findIndex(\r\n          (i) => i.product_id === product.product_id\r\n        );\r\n        if (existingIdx >= 0) {\r\n          const next = [...prev];\r\n          const newQty = next[existingIdx].quantity + qty;\r\n          if (newQty > stockQty) {\r\n            setError(\r\n              `Insufficient stock. Available: ${stockQty}, requested: ${newQty}.`\r\n            );\r\n            return prev;\r\n          }\r\n          next[existingIdx] = { ...next[existingIdx], quantity: newQty };\r\n          return next;\r\n        }\r\n        return [\r\n          ...prev,\r\n          {\r\n            product_id: product.product_id,\r\n            sku: product.sku,\r\n            name: product.product_name,\r\n            quantity: qty,\r\n            price,\r\n            is_basic_necessity: product.is_basic_necessity || false,\r\n          },\r\n        ];\r\n      });\r\n      setSku(\"\");\r\n      setQuantity(1);\r\n      // Auto-focus SKU input after adding item for next scan\r\n      setTimeout(() => {\r\n        skuInputRef.current?.focus();\r\n      }, 50);\r\n    } catch (err) {\r\n      setError(\"Product not found\");\r\n    } finally {\r\n      // Always resume scanner after processing, even on error\r\n      setTimeout(() => {\r\n        setScannerPaused(false);\r\n      }, 300);\r\n    }\r\n  };\r\n\r\n  // Handle quantity confirmation from modal\r\n  const handleQuantityConfirm = (quantityInBaseUnits) => {\r\n    if (!pendingProduct) return;\r\n    \r\n    const product = pendingProduct;\r\n    const stockQty = Number(product.stock_quantity ?? 0);\r\n    \r\n    // Check stock\r\n    if (quantityInBaseUnits > stockQty) {\r\n      setError(\r\n        `Insufficient stock. Available: ${stockQty} ${product.base_unit || ''}, requested: ${quantityInBaseUnits} ${product.base_unit || ''}.`\r\n      );\r\n      setShowQuantityModal(false);\r\n      setPendingProduct(null);\r\n      return;\r\n    }\r\n\r\n    // Calculate price per base unit for weight/volume products\r\n    let pricePerUnit = Number(product.selling_price || 0);\r\n    if (product.product_type !== 'count' && product.quantity_per_unit && product.quantity_per_unit > 0) {\r\n      // Price per base unit = price per package / quantity per package\r\n      pricePerUnit = pricePerUnit / Number(product.quantity_per_unit);\r\n    }\r\n\r\n    // For weight/volume products, quantity is stored in base units\r\n    // Price is stored as price per base unit\r\n    setCart((prev) => {\r\n      const existingIdx = prev.findIndex(\r\n        (i) => i.product_id === product.product_id\r\n      );\r\n      if (existingIdx >= 0) {\r\n        const next = [...prev];\r\n        const existingQty = next[existingIdx].quantity;\r\n        const newQty = existingQty + quantityInBaseUnits;\r\n        if (newQty > stockQty) {\r\n          setError(\r\n            `Insufficient stock. Available: ${stockQty} ${product.base_unit || ''}, requested: ${newQty} ${product.base_unit || ''}.`\r\n          );\r\n          return prev;\r\n        }\r\n        next[existingIdx] = { ...next[existingIdx], quantity: newQty };\r\n        return next;\r\n      }\r\n        return [\r\n          ...prev,\r\n          {\r\n            product_id: product.product_id,\r\n            sku: product.sku,\r\n            name: product.product_name,\r\n            quantity: quantityInBaseUnits,\r\n            price: pricePerUnit,\r\n            product_type: product.product_type,\r\n            base_unit: product.base_unit,\r\n            quantity_per_unit: product.quantity_per_unit || 1,\r\n            is_basic_necessity: product.is_basic_necessity || false,\r\n          },\r\n        ];\r\n    });\r\n    \r\n    setSku(\"\");\r\n    setQuantity(1);\r\n    setShowQuantityModal(false);\r\n    setPendingProduct(null);\r\n    \r\n    // Auto-focus SKU input after adding item for next scan\r\n    setTimeout(() => {\r\n      skuInputRef.current?.focus();\r\n    }, 50);\r\n  };\r\n\r\n  const handleAddToCart = async () => {\r\n    await addSkuToCart(sku, quantity);\r\n  };\r\n\r\n  const handleRemove = (idx) => {\r\n    if (idx >= 0 && idx < cart.length) {\r\n      setCart(cart.filter((_, i) => i !== idx));\r\n    }\r\n  };\r\n  const handleEditQuantity = (idx, qty) => {\r\n    const newQty = qty === '' ? 1 : Math.max(1, Number(qty) || 1);\r\n    setCart((prev) =>\r\n      prev.map((item, i) =>\r\n        i === idx ? { ...item, quantity: newQty } : item\r\n      )\r\n    );\r\n    setEditQty(newQty); // Keep editQty in sync\r\n    setEditingCartItem(null);\r\n  };\r\n  \r\n  // Handle edit quantity change\r\n  const handleEditQtyChange = (value) => {\r\n    setEditQty(value);\r\n  };\r\n\r\n  // Handler for increment quantity (=)\r\n  const handleIncrementQuantity = () => {\r\n    if (cart.length === 0 || selectedCartIdx < 0 || selectedCartIdx >= cart.length) return;\r\n    const item = cart[selectedCartIdx];\r\n    if (!item) return;\r\n    const currentQty = item.quantity;\r\n    const newQty = currentQty + 1;\r\n    setCart((prev) =>\r\n      prev.map((cartItem, i) =>\r\n        i === selectedCartIdx ? { ...cartItem, quantity: newQty } : cartItem\r\n      )\r\n    );\r\n  };\r\n\r\n  // Handler for decrement quantity (-)\r\n  const handleDecrementQuantity = () => {\r\n    if (cart.length === 0 || selectedCartIdx < 0 || selectedCartIdx >= cart.length) return;\r\n    const item = cart[selectedCartIdx];\r\n    if (!item) return;\r\n    const currentQty = item.quantity;\r\n    if (currentQty <= 1) return; // Don't allow going below 1\r\n    const newQty = currentQty - 1;\r\n    setCart((prev) =>\r\n      prev.map((cartItem, i) =>\r\n        i === selectedCartIdx ? { ...cartItem, quantity: newQty } : cartItem\r\n      )\r\n    );\r\n  };\r\n\r\n  // Handle keyboard navigation for cart items\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      // Don't handle keys when modals are open\r\n      if (showDiscount || showPriceCheck || showImportCart || showCashLedger || showCheckout || showCashModal || showReceipts || showChangePasswordModal || showLogoutConfirm) {\r\n        return;\r\n      }\r\n\r\n      // Don't handle if user is typing in an input field (unless it's specific navigation keys)\r\n      const isInputFocused = e.target && (\r\n        e.target.tagName === 'INPUT' || \r\n        e.target.tagName === 'TEXTAREA' ||\r\n        e.target.isContentEditable\r\n      );\r\n\r\n      // Only handle navigation keys if not in input or if editing cart item\r\n      const navigationKeys = ['ArrowUp', 'ArrowDown', 'Enter', 'Escape'];\r\n      const editKeys = ['e', 'E', 'd', 'D'];\r\n      const quantityKeys = ['=', '-'];\r\n      \r\n      if (isInputFocused && editingCartItem === null && !navigationKeys.includes(e.key) && !editKeys.includes(e.key) && !quantityKeys.includes(e.key)) {\r\n        return;\r\n      }\r\n\r\n      // Handle Escape key for editing state (but let shortcut handler handle modal closing)\r\n      if (e.key === 'Escape' && editingCartItem !== null) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        setEditingCartItem(null);\r\n        return;\r\n      }\r\n\r\n      // Handle Enter key for editing state\r\n      if (e.key === 'Enter' && editingCartItem !== null) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        handleEditQuantity(editingCartItem, editQty);\r\n        setEditingCartItem(null);\r\n        return;\r\n      }\r\n\r\n      // Handle arrow keys - allow navigation even when SKU input is focused\r\n      const isSkuInput = e.target === skuInputRef.current;\r\n      const isArrowKey = e.key === 'ArrowUp' || e.key === 'ArrowDown';\r\n      const isQuantityKey = e.key === '=' || e.key === '-';\r\n      \r\n      if (isArrowKey && (isSkuInput || !isInputFocused || editingCartItem !== null)) {\r\n        switch (e.key) {\r\n          case 'ArrowUp':\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          setSelectedCartIdx(prev => prev > 0 ? prev - 1 : cart.length - 1);\r\n          break;\r\n          case 'ArrowDown':\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          setSelectedCartIdx(prev => prev < cart.length - 1 ? prev + 1 : 0);\r\n          break;\r\n          // E and D keys removed - now using F1 and F2 instead\r\n          default:\r\n            break;\r\n        }\r\n      }\r\n      \r\n      // Handle quantity keys (= and -) even when SKU input is focused\r\n      if (isQuantityKey && (isSkuInput || !isInputFocused || editingCartItem !== null)) {\r\n        if (cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length) {\r\n          if (e.key === '=') {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            handleIncrementQuantity();\r\n          } else if (e.key === '-') {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            handleDecrementQuantity();\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    // Use bubble phase (after shortcuts hook which uses capture)\r\n    window.addEventListener('keydown', handleKeyDown, false);\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyDown, false);\r\n    };\r\n  }, [cart.length, selectedCartIdx, editingCartItem, editQty, showDiscount, showPriceCheck, showImportCart, showCashLedger, showCheckout, showCashModal, showReceipts, showChangePasswordModal, showLogoutConfirm, handleIncrementQuantity, handleDecrementQuantity]);\r\n\r\n  // Reset selected index when cart changes\r\n  useEffect(() => {\r\n    if (cart.length === 0) {\r\n      setSelectedCartIdx(0);\r\n    } else {\r\n      setSelectedCartIdx(prev => Math.min(prev, cart.length - 1));\r\n    }\r\n  }, [cart.length]);\r\n\r\n\r\n  // Pause scanner when any modal is open to avoid hardware scanner/keyboard events interfering with shortcuts\r\n  useEffect(() => {\r\n    const anyModalOpen =\r\n      showDiscount ||\r\n      showPriceCheck ||\r\n      showImportCart ||\r\n      showCashLedger ||\r\n      showCheckout ||\r\n      showCashModal ||\r\n      showReceipts ||\r\n      showChangePasswordModal ||\r\n      showLogoutConfirm;\r\n    \r\n    setScannerPaused(anyModalOpen);\r\n    \r\n    // When modals close, refocus SKU input after a delay (but not if user is interacting with other elements)\r\n    if (!anyModalOpen) {\r\n      const timer = setTimeout(() => {\r\n        const activeElement = document.activeElement;\r\n        const isInputFocused = activeElement && (\r\n          activeElement.tagName === 'INPUT' || \r\n          activeElement.tagName === 'TEXTAREA' ||\r\n          activeElement.isContentEditable ||\r\n          activeElement.tagName === 'BUTTON'\r\n        );\r\n        // Only refocus if user isn't actively clicking buttons or using inputs\r\n        if (!isInputFocused && document.body === activeElement) {\r\n          skuInputRef.current?.focus();\r\n        }\r\n      }, 300);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [\r\n    showDiscount,\r\n    showPriceCheck,\r\n    showImportCart,\r\n    showCashLedger,\r\n    showCheckout,\r\n    showCashModal,\r\n    showReceipts,\r\n    showChangePasswordModal,\r\n    showLogoutConfirm,\r\n  ]);\r\n\r\n  const subtotal = cart.reduce(\r\n    (sum, item) => sum + item.price * item.quantity,\r\n    0\r\n  );\r\n  \r\n  // Calculate total with discount\r\n  // IMPORTANT: In the Philippines, PWD/Senior Citizen discounts only apply to basic necessities\r\n  // Calculate subtotals separately for basic necessities and other items\r\n  const basicNecessitySubtotal = cart\r\n    .filter(item => item.is_basic_necessity === true)\r\n    .reduce((sum, item) => sum + item.price * item.quantity, 0);\r\n  const otherItemsSubtotal = subtotal - basicNecessitySubtotal;\r\n  \r\n  let total = subtotal;\r\n  if (appliedDiscount) {\r\n    if (appliedDiscount.type === \"percentage\") {\r\n      const discountValue = Number(appliedDiscount.value);\r\n      if (!isNaN(discountValue) && discountValue > 0) {\r\n        // Apply discount only to basic necessity items\r\n        const discountAmount = basicNecessitySubtotal * (discountValue / 100);\r\n        total = Math.max(0, basicNecessitySubtotal - discountAmount + otherItemsSubtotal);\r\n      } else {\r\n        console.warn(\"Invalid discount value:\", appliedDiscount.value, \"for discount:\", appliedDiscount);\r\n      }\r\n    } else if (appliedDiscount.type === \"amount\") {\r\n      const discountValue = Number(appliedDiscount.value);\r\n      if (!isNaN(discountValue) && discountValue > 0) {\r\n        // Apply discount only to basic necessity items (capped at basic necessity subtotal)\r\n        const discountAmount = Math.min(discountValue, basicNecessitySubtotal);\r\n        total = Math.max(0, basicNecessitySubtotal - discountAmount + otherItemsSubtotal);\r\n      } else {\r\n        console.warn(\"Invalid discount value:\", appliedDiscount.value, \"for discount:\", appliedDiscount);\r\n      }\r\n    }\r\n  }\r\n\r\n  const completeTransactionCall = async (transId) => {\r\n    if (!transId) return;\r\n    try {\r\n      const resp = await api(`/api/sales/${transId}/complete`, {\r\n        method: \"POST\",\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      return resp;\r\n    } catch (err) {\r\n      console.error(\"Failed to complete transaction:\", err);\r\n      setError(\"Failed to complete transaction\");\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const handleCheckout = async (\r\n    paymentType = \"cash\",\r\n    moneyReceived = total\r\n  ) => {\r\n    if (cart.length === 0) return;\r\n    setError(\"\");\r\n    try {\r\n      const body = {\r\n        transaction_id: transactionId || null,\r\n        transaction_number: transactionNumber || null,\r\n        items: cart.map((i) => ({\r\n          product_id: i.product_id,\r\n          quantity: i.quantity,\r\n        })),\r\n        payment_type: paymentType,\r\n        money_received: moneyReceived,\r\n        discount_id: appliedDiscount?.discount_id || null,\r\n        discount_percentage: appliedDiscount?.type === \"percentage\" ? Number(appliedDiscount.value) : null,\r\n        discount_amount: appliedDiscount?.type === \"amount\" ? Number(appliedDiscount.value) : null,\r\n      };\r\n      const resp = await api(\"/api/sales/checkout\", {\r\n        method: \"POST\",\r\n        headers: { Authorization: `Bearer ${token}` },\r\n        body: JSON.stringify(body),\r\n      });\r\n      if (resp?.transaction_number)\r\n        setTransactionNumber(resp.transaction_number);\r\n      if (resp?.transaction_id) setTransactionId(resp.transaction_id);\r\n\r\n      // Removed redundant call to completeTransaction endpoint as checkout already sets status and cashier_user_id\r\n      // if (resp?.transaction_id) {\r\n      //   await completeTransactionCall(resp.transaction_id);\r\n      // }\r\n\r\n      setCart([]);\r\n      try {\r\n        const url = new URL(window.location.origin + \"/receipt\");\r\n        if (resp?.transaction_number)\r\n          url.searchParams.set(\"tn\", resp.transaction_number);\r\n        if (resp?.transaction_id)\r\n          url.searchParams.set(\"tid\", String(resp.transaction_id));\r\n        if (resp?.total != null)\r\n          url.searchParams.set(\"total\", String(resp.total));\r\n        navigate(url.pathname + url.search);\r\n      } catch (_) {}\r\n      // Start a fresh provisional transaction number after successful checkout\r\n      const businessId = user?.businessId || user?.business_id || \"BIZ\";\r\n      const timePart = new Date()\r\n        .toISOString()\r\n        .replace(/[-:T.Z]/g, \"\")\r\n        .slice(0, 14);\r\n      const randPart = Math.floor(1000 + Math.random() * 9000);\r\n      setTransactionNumber(\r\n        `T-${businessId.toString().padStart(2, \"0\")}-${timePart}-${randPart}`\r\n      );\r\n      setAppliedDiscount(null);\r\n      setTransactionId(null);\r\n    } catch (err) {\r\n      // Extract error message from response if available\r\n      const errorMessage = err?.response?.data?.error || err?.data?.error || err?.message || \"Checkout failed\";\r\n      setError(errorMessage);\r\n    }\r\n  };\r\n\r\n  const handleCopyTn = () => {\r\n    navigator.clipboard.writeText(user.store_name);\r\n  };\r\n\r\n  const focusSkuInput = () => {\r\n    skuInputRef.current?.focus();\r\n    skuInputRef.current?.select?.();\r\n  };\r\n\r\n  const focusQuantityInput = () => {\r\n    quantityInputRef.current?.focus();\r\n    quantityInputRef.current?.select?.();\r\n  };\r\n\r\n  const handleNewTransaction = () => {\r\n    setCart([]);\r\n    setAppliedDiscount(null);\r\n    setTransactionId(null);\r\n    setError(\"\");\r\n    focusSkuInput();\r\n  };\r\n\r\n  const handleVoidSelected = () => {\r\n    if (cart.length === 0 || selectedCartIdx == null) return;\r\n    handleRemove(selectedCartIdx);\r\n  };\r\n\r\n  const handleSetQuantityShortcut = () => {\r\n    if (cart.length === 0 || selectedCartIdx == null) return;\r\n    const current = cart[selectedCartIdx];\r\n    const nextQty = Number(\r\n      window.prompt(\r\n        `Set quantity for ${current.name || current.sku}:`,\r\n        current.quantity\r\n      )\r\n    );\r\n    if (!Number.isNaN(nextQty) && nextQty > 0) {\r\n      handleEditQuantity(selectedCartIdx, nextQty);\r\n    }\r\n  };\r\n\r\n  const handleRemoveDiscount = () => {\r\n    if (appliedDiscount) {\r\n      setAppliedDiscount(null);\r\n    }\r\n  };\r\n\r\n  // Handler for edit quantity (F1)\r\n  const handleEditQuantityShortcut = () => {\r\n    if (cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length) {\r\n      setEditingCartItem(selectedCartIdx);\r\n      setEditQty(String(cart[selectedCartIdx].quantity));\r\n    }\r\n  };\r\n\r\n  // Handler for discount modal toggle (F6) - open/close discount modal\r\n  const handleDiscountToggle = () => {\r\n    setShowDiscount(!showDiscount);\r\n  };\r\n\r\n  const handleUnavailable = (message) => {\r\n    setError(message);\r\n    notificationRef.current?.scrollIntoView?.({ behavior: \"smooth\" });\r\n  };\r\n\r\n  useKeyboardShortcuts(\r\n    [\r\n      // ` (backtick) - focus SKU field\r\n      { key: \"`\", action: focusSkuInput },\r\n      // F1 - edit product quantity\r\n      {\r\n        key: \"f1\",\r\n        action: handleEditQuantityShortcut,\r\n        enabled: cart.length > 0 && selectedCartIdx >= 0,\r\n      },\r\n      // F2 - delete item\r\n      {\r\n        key: \"f2\",\r\n        action: handleVoidSelected,\r\n        enabled: cart.length > 0,\r\n      },\r\n      // F3 - logout\r\n      {\r\n        key: \"f3\",\r\n        description: \"Logout\",\r\n        action: () => setShowLogoutConfirm(true),\r\n      },\r\n      // F4 - add to cart button\r\n      {\r\n        key: \"f4\",\r\n        action: handleAddToCart,\r\n        enabled: !!sku, // Only enable if there's a SKU value\r\n      },\r\n      // F5 - cash ledger\r\n      { key: \"f5\", action: () => setShowCashLedger(true) },\r\n      // F6 - open/close discount modal\r\n      {\r\n        key: \"f6\",\r\n        action: handleDiscountToggle,\r\n      },\r\n      // F7 - price check\r\n      {\r\n        key: \"f7\",\r\n        description: \"Price Check\",\r\n        action: () => {\r\n          setShowPriceCheck(true);\r\n        },\r\n      },\r\n      // F8 - scan customer cart (keep existing)\r\n      {\r\n        key: \"f8\",\r\n        description: \"Scan Customer Cart\",\r\n        action: () => setShowImportCart(true),\r\n      },\r\n      // F9 - receipts\r\n      {\r\n        key: \"f9\",\r\n        description: \"Receipts\",\r\n        action: () => setShowReceipts(true),\r\n      },\r\n      // F10 - change password\r\n      {\r\n        key: \"f10\",\r\n        description: \"Change Password\",\r\n        action: () => setShowChangePasswordModal(true),\r\n      },\r\n      // F11 - remove discount\r\n      {\r\n        key: \"f11\",\r\n        action: handleRemoveDiscount,\r\n        enabled: !!appliedDiscount,\r\n      },\r\n      // F12 - checkout\r\n      {\r\n        key: \"f12\",\r\n        description: \"Checkout\",\r\n        action: () => setShowCheckout(true),\r\n        enabled: cart.length > 0,\r\n      },\r\n      // = (equals) - increment quantity\r\n      {\r\n        key: \"=\",\r\n        action: handleIncrementQuantity,\r\n        enabled: cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length,\r\n      },\r\n      // - (minus) - decrement quantity\r\n      {\r\n        key: \"-\",\r\n        action: handleDecrementQuantity,\r\n        enabled: cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length,\r\n      },\r\n      {\r\n        key: \"escape\",\r\n        description: \"Close Open Modals\",\r\n        action: () => {\r\n          // Only close modals, don't interfere with cart editing (handled separately)\r\n          if (showCheckout) setShowCheckout(false);\r\n          else if (showDiscount) setShowDiscount(false);\r\n          else if (showPriceCheck) setShowPriceCheck(false);\r\n          else if (showImportCart) setShowImportCart(false);\r\n          else if (showCashModal) setShowCashModal(false);\r\n          else if (showCashLedger) setShowCashLedger(false);\r\n          else if (showReceipts) setShowReceipts(false);\r\n          else if (showChangePasswordModal) setShowChangePasswordModal(false);\r\n          else if (showLogoutConfirm) setShowLogoutConfirm(false);\r\n          // Note: Cart item editing escape is handled in the separate keyboard handler\r\n        },\r\n        allowWhileTyping: true,\r\n        stopPropagation: false, // Allow other handlers to process\r\n      },\r\n    ],\r\n    [\r\n      cart.length,\r\n      selectedCartIdx,\r\n      sku,\r\n      appliedDiscount,\r\n      showCheckout,\r\n      showDiscount,\r\n      showPriceCheck,\r\n      showImportCart,\r\n      showCashModal,\r\n      showCashLedger,\r\n      showReceipts,\r\n      showChangePasswordModal,\r\n      showLogoutConfirm,\r\n    ]\r\n  );\r\n\r\n  // show confirmation modal first, perform actual logout in confirmLogout\r\n  const handleLogout = () => {\r\n    setShowLogoutConfirm(true);\r\n  };\r\n\r\n  const confirmLogout = () => {\r\n    sessionStorage.removeItem(\"auth_token\");\r\n    sessionStorage.removeItem(\"user\");\r\n    // close modal then navigate home\r\n    setShowLogoutConfirm(false);\r\n    navigate(\"/\");\r\n  };\r\n\r\n  const handleCloseLogoutModal = () => {\r\n    setShowLogoutConfirm(false);\r\n  };\r\n\r\n  // Handle keyboard events for logout confirmation\r\n  useEffect(() => {\r\n    if (!showLogoutConfirm) return;\r\n\r\n    const handleKeyDown = (e) => {\r\n      // Use stopPropagation to prevent other handlers from interfering\r\n      e.stopPropagation();\r\n      \r\n      if (e.key === 'Escape' || e.key === 'Esc') {\r\n        e.preventDefault();\r\n        handleCloseLogoutModal();\r\n      } else if (e.key === 'Enter') {\r\n        e.preventDefault();\r\n        confirmLogout();\r\n      }\r\n    };\r\n\r\n    // Use capture phase to ensure we get the event first\r\n    document.addEventListener('keydown', handleKeyDown, { capture: true });\r\n    return () => document.removeEventListener('keydown', handleKeyDown, { capture: true });\r\n  }, [showLogoutConfirm]);\r\n\r\n  const headerActions = (\r\n    <div className=\"flex items-center gap-2\">\r\n      <div className=\"hidden md:block text-right mr-2\">\r\n        <div className=\"text-xs text-gray-500 font-medium\">\r\n          {currentTime.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' })}\r\n        </div>\r\n        <div className=\"text-sm font-bold text-gray-700\">\r\n          {currentTime.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}\r\n        </div>\r\n      </div>\r\n      <button\r\n        onClick={() => setShowReceipts(true)}\r\n        className=\"flex items-center gap-2 bg-white/80 backdrop-blur-sm p-1.5 sm:px-3 sm:py-2 rounded-lg border border-gray-200/80 hover:bg-gray-50 transition-colors group relative\"\r\n        title=\"View all receipts (F9)\"\r\n      >\r\n        <div className=\"relative\">\r\n          <BiReceipt className=\"w-5 h-5 text-blue-600\" />\r\n        </div>\r\n        <span className=\"text-sm font-medium text-gray-700 hidden sm:inline\">\r\n          Receipts\r\n        </span>\r\n        <span className=\"hidden sm:inline-block bg-blue-50 text-blue-700 border border-blue-200 text-xs font-bold px-1.5 py-0.5 rounded\">\r\n          F9\r\n        </span>\r\n      </button>\r\n      <button\r\n        onClick={() => setShowChangePasswordModal(true)}\r\n        className=\"p-2 rounded-lg hover:bg-gray-100 transition-colors flex items-center gap-2\"\r\n        title=\"Change Password (F10)\"\r\n      >\r\n        <BiUser className=\"w-5 h-5 text-gray-600\" />\r\n        <span className=\"hidden sm:inline-block bg-gray-100 text-gray-600 border border-gray-200 text-xs font-bold px-1.5 py-0.5 rounded\">F10</span>\r\n      </button>\r\n      <button\r\n        onClick={handleLogout}\r\n        className=\"flex items-center gap-2 p-1.5 sm:px-3 sm:py-2 rounded-lg hover:bg-red-50 transition-colors\"\r\n        title=\"Logout (F3)\"\r\n      >\r\n        <div className=\"relative\">\r\n          <svg\r\n            className=\"w-5 h-5 text-red-600\"\r\n            fill=\"none\"\r\n            stroke=\"currentColor\"\r\n            viewBox=\"0 0 24 24\"\r\n          >\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h6a2 2 0 012 2v1\"\r\n            />\r\n          </svg>\r\n        </div>\r\n        <span className=\"text-sm font-medium text-gray-700 hidden sm:inline\">Logout</span>\r\n        <span className=\"hidden sm:inline-block bg-red-100 text-red-700 border border-red-200 text-[11px] font-bold rounded px-1.5 py-0.5\">\r\n          F3\r\n        </span>\r\n      </button>\r\n    </div>\r\n  );\r\n\r\n  const cardClass = \"bg-white border border-blue-100 rounded-2xl p-6 shadow-lg\";\r\n\r\n  return (\r\n    <div className=\"bg-white min-h-screen\">\r\n      {/* Main Content */}\r\n      <div className=\"flex-1 flex flex-col min-h-screen\">\r\n        {/* Header */}\r\n        <header className=\"flex items-center gap-2 px-4 sm:px-6 py-3 bg-white/90 backdrop-blur-md shadow-md border-b border-gray-200/50 h-[64px] min-h-[64px] max-h-[64px] sticky top-0 z-30\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <span className=\"text-xl sm:text-2xl font-bold text-gray-900 tracking-tight\">\r\n              POS\r\n            </span>\r\n            <span className=\"text-xs sm:text-sm font-semibold text-blue-700 bg-blue-50 border border-blue-200 px-2 py-1 rounded-lg\">\r\n              Cashier ID: {user?.userId || user?.user_id || user?.id || \"N/A\"}\r\n            </span>\r\n          </div>\r\n          <div className=\"flex-1 flex items-center justify-center px-2\">\r\n            <button\r\n              onClick={handleCopyTn}\r\n              title=\"Copy store name\"\r\n              className=\"inline-flex items-center gap-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg px-2.5 py-1.5 shadow-sm hover:bg-blue-100 transition-colors\"\r\n            >\r\n              <svg\r\n                className=\"w-4 h-4\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2M8 16h8a2 2 0 002-2v-6m-10 8l-2 2m2-2l2 2\"\r\n                />\r\n              </svg>\r\n              <span className=\"font-mono text-xs sm:text-sm md:text-base font-bold tracking-wider truncate max-w-[50vw]\">\r\n                {user.store_name}\r\n              </span>\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"ml-auto\">{headerActions}</div>\r\n        </header>\r\n\r\n        {/* Main Area */}\r\n        <main className=\"flex-1 bg-gradient-to-br from-gray-50/50 via-blue-50/30 to-indigo-50/50 overflow-y-auto p-2 sm:p-3 md:p-4 pb-55 lg:pb-4\">\r\n          <div className=\"grid gap-2 sm:gap-3 md:gap-4 h-full grid-cols-1 lg:grid-cols-12\">\r\n            {/* Left Column - Scanner, SKU Form, Transaction */}\r\n            <div className=\"lg:col-span-4 flex flex-col gap-2 sm:gap-3 md:gap-4\">\r\n              {/* ScannerCard */}\r\n              <div className=\"flex-shrink-0\">\r\n                <ScannerCard\r\n                  onScan={async (result) => {\r\n                    const code = result?.[0]?.rawValue;\r\n                    if (!code) return;\r\n                    setScannerPaused(true);\r\n                    if (showPriceCheck) {\r\n                      setPriceCheckSku(code);\r\n                    } else {\r\n                      try {\r\n                        let scannedData;\r\n                        try {\r\n                          scannedData = JSON.parse(code);\r\n                        } catch (e) {\r\n                          scannedData = null;\r\n                        }\r\n                        if (\r\n                          scannedData &&\r\n                          scannedData.t === \"cart\" &&\r\n                          Array.isArray(scannedData.items)\r\n                        ) {\r\n                          // set transactionId from scanned data if present\r\n                          if (scannedData.transaction_id) {\r\n                            setTransactionId(scannedData.transaction_id);\r\n                          }\r\n                          // set transaction_number from scanned data if present\r\n                          if (scannedData.transaction_number) {\r\n                            setTransactionNumber(\r\n                              scannedData.transaction_number\r\n                            );\r\n                          }\r\n                          const items = scannedData.items.map((it) => ({\r\n                            product_id: it.p,\r\n                            quantity: it.q,\r\n                            sku: it.sku || \"\",\r\n                          }));\r\n                          try {\r\n                            const fetchedProducts = await Promise.all(\r\n                              items.map(async (item) => {\r\n                                const res = await api(\r\n                                  `/api/products/${item.product_id}`,\r\n                                  {\r\n                                    headers: {\r\n                                      Authorization: `Bearer ${token}`,\r\n                                    },\r\n                                  }\r\n                                );\r\n                                return {\r\n                                  product_id: item.product_id,\r\n                                  sku: res.sku || item.sku || \"\",\r\n                                  name: res.product_name || \"\",\r\n                                  price: Number(res.selling_price) || 0,\r\n                                  quantity: item.quantity,\r\n                                };\r\n                              })\r\n                            );\r\n                            setCart((prev) => {\r\n                              const byProductId = new Map(\r\n                                prev.map((i) => [i.product_id, i])\r\n                              );\r\n                              for (const it of fetchedProducts) {\r\n                                const existing = byProductId.get(it.product_id);\r\n                                if (existing) {\r\n                                  existing.quantity += it.quantity;\r\n                                } else {\r\n                                  byProductId.set(it.product_id, { ...it });\r\n                                }\r\n                              }\r\n                              return Array.from(byProductId.values());\r\n                            });\r\n                            return;\r\n                          } catch (err) {\r\n                            console.error(\r\n                              \"Error fetching product details for scanned cart:\",\r\n                              err\r\n                            );\r\n                            // fallback to merging raw scanned items without product details\r\n                            setCart((prev) => {\r\n                              const byProductId = new Map(\r\n                                prev.map((i) => [i.product_id, i])\r\n                              );\r\n                              for (const it of items) {\r\n                                const existing = byProductId.get(it.product_id);\r\n                                if (existing) {\r\n                                  existing.quantity += it.quantity;\r\n                                } else {\r\n                                  byProductId.set(it.product_id, {\r\n                                    ...it,\r\n                                    name: \"\",\r\n                                    price: 0,\r\n                                  });\r\n                                }\r\n                              }\r\n                              return Array.from(byProductId.values());\r\n                            });\r\n                            return;\r\n                          }\r\n                        }\r\n                        await addSkuToCart(code, 1);\r\n                      } catch (err) {\r\n                        console.error(\"Error processing scanned code:\", err);\r\n                        await addSkuToCart(code, 1);\r\n                      }\r\n                    }\r\n                  }}\r\n                  paused={scannerPaused}\r\n                  onResume={() => setScannerPaused(false)}\r\n                  textMain=\"text-blue-700\"\r\n                />\r\n              </div>\r\n\r\n              {/* SkuFormCard */}\r\n              <div className=\"flex-shrink-0\">\r\n                <SkuFormCard\r\n                  ref={skuInputRef}\r\n                  sku={sku}\r\n                  setSku={setSku}\r\n                  quantity={quantity}\r\n                  setQuantity={setQuantity}\r\n                  handleAddToCart={handleAddToCart}\r\n                quantityInputRef={quantityInputRef}\r\n                />\r\n                {error && (\r\n                  <div className=\"bg-red-50 border-l-4 border-red-500 rounded-lg p-3 flex items-start gap-2 mt-3 relative animate-in slide-in-from-top-2 duration-300\">\r\n                    <svg\r\n                      className=\"w-4 h-4 text-red-500 flex-shrink-0 mt-0.5\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"\r\n                      />\r\n                    </svg>\r\n                    <p className=\"text-sm font-medium text-red-700 flex-1\">\r\n                      {(() => {\r\n                        try {\r\n                          const parsed = JSON.parse(error);\r\n                          return parsed.error || parsed.message || error;\r\n                        } catch {\r\n                          return error;\r\n                        }\r\n                      })()}\r\n                    </p>\r\n                    <button\r\n                      onClick={() => setError(\"\")}\r\n                      className=\"text-red-400 hover:text-red-600 transition-colors flex-shrink-0 ml-2\"\r\n                      aria-label=\"Dismiss error\"\r\n                    >\r\n                      <svg\r\n                        className=\"w-4 h-4\"\r\n                        fill=\"none\"\r\n                        stroke=\"currentColor\"\r\n                        viewBox=\"0 0 24 24\"\r\n                      >\r\n                        <path\r\n                          strokeLinecap=\"round\"\r\n                          strokeLinejoin=\"round\"\r\n                          strokeWidth={2}\r\n                          d=\"M6 18L18 6M6 6l12 12\"\r\n                        />\r\n                      </svg>\r\n                    </button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Right Column - Cart and Actions */}\r\n            <div className=\"lg:col-span-8 flex flex-col gap-2 sm:gap-3 min-h-0\">\r\n              {/* Transaction Number Display (when loading customer cart) */}\r\n              {transactionId && transactionNumber && (\r\n                <div className=\"bg-blue-50 border border-blue-200 rounded-lg px-4 py-2 flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <svg\r\n                      className=\"w-5 h-5 text-blue-600\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\r\n                      />\r\n                    </svg>\r\n                    <div>\r\n                      <div className=\"text-xs text-blue-600 font-medium\">Customer Transaction</div>\r\n                      <div className=\"text-sm font-bold text-blue-800 font-mono\">{transactionNumber}</div>\r\n                    </div>\r\n                  </div>\r\n                  <button\r\n                    onClick={() => {\r\n                      setTransactionId(null);\r\n                      setTransactionNumber(\"\");\r\n                      setCart([]);\r\n                      setAppliedDiscount(null);\r\n                    }}\r\n                    className=\"text-xs text-blue-600 hover:text-blue-800 underline\"\r\n                    title=\"Start new transaction\"\r\n                  >\r\n                    Clear\r\n                  </button>\r\n                </div>\r\n              )}\r\n              {/* CartTableCard */}\r\n              <div className=\"flex-1 overflow-auto\">\r\n                <CartTableCard\r\n                  cart={cart}\r\n                  handleRemove={handleRemove}\r\n                  handleEditQuantity={(idx, newQuantity) => {\r\n                    const updatedCart = [...cart];\r\n                    updatedCart[idx].quantity = newQuantity;\r\n                    setCart(updatedCart);\r\n                    setEditingCartItem(null);\r\n                  }}\r\n                  total={total}\r\n                  appliedDiscount={appliedDiscount}\r\n                  selectedIdx={selectedCartIdx}\r\n                  onSelectRow={setSelectedCartItem}\r\n                  editingIdx={editingCartItem}\r\n                  editQty={editQty}\r\n                  onEditQtyChange={handleEditQtyChange}\r\n                  onEditComplete={() => setEditingCartItem(null)}\r\n                  onStartEdit={(idx) => setEditingCartItem(idx)}\r\n                  className=\"flex-1 h-full\"\r\n                />\r\n              </div>\r\n\r\n              {/* Action Buttons */}\r\n              <div className=\"grid grid-cols-12 gap-2 sm:gap-3 flex-shrink-0\">\r\n                {appliedDiscount && (\r\n                  <div className=\"col-span-12 flex items-center justify-between bg-emerald-50 border border-emerald-200 text-emerald-800 rounded-lg px-3 py-2\">\r\n                    <span className=\"text-sm font-semibold\">\r\n                      Discount applied: {appliedDiscount.label}\r\n                    </span>\r\n                    <button\r\n                      className=\"text-xs font-bold underline flex items-center gap-1\"\r\n                      onClick={() => setAppliedDiscount(null)}\r\n                    >\r\n                      <span className=\"text-yellow-600\">(F11)</span> Remove\r\n                    </button>\r\n                  </div>\r\n                )}\r\n                {/* Grouped Buttons */}\r\n                <div className=\"col-span-8\">\r\n                  <div className=\"grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3\">\r\n                    <Button\r\n                      label={<ButtonLabel text=\"CASH LEDGER\" shortcut=\"F5\" />}\r\n                      size=\"md\"\r\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\r\n                      variant=\"secondary\"\r\n                      microinteraction\r\n                      onClick={() => setShowCashLedger(true)}\r\n                      icon={\r\n                        <svg\r\n                          className=\"w-4 h-4\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                          />\r\n                        </svg>\r\n                      }\r\n                      iconPosition=\"left\"\r\n                    />\r\n                    <div className=\"relative group w-full\">\r\n                      <Button\r\n                        label={\r\n                          appliedDiscount\r\n                            ? <ButtonLabel text=\"REMOVE DISCOUNT\" shortcut=\"F11\" variant=\"secondary\" />\r\n                            : <ButtonLabel text=\"DISCOUNT\" shortcut=\"F6\" />\r\n                        }\r\n                        size=\"md\"\r\n                        className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\r\n                        onClick={() => {\r\n                          if (appliedDiscount) {\r\n                            if (window.confirm(`Remove ${appliedDiscount.label || 'discount'}?`)) {\r\n                              setAppliedDiscount(null);\r\n                            }\r\n                          } else {\r\n                            setShowDiscount(true);\r\n                          }\r\n                        }}\r\n                        variant=\"secondary\"\r\n                        microinteraction\r\n                        icon={\r\n                          appliedDiscount ? (\r\n                            <svg\r\n                              className=\"w-5 h-5\"\r\n                              fill=\"none\"\r\n                              stroke=\"currentColor\"\r\n                              viewBox=\"0 0 24 24\"\r\n                            >\r\n                              <path\r\n                                strokeLinecap=\"round\"\r\n                                strokeLinejoin=\"round\"\r\n                                strokeWidth={2}\r\n                                d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"\r\n                              />\r\n                            </svg>\r\n                          ) : (\r\n                            <svg\r\n                              className=\"w-4 h-4\"\r\n                              fill=\"none\"\r\n                              stroke=\"currentColor\"\r\n                              viewBox=\"0 0 24 24\"\r\n                            >\r\n                              <path\r\n                                strokeLinecap=\"round\"\r\n                                strokeLinejoin=\"round\"\r\n                                strokeWidth={2}\r\n                                d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                              />\r\n                            </svg>\r\n                          )\r\n                        }\r\n                        iconPosition=\"left\"\r\n                      />\r\n                      {appliedDiscount && (\r\n                        <div className=\"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10\">\r\n                          Click to remove discount\r\n                          <div className=\"absolute bottom-0 left-1/2 w-2 h-2 bg-gray-800 transform -translate-x-1/2 translate-y-1/2 rotate-45\"></div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <Button\r\n                      label={<ButtonLabel text=\"PRICE CHECK\" shortcut=\"F7\" />}\r\n                      size=\"md\"\r\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\r\n                      onClick={() => setShowPriceCheck(true)}\r\n                      variant=\"secondary\"\r\n                      microinteraction\r\n                      icon={\r\n                        <svg\r\n                          className=\"w-4 h-4\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                          />\r\n                        </svg>\r\n                      }\r\n                      iconPosition=\"left\"\r\n                    />\r\n                    <Button\r\n                      label={<ButtonLabel text=\"SCAN CUSTOMER QR\" shortcut=\"F8\" />}\r\n                      size=\"md\"\r\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\r\n                      onClick={() => setShowImportCart(true)}\r\n                      variant=\"secondary\"\r\n                      microinteraction\r\n                      icon={\r\n                        <svg\r\n                          className=\"w-4 h-4\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12\"\r\n                          />\r\n                        </svg>\r\n                      }\r\n                      iconPosition=\"left\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Checkout Button */}\r\n                <div className=\"col-span-4\">\r\n                  <Button\r\n                    label={<ButtonLabel text=\"CHECKOUT\" shortcut=\"F12\" variant=\"primary\" />}\r\n                    size=\"md\"\r\n                    className=\"w-full h-full text-sm sm:text-base font-bold\"\r\n                    variant=\"primary\"\r\n                    microinteraction\r\n                    onClick={() => setShowCheckout(true)}\r\n                    disabled={cart.length === 0}\r\n                    icon={\r\n                      <svg\r\n                        className=\"w-5 h-5\"\r\n                        fill=\"none\"\r\n                        stroke=\"currentColor\"\r\n                        viewBox=\"0 0 24 24\"\r\n                      >\r\n                        <path\r\n                          strokeLinecap=\"round\"\r\n                          strokeLinejoin=\"round\"\r\n                          strokeWidth={2}\r\n                          d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                        />\r\n                      </svg>\r\n                    }\r\n                    iconPosition=\"left\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n        </main>\r\n\r\n        {/* Modals */}\r\n        {showLogoutConfirm && (\r\n          <div className=\"fixed inset-0 z-90 flex items-center justify-center\">\r\n            <div\r\n              className=\"absolute inset-0 bg-black/80 z-90\"\r\n              onClick={handleCloseLogoutModal}\r\n            />\r\n            <div \r\n              className=\"relative bg-white rounded-xl shadow-xl w-[92%] max-w-md z-100 p-0\"\r\n              onKeyDown={(e) => {\r\n                // Prevent event from bubbling up to document\r\n                e.stopPropagation();\r\n                \r\n                // Handle Enter key specifically for the modal\r\n                if (e.key === 'Enter' && !e.isPropagationStopped()) {\r\n                  e.preventDefault();\r\n                  confirmLogout();\r\n                }\r\n              }}\r\n            >\r\n              {/* Header Section */}\r\n              <div className=\"bg-gradient-to-r from-red-50 via-red-50/80 to-orange-50/50 border-b border-red-100 px-6 py-5 rounded-t-2xl\">\r\n                <div className=\"flex items-center gap-4\">\r\n                  <div className=\"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg\">\r\n                    <svg\r\n                      className=\"w-6 h-6 text-white\"\r\n                      fill=\"none\"\r\n                      stroke=\"white\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeWidth=\"2\"\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"\r\n                      />\r\n                    </svg>\r\n                  </div>\r\n                  <div className=\"flex-1\">\r\n                    <h2 className=\"text-xl font-bold text-gray-900 mb-1\">\r\n                      Confirm Logout\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-600\">\r\n                      Are you sure you want to log out? <span className=\"text-xs opacity-70\">(Press Esc to cancel, Enter to confirm)</span>\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Content Section */}\r\n              <div className=\"p-6\">\r\n                <p className=\"text-sm text-gray-700 mb-6\">\r\n                  You will be redirected to the login page and your session will\r\n                  end.\r\n                </p>\r\n\r\n                {/* Action Buttons */}\r\n                <div className=\"flex justify-end gap-3\">\r\n                  <button\r\n                    onClick={handleCloseLogoutModal}\r\n                    className=\"px-5 py-2.5 rounded-lg text-sm font-semibold text-gray-700 bg-white border-2 border-gray-300 hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\r\n                    autoFocus\r\n                  >\r\n                    Cancel (Esc)\r\n                  </button>\r\n                  <button\r\n                    onClick={confirmLogout}\r\n                    className=\"px-5 py-2.5 rounded-lg text-sm font-semibold text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 shadow-md hover:shadow-lg transition-all duration-200 flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\r\n                  >\r\n                    <svg\r\n                      className=\"w-5 h-5\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeWidth=\"2\"\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"\r\n                      />\r\n                    </svg>\r\n                    Logout (Enter)\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n        <DiscountModal\r\n          isOpen={showDiscount}\r\n          onClose={() => setShowDiscount(false)}\r\n          onApplyDiscount={(discount) => {\r\n            setAppliedDiscount(discount);\r\n            setShowDiscount(false);\r\n          }}\r\n        />\r\n        <PriceCheckModal\r\n          isOpen={showPriceCheck}\r\n          onClose={() => setShowPriceCheck(false)}\r\n          sku={priceCheckSku}\r\n          setSku={setPriceCheckSku}\r\n        />\r\n        <CashLedgerModal\r\n          isOpen={showCashLedger}\r\n          onClose={() => setShowCashLedger(false)}\r\n        />\r\n        <CheckoutModal\r\n          isOpen={showCheckout}\r\n          onClose={() => setShowCheckout(false)}\r\n          total={total}\r\n          onSelectPayment={(method) => {\r\n            setSelectedPayment(method);\r\n            setShowCheckout(false);\r\n            if (method === \"cash\") {\r\n              setShowCashModal(true);\r\n            } else {\r\n              if (method === \"gcash\") {\r\n                (async () => {\r\n                  try {\r\n                    const successUrl =\r\n                      window.location.origin + \"/pos?payment=success\";\r\n                    const cancelUrl =\r\n                      window.location.origin + \"/pos?payment=cancel\";\r\n                    // persist cart to finalize after redirect back\r\n                    localStorage.setItem(\r\n                      \"pending_gcash_cart\",\r\n                      JSON.stringify({\r\n                        items: cart.map((i) => ({\r\n                          product_id: i.product_id,\r\n                          quantity: i.quantity,\r\n                        })),\r\n                        total,\r\n                        transactionId: transactionId,\r\n                        transactionNumber: transactionNumber,\r\n                        discount_id: appliedDiscount?.discount_id || null,\r\n                        discount_percentage: appliedDiscount?.type === \"percentage\" ? Number(appliedDiscount.value) : null,\r\n                        discount_amount: appliedDiscount?.type === \"amount\" ? Number(appliedDiscount.value) : null,\r\n                      })\r\n                    );\r\n                    const { checkoutUrl } = await createGcashCheckout({\r\n                      amount: Number(total || 0),\r\n                      description: \"POS Order\",\r\n                      referenceNumber: transactionNumber || `POS-${Date.now()}`,\r\n                      cancelUrl,\r\n                      successUrl,\r\n                    });\r\n                    window.open(checkoutUrl, '_blank');\r\n                  } catch (e) {\r\n                    setError(\"Failed to init GCash\");\r\n                    localStorage.removeItem(\"pending_gcash_cart\");\r\n                  }\r\n                })();\r\n              } else if (method === \"maya\") {\r\n                (async () => {\r\n                  try {\r\n                    const successUrl =\r\n                      window.location.origin + \"/pos?payment=success\";\r\n                    const cancelUrl =\r\n                      window.location.origin + \"/pos?payment=cancel\";\r\n                    // persist cart to finalize after redirect back\r\n                    localStorage.setItem(\r\n                      \"pending_maya_cart\",\r\n                      JSON.stringify({\r\n                        items: cart.map((i) => ({\r\n                          product_id: i.product_id,\r\n                          quantity: i.quantity,\r\n                        })),\r\n                        total,\r\n                        transactionId: transactionId,\r\n                        transactionNumber: transactionNumber,\r\n                        discount_id: appliedDiscount?.discount_id || null,\r\n                        discount_percentage: appliedDiscount?.type === \"percentage\" ? Number(appliedDiscount.value) : null,\r\n                        discount_amount: appliedDiscount?.type === \"amount\" ? Number(appliedDiscount.value) : null,\r\n                      })\r\n                    );\r\n                    const { checkoutUrl } = await createMayaCheckout({\r\n                      amount: Number(total || 0),\r\n                      description: \"POS Order\",\r\n                      referenceNumber: transactionNumber || `POS-${Date.now()}`,\r\n                      cancelUrl,\r\n                      successUrl,\r\n                    });\r\n                    window.open(checkoutUrl, '_blank');\r\n                  } catch (e) {\r\n                    setError(\"Failed to init Maya\");\r\n                    localStorage.removeItem(\"pending_maya_cart\");\r\n                  }\r\n                })();\r\n              } else {\r\n                // For other payment methods, fall back to existing checkout flow\r\n                handleCheckout(method);\r\n              }\r\n            }\r\n          }}\r\n        />\r\n        <CashPaymentModal\r\n          isOpen={showCashModal}\r\n          onClose={() => setShowCashModal(false)}\r\n          total={total}\r\n          onConfirm={(amountReceived) => {\r\n            handleCheckout(\"cash\", amountReceived);\r\n            setShowCashModal(false);\r\n          }}\r\n        />\r\n        <QuantityInputModal\r\n          isOpen={showQuantityModal}\r\n          onClose={() => {\r\n            setShowQuantityModal(false);\r\n            setPendingProduct(null);\r\n            // Auto-focus SKU input after closing modal\r\n            setTimeout(() => {\r\n              skuInputRef.current?.focus();\r\n            }, 50);\r\n          }}\r\n          product={pendingProduct}\r\n          onConfirm={handleQuantityConfirm}\r\n          existingQuantity={\r\n            pendingProduct\r\n              ? cart.find((item) => item.product_id === pendingProduct.product_id)\r\n                  ?.quantity || 0\r\n              : 0\r\n          }\r\n        />\r\n        <ScanCustomerCartModal\r\n          isOpen={showImportCart}\r\n          onClose={() => setShowImportCart(false)}\r\n          onImport={async (items, transactionId, completionResponse, transactionNumber) => {\r\n            try {\r\n              // If transaction was completed (completionResponse exists), navigate to receipt\r\n              if (completionResponse && transactionId) {\r\n                setCart([]);\r\n                setTransactionId(null);\r\n                setTransactionNumber(null);\r\n                setError(\"\");\r\n                setShowImportCart(false);\r\n                // Navigate to receipt page for cashier\r\n                window.location.href = `/receipt?tn=${completionResponse.transaction_number || transactionId}`;\r\n                return;\r\n              }\r\n              \r\n              // If transactionId is provided, this is a pending transaction being loaded\r\n              if (transactionId && items && items.length > 0) {\r\n                // Store transaction info\r\n                setTransactionId(transactionId);\r\n                if (transactionNumber) {\r\n                  setTransactionNumber(transactionNumber);\r\n                }\r\n                \r\n                // Items from pending transaction already have all product details\r\n                // Replace cart with these items (don't merge, since we're loading a specific transaction)\r\n                setCart(items);\r\n                setError(\"\");\r\n                setShowImportCart(false);\r\n                return;\r\n              }\r\n              \r\n              // Otherwise, import items (backward compatibility for old QR format)\r\n              if (!items || items.length === 0) {\r\n                setError(\"No items found in QR code\");\r\n                return;\r\n              }\r\n              \r\n              console.log(\"Scanned items:\", items);\r\n              // Fetch product details by product_id for all scanned items concurrently\r\n              const fetchedProducts = await Promise.all(\r\n                items.map(async (item) => {\r\n                  const res = await api(`/api/products/${item.product_id}`, {\r\n                    headers: { Authorization: `Bearer ${token}` },\r\n                  });\r\n                  console.log(\r\n                    \"Fetched product for id\",\r\n                    item.product_id,\r\n                    \":\",\r\n                    res\r\n                  );\r\n                  return {\r\n                    product_id: item.product_id,\r\n                    sku: res.sku || item.sku || \"\",\r\n                    name: res.product_name || \"\",\r\n                    price: Number(res.selling_price) || 0,\r\n                    quantity: item.quantity,\r\n                  };\r\n                })\r\n              );\r\n              setCart((prev) => {\r\n                const bySku = new Map(prev.map((i) => [i.sku, i]));\r\n                for (const it of fetchedProducts) {\r\n                  const existing = bySku.get(it.sku);\r\n                  if (existing) existing.quantity += it.quantity;\r\n                  else bySku.set(it.sku, { ...it });\r\n                }\r\n                return Array.from(bySku.values());\r\n              });\r\n            } catch (e) {\r\n              console.error(\"Error fetching products for scanned items:\", e);\r\n              // Fallback to use raw items if fetch fails\r\n              setCart((prev) => {\r\n                const bySku = new Map(prev.map((i) => [i.sku, i]));\r\n                for (const it of items) {\r\n                  const existing = bySku.get(it.sku);\r\n                  if (existing) existing.quantity += it.quantity;\r\n                  else bySku.set(it.sku, { ...it });\r\n                }\r\n                return Array.from(bySku.values());\r\n              });\r\n            }\r\n          }}\r\n        />\r\n        <RecentReceiptsModal\r\n          isOpen={showReceipts}\r\n          onClose={() => setShowReceipts(false)}\r\n        />\r\n        <ChangePasswordModal\r\n          isOpen={showChangePasswordModal}\r\n          onClose={() => setShowChangePasswordModal(false)}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default CashierPOS;\r\n"],"names":["RecentReceiptsModal","isOpen","onClose","receipts","setReceipts","useState","loading","setLoading","error","setError","selectedIndex","setSelectedIndex","containerRef","useRef","modalContentRef","useEffect","async","token","sessionStorage","getItem","data","api","headers","Authorization","Array","isArray","e","fetchReceipts","openReceipt","receipt","url","URL","window","location","origin","transaction_number","searchParams","set","transaction_id","String","open","toString","useCallback","index","handleKeyDown","length","preventDefault","key","prev","newIndex","setTimeout","items","current","querySelectorAll","focus","preventScroll","container","selectedElement","children","containerRect","getBoundingClientRect","elementRect","top","scrollBy","bottom","handleKeyDownEvent","includes","addEventListener","removeEventListener","jsxs","BaseModal","title","subtitle","size","contentRef","footer","jsx","Button","label","variant","onClick","className","ref","tabIndex","role","map","r","idx","onFocus","Date","updated_at","created_at","toLocaleString","Number","total_amount","total","toFixed","payment","method","payment_type","discount_percentage","discount_amount","ButtonLabel","text","shortcut","CashierPOS","navigate","useNavigate","sku","setSku","priceCheckSku","setPriceCheckSku","quantity","setQuantity","cart","setCart","appliedDiscount","setAppliedDiscount","showDiscount","setShowDiscount","showPriceCheck","setShowPriceCheck","showImportCart","setShowImportCart","showCashLedger","setShowCashLedger","showCheckout","setShowCheckout","selectedPayment","setSelectedPayment","showCashModal","setShowCashModal","darkMode","setDarkMode","scannerPaused","setScannerPaused","showLogoutConfirm","setShowLogoutConfirm","transactionNumber","setTransactionNumber","transactionId","setTransactionId","timer","clearTimeout","showReceipts","setShowReceipts","showChangePasswordModal","setShowChangePasswordModal","isMobileNavOpen","setIsMobileNavOpen","selectedCartIdx","setSelectedCartIdx","editingCartItem","setEditingCartItem","editQty","setEditQty","showQuantityModal","setShowQuantityModal","pendingProduct","setPendingProduct","skuInputRef","quantityInputRef","currentTime","setCurrentTime","setInterval","clearInterval","user","JSON","parse","hasFinalizedRef","React","businessId","business_id","timePart","toISOString","replace","slice","randPart","Math","floor","random","padStart","status","URLSearchParams","search","get","isNewTab","opener","closed","finalizeOnlinePayment","pendingCartKey","paymentType","pending","localStorage","parsed","guardKey","toLowerCase","setItem","body","money_received","discount_id","resp","stringify","href","close","pathname","_","removeItem","delete","history","replaceState","addSkuToCart","skuValue","qty","encodeURIComponent","product","price","selling_price","stockQty","stock_quantity","product_name","product_type","existingIdx","findIndex","i","product_id","next","newQty","name","is_basic_necessity","err","handleAddToCart","handleRemove","filter","handleIncrementQuantity","item","cartItem","handleDecrementQuantity","currentQty","isInputFocused","target","tagName","isContentEditable","stopPropagation","handleEditQuantity","max","isSkuInput","isArrowKey","isQuantityKey","min","anyModalOpen","activeElement","document","subtotal","reduce","sum","basicNecessitySubtotal","otherItemsSubtotal","type","discountValue","value","isNaN","discountAmount","console","warn","handleCheckout","moneyReceived","response","message","useKeyboardShortcuts","action","focusSkuInput","select","handleEditQuantityShortcut","enabled","handleVoidSelected","description","handleDiscountToggle","handleRemoveDiscount","allowWhileTyping","confirmLogout","handleCloseLogoutModal","capture","headerActions","toLocaleDateString","weekday","month","day","year","toLocaleTimeString","hour","minute","BiReceipt","BiUser","handleLogout","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","userId","user_id","id","handleCopyTn","clipboard","writeText","store_name","ScannerCard","onScan","result","code","rawValue","scannedData","t","it","p","q","fetchedProducts","Promise","all","res","byProductId","Map","existing","from","values","paused","onResume","textMain","SkuFormCard","CartTableCard","newQuantity","updatedCart","selectedIdx","onSelectRow","editingIdx","onEditQtyChange","onEditComplete","onStartEdit","microinteraction","icon","iconPosition","confirm","disabled","onKeyDown","isPropagationStopped","autoFocus","DiscountModal","onApplyDiscount","discount","PriceCheckModal","CashLedgerModal","CheckoutModal","onSelectPayment","successUrl","cancelUrl","checkoutUrl","createGcashCheckout","amount","referenceNumber","now","createMayaCheckout","CashPaymentModal","onConfirm","amountReceived","QuantityInputModal","quantityInBaseUnits","base_unit","pricePerUnit","quantity_per_unit","existingQuantity","find","ScanCustomerCartModal","onImport","completionResponse","log","bySku","ChangePasswordModal"],"mappings":"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"}