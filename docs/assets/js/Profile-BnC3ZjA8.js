import{j as e}from"./utils-L0j39QIW.js";import{a as s,R as r}from"./vendor-DPJ7iNYg.js";import{P as a}from"./PageLayout-Dh8vRTgg.js";import{N as t}from"./Nav-Admin-Cp91K9PG.js";import{C as n}from"./Card-DXlcOk_J.js";import{b as i,a as l,L as o}from"./index-XAdJQoEG.js";import{F as d}from"./FormField-NRg-OFLz.js";import{h as c,i as m,j as u,k as x}from"./index-D5t29eUG.js";import{B as h}from"./BaseModal-Cy73DE2S.js";import{u as b}from"./useKeyboardShortcuts-5Dd6maPO.js";import{g,a as p,b as f,c as y}from"./locationApi-D8IA0i6v.js";import"./Navbar-DOOZTfSt.js";import"./Logo-za3DLZvx.js";import"./PrivacyPolicyModal-SOt_xhw-.js";import"./Input-DoNyYXSI.js";function j({name:r,value:a,options:t=[],placeholder:n="Select an option",onChange:i,error:l,disabled:o=!1,searchable:d=!0,className:h="",required:b=!1}){const[g,p]=s.useState(!1),[f,y]=s.useState(""),[j,v]=s.useState(-1),N=s.useRef(null),w=s.useRef(null),k=t.filter(e=>e.label.toLowerCase().includes(f.toLowerCase()));s.useEffect(()=>{const e=e=>{N.current&&!N.current.contains(e.target)&&(p(!1),y(""),v(-1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),s.useEffect(()=>{const e=e=>{if(g)switch(e.key){case"ArrowDown":e.preventDefault(),v(e=>e<k.length-1?e+1:0);break;case"ArrowUp":e.preventDefault(),v(e=>e>0?e-1:k.length-1);break;case"Enter":e.preventDefault(),j>=0&&j<k.length&&_(k[j]);break;case"Escape":p(!1),y(""),v(-1)}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[g,j,k]);const _=e=>{i({target:{name:r,value:e.value}}),p(!1),y(""),v(-1)},C=t.find(e=>e.value===a);return e.jsxs("div",{className:`relative ${h}`,ref:N,children:[e.jsxs("button",{type:"button",onClick:()=>{o||(p(!g),g?(y(""),v(-1)):setTimeout(()=>w.current?.focus(),100))},disabled:o,className:`\n          w-full px-4 py-3 text-left bg-white border rounded-lg shadow-sm transition-all duration-200\n          flex items-center justify-between\n          ${l?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"}\n          ${o?"bg-gray-50 text-gray-400 cursor-not-allowed":"hover:border-gray-400 focus:ring-2 focus:outline-none"}\n          ${g?"ring-2 ring-blue-500 border-blue-500":""}\n        `,children:[e.jsx("span",{className:"truncate "+(C?"text-gray-900":"text-gray-500"),children:C?C.label:n}),e.jsxs("div",{className:"flex items-center gap-2",children:[C&&e.jsx(c,{className:"w-4 h-4 text-blue-600 flex-shrink-0"}),g?e.jsx(m,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}):e.jsx(u,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]})]}),g&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg animate-in fade-in slide-in-from-top-2 duration-200",children:[d&&t.length>5&&e.jsx("div",{className:"p-3 border-b border-gray-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{ref:w,type:"text",placeholder:"Search options...",value:f,onChange:e=>{y(e.target.value),v(-1)},className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none text-sm"})]})}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:k.length>0?k.map((s,r)=>e.jsxs("button",{type:"button",onClick:()=>_(s),onMouseEnter:()=>v(r),className:`\n                    w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors duration-150\n                    flex items-center justify-between group\n                    ${j===r?"bg-blue-50":""}\n                    ${s.value===a?"bg-blue-50 text-blue-700":"text-gray-900"}\n                  `,children:[e.jsx("span",{className:"truncate",children:s.label}),s.value===a&&e.jsx(c,{className:"w-4 h-4 text-blue-600 flex-shrink-0 ml-2"})]},s.value)):e.jsx("div",{className:"px-4 py-8 text-center text-gray-500 text-sm",children:f?"No options found":"No options available"})}),C&&e.jsxs("div",{className:"px-4 py-2 border-t border-gray-100 bg-gray-50 text-xs text-gray-500",children:["Selected: ",C.label]})]}),l&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),l]})]})}const v=({isOpen:r,onClose:a,userData:t,businessData:n})=>{const[o,c]=s.useState({first_name:t?.first_name||"",last_name:t?.last_name||"",email:t?.email||"",contact_number:t?.contact_number||"",currentPassword:"",newPassword:"",confirmPassword:"",business_name:n?.business_name||"",business_email:n?.email||"",business_type:n?.business_type||"",region:n?.region||"",province:n?.province||"",city:n?.city||"",barangay:n?.barangay||"",house_street:n?.house_number||n?.business_address||n?.address_line||"",country:n?.country||"Philippines"}),[m,u]=s.useState(!1),[x,v]=s.useState(""),[N,w]=s.useState(""),[k,_]=s.useState({}),[C,P]=s.useState({}),[L,S]=s.useState("account"),[E,B]=s.useState({regions:[],provinces:[],cities:[],barangays:[]}),[M,R]=s.useState({regions:!1,provinces:!1,cities:!1,barangays:!1}),A=s.useRef({region:n?.region||"",province:n?.province||"",city:n?.city||"",barangay:n?.barangay||""});s.useEffect(()=>{(t||n)&&(c({first_name:t?.first_name||"",last_name:t?.last_name||"",email:t?.email||"",contact_number:t?.contact_number||"",currentPassword:"",newPassword:"",confirmPassword:"",business_name:n?.business_name||"",business_email:n?.email||"",business_type:n?.business_type||"",region:n?.region||"",province:n?.province||"",city:n?.city||"",barangay:n?.barangay||"",house_street:n?.house_number||n?.business_address||n?.address_line||"",country:n?.country||"Philippines"}),v(""),w(""),_({}),P({}),S("account"))},[t,n,r]);const z=(e,s)=>{if(!s)return null;const r=s.toLowerCase().trim();return e.find(e=>e.label.toLowerCase()===r)||null},D=(e,s,r)=>{const a=e.find(e=>e.value===s);return a?a.label:r||""};s.useEffect(()=>{r&&(async()=>{try{R(e=>({...e,regions:!0}));const e=(await g()).map(e=>({value:e.code,label:e.name}));B(s=>({...s,regions:e}))}catch(e){console.error("Failed to load regions",e)}finally{R(e=>({...e,regions:!1}))}})()},[r]),s.useEffect(()=>{if(E.regions.length&&A.current.region&&!o.region){const e=z(E.regions,A.current.region);e&&c(s=>({...s,region:e.value}))}},[E.regions,o.region]),s.useEffect(()=>{(async()=>{if(o.region)try{R(e=>({...e,provinces:!0}));const e=(await p(o.region)).map(e=>({value:e.code,label:e.name}));if(B(s=>({...s,provinces:e,cities:[],barangays:[]})),A.current.province){const s=z(e,A.current.province);s&&c(e=>({...e,province:s.value}))}}catch(e){console.error("Failed to load provinces",e)}finally{R(e=>({...e,provinces:!1}))}else B(e=>({...e,provinces:[],cities:[],barangays:[]}))})()},[o.region]),s.useEffect(()=>{(async()=>{if(o.province)try{R(e=>({...e,cities:!0}));const e=(await f(o.province)).map(e=>({value:e.code,label:e.name}));if(B(s=>({...s,cities:e,barangays:[]})),A.current.city){const s=z(e,A.current.city);s&&c(e=>({...e,city:s.value}))}}catch(e){console.error("Failed to load cities",e)}finally{R(e=>({...e,cities:!1}))}else B(e=>({...e,cities:[],barangays:[]}))})()},[o.province]),s.useEffect(()=>{(async()=>{if(o.city)try{R(e=>({...e,barangays:!0}));const e=(await y(o.city)).map(e=>({value:e.code,label:e.name}));if(B(s=>({...s,barangays:e})),A.current.barangay){const s=z(e,A.current.barangay);s&&c(e=>({...e,barangay:s.value}))}}catch(e){console.error("Failed to load barangays",e)}finally{R(e=>({...e,barangays:!1}))}else B(e=>({...e,barangays:[]}))})()},[o.city]);const q=(e,s)=>{const r={...k};switch(e){case"first_name":"account"!==L||s.trim()?s.trim().length<2?r.first_name="First name must be at least 2 characters":delete r.first_name:r.first_name="First name is required";break;case"last_name":"account"!==L||s.trim()?s.trim().length<2?r.last_name="Last name must be at least 2 characters":delete r.last_name:r.last_name="Last name is required";break;case"email":"account"!==L||s.trim()?s.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.trim())?r.email="Please enter a valid email":delete r.email:r.email="Email is required";break;case"contact_number":s&&s.trim().length<7?r.contact_number="Phone number must be at least 7 digits":delete r.contact_number;break;case"business_email":s.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.trim())?r.business_email="Please enter a valid email":delete r.business_email;break;case"currentPassword":o.newPassword&&!s?r.currentPassword="Current password is required to change password":delete r.currentPassword;break;case"newPassword":s&&s.length<6?r.newPassword="Password must be at least 6 characters":delete r.newPassword;break;case"confirmPassword":s&&s!==o.newPassword?r.confirmPassword="Passwords do not match":delete r.confirmPassword}_(r)},F=e=>{const{name:s,value:r}=e.target;c(e=>({...e,[s]:r})),C[s]&&q(s,r)},I=e=>{const{name:s,value:r}=e.target;P(e=>({...e,[s]:!0})),q(s,r)},O=async e=>{if(e.preventDefault(),u(!0),v(""),w(""),"security"===L){if(!o.currentPassword||!o.newPassword||!o.confirmPassword)return w("Please fill in all password fields."),void u(!1);if(o.newPassword!==o.confirmPassword)return w("New password and confirmation do not match."),void u(!1)}try{const e=sessionStorage.getItem("auth_token");if("account"===L||"security"===L){const s={first_name:o.first_name,last_name:o.last_name,email:o.email,contact_number:o.contact_number};o.newPassword&&(s.currentPassword=o.currentPassword,s.newPassword=o.newPassword),await l("/api/auth/update-profile",{method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(s)})}else if("business"===L){const s=D(E.regions,o.region,n?.region),r=D(E.provinces,o.province,n?.province),a=D(E.cities,o.city,n?.city),t=D(E.barangays,o.barangay,n?.barangay),i={businessName:o.business_name||void 0,businessType:o.business_type||void 0,businessAddress:[o.house_street,t,a,r,s,o.country||"Philippines"].filter(Boolean).join(", "),houseNumber:o.house_street||void 0,country:o.country||"Philippines",business_email:o.business_email||void 0};await l("/api/business/update-business",{method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(i)})}v("Profile updated successfully!"),setTimeout(()=>{a(),window.location.reload()},2e3)}catch(s){console.error("Failed to update profile:",s),w(s.message||"Failed to update profile. Please try again.")}finally{u(!1)}};return s.useEffect(()=>{r&&(S("account"),c({first_name:t?.first_name||"",last_name:t?.last_name||"",email:t?.email||"",contact_number:t?.contact_number||"",currentPassword:"",newPassword:"",confirmPassword:"",business_name:n?.business_name||"",business_email:n?.email||"",business_type:n?.business_type||"",region:n?.region||"",province:n?.province||"",city:n?.city||"",barangay:n?.barangay||"",house_street:n?.house_number||n?.business_address||n?.address_line||"",country:n?.country||"Philippines"}),_({}),P({}),v(""),w(""))},[r,t,n]),b([{key:"escape",action:a,enabled:r,allowWhileTyping:!0},{key:"enter",action:e=>{r&&(e.preventDefault(),e.stopPropagation(),O(e))},enabled:r&&"security"!==L}],[r,a,O,L]),r?e.jsxs(h,{isOpen:r,onClose:a,title:"Update Password",subtitle:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("p",{children:"Cashiers can only change their password here"})}),footer:e.jsxs("div",{className:"w-full flex gap-2 justify-end",children:[e.jsx(i,{label:"Cancel",variant:"secondary",onClick:a,disabled:m}),e.jsx(i,{label:m?"Saving...":"Save Password (Enter)",variant:"primary",onClick:O,disabled:m})]}),children:[x&&e.jsx("div",{className:"text-sm text-emerald-700 bg-emerald-50 border border-emerald-200 rounded-lg px-3 py-2 mb-3",children:x}),N&&e.jsx("div",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg px-3 py-2 mb-3",children:N}),e.jsxs("div",{className:"flex gap-1 border-b border-slate-200/10 -mx-6 px-6",children:[e.jsxs("button",{onClick:()=>S("account"),className:"px-4 py-2 rounded-t-xl font-medium transition-all duration-200 relative "+("account"===L?"text-blue-600 bg-blue-50/30":"text-slate-500 hover:text-slate-700"),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Account"]}),"account"===L&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full"})]}),e.jsxs("button",{onClick:()=>S("business"),className:"px-4 py-2 rounded-t-xl font-medium transition-all duration-200 relative "+("business"===L?"text-blue-600 bg-blue-50/30":"text-slate-500 hover:text-slate-700"),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),"Business"]}),"business"===L&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full"})]}),e.jsxs("button",{onClick:()=>S("security"),className:"px-4 py-2 rounded-t-xl font-medium transition-all duration-200 relative "+("security"===L?"text-blue-600 bg-blue-50/30":"text-slate-500 hover:text-slate-700"),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"Security"]}),"security"===L&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full"})]})]}),e.jsxs("form",{onSubmit:O,className:"space-y-6",children:["account"===L&&e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-900",children:"Personal Information"}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-slate-200 to-transparent"})]}),e.jsx(d,{label:"First Name",name:"first_name",value:o.first_name,onChange:F,onBlur:I,placeholder:"Enter first name",error:C.first_name&&k.first_name?k.first_name:null,required:!0}),e.jsx(d,{label:"Last Name",name:"last_name",value:o.last_name,onChange:F,onBlur:I,placeholder:"Enter last name",error:C.last_name&&k.last_name?k.last_name:null,required:!0}),e.jsx(d,{label:"Email Address",name:"email",type:"email",value:o.email,onChange:F,onBlur:I,placeholder:"Enter email address",error:C.email&&k.email?k.email:null,required:!0}),e.jsx(d,{label:"Contact Number",name:"contact_number",type:"tel",value:o.contact_number,onChange:F,onBlur:I,placeholder:"Enter phone number",error:C.contact_number&&k.contact_number?k.contact_number:null})]}),"business"===L&&e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-900",children:"Business Information"}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-slate-200 to-transparent"})]}),e.jsx(d,{label:"Business Name",name:"business_name",value:o.business_name,onChange:F,onBlur:I,placeholder:"Enter business name",error:C.business_name&&k.business_name?k.business_name:null}),e.jsx(d,{label:"Business Email",name:"business_email",type:"email",value:o.business_email,onChange:F,onBlur:I,placeholder:"Enter business email",error:C.business_email&&k.business_email?k.business_email:null}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block mb-1 font-medium text-blue-800",children:"Business Type"}),e.jsx(j,{name:"business_type",value:o.business_type,onChange:e=>F(e),options:[{value:"Grocery Store",label:"Grocery Store"},{value:"Retail",label:"Retail"},{value:"Restaurant",label:"Restaurant"},{value:"Cafe",label:"Cafe"},{value:"Pharmacy",label:"Pharmacy"},{value:"Services",label:"Services"},...o.business_type&&!["Grocery Store","Retail","Restaurant","Cafe","Pharmacy","Services"].includes(o.business_type)?[{value:o.business_type,label:o.business_type}]:[]],placeholder:"Select business type",error:C.business_type&&k.business_type?k.business_type:null})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 pt-2",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-900",children:"Business Location"}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-slate-200 to-transparent"})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block mb-1 font-medium text-blue-800",children:"Region"}),e.jsx(j,{name:"region",value:o.region,options:E.regions,onChange:e=>F({target:{name:"region",value:e.target.value}}),placeholder:M.regions?"Loading regions...":"Select Region",disabled:M.regions,error:C.region&&k.region?k.region:null})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block mb-1 font-medium text-blue-800",children:"Province"}),e.jsx(j,{name:"province",value:o.province,options:E.provinces,onChange:e=>F({target:{name:"province",value:e.target.value}}),placeholder:M.provinces?"Loading provinces...":"Select Province",disabled:!o.region||M.provinces,error:C.province&&k.province?k.province:null})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block mb-1 font-medium text-blue-800",children:"City/Municipality"}),e.jsx(j,{name:"city",value:o.city,options:E.cities,onChange:e=>F({target:{name:"city",value:e.target.value}}),placeholder:M.cities?"Loading cities...":"Select City/Municipality",disabled:!o.province||M.cities,error:C.city&&k.city?k.city:null})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block mb-1 font-medium text-blue-800",children:"Barangay"}),e.jsx(j,{name:"barangay",value:o.barangay,options:E.barangays,onChange:e=>F({target:{name:"barangay",value:e.target.value}}),placeholder:M.barangays?"Loading barangays...":"Select Barangay",disabled:!o.city||M.barangays,error:C.barangay&&k.barangay?k.barangay:null})]}),e.jsx(d,{label:"House no./ Street Name / Landmark (optional)",name:"house_street",value:o.house_street,onChange:F,onBlur:I,placeholder:"Enter house number, street, or landmark",error:C.house_street&&k.house_street?k.house_street:null})]}),"security"===L&&e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-900",children:"Change Password"}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-slate-200 to-transparent"})]}),e.jsx("p",{className:"text-xs text-slate-500 bg-amber-50 border border-amber-100/50 rounded-xl px-3 py-2",children:"Leave blank to keep your current password"}),e.jsx(d,{label:"Current Password",name:"currentPassword",type:"password",value:o.currentPassword,onChange:F,onBlur:I,placeholder:"Enter current password",error:C.currentPassword&&k.currentPassword?k.currentPassword:null}),o.newPassword&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-slate-700",children:"Password Strength"}),e.jsx("div",{className:"w-full h-1.5 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-300 "+(o.newPassword.length>=12?"w-full bg-gradient-to-r from-green-500 to-emerald-500":o.newPassword.length>=8?"w-2/3 bg-gradient-to-r from-yellow-500 to-amber-500":"w-1/3 bg-gradient-to-r from-red-500 to-orange-500")})})]}),e.jsx(d,{label:"New Password",name:"newPassword",type:"password",value:o.newPassword,onChange:F,onBlur:I,placeholder:"Min. 6 characters",error:C.newPassword&&k.newPassword?k.newPassword:null}),e.jsx(d,{label:"Confirm Password",name:"confirmPassword",type:"password",value:o.confirmPassword,onChange:F,onBlur:I,placeholder:"Re-enter new password",error:C.confirmPassword&&k.confirmPassword?k.confirmPassword:null})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t border-gray-100 mt-6",children:[e.jsx(i,{label:"Cancel",variant:"secondary",onClick:a,disabled:m,type:"button"}),e.jsx(i,{label:m?"Saving...":"Save Changes",variant:"primary",type:"submit",disabled:m})]})]})]}):null},N=s=>e.jsx("svg",{className:`w-5 h-5 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),w=s=>e.jsx("svg",{className:`w-5 h-5 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),k=s=>e.jsx("svg",{className:`w-5 h-5 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),_=s=>e.jsx("svg",{className:`w-5 h-5 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),C=s=>e.jsx("svg",{className:`w-5 h-5 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),P=s=>e.jsxs("svg",{className:`w-5 h-5 ${s.className||""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),L=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),S=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),E=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),B=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h4a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),M=e=>{const s=e?.business?.business_id||e?.user?.businessId||JSON.parse(sessionStorage.getItem("user")||"{}")?.businessId||JSON.parse(localStorage.getItem("user")||"{}")?.businessId;if(!s)return{url:"N/A",qrSrc:null,businessId:null};const r=new URL(window.location.origin+"/enter-store");r.searchParams.set("business_id",String(s));const a=r.toString(),t=encodeURIComponent(a);return{url:a,qrSrc:`https://api.qrserver.com/v1/create-qr-code/?size=260x260&data=${t}&qzone=2&format=png&_=${Date.now()}`,downloadSrc:`https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${t}&qzone=2&format=png&_=${Date.now()}`,businessId:s}},R=()=>{const[d,c]=s.useState(null),[m,u]=s.useState(!0),[x,h]=s.useState(""),[b,g]=s.useState(!1),[p,f]=s.useState(!1),[y,j]=s.useState({status:"none"}),[R,A]=s.useState(""),[z,D]=s.useState(""),[q,F]=s.useState(!1),[I,O]=s.useState(!1),[U,$]=s.useState(""),[T,W]=s.useState(""),[H,V]=s.useState(!1),Q=e=>e?"cancelled"===e.status?{status:"none"}:e:{status:"none"};s.useEffect(()=>{G(),(async()=>{try{F(!0);const e=await l("/api/business/delete-request"),s=Q(e?.deletion);j(s),A("pending"===s.status&&e?.message||"")}catch(e){D(e?.message||"Could not load deletion status. Please try again.")}finally{F(!1)}})()},[]);const J=e=>{if(!e)return null;const s=(e.business_address||"").split(",").map(e=>e.trim()).filter(Boolean);for(;s.length&&/philippines?/i.test(s[s.length-1]);)s.pop();const r=s.length,a=r>=1?s[r-1]:"",t=r>=2?s[r-2]:"",n=r>=3?s[r-3]:"",i=r>3?s.slice(0,r-3).join(", "):s[0]||"";return{...e,address_line:e.address_line||e.business_address||"",region:e.region||e.regionName||e.region_name||e.region_name||"",province:e.province||e.provinceName||a||"",city:e.city||e.cityName||t||"",barangay:e.barangay||e.barangayName||n||"",house_number:e.house_number||e.houseNumber||i||""}},G=async()=>{try{u(!0),h("");const s=sessionStorage.getItem("auth_token")||localStorage.getItem("auth_token")||localStorage.getItem("token");s&&!sessionStorage.getItem("auth_token")&&sessionStorage.setItem("auth_token",s),console.log("Fetching profile data from /auth/profile");const r=await l("/auth/profile"),a={...r,business:J(r.business)};if(a.business&&!a.business.region)try{if(!locationsCacheRef.current){const e=await l("/location/locations");locationsCacheRef.current=e}const e=Y(locationsCacheRef.current,a.business.province,a.business.city);e&&(a.business.region=e)}catch(e){console.warn("Failed to derive region from locations:",e)}console.log("Profile data received:",a),c(a)}catch(s){console.error("Failed to fetch profile data:",s),h("Failed to load profile information. Please check your connection and try again.")}finally{u(!1)}},Y=(e,s,r)=>{if(!e||!s&&!r)return"";const a=(s||"").toLowerCase().trim(),t=(r||"").toLowerCase().trim();for(const[n,i]of Object.entries(e))for(const e of Object.keys(i.provinces||{})){const s=e.toLowerCase();if(a&&s===a)return n;if(t&&s===t)return n}return""},K=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",X=e.jsxs("div",{className:"flex items-center justify-end gap-2 sm:gap-3",children:[e.jsx(i,{onClick:G,variant:"secondary",size:"sm",icon:e.jsx(L,{}),iconPosition:"left",className:"whitespace-nowrap [&>span]:hidden sm:[&>span]:inline",children:e.jsx("span",{children:"Refresh"})}),e.jsx(i,{variant:"primary",size:"sm",icon:e.jsx(S,{}),iconPosition:"left",onClick:()=>f(!0),className:"whitespace-nowrap [&>span]:hidden sm:[&>span]:inline",children:e.jsx("span",{children:"Edit Profile"})})]});return m?e.jsx(a,{title:"PROFILE",subtitle:"Store and admin credentials",sidebar:e.jsx(t,{}),isSidebarOpen:b,setSidebarOpen:g,className:"bg-gray-50",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(o,{})})}):e.jsxs(a,{title:"PROFILE",subtitle:"",sidebar:e.jsx(t,{}),headerActions:X,isSidebarOpen:b,setSidebarOpen:g,className:"bg-gray-50",children:[e.jsx(v,{isOpen:p,onClose:()=>f(!1),userData:d?.user,businessData:d?.business}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:[x&&e.jsx(n,{className:"bg-gradient-to-br from-red-50 to-orange-50 border-red-200/50",children:e.jsxs("div",{className:"flex items-start gap-4 p-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-900 mb-1",children:"Error Loading Profile"}),e.jsx("p",{className:"text-sm text-red-700",children:x})]})]})}),!m&&!x&&!d&&e.jsx(n,{className:"bg-gradient-to-br from-gray-50 to-blue-50/30 border-gray-200/50",children:e.jsxs("div",{className:"p-8 md:p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-gray-200 to-gray-300 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg",children:e.jsx("svg",{className:"w-10 h-10 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"No Profile Data Available"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Unable to load your profile information. Please try refreshing or check your connection."}),e.jsx(i,{onClick:G,variant:"primary",size:"md",icon:e.jsx(L,{}),iconPosition:"left",children:"Try Again"})]})}),d&&e.jsxs(r.Fragment,{children:[e.jsx(n,{className:"bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 border-blue-200/50 overflow-hidden",children:e.jsx("div",{className:"p-6 md:p-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 md:w-32 md:h-32 bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-2xl flex items-center justify-center text-3xl md:text-4xl font-bold shadow-lg ring-4 ring-white/50",children:d?.user?.first_name?.charAt(0)?.toUpperCase()||"A"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-8 h-8 bg-green-500 rounded-full border-4 border-white flex items-center justify-center",children:e.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 mb-2",children:d?.business?.business_name||"Admin User"}),e.jsxs("p",{className:"text-gray-600 mb-4 flex items-center gap-2",children:[e.jsx(w,{}),e.jsx("span",{className:"truncate",children:d?.user?.email||"N/A"})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-sm font-semibold bg-gradient-to-r from-blue-50 to-indigo-50 text-blue-800 border border-blue-200",children:[e.jsx("div",{className:"w-5 h-5 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(C,{className:"w-3 h-3 text-blue-600"})}),e.jsxs("span",{children:[d?.user?.role?.replace("_"," ").toUpperCase()||"ADMIN",d?.business?.business_type&&` â€¢ ${d.business.business_type}`]})]})})]})]})})}),e.jsx(n,{className:"bg-white shadow-sm",children:e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center mb-6 pb-4 border-b border-gray-200",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl flex items-center justify-center mr-3",children:e.jsx(N,{})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Account Information"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Personal details and credentials"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"First Name"}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-gray-50 to-gray-100/50 px-4 py-3 rounded-xl border border-gray-200/50 group-hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(N,{className:"text-blue-600"})}),e.jsx("span",{className:"text-gray-900 font-medium flex-1",children:d?.user?.first_name||"N/A"})]})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Last Name"}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-gray-50 to-gray-100/50 px-4 py-3 rounded-xl border border-gray-200/50 group-hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(N,{className:"text-blue-600"})}),e.jsx("span",{className:"text-gray-900 font-medium flex-1",children:d?.user?.last_name||"N/A"})]})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Email Address"}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-gray-50 to-gray-100/50 px-4 py-3 rounded-xl border border-gray-200/50 group-hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(w,{className:"text-blue-600"})}),e.jsx("span",{className:"text-gray-900 font-medium flex-1 truncate",children:d?.user?.email||"N/A"})]})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Role"}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-gray-50 to-gray-100/50 px-4 py-3 rounded-xl border border-gray-200/50",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})}),e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-800 border border-blue-200 capitalize",children:d?.user?.role?.replace("_"," ")||"N/A"})]})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Contact Number"}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-gray-50 to-gray-100/50 px-4 py-3 rounded-xl border border-gray-200/50 group-hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(k,{className:"text-green-600"})}),e.jsx("span",{className:"text-gray-900 font-medium flex-1",children:d?.user?.contact_number||"N/A"})]})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Account Created"}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-gray-50 to-gray-100/50 px-4 py-3 rounded-xl border border-gray-200/50 group-hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(_,{className:"text-purple-600"})}),e.jsx("span",{className:"text-gray-900 font-medium flex-1",children:K(d?.user?.created_at)})]})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Last Updated"}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-gray-50 to-gray-100/50 px-4 py-3 rounded-xl border border-gray-200/50 group-hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(_,{className:"text-orange-600"})}),e.jsx("span",{className:"text-gray-900 font-medium flex-1",children:K(d?.user?.updated_at)})]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-xl flex items-center justify-center",children:e.jsx(B,{})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Store Entry QR Code"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Share this QR code for customer self-checkout"})]})]}),e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-blue-50/30 rounded-2xl p-6 border border-gray-200/50",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-2xl blur-xl opacity-20"}),e.jsx("img",{src:M(d).qrSrc,alt:"Store Entry QR",className:"relative w-[260px] h-[260px] border-4 border-white rounded-2xl bg-white shadow-xl"})]}),e.jsxs("div",{className:"flex-1 space-y-4 min-w-0",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"QR Code URL"}),e.jsx("div",{className:"bg-white px-4 py-3 rounded-xl border border-gray-200 break-all text-sm text-gray-700 font-mono",children:M(d).url})]}),e.jsx(i,{variant:"primary",size:"md",icon:e.jsx(E,{}),iconPosition:"left",onClick:async()=>{const{downloadSrc:e,businessId:s}=M(d);if(e)try{const r=await fetch(e);if(!r.ok)throw new Error("Failed to fetch QR code image");const a=await r.blob(),t=window.URL.createObjectURL(a),n=document.createElement("a");n.href=t,n.download=`store-${s||"qr"}.png`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(t)}catch(r){console.error("Error downloading QR code:",r),alert("Failed to download QR code. Please try again.")}else alert("Business ID not found to generate QR code.")},className:"w-full md:w-auto",children:"Download QR Code"})]})]})})]})]})}),e.jsx(n,{className:"bg-white shadow-sm",children:e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center mb-6 pb-4 border-b border-gray-200",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 text-white rounded-xl flex items-center justify-center mr-3",children:e.jsx(C,{})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Store Information"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Business details and credentials"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Business Name"}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-gray-50 to-gray-100/50 px-4 py-3 rounded-xl border border-gray-200/50 group-hover:border-green-300 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(C,{className:"text-green-600"})}),e.jsx("span",{className:"text-gray-900 font-medium flex-1",children:d?.business?.business_name||"N/A"})]})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Business Email"}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-gray-50 to-gray-100/50 px-4 py-3 rounded-xl border border-gray-200/50 group-hover:border-green-300 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(w,{className:"text-blue-600"})}),e.jsx("span",{className:"text-gray-900 font-medium flex-1 truncate",children:d?.business?.email||"N/A"})]})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Region"}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-gray-50 to-gray-100/50 px-4 py-3 rounded-xl border border-gray-200/50 group-hover:border-green-300 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-teal-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(P,{className:"text-teal-600"})}),e.jsx("span",{className:"text-gray-900 font-medium flex-1",children:d?.business?.region||"N/A"})]})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Province"}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-gray-50 to-gray-100/50 px-4 py-3 rounded-xl border border-gray-200/50 group-hover:border-green-300 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(P,{className:"text-emerald-600"})}),e.jsx("span",{className:"text-gray-900 font-medium flex-1",children:d?.business?.province||"N/A"})]})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Business Type"}),e.jsxs("div",{className:"flex items-center gap-3 bg-gradient-to-r from-gray-50 to-gray-100/50 px-4 py-3 rounded-xl border border-gray-200/50 group-hover:border-green-300 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsx("span",{className:"text-gray-900 font-medium flex-1",children:d?.business?.business_type||"N/A"})]})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2",children:"Business Location"}),e.jsx("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100/50 px-4 py-3 rounded-xl border border-gray-200/50",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(P,{className:"text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"City/Municipality"}),e.jsx("div",{className:"text-gray-900 font-medium",children:d?.business?.city||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(P,{className:"text-indigo-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Barangay"}),e.jsx("div",{className:"text-gray-900 font-medium",children:d?.business?.barangay||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx(P,{className:"text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"House no./ Street Name / Landmark (optional)"}),e.jsx("div",{className:"text-gray-900 font-medium",children:[d?.business?.house_number,d?.business?.business_address,d?.business?.landmark].filter(Boolean).join(", ")||"N/A"})]})]})]})})]})]})]})]})}),d?.business?.users&&d.business.users.length>0&&e.jsx(e.Fragment,{children:(()=>{const s=d.business.users.filter(e=>"admin"===e.user_type_name||"cashier"===e.user_type_name||"admin"===e.role||"cashier"===e.role||"business_owner"===e.role);return e.jsx(n,{className:"bg-white shadow-sm",children:e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center mb-6 pb-4 border-b border-gray-200",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br bg-blue-500 text-white rounded-xl flex items-center justify-center mr-3",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Business Team"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["All users associated with this business (",s.length," total)"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:s.map((s,r)=>e.jsxs("div",{className:"group bg-gradient-to-br from-white to-gray-50/50 rounded-2xl p-5 border border-gray-200/50 hover:border-purple-300 hover:shadow-lg transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br bg-blue-500 text-white rounded-xl flex items-center justify-center text-lg font-bold shadow-md ring-2 ring-white",children:s.username?.charAt(0)?.toUpperCase()||"U"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white"})]}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("h4",{className:"font-bold text-gray-900 truncate",children:s.username}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold mt-1 "+("admin"===s.user_type_name||"business_owner"===s.role?"bg-red-100 text-red-800 border border-red-200":"cashier"===s.user_type_name||"cashier"===s.role?"bg-green-100 text-green-800 border border-green-200":"bg-gray-100 text-gray-800 border border-gray-200"),children:s.user_type_name||s.role})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-0.5",children:"Email"}),e.jsx("div",{className:"font-medium text-gray-900 truncate",children:s.email})]})]}),s.contact_number&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(k,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-0.5",children:"Contact"}),e.jsx("div",{className:"font-medium text-gray-900",children:s.contact_number})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-0.5",children:"Joined"}),e.jsx("div",{className:"font-medium text-gray-900",children:K(s.created_at)})]})]})]})]},s.user_id))})]})})})()}),e.jsx(n,{className:"border-red-100 border-2 mt-6",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-3",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-red-900",children:"Delete Your Store"}),e.jsx("p",{className:"text-sm text-red-600",children:"This action cannot be undone after 30 days"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-700",children:"Download all transactions then schedule deletion with a 30-day recovery window."}),R&&e.jsx("div",{className:"text-sm text-emerald-700 bg-emerald-50 border border-emerald-200 rounded-lg px-3 py-2",children:R}),z&&e.jsx("div",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg px-3 py-2",children:z}),"pending"===y.status&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-xs text-gray-700 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Status:"}),e.jsx("span",{className:"px-2 py-1 rounded-full border text-xs",children:y.status||"none"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Scheduled:"})," ",K(y.scheduledFor)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Requested:"})," ",K(y.requestedAt)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Export ready:"})," ",K(y.exportReadyAt)||"N/A"]})]}),e.jsxs("div",{className:"space-y-4",children:[H?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:'Type "DELETE" to confirm'}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500",placeholder:"DELETE",value:U,onChange:e=>$(e.target.value)})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Enter your password to confirm"}),e.jsx("input",{type:"password",className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500",placeholder:"Your account password",value:T,onChange:e=>W(e.target.value),disabled:q})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(i,{label:"Cancel",variant:"secondary",onClick:()=>{V(!1),$(""),W(""),D("")},disabled:q}),e.jsx(i,{label:q?"Processing...":"Confirm Deletion",variant:"danger",onClick:async()=>{if(D(""),A(""),"delete"===U.trim().toLowerCase())if(T){F(!0);try{const e=await l("/api/business/delete-request",{method:"POST",body:JSON.stringify({password:T})});j(e?.deletion||{status:"pending"}),A(e?.message||"Deletion request recorded with a 30-day grace period."),V(!1),W(""),$("")}catch(e){D(e?.message||"Could not request deletion. Please check your password and try again.")}finally{F(!1)}}else D("Please enter your password to confirm deletion.");else D('Type "DELETE" to confirm.')},disabled:q||"delete"!==U.trim().toLowerCase()||!T})]})]})})]}):e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(i,{label:I?"Preparing...":"Download transactions",variant:"secondary",onClick:async()=>{D(""),O(!0);try{const e=await l("/api/business/delete-request/export",{method:"GET"},!0),s=await e.blob(),r=window.URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download="transactions-export."+(s.type.includes("gzip")?"gz":"json"),document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(r)}catch(e){D(e?.message||"Failed to download export. Please try again.")}finally{O(!1)}},disabled:I,icon:e.jsx(E,{})}),e.jsx(i,{label:"Delete store",variant:"danger",onClick:()=>V(!0),disabled:q||"pending"===y.status})]}),"pending"===y.status&&e.jsx(i,{label:"Cancel Deletion",variant:"secondary",onClick:async()=>{D(""),A(""),F(!0);try{const e=await l("/api/business/delete-request/cancel",{method:"POST"}),s=Q(e?.deletion);j(s),A(""),$("")}catch(e){D(e?.message||"Could not cancel deletion. Please try again.")}finally{F(!1)}},disabled:q,className:"mt-2"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"You can recover the account within 30 days. After that, the store is permanently removed."})]})]})]})})]})]})]})};export{R as default};
//# sourceMappingURL=Profile-BnC3ZjA8.js.map
