import{j as e}from"./utils-CzS7jPpm.js";import{h as t,j as s,u as a,a as n}from"./vendor-DpjJfaBO.js";import{L as o,b as r,a as i}from"./index-BOtBOzLp.js";var l={};const c=()=>{const{documentId:c}=t(),[d]=s(),m=a(),[u,x]=n.useState(null),[f,p]=n.useState(!0),[b,g]=n.useState(""),[h,j]=n.useState(""),[y,v]=n.useState(null),[N,w]=n.useState(!1),[S,k]=n.useState(""),[_,D]=n.useState(!1);n.useEffect(()=>{const e=sessionStorage.getItem("auth_token"),t=sessionStorage.getItem("user");if(e&&t){D(!0);const e=JSON.parse(t);k(e.email||"")}else{const e=d.get("email");if(!e)return void m("/login",{state:{from:window.location.pathname}});k(e)}c?(async()=>{try{p(!0);const e=await i(`/documents/${c}/info`);"rejected"!==e.verification_status?g("This document is not marked as rejected and cannot be resubmitted."):x(e)}catch(e){console.error("Failed to fetch document:",e),g("Failed to load document. Please check the link and try again.")}finally{p(!1)}})():(g("No document ID provided"),p(!1))},[c,d]);return f?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(o,{size:"lg"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading document information..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Document Resubmission"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:u?`Please upload a new version of your ${u.document_type}`:"Document Resubmission"})]}),b&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border-l-4 border-red-500 text-red-700",children:e.jsx("p",{children:b})}),h?e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border-l-4 border-green-500 text-green-700",children:[e.jsx("p",{children:h}),e.jsx("p",{className:"mt-2",children:"You will be redirected to the login page shortly..."})]}):e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!y)return void g("Please select a file to upload");const t=new FormData;t.append("document",y),t.append("document_id",c),!_&&S&&t.append("user_email",S);try{w(!0),g("");const e=sessionStorage.getItem("auth_token"),s={Accept:"application/json"};e&&(s.Authorization=`Bearer ${e}`);const a=await fetch(`${l.REACT_APP_API_URL||""}/api/documents/resubmit`,{method:"POST",body:t,headers:s}),n=await a.json();if(!a.ok)throw new Error(n.error||"Failed to resubmit document");toast.success("Document resubmitted successfully!"),j("Document resubmitted successfully!"),v(null),u.verification_status="pending",u.verification_notes=null,setTimeout(()=>{m("/login")},2e3)}catch(s){console.error("Resubmission error:",s),g(s.message||"Failed to resubmit document. Please try again.")}finally{w(!1)}},className:"space-y-6",children:[!S&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Your Email Address"}),e.jsx("input",{type:"email",id:"email",value:S,onChange:e=>k(e.target.value),required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"your.email@example.com"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Document: ",u?.document_type]}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Status: ",e.jsx("span",{className:"font-medium text-red-600",children:"Rejected"}),u?.verification_notes&&e.jsxs("span",{className:"block mt-1 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Note:"})," ",u.verification_notes]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload New Version"}),e.jsx("div",{className:"mt-1 flex items-center",children:e.jsx("input",{type:"file",onChange:e=>{const t=e.target.files[0];t&&(v(t),g(""))},accept:".pdf,.jpg,.jpeg,.png",className:"block w-full text-sm text-gray-500\r\n                    file:mr-4 file:py-2 file:px-4\r\n                    file:rounded-md file:border-0\r\n                    file:text-sm file:font-semibold\r\n                    file:bg-blue-50 file:text-blue-700\r\n                    hover:file:bg-blue-100",required:!0})}),y&&e.jsxs("p",{className:"mt-2 text-sm text-green-600",children:["Selected: ",y.name," (",(y.size/1024).toFixed(2)," KB)"]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Accepted formats: .pdf, .jpg, .jpeg, .png (Max: 5MB)"})]}),e.jsxs("div",{className:"pt-4 space-y-3",children:[e.jsx(r,{type:"submit",disabled:!y||N||!S,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:N?"Uploading...":"Resubmit Document"}),e.jsx(r,{type:"button",onClick:()=>m("/login"),variant:"outline",className:"w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Back to Login"})]})]})]})})};export{c as default};
//# sourceMappingURL=DocumentResubmitPage-UWc1MrGg.js.map
