{"version":3,"file":"POS-GFk88KJe.js","sources":["../../../frontend/src/components/modals/AdminReceiptsModal.jsx","../../../frontend/src/pages/POS.jsx"],"sourcesContent":["import React, { useEffect, useState, useCallback, useRef } from \"react\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport Button from \"../common/Button\";\r\nimport { api } from \"../../lib/api\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nfunction AdminReceiptsModal({ isOpen, onClose }) {\r\n  const [receipts, setReceipts] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [selectedIndex, setSelectedIndex] = useState(0);\r\n  const containerRef = useRef(null);\r\n  const modalContentRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    const fetchReceipts = async () => {\r\n      setLoading(true);\r\n      setError(\"\");\r\n      try {\r\n        const token = sessionStorage.getItem(\"auth_token\");\r\n        const data = await api(\"/api/sales/business/recent\", {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        setReceipts(Array.isArray(data) ? data : []);\r\n      } catch (e) {\r\n        console.error(\"Error fetching receipts:\", e);\r\n        setError(\"Failed to load receipts. Please try again.\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchReceipts();\r\n  }, [isOpen]);\r\n\r\n  const openReceipt = useCallback((receipt) => {\r\n    const url = new URL(window.location.origin + \"/receipt\");\r\n    if (receipt.transaction_number)\r\n      url.searchParams.set(\"tn\", receipt.transaction_number);\r\n    if (receipt.transaction_id)\r\n      url.searchParams.set(\"tid\", String(receipt.transaction_id));\r\n    window.open(url.toString(), \"_blank\");\r\n  }, []);\r\n\r\n  const openReceiptByIndex = useCallback((index) => {\r\n    if (!receipts[index]) return;\r\n    openReceipt(receipts[index]);\r\n  }, [receipts, openReceipt]);\r\n\r\n  // Handle keyboard navigation\r\n  const handleKeyDown = useCallback((e) => {\r\n    if (!isOpen || !receipts.length) return;\r\n    e.preventDefault();\r\n\r\n    switch (e.key) {\r\n      case 'ArrowUp': {\r\n        setSelectedIndex(prev => {\r\n          const newIndex = prev <= 0 ? receipts.length - 1 : prev - 1;\r\n          // Use setTimeout to ensure state update is complete before scrolling\r\n          setTimeout(() => {\r\n            const items = containerRef.current?.querySelectorAll('button');\r\n            const selectedItem = items?.[newIndex];\r\n            if (selectedItem) {\r\n              // Scroll the item into view with smooth behavior\r\n              selectedItem.scrollIntoView({\r\n                behavior: 'smooth',\r\n                block: 'nearest',\r\n                inline: 'nearest'\r\n              });\r\n              selectedItem.focus({ preventScroll: true });\r\n            }\r\n          }, 0);\r\n          return newIndex;\r\n        });\r\n        break;\r\n      }\r\n      case 'ArrowDown': {\r\n        setSelectedIndex(prev => {\r\n          const newIndex = prev >= receipts.length - 1 ? 0 : prev + 1;\r\n          // Use setTimeout to ensure state update is complete before scrolling\r\n          setTimeout(() => {\r\n            const items = containerRef.current?.querySelectorAll('button');\r\n            const selectedItem = items?.[newIndex];\r\n            if (selectedItem) {\r\n              // Scroll the item into view with smooth behavior\r\n              selectedItem.scrollIntoView({\r\n                behavior: 'smooth',\r\n                block: 'nearest',\r\n                inline: 'nearest'\r\n              });\r\n              selectedItem.focus({ preventScroll: true });\r\n            }\r\n          }, 0);\r\n          return newIndex;\r\n        });\r\n        break;\r\n      }\r\n      case 'Enter':\r\n        e.preventDefault();\r\n        if (receipts[selectedIndex]) {\r\n          openReceipt(receipts[selectedIndex]);\r\n        }\r\n        break;\r\n      case 'Escape':\r\n        onClose();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }, [isOpen, receipts, selectedIndex, onClose, openReceipt]);\r\n\r\n  // Set up keyboard shortcuts - removed as we're handling it in handleKeyDown\r\n\r\n  // Reset selected index when modal opens or receipts change\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setSelectedIndex(0);\r\n      // Focus the container when it opens\r\n      setTimeout(() => {\r\n        const firstButton = containerRef.current?.querySelector('button');\r\n        if (firstButton) {\r\n          firstButton.focus({ preventScroll: true });\r\n        }\r\n      }, 100);\r\n    }\r\n  }, [isOpen, receipts]);\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"All Transactions\"\r\n      subtitle=\"Latest transactions across all cashiers\"\r\n      size=\"lg\"\r\n      footer={\r\n        <Button\r\n          label=\"Close (Esc)\"\r\n          variant=\"secondary\"\r\n          onClick={onClose}\r\n          className=\"w-full\"\r\n        />\r\n      }\r\n    >\r\n      {loading && (\r\n        <div className=\"text-sm text-gray-600 py-4 text-center\">\r\n          Loading transactions...\r\n        </div>\r\n      )}\r\n      {error && (\r\n        <div className=\"text-sm text-red-600 bg-red-50 border border-red-100 rounded-lg px-3 py-2 mb-2\">\r\n          {error}\r\n        </div>\r\n      )}\r\n      {!loading && !error && receipts.length === 0 && (\r\n        <div className=\"text-sm text-gray-500 py-6 text-center\">\r\n          No transactions found.\r\n        </div>\r\n      )}\r\n      <div \r\n        ref={containerRef}\r\n        className=\"space-y-2 max-h-[60vh] overflow-y-auto outline-none\"\r\n        onKeyDown={handleKeyDown}\r\n        tabIndex={0}\r\n      >\r\n        {receipts.map((r, index) => (\r\n          <button\r\n            key={`${r.transaction_id}-${r.transaction_number}`}\r\n            onClick={() => openReceipt(r)}\r\n            className={`w-full text-left border rounded-xl px-3 py-2 transition-colors ${\r\n              selectedIndex === index \r\n                ? 'border-blue-500 bg-blue-50 ring-2 ring-blue-200' \r\n                : 'border-gray-200 hover:border-blue-300 hover:bg-blue-50'\r\n            }`}\r\n            onFocus={() => setSelectedIndex(index)}\r\n            tabIndex={0}\r\n          >\r\n            <div className=\"flex justify-between items-center\">\r\n              <div>\r\n                <p className=\"text-sm font-semibold text-gray-900\">\r\n                  {r.transaction_number || `TXN-${r.transaction_id || ''}`}\r\n                </p>\r\n                <p className=\"text-xs text-gray-600\">\r\n                  {new Date(r.updated_at || r.created_at).toLocaleString()}\r\n                </p>\r\n              </div>\r\n              <div className=\"text-right\">\r\n                <p className=\"text-sm font-bold text-blue-700\">\r\n                  ₱{Number(r.total_amount || r.total || 0).toFixed(2)}\r\n                </p>\r\n                <p className=\"text-[11px] text-gray-600 uppercase\">\r\n                  {r.payment?.method || r.payment_type || 'cash'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            {(r.discount_percentage || r.discount_amount) && (\r\n              <p className=\"text-[11px] text-emerald-700 mt-1\">\r\n                Discount applied{\" \"}\r\n                {r.discount_percentage\r\n                  ? `${r.discount_percentage}%`\r\n                  : `₱${Number(r.discount_amount || 0).toFixed(2)}`}\r\n              </p>\r\n            )}\r\n          </button>\r\n        ))}\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default AdminReceiptsModal;\r\n","import React, { useState, useRef, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport ScannerCard from \"../components/ui/POS/ScannerCard\";\nimport PageLayout from \"../components/layout/PageLayout\";\nimport SkuFormCard from \"../components/ui/POS/SkuFormCard\";\nimport CartTableCard from \"../components/ui/POS/CartTableCard\";\nimport Button from \"../components/common/Button\";\nimport NavAdmin from \"../components/layout/Nav-Admin\";\n// Background gradient removed for a neutral look\nimport { api, createGcashCheckout, createMayaCheckout } from \"../lib/api\";\nimport PriceCheckModal from \"../components/modals/PriceCheckModal\";\nimport DiscountModal from \"../components/modals/DiscountModal\";\nimport CashLedgerModal from \"../components/modals/CashLedgerModal\";\nimport CheckoutModal from \"../components/modals/CheckoutModal\";\nimport CashPaymentModal from \"../components/modals/CashPaymentModal\";\nimport ScanCustomerCartModal from \"../components/modals/ScanCustomerCartModal\";\nimport { BiReceipt, BiSync } from \"react-icons/bi\";\nimport AdminReceiptsModal from \"../components/modals/AdminReceiptsModal\";\nimport { MdClose } from \"react-icons/md\";\nimport { useKeyboardShortcuts } from \"../hooks/useKeyboardShortcuts\";\n\nconst ButtonLabel = ({ text, shortcut, variant = \"secondary\" }) => (\n  <div className=\"flex items-center gap-2\">\n    <span>{text}</span>\n    <span className={`hidden sm:inline-block text-xs font-bold px-1.5 py-0.5 rounded border ${\n      variant === \"primary\" \n        ? \"bg-white/20 border-white/40 text-white\" \n        : \"bg-gray-100 border-gray-300 text-gray-600\"\n    }`}>\n      {shortcut}\n    </span>\n  </div>\n);\n\nfunction POS() {\n  const navigate = useNavigate();\n\n  // States\n  const [sku, setSku] = useState(\"\");\n  const [quantity, setQuantity] = useState(1);\n  const [cart, setCart] = useState([]);\n  const [showDiscount, setShowDiscount] = useState(false);\n  const [showPriceCheck, setShowPriceCheck] = useState(false);\n  const [priceCheckSku, setPriceCheckSku] = useState(\"\");\n  const [showImportCart, setShowImportCart] = useState(false);\n  const [showCashLedger, setShowCashLedger] = useState(false);\n  const [showCheckout, setShowCheckout] = useState(false);\n  const [showCashModal, setShowCashModal] = useState(false);\n  const [selectedPayment, setSelectedPayment] = useState(null);\n  const [darkMode, setDarkMode] = useState(false);\n  const [scannerPaused, setScannerPaused] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [transactionNumber, setTransactionNumber] = useState(\"\");\n  const [transactionId, setTransactionId] = useState(null);\n  \n  // Auto-clear error message after 5 seconds\n  useEffect(() => {\n    if (error) {\n      const timer = setTimeout(() => {\n        setError(\"\");\n      }, 5000);\n      return () => clearTimeout(timer);\n    }\n  }, [error]);\n  const [showReceipts, setShowReceipts] = useState(false);\n  const skuInputRef = useRef(null);\n  const [isSidebarOpen, setSidebarOpen] = useState(false);\n  const [selectedItemIdx, setSelectedItemIdx] = useState(-1);\n  const [editingIdx, setEditingIdx] = useState(null);\n  const token = sessionStorage.getItem(\"auth_token\");\n  const user = JSON.parse(sessionStorage.getItem(\"user\") || \"{}\");\n  const hasFinalizedRef = React.useRef(false);\n  const [businessName, setBusinessName] = useState(\"\");\n  const [selectedCartIdx, setSelectedCartIdx] = useState(0);\n  const [editingCartItem, setEditingCartItem] = useState(null);\n  const [editQty, setEditQty] = useState('1');\n  const [showLogoutConfirm, setShowLogoutConfirm] = useState(false);\n  const [appliedDiscount, setAppliedDiscount] = useState(null);\n  const quantityInputRef = useRef(null);\n\n  // Set editing cart item and initialize quantity\n  const setSelectedCartItem = (idx) => {\n    setSelectedCartIdx(idx);\n    if (idx >= 0 && idx < cart.length) {\n      setEditQty(String(cart[idx].quantity));\n    }\n  };\n\n  // Generate a client-side provisional transaction number when POS opens\n  useEffect(() => {\n    if (!transactionNumber) {\n      const businessId = user?.businessId || user?.business_id || \"BIZ\";\n      const timePart = new Date()\n        .toISOString()\n        .replace(/[-:T.Z]/g, \"\")\n        .slice(0, 14);\n      const randPart = Math.floor(1000 + Math.random() * 9000);\n      setTransactionNumber(\n        `T-${businessId.toString().padStart(2, \"0\")}-${timePart}-${randPart}`\n      );\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Auto-focus SKU input on initial mount\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      skuInputRef.current?.focus();\n    }, 300);\n    return () => clearTimeout(timer);\n  }, []);\n\n  // On mount, if returned from PayMongo success/cancel, finalize or cleanup\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const status = params.get(\"payment\");\n    const businessId = user?.businessId || user?.business_id;\n\n    // Check if we're in a new tab (opened from payment)\n    const isNewTab = window.opener && !window.opener.closed;\n\n    const finalizeOnlinePayment = async (pendingCartKey, paymentType) => {\n      const pending = localStorage.getItem(pendingCartKey);\n      if (status === \"success\" && pending && businessId) {\n        try {\n          const parsed = JSON.parse(pending);\n          if (hasFinalizedRef.current) return;\n          const guardKey = `${paymentType}_finalize_done`;\n          if (sessionStorage.getItem(guardKey) === \"1\") return;\n          hasFinalizedRef.current = true;\n          sessionStorage.setItem(guardKey, \"1\");\n          try {\n            setError(\"\");\n            const body = {\n              items: parsed.items || [],\n              payment_type: paymentType.toLowerCase(),\n              money_received: parsed.total || null,\n              discount_id: parsed.discount_id || null,\n              discount_percentage: parsed.discount_percentage || null,\n              discount_amount: parsed.discount_amount || null,\n            };\n            const resp = await api(\"/api/sales/checkout\", {\n              method: \"POST\",\n              headers: { Authorization: `Bearer ${token}` },\n              body: JSON.stringify(body),\n            });\n            if (resp?.transaction_number)\n              setTransactionNumber(resp.transaction_number);\n            if (resp?.transaction_id) setTransactionId(resp.transaction_id);\n            setCart([]);\n            try {\n              const url = new URL(window.location.origin + \"/receipt\");\n              if (resp?.transaction_number)\n                url.searchParams.set(\"tn\", resp.transaction_number);\n              if (resp?.transaction_id)\n                url.searchParams.set(\"tid\", String(resp.transaction_id));\n              if (resp?.total != null)\n                url.searchParams.set(\"total\", String(resp.total));\n\n              // If in new tab, redirect opener and close this tab\n              if (isNewTab && window.opener) {\n                window.opener.location.href = url.toString();\n                window.close();\n              } else {\n                window.location.href = url.toString();\n              }\n            } catch (_) {}\n          } catch (e) {\n            setError(`Failed to record ${paymentType} payment`);\n          } finally {\n            localStorage.removeItem(pendingCartKey);\n            if (!isNewTab) {\n              const url = new URL(window.location.href);\n              url.searchParams.delete(\"payment\");\n              window.history.replaceState({}, \"\", url.toString());\n            }\n          }\n        } catch (_) {\n          localStorage.removeItem(pendingCartKey);\n        }\n      } else if (status === \"cancel\" && pending) {\n        localStorage.removeItem(pendingCartKey);\n        // If in new tab, close it; otherwise just clean up URL\n        if (isNewTab && window.opener) {\n          window.close();\n        } else {\n          const url = new URL(window.location.href);\n          url.searchParams.delete(\"payment\");\n          window.history.replaceState({}, \"\", url.toString());\n        }\n      }\n    };\n\n    finalizeOnlinePayment(\"pending_gcash_cart\", \"GCash\");\n    finalizeOnlinePayment(\"pending_maya_cart\", \"Maya\");\n  }, []);\n\n  const addSkuToCart = async (skuValue, qty = 1) => {\n    if (!skuValue || qty < 1) return;\n    setError(\"\");\n    try {\n      const product = await api(\n        `/api/products/sku/${encodeURIComponent(skuValue)}`,\n        {\n          headers: { Authorization: `Bearer ${token}` },\n        }\n      );\n      const price = Number(product.selling_price || 0);\n      const stockQty = Number(product.stock_quantity ?? 0);\n      if (stockQty <= 0) {\n        setError(\n          `Stock for ${product.product_name} (SKU ${product.sku}) is 0.`\n        );\n        return;\n      }\n      if (qty > stockQty) {\n        setError(\n          `Insufficient stock. Available: ${stockQty}, requested: ${qty}.`\n        );\n        return;\n      }\n      setCart((prev) => {\n        const existingIdx = prev.findIndex(\n          (i) => i.product_id === product.product_id\n        );\n        if (existingIdx >= 0) {\n          const next = [...prev];\n          const newQty = next[existingIdx].quantity + qty;\n          if (newQty > stockQty) {\n            setError(\n              `Insufficient stock. Available: ${stockQty}, requested: ${newQty}.`\n            );\n            return prev;\n          }\n          next[existingIdx] = { ...next[existingIdx], quantity: newQty };\n          return next;\n        }\n        return [\n          ...prev,\n          {\n            product_id: product.product_id,\n            sku: product.sku,\n            name: product.product_name,\n            quantity: qty,\n            price,\n          },\n        ];\n      });\n      setSku(\"\");\n      setQuantity(1);\n      // Auto-focus SKU input after adding item for next scan\n      setTimeout(() => {\n        skuInputRef.current?.focus();\n      }, 50);\n    } catch (err) {\n      setError(\"Product not found\");\n    } finally {\n      // Always resume scanner after processing, even on error\n      setTimeout(() => {\n        setScannerPaused(false);\n      }, 300);\n    }\n  };\n\n  const handleAddToCart = async () => {\n    await addSkuToCart(sku, quantity);\n  };\n\n  const handleRemove = (idx) => {\n    if (idx >= 0 && idx < cart.length) {\n      setCart(cart.filter((_, i) => i !== idx));\n    }\n  };\n\n  const handleEditQuantity = async (idx, qty) => {\n    const newQty = qty === '' ? 1 : Math.max(1, Number(qty) || 1);\n    const item = cart[idx];\n    if (!item) return;\n    setError(\"\");\n    try {\n      const product = await api(\n        `/api/products/sku/${encodeURIComponent(item.sku)}`,\n        {\n          headers: { Authorization: `Bearer ${token}` },\n        }\n      );\n      const stockQty = Number(product.stock_quantity ?? 0);\n      if (newQty > stockQty) {\n        setError(\n          `Insufficient stock. Available: ${stockQty}, requested: ${newQty}.`\n        );\n        return;\n      }\n      setCart((prev) =>\n        prev.map((item, i) =>\n          i === idx ? { ...item, quantity: newQty } : item\n        )\n      );\n      setEditQty(newQty); // Keep editQty in sync\n      setEditingCartItem(null);\n    } catch (err) {\n      setError(err.message || \"Failed to update quantity\");\n    }\n  };\n  \n  // Handle edit quantity change\n  const handleEditQtyChange = (value) => {\n    setEditQty(value);\n  };\n\n  // Handler for increment quantity (=)\n  const handleIncrementQuantity = async () => {\n    if (cart.length === 0 || selectedCartIdx < 0 || selectedCartIdx >= cart.length) return;\n    const item = cart[selectedCartIdx];\n    if (!item) return;\n    const currentQty = item.quantity;\n    const newQty = currentQty + 1;\n    setError(\"\");\n    try {\n      const product = await api(\n        `/api/products/sku/${encodeURIComponent(item.sku)}`,\n        {\n          headers: { Authorization: `Bearer ${token}` },\n        }\n      );\n      const stockQty = Number(product.stock_quantity ?? 0);\n      if (newQty > stockQty) {\n        setError(\n          `Insufficient stock. Available: ${stockQty}, requested: ${newQty}.`\n        );\n        return;\n      }\n      setCart((prev) =>\n        prev.map((cartItem, i) =>\n          i === selectedCartIdx ? { ...cartItem, quantity: newQty } : cartItem\n        )\n      );\n    } catch (err) {\n      setError(err.message || \"Failed to update quantity\");\n    }\n  };\n\n  // Handler for decrement quantity (-)\n  const handleDecrementQuantity = () => {\n    if (cart.length === 0 || selectedCartIdx < 0 || selectedCartIdx >= cart.length) return;\n    const item = cart[selectedCartIdx];\n    if (!item) return;\n    const currentQty = item.quantity;\n    if (currentQty <= 1) return; // Don't allow going below 1\n    const newQty = currentQty - 1;\n    setCart((prev) =>\n      prev.map((cartItem, i) =>\n        i === selectedCartIdx ? { ...cartItem, quantity: newQty } : cartItem\n      )\n    );\n  };\n\n  const subtotal = cart.reduce(\n    (sum, item) => sum + item.price * item.quantity,\n    0\n  );\n\n  // Calculate total with discount\n  let total = subtotal;\n  if (appliedDiscount) {\n    if (appliedDiscount.type === \"percentage\") {\n      const discountValue = Number(appliedDiscount.value);\n      if (!isNaN(discountValue) && discountValue > 0) {\n        const discountAmount = subtotal * (discountValue / 100);\n        total = Math.max(0, subtotal - discountAmount);\n      }\n    } else if (appliedDiscount.type === \"amount\") {\n      const discountValue = Number(appliedDiscount.value);\n      if (!isNaN(discountValue) && discountValue > 0) {\n        total = Math.max(0, subtotal - discountValue);\n      }\n    }\n  }\n\n  // Handle keyboard navigation for cart items\n  useEffect(() => {\n    const handleKeyDown = (e) => {\n      // Don't handle keys when modals are open\n      if (showDiscount || showPriceCheck || showImportCart || showCashLedger || showCheckout || showCashModal || showReceipts || showLogoutConfirm) {\n        return;\n      }\n\n      // Don't handle if user is typing in an input field (unless it's specific navigation keys)\n      const isInputFocused = e.target && (\n        e.target.tagName === 'INPUT' || \n        e.target.tagName === 'TEXTAREA' ||\n        e.target.isContentEditable\n      );\n\n      // Only handle navigation keys if not in input or if editing cart item\n      const navigationKeys = ['ArrowUp', 'ArrowDown', 'Enter', 'Escape'];\n      const editKeys = ['e', 'E', 'd', 'D'];\n      const quantityKeys = ['=', '-'];\n      \n      if (isInputFocused && editingCartItem === null && !navigationKeys.includes(e.key) && !editKeys.includes(e.key) && !quantityKeys.includes(e.key)) {\n        return;\n      }\n\n      // Handle Escape key for editing state (but let shortcut handler handle modal closing)\n      if (e.key === 'Escape' && editingCartItem !== null) {\n        e.preventDefault();\n        e.stopPropagation();\n        setEditingCartItem(null);\n        return;\n      }\n\n      // Handle Enter key for editing state\n      if (e.key === 'Enter' && editingCartItem !== null) {\n        e.preventDefault();\n        e.stopPropagation();\n        handleEditQuantity(editingCartItem, editQty);\n        setEditingCartItem(null);\n        return;\n      }\n\n      // Handle arrow keys - allow navigation even when SKU input is focused\n      const isSkuInput = e.target === skuInputRef.current;\n      const isArrowKey = e.key === 'ArrowUp' || e.key === 'ArrowDown';\n      const isQuantityKey = e.key === '=' || e.key === '-';\n      \n      if (isArrowKey && (isSkuInput || !isInputFocused || editingCartItem !== null)) {\n        switch (e.key) {\n          case 'ArrowUp':\n          e.preventDefault();\n          e.stopPropagation();\n          setSelectedCartIdx(prev => prev > 0 ? prev - 1 : cart.length - 1);\n          break;\n          case 'ArrowDown':\n          e.preventDefault();\n          e.stopPropagation();\n          setSelectedCartIdx(prev => prev < cart.length - 1 ? prev + 1 : 0);\n          break;\n          // E and D keys removed - now using F1 and F2 instead\n          default:\n            break;\n        }\n      }\n      \n      // Handle quantity keys (= and -) even when SKU input is focused\n      if (isQuantityKey && (isSkuInput || !isInputFocused || editingCartItem !== null)) {\n        if (cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length) {\n          if (e.key === '=') {\n            e.preventDefault();\n            e.stopPropagation();\n            handleIncrementQuantity();\n          } else if (e.key === '-') {\n            e.preventDefault();\n            e.stopPropagation();\n            handleDecrementQuantity();\n          }\n        }\n      }\n    };\n\n    // Use bubble phase (after shortcuts hook which uses capture)\n    window.addEventListener('keydown', handleKeyDown, false);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown, false);\n    };\n  }, [cart.length, selectedCartIdx, editingCartItem, editQty, showDiscount, showPriceCheck, showImportCart, showCashLedger, showCheckout, showCashModal, showReceipts, showLogoutConfirm, handleIncrementQuantity, handleDecrementQuantity]);\n\n  // Reset selected index when cart changes\n  useEffect(() => {\n    if (cart.length === 0) {\n      setSelectedCartIdx(0);\n    } else {\n      setSelectedCartIdx(prev => Math.min(prev, cart.length - 1));\n    }\n  }, [cart.length]);\n\n\n  // Pause scanner when any modal is open to avoid hardware scanner/keyboard events interfering with shortcuts\n  useEffect(() => {\n    const anyModalOpen =\n      showDiscount ||\n      showPriceCheck ||\n      showImportCart ||\n      showCashLedger ||\n      showCheckout ||\n      showCashModal ||\n      showReceipts ||\n      showLogoutConfirm;\n    \n    setScannerPaused(anyModalOpen);\n    \n    // When modals close, refocus SKU input after a delay (but not if user is interacting with other elements)\n    if (!anyModalOpen) {\n      const timer = setTimeout(() => {\n        const activeElement = document.activeElement;\n        const isInputFocused = activeElement && (\n          activeElement.tagName === 'INPUT' || \n          activeElement.tagName === 'TEXTAREA' ||\n          activeElement.isContentEditable ||\n          activeElement.tagName === 'BUTTON'\n        );\n        // Only refocus if user isn't actively clicking buttons or using inputs\n        if (!isInputFocused && document.body === activeElement) {\n          skuInputRef.current?.focus();\n        }\n      }, 300);\n      return () => clearTimeout(timer);\n    }\n  }, [\n    showDiscount,\n    showPriceCheck,\n    showImportCart,\n    showCashLedger,\n    showCheckout,\n    showCashModal,\n    showReceipts,\n    showLogoutConfirm,\n  ]);\n\n  const focusSkuInput = () => {\n    skuInputRef.current?.focus();\n    skuInputRef.current?.select?.();\n  };\n\n  const handleNewTransaction = () => {\n    setCart([]);\n    setAppliedDiscount(null);\n    setTransactionId(null);\n    setError(\"\");\n    focusSkuInput();\n  };\n\n  const handleVoidSelected = () => {\n    if (cart.length === 0 || selectedCartIdx == null) return;\n    handleRemove(selectedCartIdx);\n  };\n\n  const handleSetQuantityShortcut = () => {\n    if (cart.length === 0 || selectedCartIdx == null) return;\n    const current = cart[selectedCartIdx];\n    const nextQty = Number(\n      window.prompt(\n        `Set quantity for ${current.name || current.sku}:`,\n        current.quantity\n      )\n    );\n    if (!Number.isNaN(nextQty) && nextQty > 0) {\n      handleEditQuantity(selectedCartIdx, nextQty);\n    }\n  };\n\n  const handleRemoveDiscount = () => {\n    if (appliedDiscount) {\n      setAppliedDiscount(null);\n    }\n  };\n\n  // Handler for edit quantity (F1)\n  const handleEditQuantityShortcut = () => {\n    if (cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length) {\n      setEditingCartItem(selectedCartIdx);\n      setEditQty(String(cart[selectedCartIdx].quantity));\n    }\n  };\n\n  // Handler for discount modal toggle (F6) - open/close discount modal\n  const handleDiscountToggle = () => {\n    setShowDiscount(!showDiscount);\n  };\n\n  useKeyboardShortcuts(\n    [\n      // ` (backtick) - focus SKU field\n      { key: \"`\", action: focusSkuInput },\n      // F1 - edit product quantity\n      {\n        key: \"f1\",\n        action: handleEditQuantityShortcut,\n        enabled: cart.length > 0 && selectedCartIdx >= 0,\n      },\n      // F2 - delete item\n      {\n        key: \"f2\",\n        action: handleVoidSelected,\n        enabled: cart.length > 0,\n      },\n      // F3 - logout\n      {\n        key: \"f3\",\n        description: \"Logout\",\n        action: () => setShowLogoutConfirm(true),\n      },\n      // F4 - add to cart button\n      {\n        key: \"f4\",\n        action: handleAddToCart,\n        enabled: !!sku, // Only enable if there's a SKU value\n      },\n      // F5 - cash ledger\n      { key: \"f5\", action: () => setShowCashLedger(true) },\n      // F6 - open/close discount modal\n      {\n        key: \"f6\",\n        action: handleDiscountToggle,\n      },\n      // F7 - price check\n      {\n        key: \"f7\",\n        action: () => {\n          setShowPriceCheck(true);\n        },\n      },\n      // F8 - scan customer cart (keep existing)\n      {\n        key: \"f8\",\n        action: () => setShowImportCart(true),\n      },\n      // F9 - receipts\n      { key: \"f9\", action: () => setShowReceipts(true) },\n      // F10 - (reserved, no action specified)\n      // F11 - remove discount\n      {\n        key: \"f11\",\n        action: handleRemoveDiscount,\n        enabled: !!appliedDiscount,\n      },\n      // F12 - checkout\n      {\n        key: \"f12\",\n        action: () => setShowCheckout(true),\n        enabled: cart.length > 0,\n      },\n      // = (equals) - increment quantity\n      {\n        key: \"=\",\n        action: handleIncrementQuantity,\n        enabled: cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length,\n      },\n      // - (minus) - decrement quantity\n      {\n        key: \"-\",\n        action: handleDecrementQuantity,\n        enabled: cart.length > 0 && selectedCartIdx >= 0 && selectedCartIdx < cart.length,\n      },\n      {\n        key: \"escape\",\n        action: () => {\n          // Only close modals, don't interfere with cart editing (handled separately)\n          if (showCheckout) setShowCheckout(false);\n          else if (showDiscount) setShowDiscount(false);\n          else if (showPriceCheck) setShowPriceCheck(false);\n          else if (showImportCart) setShowImportCart(false);\n          else if (showCashModal) setShowCashModal(false);\n          else if (showCashLedger) setShowCashLedger(false);\n          else if (showReceipts) setShowReceipts(false);\n          else if (showLogoutConfirm) setShowLogoutConfirm(false);\n          // Note: Cart item editing escape is handled in the separate keyboard handler\n        },\n        allowWhileTyping: true,\n        stopPropagation: false, // Allow other handlers to process\n      },\n    ],\n    [\n      cart.length,\n      selectedCartIdx,\n      sku,\n      appliedDiscount,\n      showCheckout,\n      showDiscount,\n      showPriceCheck,\n      showImportCart,\n      showCashModal,\n      showCashLedger,\n      showReceipts,\n      showLogoutConfirm,\n    ]\n  );\n\n  // show confirmation modal first, perform actual logout in confirmLogout\n  const handleLogout = () => {\n    setShowLogoutConfirm(true);\n  };\n\n  const confirmLogout = () => {\n    sessionStorage.removeItem(\"auth_token\");\n    sessionStorage.removeItem(\"user\");\n    // close modal then navigate home\n    setShowLogoutConfirm(false);\n    navigate(\"/\");\n  };\n\n  const handleCloseLogoutModal = () => {\n    setShowLogoutConfirm(false);\n  };\n\n  // Handle keyboard events for logout confirmation\n  useEffect(() => {\n    if (!showLogoutConfirm) return;\n\n    const handleKeyDown = (e) => {\n      // Use stopPropagation to prevent other handlers from interfering\n      e.stopPropagation();\n      \n      if (e.key === 'Escape' || e.key === 'Esc') {\n        e.preventDefault();\n        handleCloseLogoutModal();\n      } else if (e.key === 'Enter') {\n        e.preventDefault();\n        confirmLogout();\n      }\n    };\n\n    // Use capture phase to ensure we get the event first\n    document.addEventListener('keydown', handleKeyDown, { capture: true });\n    return () => document.removeEventListener('keydown', handleKeyDown, { capture: true });\n  }, [showLogoutConfirm]);\n\n  const handleCheckout = async (paymentMethod, amountReceived = null) => {\n    if (cart.length === 0) return;\n    setError(\"\");\n    try {\n      // Prepare the checkout payload\n      const payload = {\n        items: cart.map((item) => ({\n          product_id: item.product_id,\n          quantity: item.quantity,\n          price: item.price,\n        })),\n        payment_type: paymentMethod,\n        money_received: amountReceived,\n        transaction_id: transactionId, // Include the transaction ID if it exists\n        transaction_number: transactionNumber,\n        discount_id: appliedDiscount?.discount_id || null,\n        discount_percentage: appliedDiscount?.type === 'percentage' ? appliedDiscount.value : null,\n        discount_amount: appliedDiscount?.type === 'amount' ? appliedDiscount.value : null,\n      };\n\n      const resp = await api(\"/api/sales/checkout\", {\n        method: \"POST\",\n        headers: { Authorization: `Bearer ${token}` },\n        body: JSON.stringify(payload),\n      });\n      if (resp?.transaction_number)\n        setTransactionNumber(resp.transaction_number);\n      if (resp?.transaction_id) setTransactionId(resp.transaction_id);\n      setCart([]);\n      try {\n        const url = new URL(window.location.origin + \"/receipt\");\n        if (resp?.transaction_number)\n          url.searchParams.set(\"tn\", resp.transaction_number);\n        if (resp?.transaction_id)\n          url.searchParams.set(\"tid\", String(resp.transaction_id));\n        if (resp?.total != null)\n          url.searchParams.set(\"total\", String(resp.total));\n        navigate(url.pathname + url.search);\n      } catch (_) {}\n      // Start a fresh provisional transaction number after successful checkout\n      const businessId = user?.businessId || user?.business_id || \"BIZ\";\n      const timePart = new Date()\n        .toISOString()\n        .replace(/[-:T.Z]/g, \"\")\n        .slice(0, 14);\n      const randPart = Math.floor(1000 + Math.random() * 9000);\n      setTransactionNumber(\n        `T-${businessId.toString().padStart(2, \"0\")}-${timePart}-${randPart}`\n      );\n      setAppliedDiscount(null); // Reset discount after successful checkout\n      setTransactionId(null);\n    } catch (err) {\n      console.error(\"Checkout error:\", err);\n      setError(\"Checkout failed\");\n    }\n  };\n\n  const [showRecentReceiptsModal, setShowRecentReceiptsModal] = useState(false);\n\n  const handleCopyTn = async () => {\n    try {\n      if (!user.store_name) return;\n      await navigator.clipboard.writeText(user.store_name);\n    } catch (_) {}\n  };\n\n  const headerActions = (\n    <div className=\"flex items-center gap-1 sm:gap-4 mr-3\">\n      {/* Transaction Number display */}\n      <div className=\"space-y-2\">\n        {appliedDiscount && (\n          <div className=\"flex items-center justify-between text-sm text-green-600\">\n            <span>Discount Applied:</span>\n            <span className=\"font-medium\">\n              {appliedDiscount.type === 'percentage' \n                ? `${appliedDiscount.value}%` \n                : `₱${Number(appliedDiscount.value).toFixed(2)}`}\n            </span>\n          </div>\n        )}\n        <div className=\"flex items-center justify-between text-lg font-semibold\">\n          <span>Total:</span>\n          <div className=\"flex items-center gap-2\">\n            {appliedDiscount && (\n              <span className=\"text-sm text-gray-500 line-through\">\n                ₱{subtotal.toFixed(2)}\n              </span>\n            )}\n            <span>₱{total.toFixed(2)}</span>\n          </div>\n        </div>\n      </div>\n      {/* Transaction Number display */}\n      <div className=\"flex-1 flex items-center justify-center\">\n        <button\n          onClick={handleCopyTn}\n          title=\"Copy store name\"\n          className=\"inline-flex items-center gap-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg px-2 py-1.5 sm:px-2.5 shadow-sm\"\n        >\n          <svg\n            className=\"w-3 h-3 sm:w-4 sm:h-4\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2M8 16h8a2 2 0 002-2v-6m-10 8l-2 2m2-2l2 2\"\n            />\n          </svg>\n          <span className=\"font-mono text-xs sm:text-sm font-bold tracking-wider truncate max-w-[30vw] sm:max-w-[50vw]\">\n            {user.store_name}\n          </span>\n        </button>\n      </div>\n      {/* View All Receipts Button */}\n      <button\n        onClick={() => setShowReceipts(true)}\n        className=\"flex items-center gap-2 bg-white/80 backdrop-blur-sm p-1.5 sm:px-3 sm:py-2 rounded-lg border border-gray-200/80 hover:bg-gray-50 transition-colors\"\n        title=\"View all receipts (F9)\"\n      >\n        <div className=\"relative\">\n          <BiReceipt className=\"w-5 h-5 text-blue-600\" />\n        </div>\n        <span className=\"text-sm font-medium text-gray-700 hidden sm:inline\">\n          Receipts\n        </span>\n        <span className=\"hidden sm:inline-block bg-blue-50 text-blue-700 border border-blue-200 text-xs font-bold px-1.5 py-0.5 rounded\">\n          F9\n        </span>\n      </button>\n    </div>\n  );\n\n  return (\n    <PageLayout\n      title=\"POS\"\n      sidebar={<NavAdmin />}\n      headerActions={headerActions}\n      isSidebarOpen={isSidebarOpen}\n      setSidebarOpen={setSidebarOpen}\n    >\n      <div className=\"flex-1 flex flex-col min-h-screen\">\n        <main className=\"flex-1 bg-gradient-to-br from-gray-50/50 via-blue-50/30 to-indigo-50/50 overflow-hidden p-2 sm:p-3 md:p-4 pb-10 lg:pb-4\">\n          <div className=\"grid gap-2 sm:gap-3 md:gap-4 h-full grid-cols-1 lg:grid-cols-12\">\n            {/* Left Column - Scanner, SKU Form, Transaction */}\n            <div className=\"lg:col-span-4 flex flex-col gap-2 sm:gap-3 md:gap-4\">\n              {/* ScannerCard */}\n              <div className=\"flex-shrink-0\">\n                <ScannerCard\n                  onScan={async (result) => {\n                    const code = result?.[0]?.rawValue;\n                    if (!code) return;\n                    setScannerPaused(true);\n                    if (showPriceCheck) {\n                      setPriceCheckSku(code);\n                    } else {\n                      try {\n                        let scannedData;\n                        try {\n                          scannedData = JSON.parse(code);\n                        } catch (e) {\n                          scannedData = null;\n                        }\n                        if (\n                          scannedData &&\n                          scannedData.t === \"cart\" &&\n                          Array.isArray(scannedData.items)\n                        ) {\n                          // set transactionId from scanned data if present\n                          if (scannedData.transaction_id) {\n                            setTransactionId(scannedData.transaction_id);\n                          }\n                          // set transaction_number from scanned data if present\n                          if (scannedData.transaction_number) {\n                            setTransactionNumber(\n                              scannedData.transaction_number\n                            );\n                          }\n                          const items = scannedData.items.map((it) => ({\n                            product_id: it.p,\n                            quantity: it.q,\n                            sku: it.sku || \"\",\n                          }));\n                          try {\n                            const fetchedProducts = await Promise.all(\n                              items.map(async (item) => {\n                                const res = await api(\n                                  `/api/products/${item.product_id}`,\n                                  {\n                                    headers: {\n                                      Authorization: `Bearer ${token}`,\n                                    },\n                                  }\n                                );\n                                return {\n                                  product_id: item.product_id,\n                                  sku: res.sku || item.sku || \"\",\n                                  name: res.product_name || \"\",\n                                  price: Number(res.selling_price) || 0,\n                                  quantity: item.quantity,\n                                };\n                              })\n                            );\n                            setCart((prev) => {\n                              const byProductId = new Map(\n                                prev.map((i) => [i.product_id, i])\n                              );\n                              for (const it of fetchedProducts) {\n                                const existing = byProductId.get(it.product_id);\n                                if (existing) {\n                                  existing.quantity += it.quantity;\n                                } else {\n                                  byProductId.set(it.product_id, { ...it });\n                                }\n                              }\n                              return Array.from(byProductId.values());\n                            });\n                            return;\n                          } catch (err) {\n                            console.error(\n                              \"Error fetching product details for scanned cart:\",\n                              err\n                            );\n                            // fallback to merging raw scanned items without product details\n                            setCart((prev) => {\n                              const byProductId = new Map(\n                                prev.map((i) => [i.product_id, i])\n                              );\n                              for (const it of items) {\n                                const existing = byProductId.get(it.product_id);\n                                if (existing) {\n                                  existing.quantity += it.quantity;\n                                } else {\n                                  byProductId.set(it.product_id, {\n                                    ...it,\n                                    name: \"\",\n                                    price: 0,\n                                  });\n                                }\n                              }\n                              return Array.from(byProductId.values());\n                            });\n                            return;\n                          }\n                        }\n                        await addSkuToCart(code, 1);\n                      } catch (err) {\n                        console.error(\"Error processing scanned code:\", err);\n                        await addSkuToCart(code, 1);\n                      }\n                    }\n                  }}\n                  paused={scannerPaused}\n                  onResume={() => setScannerPaused(false)}\n                  textMain=\"text-blue-700\"\n                />\n              </div>\n\n              {/* SkuFormCard */}\n              <div className=\"flex-shrink-0\">\n                <SkuFormCard\n                  ref={skuInputRef}\n                  sku={sku}\n                  setSku={setSku}\n                  quantity={quantity}\n                  setQuantity={setQuantity}\n                  handleAddToCart={handleAddToCart}\n                  quantityInputRef={quantityInputRef}\n                />\n                {error && (\n                  <div className=\"bg-red-50 border-l-4 border-red-500 rounded-lg p-3 flex items-start gap-2 mt-3 relative animate-in slide-in-from-top-2 duration-300\">\n                    <svg\n                      className=\"w-4 h-4 text-red-500 flex-shrink-0 mt-0.5\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"\n                      />\n                    </svg>\n                    <p className=\"text-sm font-medium text-red-700 flex-1\">\n                      {(() => {\n                        try {\n                          const parsed = JSON.parse(error);\n                          return parsed.error || parsed.message || error;\n                        } catch {\n                          return error;\n                        }\n                      })()}\n                    </p>\n                    <button\n                      onClick={() => setError(\"\")}\n                      className=\"text-red-400 hover:text-red-600 transition-colors flex-shrink-0 ml-2\"\n                      aria-label=\"Dismiss error\"\n                    >\n                      <svg\n                        className=\"w-4 h-4\"\n                        fill=\"none\"\n                        stroke=\"currentColor\"\n                        viewBox=\"0 0 24 24\"\n                      >\n                        <path\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                          strokeWidth={2}\n                          d=\"M6 18L18 6M6 6l12 12\"\n                        />\n                      </svg>\n                    </button>\n                  </div>\n                )}\n              </div>\n\n              {/* TransactionCard */}\n              {/* Removed card display; transaction number now shown in header */}\n              {/* <div className=\"flex-shrink-0\">\n                  <TransactionCard\n                    transactionNumber={transactionNumber}\n                    transactionId={transactionId}\n                  />\n                </div> */}\n            </div>\n\n            {/* Right Column - Cart and Actions */}\n            <div className=\"lg:col-span-8 flex flex-col gap-2 sm:gap-3 min-h-0\">\n              {/* CartTableCard */}\n              <div className=\"flex-1 min-h-0 max-h-[calc(100vh-280px)]\">\n                <CartTableCard\n                cart={cart}\n                handleRemove={handleRemove}\n                handleEditQuantity={(idx, newQuantity) => {\n                  handleEditQuantity(idx, newQuantity);\n                  setEditingCartItem(null);\n                }}\n                total={total}\n                appliedDiscount={appliedDiscount}\n                selectedIdx={selectedCartIdx}\n                onSelectRow={setSelectedCartItem}\n                editingIdx={editingCartItem}\n                editQty={editQty}\n                onEditQtyChange={handleEditQtyChange}\n                onEditComplete={() => setEditingCartItem(null)}\n                onStartEdit={(idx) => setEditingCartItem(idx)}\n                className=\"flex-1 h-full\"\n              />\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"grid grid-cols-12 gap-2 sm:gap-3 flex-shrink-0\">\n                {appliedDiscount && (\n                  <div className=\"col-span-12 flex items-center justify-between bg-emerald-50 border border-emerald-200 text-emerald-800 rounded-lg px-3 py-2\">\n                    <span className=\"text-sm font-semibold\">\n                      Discount applied: {appliedDiscount.label}\n                    </span>\n                    <button\n                      className=\"text-xs font-bold underline flex items-center gap-1\"\n                      onClick={() => setAppliedDiscount(null)}\n                    >\n                      <span className=\"text-yellow-600\">(F11)</span> Remove\n                    </button>\n                  </div>\n                )}\n                {/* Grouped Buttons */}\n                <div className=\"col-span-8\">\n                  <div className=\"grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3\">\n                    <Button\n                      label={<ButtonLabel text=\"CASH LEDGER\" shortcut=\"F5\" />}\n                      size=\"md\"\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\n                      variant=\"secondary\"\n                      microinteraction\n                      onClick={() => setShowCashLedger(true)}\n                      icon={\n                        <svg\n                          className=\"w-4 h-4\"\n                          fill=\"none\"\n                          stroke=\"currentColor\"\n                          viewBox=\"0 0 24 24\"\n                        >\n                          <path\n                            strokeLinecap=\"round\"\n                            strokeLinejoin=\"round\"\n                            strokeWidth={2}\n                            d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n                          />\n                        </svg>\n                      }\n                      iconPosition=\"left\"\n                    />\n                    <div className=\"relative group flex-1\">\n                      <Button\n                        label={\n                          appliedDiscount\n                            ? <ButtonLabel text=\"REMOVE DISCOUNT\" shortcut=\"F11\" variant=\"secondary\" />\n                            : <ButtonLabel text=\"ADD DISCOUNT\" shortcut=\"F6\" />\n                        }\n                        variant=\"secondary\"\n                        onClick={() => {\n                          if (appliedDiscount) {\n                            if (window.confirm(`Remove ${appliedDiscount.label || 'discount'}?`)) {\n                              setAppliedDiscount(null);\n                            }\n                          } else {\n                            setShowDiscount(true);\n                          }\n                        }}\n                        icon={\n                          appliedDiscount ? (\n                            <svg\n                              className=\"w-5 h-5\"\n                              fill=\"none\"\n                              stroke=\"currentColor\"\n                              viewBox=\"0 0 24 24\"\n                            >\n                              <path\n                                strokeLinecap=\"round\"\n                                strokeLinejoin=\"round\"\n                                strokeWidth={2}\n                                d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"\n                              />\n                            </svg>\n                          ) : (\n                            <svg\n                              className=\"w-5 h-5\"\n                              fill=\"none\"\n                              stroke=\"currentColor\"\n                              viewBox=\"0 0 24 24\"\n                            >\n                              <path\n                                strokeLinecap=\"round\"\n                                strokeLinejoin=\"round\"\n                                strokeWidth={2}\n                                d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n                              />\n                            </svg>\n                          )\n                        }\n                        className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\n                      />\n                      {appliedDiscount && (\n                        <div className=\"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none\">\n                          Click to remove discount\n                          <div className=\"absolute bottom-0 left-1/2 w-2 h-2 bg-gray-800 transform -translate-x-1/2 translate-y-1/2 rotate-45\"></div>\n                        </div>\n                      )}\n                    </div>\n                    <Button\n                      label={<ButtonLabel text=\"PRICE CHECK\" shortcut=\"F7\" />}\n                      size=\"md\"\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\n                      onClick={() => setShowPriceCheck(true)}\n                      variant=\"secondary\"\n                      microinteraction\n                      icon={\n                        <svg\n                          className=\"w-4 h-4\"\n                          fill=\"none\"\n                          stroke=\"currentColor\"\n                          viewBox=\"0 0 24 24\"\n                        >\n                          <path\n                            strokeLinecap=\"round\"\n                            strokeLinejoin=\"round\"\n                            strokeWidth={2}\n                            d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\n                          />\n                        </svg>\n                      }\n                      iconPosition=\"left\"\n                    />\n                    <Button\n                      label={<ButtonLabel text=\"SCAN CUSTOMER QR\" shortcut=\"F8\" />}\n                      size=\"md\"\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\n                      onClick={() => setShowImportCart(true)}\n                      variant=\"secondary\"\n                      microinteraction\n                      icon={\n                        <svg\n                          className=\"w-4 h-4\"\n                          fill=\"none\"\n                          stroke=\"currentColor\"\n                          viewBox=\"0 0 24 24\"\n                        >\n                          <path\n                            strokeLinecap=\"round\"\n                            strokeLinejoin=\"round\"\n                            strokeWidth={2}\n                            d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12\"\n                          />\n                        </svg>\n                      }\n                      iconPosition=\"left\"\n                    />\n                  </div>\n                </div>\n\n                {/* Checkout Button */}\n                <div className=\"col-span-4\">\n                  <Button\n                    label={<ButtonLabel text=\"CHECKOUT\" shortcut=\"F12\" variant=\"primary\" />}\n                    size=\"md\"\n                    className=\"w-full h-full text-sm sm:text-base font-bold\"\n                    variant=\"primary\"\n                    microinteraction\n                    onClick={() => setShowCheckout(true)}\n                    disabled={cart.length === 0}\n                    icon={\n                      <svg\n                        className=\"w-5 h-5\"\n                        fill=\"none\"\n                        stroke=\"currentColor\"\n                        viewBox=\"0 0 24 24\"\n                      >\n                        <path\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                          strokeWidth={2}\n                          d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\n                        />\n                      </svg>\n                    }\n                    iconPosition=\"left\"\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n        </main>\n      </div>\n      {/* Modals */}\n      <DiscountModal\n        isOpen={showDiscount}\n        onClose={() => setShowDiscount(false)}\n        onApplyDiscount={(discount) => {\n          setAppliedDiscount(discount);\n          setShowDiscount(false);\n        }}\n      />\n      <PriceCheckModal\n        isOpen={showPriceCheck}\n        onClose={() => setShowPriceCheck(false)}\n        sku={priceCheckSku}\n        setSku={setPriceCheckSku}\n      />\n      <CashLedgerModal\n        isOpen={showCashLedger}\n        onClose={() => setShowCashLedger(false)}\n      />\n      <AdminReceiptsModal\n        isOpen={showReceipts}\n        onClose={() => setShowReceipts(false)}\n      />\n      <CheckoutModal\n        isOpen={showCheckout}\n        onClose={() => setShowCheckout(false)}\n        total={total}\n        onSelectPayment={(method) => {\n          setSelectedPayment(method);\n          setShowCheckout(false);\n\n          if (method === \"cash\") {\n            setShowCashModal(true);\n          } else if (method === \"gcash\") {\n            (async () => {\n              try {\n                const successUrl =\n                  window.location.origin + \"/pos?payment=success\";\n                const cancelUrl =\n                  window.location.origin + \"/pos?payment=cancel\";\n                // persist cart to finalize after redirect back\n                localStorage.setItem(\n                  \"pending_gcash_cart\",\n                  JSON.stringify({\n                    items: cart.map((i) => ({\n                      product_id: i.product_id,\n                      quantity: i.quantity,\n                    })),\n                    total,\n                    discount_id: appliedDiscount?.discount_id || null,\n                    discount_percentage: appliedDiscount?.type === 'percentage' ? Number(appliedDiscount.value) : null,\n                    discount_amount: appliedDiscount?.type === 'amount' ? Number(appliedDiscount.value) : null,\n                  })\n                );\n                const { checkoutUrl } = await createGcashCheckout({\n                  amount: Number(total || 0),\n                  description: \"POS Order\",\n                  referenceNumber: transactionNumber || `POS-${Date.now()}`,\n                  cancelUrl,\n                  successUrl,\n                });\n                window.open(checkoutUrl, \"_blank\");\n              } catch (e) {\n                setError(\"Failed to init GCash\");\n                localStorage.removeItem(\"pending_gcash_cart\");\n              }\n            })();\n          } else if (method === \"maya\") {\n            (async () => {\n              try {\n                const successUrl =\n                  window.location.origin + \"/pos?payment=success\";\n                const cancelUrl =\n                  window.location.origin + \"/pos?payment=cancel\";\n                // persist cart to finalize after redirect back\n                localStorage.setItem(\n                  \"pending_maya_cart\",\n                  JSON.stringify({\n                    items: cart.map((i) => ({\n                      product_id: i.product_id,\n                      quantity: i.quantity,\n                    })),\n                    total,\n                    discount_id: appliedDiscount?.discount_id || null,\n                    discount_percentage: appliedDiscount?.type === 'percentage' ? Number(appliedDiscount.value) : null,\n                    discount_amount: appliedDiscount?.type === 'amount' ? Number(appliedDiscount.value) : null,\n                  })\n                );\n                const { checkoutUrl } = await createMayaCheckout({\n                  amount: Number(total || 0),\n                  description: \"POS Order\",\n                  referenceNumber: transactionNumber || `POS-${Date.now()}`,\n                  cancelUrl,\n                  successUrl,\n                });\n                window.open(checkoutUrl, \"_blank\");\n              } catch (e) {\n                setError(\"Failed to init Maya\");\n                localStorage.removeItem(\"pending_maya_cart\");\n              }\n            })();\n          } else {\n            handleCheckout(method);\n          }\n        }}\n      />\n      <CashPaymentModal\n        isOpen={showCashModal}\n        onClose={() => setShowCashModal(false)}\n        total={total}\n        onConfirm={(amountReceived) => {\n          handleCheckout(\"cash\", amountReceived);\n          setShowCashModal(false);\n        }}\n      />\n      {showLogoutConfirm && (\n        <div className=\"fixed inset-0 z-90 flex items-center justify-center\">\n          <div\n            className=\"absolute inset-0 bg-black/80 z-90\"\n            onClick={handleCloseLogoutModal}\n          />\n          <div \n            className=\"relative bg-white rounded-xl shadow-xl w-[92%] max-w-md z-100 p-0\"\n            onKeyDown={(e) => {\n              // Prevent event from bubbling up to document\n              e.stopPropagation();\n              \n              // Handle Enter key specifically for the modal\n              if (e.key === 'Enter' && !e.isPropagationStopped()) {\n                e.preventDefault();\n                confirmLogout();\n              }\n            }}\n          >\n            {/* Header Section */}\n            <div className=\"bg-gradient-to-r from-red-50 via-red-50/80 to-orange-50/50 border-b border-red-100 px-6 py-5 rounded-t-2xl\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg\">\n                  <svg\n                    className=\"w-6 h-6 text-white\"\n                    fill=\"none\"\n                    stroke=\"white\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeWidth=\"2\"\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"\n                    />\n                  </svg>\n                </div>\n                <div className=\"flex-1\">\n                  <h2 className=\"text-xl font-bold text-gray-900 mb-1\">\n                    Confirm Logout\n                  </h2>\n                  <p className=\"text-sm text-gray-600\">\n                    Are you sure you want to log out? <span className=\"text-xs opacity-70\">(Press Esc to cancel, Enter to confirm)</span>\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Content Section */}\n            <div className=\"p-6\">\n              <p className=\"text-sm text-gray-700 mb-6\">\n                You will be redirected to the login page and your session will\n                end.\n              </p>\n\n              {/* Action Buttons */}\n              <div className=\"flex justify-end gap-3\">\n                <button\n                  onClick={handleCloseLogoutModal}\n                  className=\"px-5 py-2.5 rounded-lg text-sm font-semibold text-gray-700 bg-white border-2 border-gray-300 hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\n                  autoFocus\n                >\n                  Cancel (Esc)\n                </button>\n                <button\n                  onClick={confirmLogout}\n                  className=\"px-5 py-2.5 rounded-lg text-sm font-semibold text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 shadow-md hover:shadow-lg transition-all duration-200 flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\n                >\n                  <svg\n                    className=\"w-5 h-5\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeWidth=\"2\"\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"\n                    />\n                  </svg>\n                  Logout (Enter)\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n      <ScanCustomerCartModal\n        isOpen={showImportCart}\n        onClose={() => setShowImportCart(false)}\n        onImport={async (items, transactionId, completionResponse) => {\n          try {\n            // If transaction was completed (completionResponse exists), navigate to receipt\n            if (completionResponse && transactionId) {\n              setCart([]);\n              setTransactionId(null);\n              setTransactionNumber(null);\n              setError(\"\");\n              setShowImportCart(false);\n              // Navigate to receipt page for admin\n              window.location.href = `/receipt?tn=${completionResponse.transaction_number || transactionId}`;\n              return;\n            }\n            \n            // Otherwise, import items (backward compatibility for old QR format)\n            if (!items || items.length === 0) {\n              setError(\"No items found in QR code\");\n              return;\n            }\n            \n            // If we have a transaction ID from the scanned cart, use it\n            if (transactionId) {\n              setTransactionId(transactionId);\n            }\n            \n            console.log(\"Scanned items:\", items);\n            // Fetch product details by product_id for all scanned items concurrently\n            const fetchedProducts = await Promise.all(\n              items.map(async (item) => {\n                const res = await api(`/api/products/${item.product_id}`, {\n                  headers: { Authorization: `Bearer ${token}` },\n                });\n                console.log(\n                  \"Fetched product for id\",\n                  item.product_id,\n                  \":\",\n                  res\n                );\n                return {\n                  product_id: item.product_id,\n                  sku: res.sku || item.sku || \"\",\n                  name: res.product_name || \"\",\n                  price: Number(res.selling_price) || 0,\n                  quantity: item.quantity,\n                };\n              })\n            );\n            setCart((prev) => {\n              const byProductId = new Map(prev.map((i) => [i.product_id, i]));\n              for (const it of fetchedProducts) {\n                const existing = byProductId.get(it.product_id);\n                if (existing) {\n                  existing.quantity += it.quantity;\n                } else {\n                  byProductId.set(it.product_id, { ...it });\n                }\n              }\n              return Array.from(byProductId.values());\n            });\n          } catch (e) {\n            console.error(\"Error fetching products for scanned items:\", e);\n            // Fallback to use raw items if fetch fails\n            setCart((prev) => {\n              const byProductId = new Map(prev.map((i) => [i.product_id, i]));\n              for (const it of items) {\n                const existing = byProductId.get(it.product_id);\n                if (existing) {\n                  existing.quantity += it.quantity;\n                } else {\n                  byProductId.set(it.product_id, {\n                    ...it,\n                    name: \"\",\n                    price: 0,\n                  });\n                }\n              }\n              return Array.from(byProductId.values());\n            });\n          }\n        }}\n      />\n    </PageLayout>\n  );\n}\n\nexport default POS;\n"],"names":["AdminReceiptsModal","isOpen","onClose","receipts","setReceipts","useState","loading","setLoading","error","setError","selectedIndex","setSelectedIndex","containerRef","useRef","useEffect","async","token","sessionStorage","getItem","data","api","headers","Authorization","Array","isArray","e","fetchReceipts","openReceipt","useCallback","receipt","url","URL","window","location","origin","transaction_number","searchParams","set","transaction_id","String","open","toString","index","handleKeyDown","length","preventDefault","key","prev","newIndex","setTimeout","items","current","querySelectorAll","selectedItem","scrollIntoView","behavior","block","inline","focus","preventScroll","firstButton","querySelector","jsxs","BaseModal","title","subtitle","size","footer","jsx","Button","label","variant","onClick","className","children","ref","onKeyDown","tabIndex","map","r","onFocus","Date","updated_at","created_at","toLocaleString","Number","total_amount","total","toFixed","payment","method","payment_type","discount_percentage","discount_amount","ButtonLabel","text","shortcut","POS","navigate","useNavigate","sku","setSku","quantity","setQuantity","cart","setCart","showDiscount","setShowDiscount","showPriceCheck","setShowPriceCheck","priceCheckSku","setPriceCheckSku","showImportCart","setShowImportCart","showCashLedger","setShowCashLedger","showCheckout","setShowCheckout","showCashModal","setShowCashModal","selectedPayment","setSelectedPayment","darkMode","setDarkMode","scannerPaused","setScannerPaused","transactionNumber","setTransactionNumber","transactionId","setTransactionId","timer","clearTimeout","showReceipts","setShowReceipts","skuInputRef","isSidebarOpen","setSidebarOpen","selectedItemIdx","setSelectedItemIdx","editingIdx","setEditingIdx","user","JSON","parse","hasFinalizedRef","React","businessName","setBusinessName","selectedCartIdx","setSelectedCartIdx","editingCartItem","setEditingCartItem","editQty","setEditQty","showLogoutConfirm","setShowLogoutConfirm","appliedDiscount","setAppliedDiscount","quantityInputRef","businessId","business_id","timePart","toISOString","replace","slice","randPart","Math","floor","random","padStart","status","URLSearchParams","search","get","isNewTab","opener","closed","finalizeOnlinePayment","pendingCartKey","paymentType","pending","localStorage","parsed","guardKey","setItem","body","toLowerCase","money_received","discount_id","resp","stringify","href","close","_","removeItem","delete","history","replaceState","addSkuToCart","skuValue","qty","product","encodeURIComponent","price","selling_price","stockQty","stock_quantity","product_name","existingIdx","findIndex","i","product_id","next","newQty","name","err","handleAddToCart","handleRemove","idx","filter","handleEditQuantity","max","item","message","handleIncrementQuantity","cartItem","handleDecrementQuantity","currentQty","subtotal","reduce","sum","type","discountValue","value","isNaN","discountAmount","isInputFocused","target","tagName","isContentEditable","includes","stopPropagation","isSkuInput","isArrowKey","isQuantityKey","addEventListener","removeEventListener","min","anyModalOpen","activeElement","document","useKeyboardShortcuts","action","focusSkuInput","select","handleEditQuantityShortcut","enabled","handleVoidSelected","description","handleDiscountToggle","handleRemoveDiscount","allowWhileTyping","confirmLogout","handleCloseLogoutModal","capture","handleCheckout","paymentMethod","amountReceived","payload","pathname","showRecentReceiptsModal","setShowRecentReceiptsModal","headerActions","store_name","navigator","clipboard","writeText","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","BiReceipt","PageLayout","sidebar","NavAdmin","ScannerCard","onScan","result","code","rawValue","scannedData","t","it","p","q","fetchedProducts","Promise","all","res","byProductId","Map","existing","from","values","paused","onResume","textMain","SkuFormCard","CartTableCard","newQuantity","selectedIdx","onSelectRow","onEditQtyChange","onEditComplete","onStartEdit","microinteraction","icon","iconPosition","confirm","disabled","DiscountModal","onApplyDiscount","discount","PriceCheckModal","CashLedgerModal","CheckoutModal","onSelectPayment","successUrl","cancelUrl","checkoutUrl","createGcashCheckout","amount","referenceNumber","now","createMayaCheckout","CashPaymentModal","onConfirm","isPropagationStopped","autoFocus","ScanCustomerCartModal","onImport","completionResponse","log","console"],"mappings":"wsBAMA,SAASA,GAAmBC,OAAEA,EAAAA,QAAQC,IACpC,MAAOC,EAAUC,GAAeC,EAAAA,SAAS,KAClCC,EAASC,GAAcF,EAAAA,UAAS,IAChCG,EAAOC,GAAYJ,EAAAA,SAAS,KAC5BK,EAAeC,GAAoBN,EAAAA,SAAS,GAC7CO,EAAeC,SAAO,MACJA,EAAAA,OAAO,MAE/BC,EAAAA,UAAU,KACR,IAAKb,EAAQ,OACSc,WACpBR,GAAW,GACXE,EAAS,IACL,IACIO,MAAAA,EAAQC,eAAeC,QAAQ,cAC/BC,QAAaC,EAAI,6BAA8B,CACnDC,QAAS,CAAEC,cAAe,UAAUN,OAEtCZ,EAAYmB,MAAMC,QAAQL,GAAQA,EAAO,UAClCM,GACCjB,QAAAA,MAAM,2BAA4BiB,GAC1ChB,EAAS,6CAA4C,CAC7C,QACRF,GAAW,EAAK,GAGNmB,IACb,CAACzB,IAEE0B,MAAAA,EAAcC,cAAyBC,IAC3C,MAAMC,EAAM,IAAIC,IAAIC,OAAOC,SAASC,OAAS,YACzCL,EAAQM,oBACVL,EAAIM,aAAaC,IAAI,KAAMR,EAAQM,oBACjCN,EAAQS,gBACNF,EAAAA,aAAaC,IAAI,MAAOE,OAAOV,EAAQS,iBAC7CN,OAAOQ,KAAKV,EAAIW,WAAY,WAC3B,IAEwBb,cAAuBc,IAC3CvC,EAASuC,IACFvC,EAAAA,EAASuC,KACpB,CAACvC,EAAUwB,IAGRgB,MAAAA,EAAgBf,cAAmBH,IACvC,GAAKxB,GAAWE,EAASyC,OAGzB,OAFAnB,EAAEoB,iBAEMpB,EAAEqB,KACR,IAAK,UACHnC,EAAyBoC,IACvB,MAAMC,EAAWD,GAAQ,EAAI5C,EAASyC,OAAS,EAAIG,EAAO,EAenDC,OAbPC,WAAW,KACT,MAAMC,EAAQtC,EAAauC,SAASC,iBAAiB,UAC/CC,EAAeH,IAAQF,GACzBK,IAEFA,EAAaC,eAAe,CAC1BC,SAAU,SACVC,MAAO,UACPC,OAAQ,YAEVJ,EAAaK,MAAM,CAAEC,eAAe,MAErC,GACIX,IAET,MAEF,IAAK,YACHrC,EAAyBoC,IACvB,MAAMC,EAAWD,GAAQ5C,EAASyC,OAAS,EAAI,EAAIG,EAAO,EAenDC,OAbPC,WAAW,KACT,MAAMC,EAAQtC,EAAauC,SAASC,iBAAiB,UAC/CC,EAAeH,IAAQF,GACzBK,IAEFA,EAAaC,eAAe,CAC1BC,SAAU,SACVC,MAAO,UACPC,OAAQ,YAEVJ,EAAaK,MAAM,CAAEC,eAAe,MAErC,GACIX,IAET,MAEF,IAAK,QACHvB,EAAEoB,iBACE1C,EAASO,IACCP,EAAAA,EAASO,IAEvB,MACF,IAAK,SACKR,MAKX,CAACD,EAAQE,EAAUO,EAAeR,EAASyB,IAmB5C,OAdFb,EAAAA,UAAU,KACJb,IACFU,EAAiB,GAEjBsC,WAAW,KACT,MAAMW,EAAchD,EAAauC,SAASU,cAAc,UACpDD,GACFA,EAAYF,MAAM,CAAEC,eAAe,KAEpC,OAEJ,CAAC1D,EAAQE,IAGV2D,OAACC,GACC9D,SACAC,UACA8D,MAAM,mBACNC,SAAS,0CACTC,KAAK,KACLC,OACGC,MAAAC,EAAA,CACCC,MAAM,cACNC,QAAQ,YACRC,QAAStE,EACTuE,UAAU,WAIbnE,SAAAA,CAAAA,GACE8D,EAAAA,IAAA,MAAA,CAAIK,UAAU,yCAAyCC,SAExD,4BAEDlE,GACC4D,EAAAA,IAAC,MAAI,CAAAK,UAAU,iFACZjE,SACHA,KAEAF,IAAYE,GAA6B,IAApBL,EAASyC,QAC7BwB,MAAA,MAAA,CAAIK,UAAU,yCAAyCC,SAExD,2BAEDN,EAAAA,IAAA,MAAA,CACCO,IAAK/D,EACL6D,UAAU,sDACVG,UAAWjC,EACXkC,SAAU,EAET1E,SAAS2E,EAAAA,IAAI,CAACC,EAAGrC,IACfoB,EAAAA,KAAA,SAAA,CAECU,QAAS,IAAM7C,EAAYoD,GAC3BN,UAAW,mEACT/D,IAAkBgC,EACd,kDACA,0DAENsC,QAAS,IAAMrE,EAAiB+B,GAChCmC,SAAU,EAEVH,SAAA,CAACZ,EAAAA,KAAA,MAAA,CAAIW,UAAU,oCACbC,SAAA,CAAAZ,OAAC,MACC,CAAAY,SAAA,CAACN,EAAAA,IAAA,IAAA,CAAEK,UAAU,sCACVM,SAAAA,EAAE5C,oBAAsB,OAAO4C,EAAEzC,gBAAkB,OAErD8B,EAAAA,IAAA,IAAA,CAAEK,UAAU,wBACVC,SAAIO,IAAAA,KAAKF,EAAEG,YAAcH,EAAEI,YAAYC,sBAG5CtB,EAAAA,KAAC,MAAI,CAAAW,UAAU,aACbC,SAAA,CAACZ,EAAAA,KAAA,IAAA,CAAEW,UAAU,kCAAkCC,SAAA,CAAA,IAC3CW,OAAON,EAAEO,cAAgBP,EAAEQ,OAAS,GAAGC,QAAQ,MAEnDpB,EAAAA,IAAC,KAAEK,UAAU,sCACVM,WAAEU,SAASC,QAAUX,EAAEY,cAAgB,gBAI5CZ,EAAEa,qBAAuBb,EAAEc,kBAC1B/B,OAAA,IAAA,CAAEW,UAAU,oCAAoCC,SAAA,CAAA,mBAC9B,IAChBK,EAAEa,oBACC,GAAGb,EAAEa,uBACL,IAAIP,OAAON,EAAEc,iBAAmB,GAAGL,QAAQ,UAjC9C,GAAGT,EAAEzC,kBAAkByC,EAAE5C,2BAyC1C,CC1LA,MAAM2D,EAAcA,EAAGC,OAAMC,WAAUzB,UAAU,eAC/CT,EAAAA,KAAC,MAAI,CAAAW,UAAU,0BACbC,SAAA,CAAAN,EAAAA,IAAC,QAAM2B,SAAKA,IACZ3B,EAAAA,IAAC,QAAKK,UAAW,0EACH,YAAZF,EACI,yCACA,6CAEHyB,SACHA,OAIJ,SAASC,IACP,MAAMC,EAAWC,KAGVC,EAAKC,GAAUhG,EAAAA,SAAS,KACxBiG,EAAUC,GAAelG,EAAAA,SAAS,IAClCmG,EAAMC,GAAWpG,EAAAA,SAAS,KAC1BqG,EAAcC,GAAmBtG,EAAAA,UAAS,IAC1CuG,EAAgBC,GAAqBxG,EAAAA,UAAS,IAC9CyG,EAAeC,GAAoB1G,EAAAA,SAAS,KAC5C2G,EAAgBC,GAAqB5G,EAAAA,UAAS,IAC9C6G,EAAgBC,GAAqB9G,EAAAA,UAAS,IAC9C+G,EAAcC,GAAmBhH,EAAAA,UAAS,IAC1CiH,EAAeC,GAAoBlH,EAAAA,UAAS,IAC5CmH,EAAiBC,GAAsBpH,EAAAA,SAAS,OAChDqH,EAAUC,GAAetH,EAAAA,UAAS,IAClCuH,EAAeC,GAAoBxH,EAAAA,UAAS,IAC5CG,EAAOC,GAAYJ,EAAAA,SAAS,KAC5ByH,EAAmBC,GAAwB1H,EAAAA,SAAS,KACpD2H,GAAeC,IAAoB5H,EAAAA,SAAS,MAGnDS,EAAAA,UAAU,KACR,GAAIN,EAAO,CACH0H,MAAAA,EAAQjF,WAAW,KACvBxC,EAAS,KACR,KACI,MAAA,IAAM0H,aAAaD,EAAK,GAEhC,CAAC1H,IACJ,MAAO4H,GAAcC,IAAmBhI,EAAAA,UAAS,GAC3CiI,GAAczH,SAAO,OACpB0H,GAAeC,IAAkBnI,EAAAA,UAAS,IAC1CoI,GAAiBC,IAAsBrI,EAAAA,UAAS,IAChDsI,GAAYC,IAAiBvI,EAAAA,SAAS,MACvCW,GAAQC,eAAeC,QAAQ,cAC/B2H,GAAOC,KAAKC,MAAM9H,eAAeC,QAAQ,SAAW,MACpD8H,GAAkBC,EAAMpI,QAAO,IAC9BqI,GAAcC,IAAmB9I,EAAAA,SAAS,KAC1C+I,GAAiBC,IAAsBhJ,EAAAA,SAAS,IAChDiJ,GAAiBC,IAAsBlJ,EAAAA,SAAS,OAChDmJ,GAASC,IAAcpJ,EAAAA,SAAS,MAChCqJ,GAAmBC,IAAwBtJ,EAAAA,UAAS,IACpDuJ,GAAiBC,IAAsBxJ,EAAAA,SAAS,MACjDyJ,GAAmBjJ,SAAO,MAWhCC,EAAAA,UAAU,KACR,IAAKgH,EAAmB,CACtB,MAAMiC,EAAalB,IAAMkB,YAAclB,IAAMmB,aAAe,MACtDC,GAAW,IAAIhF,MAClBiF,cACAC,QAAQ,WAAY,IACpBC,MAAM,EAAG,IACNC,EAAWC,KAAKC,MAAM,IAAuB,IAAhBD,KAAKE,UACxCzC,EACE,KAAKgC,EAAWtH,WAAWgI,SAAS,EAAG,QAAQR,KAAYI,IAC7D,GAGD,IAGHvJ,EAAAA,UAAU,KACFoH,MAAAA,EAAQjF,WAAW,KACvBqF,GAAYnF,SAASO,SACpB,KACI,MAAA,IAAMyE,aAAaD,IACzB,IAGHpH,EAAAA,UAAU,KACR,MACM4J,EADS,IAAIC,gBAAgB3I,OAAOC,SAAS2I,QAC7BC,IAAI,WACpBd,EAAalB,IAAMkB,YAAclB,IAAMmB,YAGvCc,EAAW9I,OAAO+I,SAAW/I,OAAO+I,OAAOC,OAE3CC,EAAwBlK,MAAOmK,EAAgBC,KAC7CC,MAAAA,EAAUC,aAAanK,QAAQgK,GACjCR,GAAW,YAAXA,GAAwBU,GAAWrB,EACjC,IACIuB,MAAAA,EAASxC,KAAKC,MAAMqC,GAC1B,GAAIpC,GAAgB7F,QAAS,OACvBoI,MAAAA,EAAW,GAAGJ,kBACpB,GAAyC,MAArClK,eAAeC,QAAQqK,GAAmB,OAC9CvC,GAAgB7F,SAAU,EACXqI,eAAAA,QAAQD,EAAU,KAC7B,IACF9K,EAAS,IACT,MAAMgL,EAAO,CACXvI,MAAOoI,EAAOpI,OAAS,GACvByC,aAAcwF,EAAYO,cAC1BC,eAAgBL,EAAO/F,OAAS,KAChCqG,YAAaN,EAAOM,aAAe,KACnChG,oBAAqB0F,EAAO1F,qBAAuB,KACnDC,gBAAiByF,EAAOzF,iBAAmB,MAEvCgG,QAAazK,EAAI,sBAAuB,CAC5CsE,OAAQ,OACRrE,QAAS,CAAEC,cAAe,UAAUN,MACpCyK,KAAM3C,KAAKgD,UAAUL,KAEnBI,GAAM1J,oBACa0J,EAAAA,EAAK1J,oBACxB0J,GAAMvJ,gBAAiCuJ,GAAAA,EAAKvJ,gBAChDmE,EAAQ,IACJ,IACF,MAAM3E,EAAM,IAAIC,IAAIC,OAAOC,SAASC,OAAS,YACzC2J,GAAM1J,oBACRL,EAAIM,aAAaC,IAAI,KAAMwJ,EAAK1J,oBAC9B0J,GAAMvJ,gBACJF,EAAAA,aAAaC,IAAI,MAAOE,OAAOsJ,EAAKvJ,iBACvB,MAAfuJ,GAAMtG,OACJnD,EAAAA,aAAaC,IAAI,QAASE,OAAOsJ,EAAKtG,QAGxCuF,GAAY9I,OAAO+I,QACrB/I,OAAO+I,OAAO9I,SAAS8J,KAAOjK,EAAIW,WAClCT,OAAOgK,SAEA/J,OAAAA,SAAS8J,KAAOjK,EAAIW,iBAEtBwJ,GAAG,QACLxK,GACEhB,EAAA,oBAAoB0K,YAAqB,CAC1C,QAER,GADAE,aAAaa,WAAWhB,IACnBJ,EAAU,CACb,MAAMhJ,EAAM,IAAIC,IAAIC,OAAOC,SAAS8J,MAChC3J,EAAAA,aAAa+J,OAAO,WACxBnK,OAAOoK,QAAQC,aAAa,CAAA,EAAI,GAAIvK,EAAIW,WAAU,CACpD,QAEKwJ,GACPZ,aAAaa,WAAWhB,EAAc,MAE1C,GAAsB,WAAXR,GAAuBU,EAG5BN,GAFJO,aAAaa,WAAWhB,GAEpBJ,GAAY9I,OAAO+I,OACrB/I,OAAOgK,YACF,CACL,MAAMlK,EAAM,IAAIC,IAAIC,OAAOC,SAAS8J,MAChC3J,EAAAA,aAAa+J,OAAO,WACxBnK,OAAOoK,QAAQC,aAAa,CAAA,EAAI,GAAIvK,EAAIW,WAAU,GAKxDwI,EAAsB,qBAAsB,SAC5CA,EAAsB,oBAAqB,SAC1C,IAEH,MAAMqB,GAAevL,MAAOwL,EAAUC,EAAM,KACtC,GAACD,KAAYC,EAAM,GAAnB,CACJ/L,EAAS,IACL,IACF,MAAMgM,QAAgBrL,EACpB,qBAAqBsL,mBAAmBH,KACxC,CACElL,QAAS,CAAEC,cAAe,UAAUN,QAGlC2L,EAAQtH,OAAOoH,EAAQG,eAAiB,GACxCC,EAAWxH,OAAOoH,EAAQK,gBAAkB,GAClD,GAAID,GAAY,EAId,YAHApM,EACE,aAAagM,EAAQM,qBAAqBN,EAAQrG,cAItD,GAAIoG,EAAMK,EAIR,YAHApM,EACE,kCAAkCoM,iBAAwBL,MAI9D/F,EAAkB1D,IAChB,MAAMiK,EAAcjK,EAAKkK,aAChBC,EAAEC,aAAeV,EAAQU,YAElC,GAAIH,GAAe,EAAG,CACdI,MAAAA,EAAO,IAAIrK,GACXsK,EAASD,EAAKJ,GAAa1G,SAAWkG,EAC5C,OAAIa,EAASR,GACXpM,EACE,kCAAkCoM,iBAAwBQ,MAErDtK,IAETqK,EAAKJ,GAAe,IAAKI,EAAKJ,GAAc1G,SAAU+G,GAC/CD,EAAAA,CAEF,MAAA,IACFrK,EACH,CACEoK,WAAYV,EAAQU,WACpB/G,IAAKqG,EAAQrG,IACbkH,KAAMb,EAAQM,aACdzG,SAAUkG,EACVG,YAINtG,EAAO,IACPE,EAAY,GAEZtD,WAAW,KACTqF,GAAYnF,SAASO,SACpB,UACI6J,GACP9M,EAAS,oBAAmB,CACpB,QAERwC,WAAW,KACT4E,GAAiB,IAChB,IAAG,CA9DkB,GAkEtB2F,GAAkBzM,gBAChBuL,GAAalG,EAAKE,IAGpBmH,GAAwBC,IACxBA,GAAO,GAAKA,EAAMlH,EAAK5D,QACzB6D,EAAQD,EAAKmH,OAAO,CAAC1B,EAAGiB,IAAMA,IAAMQ,KAIlCE,GAAqB7M,MAAO2M,EAAKlB,KAC/Ba,MAAAA,EAAiB,KAARb,EAAa,EAAIlC,KAAKuD,IAAI,EAAGxI,OAAOmH,IAAQ,GACrDsB,EAAOtH,EAAKkH,GAClB,GAAKI,EAAL,CACArN,EAAS,IACL,IACIgM,MAAAA,QAAgBrL,EACpB,qBAAqBsL,mBAAmBoB,EAAK1H,OAC7C,CACE/E,QAAS,CAAEC,cAAe,UAAUN,QAGlC6L,EAAWxH,OAAOoH,EAAQK,gBAAkB,GAClD,GAAIO,EAASR,EAIX,YAHApM,EACE,kCAAkCoM,iBAAwBQ,MAI9D5G,KACE1D,EAAK+B,IAAI,CAACgJ,EAAMZ,IACdA,IAAMQ,EAAM,IAAKI,EAAMxH,SAAU+G,GAAWS,IAGhDrE,GAAW4D,GACX9D,GAAmB,YACZgE,GACEA,EAAAA,EAAIQ,SAAW,4BAA2B,CAxB1C,GAkCPC,GAA0BjN,UAC9B,GAAoB,IAAhByF,EAAK5D,QAAgBwG,GAAkB,GAAKA,IAAmB5C,EAAK5D,OAAQ,OAC1EkL,MAAAA,EAAOtH,EAAK4C,IAClB,IAAK0E,EAAM,OACX,MACMT,EADaS,EAAKxH,SACI,EAC5B7F,EAAS,IACL,IACIgM,MAAAA,QAAgBrL,EACpB,qBAAqBsL,mBAAmBoB,EAAK1H,OAC7C,CACE/E,QAAS,CAAEC,cAAe,UAAUN,QAGlC6L,EAAWxH,OAAOoH,EAAQK,gBAAkB,GAClD,GAAIO,EAASR,EAIX,YAHApM,EACE,kCAAkCoM,iBAAwBQ,MAI9D5G,KACE1D,EAAK+B,IAAI,CAACmJ,EAAUf,IAClBA,IAAM9D,GAAkB,IAAK6E,EAAU3H,SAAU+G,GAAWY,UAGzDV,GACEA,EAAAA,EAAIQ,SAAW,4BAA2B,GAKjDG,GAA0BA,KAC9B,GAAoB,IAAhB1H,EAAK5D,QAAgBwG,GAAkB,GAAKA,IAAmB5C,EAAK5D,OAAQ,OAC1EkL,MAAAA,EAAOtH,EAAK4C,IAClB,IAAK0E,EAAM,OACX,MAAMK,EAAaL,EAAKxH,SACxB,GAAI6H,GAAc,EAAG,OACrB,MAAMd,EAASc,EAAa,EAC5B1H,KACE1D,EAAK+B,IAAI,CAACmJ,EAAUf,IAClBA,IAAM9D,GAAkB,IAAK6E,EAAU3H,SAAU+G,GAAWY,KAK5DG,GAAW5H,EAAK6H,OACpB,CAACC,EAAKR,IAASQ,EAAMR,EAAKnB,MAAQmB,EAAKxH,SACvC,GAIF,IAAIf,GAAQ6I,GACZ,GAAIxE,GACEA,GAAyB,eAAzBA,GAAgB2E,KAAuB,CACnCC,MAAAA,EAAgBnJ,OAAOuE,GAAgB6E,OAC7C,IAAKC,MAAMF,IAAkBA,EAAgB,EAAG,CACxCG,MAAAA,EAAiBP,IAAYI,EAAgB,KACnDjJ,GAAQ+E,KAAKuD,IAAI,EAAGO,GAAWO,EAAc,CAC/C,MACF,GAAoC,WAAzB/E,GAAgB2E,KAAmB,CACtCC,MAAAA,EAAgBnJ,OAAOuE,GAAgB6E,QACxCC,MAAMF,IAAkBA,EAAgB,IAC3CjJ,GAAQ+E,KAAKuD,IAAI,EAAGO,GAAWI,GACjC,CAKJ1N,EAAAA,UAAU,KACR,MAAM6B,EAAuBlB,IAE3B,GAAIiF,GAAgBE,GAAkBI,GAAkBE,GAAkBE,GAAgBE,GAAiBc,IAAgBsB,GACzH,OAIF,MAAMkF,EAAiBnN,EAAEoN,SACF,UAArBpN,EAAEoN,OAAOC,SACY,aAArBrN,EAAEoN,OAAOC,SACTrN,EAAEoN,OAAOE,mBAQPH,GAAAA,GAAsC,OAApBtF,KAJC,CAAC,UAAW,YAAa,QAAS,UAIS0F,SAASvN,EAAEqB,OAH5D,CAAC,IAAK,IAAK,IAAK,KAG8DkM,SAASvN,EAAEqB,OAFrF,CAAC,IAAK,KAEqGkM,SAASvN,EAAEqB,KACzI,OAIF,GAAc,WAAVrB,EAAEqB,KAAwC,OAApBwG,GAIxB,OAHA7H,EAAEoB,iBACFpB,EAAEwN,uBACF1F,GAAmB,MAKrB,GAAc,UAAV9H,EAAEqB,KAAuC,OAApBwG,GAKvB,OAJA7H,EAAEoB,iBACFpB,EAAEwN,kBACFrB,GAAmBtE,GAAiBE,SACpCD,GAAmB,MAKf2F,MAAAA,EAAazN,EAAEoN,SAAWvG,GAAYnF,QACtCgM,EAAuB,YAAV1N,EAAEqB,KAA+B,cAAVrB,EAAEqB,IACtCsM,EAA0B,MAAV3N,EAAEqB,KAAyB,MAAVrB,EAAEqB,IAEzC,GAAIqM,IAAeD,IAAeN,GAAsC,OAApBtF,IAClD,OAAQ7H,EAAEqB,KACR,IAAK,UACLrB,EAAEoB,iBACFpB,EAAEwN,kBACF5F,MAA2BtG,EAAO,EAAIA,EAAO,EAAIyD,EAAK5D,OAAS,GAC/D,MACA,IAAK,YACLnB,EAAEoB,iBACFpB,EAAEwN,kBACF5F,MAA2BtG,EAAOyD,EAAK5D,OAAS,EAAIG,EAAO,EAAI,IAS/DqM,IAAkBF,GAAeN,GAAsC,OAApBtF,IACjD9C,EAAK5D,OAAS,GAAKwG,IAAmB,GAAKA,GAAkB5C,EAAK5D,SACtD,MAAVnB,EAAEqB,KACJrB,EAAEoB,iBACFpB,EAAEwN,kBACsBjB,MACL,MAAVvM,EAAEqB,MACXrB,EAAEoB,iBACFpB,EAAEwN,kBACsBf,QAQhC,OADOmB,OAAAA,iBAAiB,UAAW1M,GAAe,GAC3C,KACE2M,OAAAA,oBAAoB,UAAW3M,GAAe,KAEtD,CAAC6D,EAAK5D,OAAQwG,GAAiBE,GAAiBE,GAAS9C,EAAcE,EAAgBI,EAAgBE,EAAgBE,EAAcE,EAAec,GAAcsB,GAAmBsE,GAAyBE,KAGjNpN,EAAAA,UAAU,KACY,IAAhB0F,EAAK5D,OACPyG,GAAmB,GAEnBA,MAA2BiB,KAAKiF,IAAIxM,EAAMyD,EAAK5D,OAAS,KAEzD,CAAC4D,EAAK5D,SAIT9B,EAAAA,UAAU,KACR,MAAM0O,EACJ9I,GACAE,GACAI,GACAE,GACAE,GACAE,GACAc,IACAsB,GAKF,GAHA7B,EAAiB2H,IAGZA,EAAc,CACXtH,MAAAA,EAAQjF,WAAW,KACvB,MAAMwM,EAAgBC,SAASD,cACRA,IACK,UAA1BA,EAAcX,SACY,aAA1BW,EAAcX,SACdW,EAAcV,mBACY,WAA1BU,EAAcX,UAGOY,SAASjE,OAASgE,GACvCnH,GAAYnF,SAASO,SAEtB,KACI,MAAA,IAAMyE,aAAaD,EAAK,GAEhC,CACDxB,EACAE,EACAI,EACAE,EACAE,EACAE,EACAc,GACAsB,KAuDAiG,EAAA,CAEE,CAAE7M,IAAK,IAAK8M,OAtDMC,KACpBvH,GAAYnF,SAASO,QACrB4E,GAAYnF,SAAS2M,aAsDnB,CACEhN,IAAK,KACL8M,OAnB6BG,KAC7BvJ,EAAK5D,OAAS,GAAKwG,IAAmB,GAAKA,GAAkB5C,EAAK5D,SACpE2G,GAAmBH,IACnBK,GAAWlH,OAAOiE,EAAK4C,IAAiB9C,aAiBtC0J,QAASxJ,EAAK5D,OAAS,GAAKwG,IAAmB,GAGjD,CACEtG,IAAK,KACL8M,OAnDqBK,KACL,IAAhBzJ,EAAK5D,QAAmC,MAAnBwG,IACzBqE,GAAarE,KAkDT4G,QAASxJ,EAAK5D,OAAS,GAGzB,CACEE,IAAK,KACLoN,YAAa,SACbN,OAAQA,IAAMjG,IAAqB,IAGrC,CACE7G,IAAK,KACL8M,OAAQpC,GACRwC,UAAW5J,GAGb,CAAEtD,IAAK,KAAM8M,OAAQA,IAAMzI,GAAkB,IAE7C,CACErE,IAAK,KACL8M,OArCuBO,KAC3BxJ,GAAiBD,KAuCf,CACE5D,IAAK,KACL8M,OAAQA,KACN/I,GAAkB,KAItB,CACE/D,IAAK,KACL8M,OAAQA,IAAM3I,GAAkB,IAGlC,CAAEnE,IAAK,KAAM8M,OAAQA,IAAMvH,IAAgB,IAG3C,CACEvF,IAAK,MACL8M,OAxEuBQ,KACvBxG,IACFC,GAAmB,OAuEjBmG,UAAWpG,IAGb,CACE9G,IAAK,MACL8M,OAAQA,IAAMvI,GAAgB,GAC9B2I,QAASxJ,EAAK5D,OAAS,GAGzB,CACEE,IAAK,IACL8M,OAAQ5B,GACRgC,QAASxJ,EAAK5D,OAAS,GAAKwG,IAAmB,GAAKA,GAAkB5C,EAAK5D,QAG7E,CACEE,IAAK,IACL8M,OAAQ1B,GACR8B,QAASxJ,EAAK5D,OAAS,GAAKwG,IAAmB,GAAKA,GAAkB5C,EAAK5D,QAE7E,CACEE,IAAK,SACL8M,OAAQA,KAEFxI,KAA8B,GACzBV,KAA8B,GAC9BE,KAAkC,GAClCI,KAAkC,GAClCM,KAAgC,GAChCJ,KAAkC,GAClCkB,OAA8B,GAC9BsB,QAAwC,IAGnD2G,kBAAkB,EAClBpB,iBAAiB,IAGrB,CACEzI,EAAK5D,OACLwG,GACAhD,EACAwD,GACAxC,EACAV,EACAE,EACAI,EACAM,EACAJ,EACAkB,GACAsB,KASJ,MAAM4G,GAAgBA,KACpBrP,eAAeiL,WAAW,cAC1BjL,eAAeiL,WAAW,QAE1BvC,IAAqB,GACrBzD,EAAS,MAGLqK,GAAyBA,KAC7B5G,IAAqB,IAIvB7I,EAAAA,UAAU,KACR,IAAK4I,GAAmB,OAExB,MAAM/G,EAAuBlB,IAE3BA,EAAEwN,kBAEY,WAAVxN,EAAEqB,KAA8B,QAAVrB,EAAEqB,KAC1BrB,EAAEoB,iBACqB0N,MACJ,UAAV9O,EAAEqB,MACXrB,EAAEoB,iBACYyN,OAMlB,OADSjB,SAAAA,iBAAiB,UAAW1M,EAAe,CAAE6N,SAAS,IACxD,IAAMd,SAASJ,oBAAoB,UAAW3M,EAAe,CAAE6N,SAAS,KAC9E,CAAC9G,KAEJ,MAAM+G,GAAiB1P,MAAO2P,EAAeC,EAAiB,QACxDnK,GAAgB,IAAhBA,EAAK5D,OAAL4D,CACJ/F,EAAS,IACL,IAEF,MAAMmQ,EAAU,CACd1N,MAAOsD,EAAK1B,IAAegJ,IAAA,CACzBX,WAAYW,EAAKX,WACjB7G,SAAUwH,EAAKxH,SACfqG,MAAOmB,EAAKnB,SAEdhH,aAAc+K,EACd/E,eAAgBgF,EAChBrO,eAAgB0F,GAChB7F,mBAAoB2F,EACpB8D,YAAahC,IAAiBgC,aAAe,KAC7ChG,oBAA+C,eAA1BgE,IAAiB2E,KAAwB3E,GAAgB6E,MAAQ,KACtF5I,gBAA2C,WAA1B+D,IAAiB2E,KAAoB3E,GAAgB6E,MAAQ,MAG1E5C,QAAazK,EAAI,sBAAuB,CAC5CsE,OAAQ,OACRrE,QAAS,CAAEC,cAAe,UAAUN,MACpCyK,KAAM3C,KAAKgD,UAAU8E,KAEnB/E,GAAM1J,oBACa0J,EAAAA,EAAK1J,oBACxB0J,GAAMvJ,gBAAiCuJ,GAAAA,EAAKvJ,gBAChDmE,EAAQ,IACJ,IACF,MAAM3E,EAAM,IAAIC,IAAIC,OAAOC,SAASC,OAAS,YACzC2J,GAAM1J,oBACRL,EAAIM,aAAaC,IAAI,KAAMwJ,EAAK1J,oBAC9B0J,GAAMvJ,gBACJF,EAAAA,aAAaC,IAAI,MAAOE,OAAOsJ,EAAKvJ,iBACvB,MAAfuJ,GAAMtG,OACJnD,EAAAA,aAAaC,IAAI,QAASE,OAAOsJ,EAAKtG,QACnCzD,EAAAA,EAAI+O,SAAW/O,EAAI8I,cACrBqB,GAAG,CAEZ,MAAMlC,EAAalB,IAAMkB,YAAclB,IAAMmB,aAAe,MACtDC,GAAW,IAAIhF,MAClBiF,cACAC,QAAQ,WAAY,IACpBC,MAAM,EAAG,IACNC,EAAWC,KAAKC,MAAM,IAAuB,IAAhBD,KAAKE,UACxCzC,EACE,KAAKgC,EAAWtH,WAAWgI,SAAS,EAAG,QAAQR,KAAYI,KAE7DR,GAAmB,MACnB5B,GAAiB,YACVsF,GACC/M,QAAAA,MAAM,kBAAmB+M,GACjC9M,EAAS,kBAAiB,CApDL,IAwDlBqQ,GAAyBC,IAA8B1Q,EAAAA,UAAS,GASjE2Q,GACJlN,EAAAA,KAAC,MAAI,CAAAW,UAAU,wCAEbC,SAAA,CAACZ,EAAAA,KAAA,MAAA,CAAIW,UAAU,YACZmF,SAAAA,CACCA,IAAA9F,EAAAA,KAAC,MAAI,CAAAW,UAAU,2DACbC,SAAA,CAAAN,EAAAA,IAAC,QAAKM,SAAiB,4BACtB,OAAK,CAAAD,UAAU,cACbmF,SAAyB,eAAT2E,GAAAA,KACb,GAAG3E,GAAgB6E,SACnB,IAAIpJ,OAAOuE,GAAgB6E,OAAOjJ,QAAQ,UAIpD1B,EAAAA,KAAC,MAAI,CAAAW,UAAU,0DACbC,SAAA,CAAAN,EAAAA,IAAC,QAAKM,SAAM,WACZZ,EAAAA,KAAC,MAAI,CAAAW,UAAU,0BACZmF,SAAAA,CACCA,IAAA9F,EAAAA,KAAC,OAAK,CAAAW,UAAU,qCAAoCC,SAAA,CAAA,IAChD0J,GAAS5I,QAAQ,aAGtB,OAAK,CAAAd,SAAA,CAAA,IAAEa,GAAMC,QAAQ,eAK5BpB,EAAAA,IAAC,MAAI,CAAAK,UAAU,0CACbC,SAAAZ,EAAAA,KAAC,SACC,CAAAU,QApCazD,UACf,IACE,IAAC8H,GAAKoI,WAAY,aAChBC,UAAUC,UAAUC,UAAUvI,GAAKoI,kBAClChF,GAAG,GAiCNjI,MAAM,kBACNS,UAAU,4HAEVC,SAAA,CAAAN,EAAAA,IAAC,OACCK,UAAU,wBACV4M,KAAK,OACLC,OAAO,eACPC,QAAQ,YAER7M,eAAC,OACC,CAAA8M,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,kGAGLvN,EAAAA,IAAA,OAAA,CAAKK,UAAU,8FACboE,YAAKoI,kBAKZnN,EAAAA,KAAC,SACC,CAAAU,QAAS,IAAM6D,IAAgB,GAC/B5D,UAAU,qJACVT,MAAM,yBAENU,SAAA,CAAAN,EAAAA,IAAC,OAAIK,UAAU,WACbC,eAACkN,EAAU,CAAAnN,UAAU,4BAEtBL,EAAAA,IAAA,OAAA,CAAKK,UAAU,qDAAoDC,SAEpE,aACCN,EAAAA,IAAA,OAAA,CAAKK,UAAU,iHAAgHC,SAEhI,aAMJ,OAAAZ,EAAAA,KAAC+N,EACC,CAAA7N,MAAM,MACN8N,cAAUC,MACVf,iBACAzI,iBACAC,kBAEA9D,SAAA,CAACN,EAAAA,IAAA,MAAA,CAAIK,UAAU,oCACbC,SAACN,EAAAA,IAAA,OAAA,CAAKK,UAAU,0HACdC,SAAAZ,OAAC,MAAI,CAAAW,UAAU,kEAEbC,SAAA,CAACZ,EAAAA,KAAA,MAAA,CAAIW,UAAU,sDAEbC,SAAA,CAAAN,EAAAA,IAAC,OAAIK,UAAU,gBACbC,eAACsN,EACC,CAAAC,OAAQlR,MAAOmR,IACPC,MAAAA,EAAOD,IAAS,IAAIE,SAC1B,GAAKD,EAEL,GADAtK,GAAiB,GACbjB,EACFG,EAAiBoL,QAEb,IACEE,IAAAA,EACA,IACYvJ,EAAAA,KAAKC,MAAMoJ,SAClB1Q,GACO4Q,EAAA,IAAA,CAGdA,GAAAA,GACkB,SAAlBA,EAAYC,GACZ/Q,MAAMC,QAAQ6Q,EAAYnP,OAC1B,CAEImP,EAAY/P,gBACd2F,GAAiBoK,EAAY/P,gBAG3B+P,EAAYlQ,oBACd4F,EACEsK,EAAYlQ,oBAGhB,MAAMe,EAAQmP,EAAYnP,MAAM4B,IAAayN,IAAA,CAC3CpF,WAAYoF,EAAGC,EACflM,SAAUiM,EAAGE,EACbrM,IAAKmM,EAAGnM,KAAO,MAEb,IACF,MAAMsM,QAAwBC,QAAQC,IACpC1P,EAAM4B,IAAI/D,MAAO+M,IACf,MAAM+E,QAAYzR,EAChB,iBAAiB0M,EAAKX,aACtB,CACE9L,QAAS,CACPC,cAAe,UAAUN,QAIxB,MAAA,CACLmM,WAAYW,EAAKX,WACjB/G,IAAKyM,EAAIzM,KAAO0H,EAAK1H,KAAO,GAC5BkH,KAAMuF,EAAI9F,cAAgB,GAC1BJ,MAAOtH,OAAOwN,EAAIjG,gBAAkB,EACpCtG,SAAUwH,EAAKxH,aAkBrB,YAdAG,EAAkB1D,IACV+P,MAAAA,EAAc,IAAIC,IACtBhQ,EAAK+B,IAAWoI,GAAA,CAACA,EAAEC,WAAYD,KAEjC,IAAA,MAAWqF,KAAMG,EAAiB,CAChC,MAAMM,EAAWF,EAAYjI,IAAI0H,EAAGpF,YAChC6F,EACFA,EAAS1M,UAAYiM,EAAGjM,SAEZjE,EAAAA,IAAIkQ,EAAGpF,WAAY,IAAKoF,GACtC,CAEF,OAAOhR,MAAM0R,KAAKH,EAAYI,kBAGzB3F,GAwBP,OAvBQ/M,QAAAA,MACN,mDACA+M,QAGF9G,EAAkB1D,IACV+P,MAAAA,EAAc,IAAIC,IACtBhQ,EAAK+B,IAAWoI,GAAA,CAACA,EAAEC,WAAYD,KAEjC,IAAA,MAAWqF,KAAMrP,EAAO,CACtB,MAAM8P,EAAWF,EAAYjI,IAAI0H,EAAGpF,YAChC6F,EACFA,EAAS1M,UAAYiM,EAAGjM,SAEZjE,EAAAA,IAAIkQ,EAAGpF,WAAY,IAC1BoF,EACHjF,KAAM,GACNX,MAAO,GAEX,CAEF,OAAOpL,MAAM0R,KAAKH,EAAYI,WAEhC,CACF,OAEI5G,GAAa6F,EAAM,SAClB5E,GACC/M,QAAAA,MAAM,iCAAkC+M,SAC1CjB,GAAa6F,EAAM,EAAC,GAIhCgB,OAAQvL,EACRwL,SAAU,IAAMvL,GAAiB,GACjCwL,SAAS,oBAKbvP,EAAAA,KAAC,MAAI,CAAAW,UAAU,gBACbC,SAAA,CAACN,EAAAA,IAAAkP,EAAA,CACC3O,IAAK2D,GACLlC,MACAC,SACAC,WACAC,cACAiH,mBACA1D,sBAEDtJ,GACCsD,EAAAA,KAAC,MAAI,CAAAW,UAAU,sIACbC,SAAA,CAAAN,EAAAA,IAAC,OACCK,UAAU,4CACV4M,KAAK,OACLC,OAAO,eACPC,QAAQ,YAER7M,eAAC,OACC,CAAA8M,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,gJAGLvN,EAAAA,IAAA,IAAA,CAAEK,UAAU,0CACTC,SAAM,MACF,IACI4G,MAAAA,EAASxC,KAAKC,MAAMvI,GACnB8K,OAAAA,EAAO9K,OAAS8K,EAAOyC,SAAWvN,CAAAA,CACnC,MACCA,OAAAA,CAAAA,GALH,KAST4D,EAAAA,IAAA,SAAA,CACCI,QAAS,IAAM/D,EAAS,IACxBgE,UAAU,uEACV,aAAW,gBAEXC,SAACN,EAAAA,IAAA,MAAA,CACCK,UAAU,UACV4M,KAAK,OACLC,OAAO,eACPC,QAAQ,YAER7M,SAAAN,EAAAA,IAAC,QACCoN,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,sCAmBhB7N,EAAAA,KAAC,MAAI,CAAAW,UAAU,qDAEbC,SAAA,CAACN,EAAAA,IAAA,MAAA,CAAIK,UAAU,2CACbC,SAACN,EAAAA,IAAAmP,EAAA,CACD/M,OACAiH,gBACAG,mBAAoB,CAACF,EAAK8F,KACxB5F,GAAmBF,EAAK8F,GACxBjK,GAAmB,OAErBhE,SACAqE,mBACA6J,YAAarK,GACbsK,YAn9BuBhG,IACnCrE,GAAmBqE,GACfA,GAAO,GAAKA,EAAMlH,EAAK5D,QACzB6G,GAAWlH,OAAOiE,EAAKkH,GAAKpH,YAi9BlBqC,WAAYW,GACZE,WACAmK,gBArvByBlF,IACrChF,GAAWgF,IAqvBCmF,eAAgB,IAAMrK,GAAmB,MACzCsK,YAAcnG,GAAQnE,GAAmBmE,GACzCjJ,UAAU,oBAKZX,EAAAA,KAAC,MAAI,CAAAW,UAAU,iDACZmF,SAAAA,CACCA,IAAA9F,EAAAA,KAAC,MAAI,CAAAW,UAAU,8HACbC,SAAA,CAACZ,EAAAA,KAAA,OAAA,CAAKW,UAAU,wBAAuBC,SAAA,CAAA,qBAClBkF,GAAgBtF,SAErCR,OAAC,UACCW,UAAU,sDACVD,QAAS,IAAMqF,GAAmB,MAElCnF,SAAA,CAACN,EAAAA,IAAA,OAAA,CAAKK,UAAU,kBAAkBC,SAAK,UAAO,sBAKnD,MAAI,CAAAD,UAAU,aACbC,SAACZ,EAAAA,KAAA,MAAA,CAAIW,UAAU,iDACbC,SAAA,CAACN,EAAAA,IAAAC,EAAA,CACCC,MAAQF,EAAAA,IAAA0B,EAAA,CAAYC,KAAK,cAAcC,SAAS,OAChD9B,KAAK,KACLO,UAAU,mDACVF,QAAQ,YACRuP,kBAAgB,EAChBtP,QAAS,IAAM2C,GAAkB,GACjC4M,WACG,MACC,CAAAtP,UAAU,UACV4M,KAAK,OACLC,OAAO,eACPC,QAAQ,YAER7M,SAACN,EAAAA,IAAA,OAAA,CACCoN,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,kLAIRqC,aAAa,SAEflQ,EAAAA,KAAC,MAAI,CAAAW,UAAU,wBACbC,SAAA,CAACN,EAAAA,IAAAC,EAAA,CACCC,MACEsF,GACIxF,EAAAA,IAAC0B,GAAYC,KAAK,kBAAkBC,SAAS,MAAMzB,QAAQ,cAC1DH,EAAAA,IAAA0B,EAAA,CAAYC,KAAK,eAAeC,SAAS,OAEhDzB,QAAQ,YACRC,QAAS,KACHoF,GACE5H,OAAOiS,QAAQ,UAAUrK,GAAgBtF,OAAS,gBACpDuF,GAAmB,MAGrBlD,GAAgB,IAGpBoN,KACEnK,GACExF,EAAAA,IAAC,OACCK,UAAU,UACV4M,KAAK,OACLC,OAAO,eACPC,QAAQ,YAER7M,SAAAN,MAAC,QACCoN,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,mIAILvN,EAAAA,IAAA,MAAA,CACCK,UAAU,UACV4M,KAAK,OACLC,OAAO,eACPC,QAAQ,YAER7M,SAACN,EAAAA,IAAA,OAAA,CACCoN,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,kLAKVlN,UAAU,qDAEXmF,IACC9F,EAAAA,KAAC,MAAI,CAAAW,UAAU,kMAAiMC,SAAA,CAAA,2BAE9MN,EAAAA,IAAC,MAAI,CAAAK,UAAU,8GAIrBL,EAAAA,IAACC,GACCC,MAAOF,EAAAA,IAAC0B,GAAYC,KAAK,cAAcC,SAAS,OAChD9B,KAAK,KACLO,UAAU,mDACVD,QAAS,IAAMqC,GAAkB,GACjCtC,QAAQ,YACRuP,kBAAgB,EAChBC,KACG3P,EAAAA,IAAA,MAAA,CACCK,UAAU,UACV4M,KAAK,OACLC,OAAO,eACPC,QAAQ,YAER7M,SAACN,EAAAA,IAAA,OAAA,CACCoN,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,oDAIRqC,aAAa,SAEf5P,EAAAA,IAACC,GACCC,MAAOF,MAAC0B,GAAYC,KAAK,mBAAmBC,SAAS,OACrD9B,KAAK,KACLO,UAAU,mDACVD,QAAS,IAAMyC,GAAkB,GACjC1C,QAAQ,YACRuP,kBAAgB,EAChBC,KACG3P,EAAAA,IAAA,MAAA,CACCK,UAAU,UACV4M,KAAK,OACLC,OAAO,eACPC,QAAQ,YAER7M,SAACN,EAAAA,IAAA,OAAA,CACCoN,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,qEAIRqC,aAAa,cAMnB5P,EAAAA,IAAC,MAAI,CAAAK,UAAU,aACbC,SAAAN,EAAAA,IAACC,EACC,CAAAC,MAAQF,EAAAA,IAAA0B,EAAA,CAAYC,KAAK,WAAWC,SAAS,MAAMzB,QAAQ,YAC3DL,KAAK,KACLO,UAAU,+CACVF,QAAQ,UACRuP,kBAAgB,EAChBtP,QAAS,IAAM6C,GAAgB,GAC/B6M,SAA0B,IAAhB1N,EAAK5D,OACfmR,KACG3P,EAAAA,IAAA,MAAA,CACCK,UAAU,UACV4M,KAAK,OACLC,OAAO,eACPC,QAAQ,YAER7M,SAACN,EAAAA,IAAA,OAAA,CACCoN,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,oDAIRqC,aAAa,wBAS3B5P,EAAAA,IAAC+P,EACC,CAAAlU,OAAQyG,EACRxG,QAAS,IAAMyG,GAAgB,GAC/ByN,gBAA+BC,IAC7BxK,GAAmBwK,GACnB1N,GAAgB,MAGnBvC,EAAAA,IAAAkQ,EAAA,CACCrU,OAAQ2G,EACR1G,QAAS,IAAM2G,GAAkB,GACjCT,IAAKU,EACLT,OAAQU,IAEV3C,MAACmQ,GACCtU,OAAQiH,EACRhH,QAAS,IAAMiH,GAAkB,KAEnC/C,MAACpE,GACCC,OAAQmI,GACRlI,QAAS,IAAMmI,IAAgB,KAEjCjE,EAAAA,IAACoQ,EACC,CAAAvU,OAAQmH,EACRlH,QAAS,IAAMmH,GAAgB,GAC/B9B,SACAkP,gBAA6B/O,IAC3B+B,EAAmB/B,GACnB2B,GAAgB,GAED,SAAX3B,EACF6B,GAAiB,GACG,UAAX7B,EACT,WACM,IACIgP,MAAAA,EACJ1S,OAAOC,SAASC,OAAS,uBACrByS,EACJ3S,OAAOC,SAASC,OAAS,sBAEdsJ,aAAAA,QACX,qBACA1C,KAAKgD,UAAU,CACb5I,MAAOsD,EAAK1B,IAAYoI,IAAA,CACtBC,WAAYD,EAAEC,WACd7G,SAAU4G,EAAE5G,YAEdf,SACAqG,YAAahC,IAAiBgC,aAAe,KAC7ChG,oBAA+C,eAA1BgE,IAAiB2E,KAAwBlJ,OAAOuE,GAAgB6E,OAAS,KAC9F5I,gBAA2C,WAA1B+D,IAAiB2E,KAAoBlJ,OAAOuE,GAAgB6E,OAAS,QAGpF,MAAAmG,YAAEA,SAAsBC,EAAoB,CAChDC,OAAQzP,OAAOE,IAAS,GACxB2K,YAAa,YACb6E,gBAAiBjN,GAAqB,OAAO7C,KAAK+P,QAClDL,YACAD,eAEKlS,OAAAA,KAAKoS,EAAa,gBAClBnT,GACPhB,EAAS,wBACT4K,aAAaa,WAAW,qBAAoB,CAE7C,EAhCH,GAiCoB,SAAXxG,EACT,WACM,IACIgP,MAAAA,EACJ1S,OAAOC,SAASC,OAAS,uBACrByS,EACJ3S,OAAOC,SAASC,OAAS,sBAEdsJ,aAAAA,QACX,oBACA1C,KAAKgD,UAAU,CACb5I,MAAOsD,EAAK1B,IAAYoI,IAAA,CACtBC,WAAYD,EAAEC,WACd7G,SAAU4G,EAAE5G,YAEdf,SACAqG,YAAahC,IAAiBgC,aAAe,KAC7ChG,oBAA+C,eAA1BgE,IAAiB2E,KAAwBlJ,OAAOuE,GAAgB6E,OAAS,KAC9F5I,gBAA2C,WAA1B+D,IAAiB2E,KAAoBlJ,OAAOuE,GAAgB6E,OAAS,QAGpF,MAAAmG,YAAEA,SAAsBK,EAAmB,CAC/CH,OAAQzP,OAAOE,IAAS,GACxB2K,YAAa,YACb6E,gBAAiBjN,GAAqB,OAAO7C,KAAK+P,QAClDL,YACAD,eAEKlS,OAAAA,KAAKoS,EAAa,gBAClBnT,GACPhB,EAAS,uBACT4K,aAAaa,WAAW,oBAAmB,CAE5C,EAhCH,GAkCAuE,GAAe/K,MAIrBtB,EAAAA,IAAC8Q,EACC,CAAAjV,OAAQqH,EACRpH,QAAS,IAAMqH,GAAiB,GAChChC,SACA4P,UAA+BxE,IAC7BF,GAAe,OAAQE,GACvBpJ,GAAiB,MAGpBmC,IACC5F,EAAAA,KAAC,MAAI,CAAAW,UAAU,sDACbC,SAAA,CAAAN,EAAAA,IAAC,MACC,CAAAK,UAAU,oCACVD,QAAS+L,KAEVzM,EAAAA,KAAA,MAAA,CACCW,UAAU,oEACVG,UAAkBnD,IAEhBA,EAAEwN,kBAGY,UAAVxN,EAAEqB,KAAoBrB,EAAE2T,yBAC1B3T,EAAEoB,iBACYyN,OAKlB5L,SAAA,CAAAN,EAAAA,IAAC,OAAIK,UAAU,6GACbC,SAACZ,EAAAA,KAAA,MAAA,CAAIW,UAAU,0BACbC,SAAA,CAACN,EAAAA,IAAA,MAAA,CAAIK,UAAU,4GACbC,SAACN,EAAAA,IAAA,MAAA,CACCK,UAAU,qBACV4M,KAAK,OACLC,OAAO,QACPC,QAAQ,YAER7M,SAACN,EAAAA,IAAA,OAAA,CACCsN,YAAY,IACZF,cAAc,QACdC,eAAe,QACfE,EAAE,kGAIR7N,EAAAA,KAAC,MAAI,CAAAW,UAAU,SACbC,SAAA,CAACN,EAAAA,IAAA,KAAA,CAAGK,UAAU,uCAAsCC,SAEpD,mBACAZ,EAAAA,KAAC,IAAE,CAAAW,UAAU,wBAAuBC,SAAA,CAAA,qCACCN,EAAAA,IAAA,OAAA,CAAKK,UAAU,qBAAqBC,SAAuC,uDAOtHZ,EAAAA,KAAC,MAAI,CAAAW,UAAU,MACbC,SAAA,CAACN,EAAAA,IAAA,IAAA,CAAEK,UAAU,6BAA4BC,SAGzC,wEAGAZ,EAAAA,KAAC,MAAI,CAAAW,UAAU,yBACbC,SAAA,CAAAN,EAAAA,IAAC,UACCI,QAAS+L,GACT9L,UAAU,yOACV4Q,WAAS,EAAA3Q,SAGX,iBACCZ,EAAAA,KAAA,SAAA,CACCU,QAAS8L,GACT7L,UAAU,4RAEVC,SAAA,CAAAN,EAAAA,IAAC,OACCK,UAAU,UACV4M,KAAK,OACLC,OAAO,eACPC,QAAQ,YAER7M,eAAC,OACC,CAAAgN,YAAY,IACZF,cAAc,QACdC,eAAe,QACfE,EAAE,gGAED,gCAQhBvN,EAAAA,IAAAkR,EAAA,CACCrV,OAAQ+G,EACR9G,QAAS,IAAM+G,GAAkB,GACjCsO,SAAUxU,MAAOmC,EAAO8E,EAAewN,KACjC,IAEF,GAAIA,GAAsBxN,EAQxB,OAPAvB,EAAQ,IACRwB,GAAiB,MACjBF,EAAqB,MACrBtH,EAAS,IACTwG,GAAkB,QAElBjF,OAAOC,SAAS8J,KAAO,eAAeyJ,EAAmBrT,oBAAsB6F,KAKjF,IAAK9E,GAA0B,IAAjBA,EAAMN,OAElB,YADAnC,EAAS,6BAKPuH,GACFC,GAAiBD,GAGXyN,QAAAA,IAAI,iBAAkBvS,GAE9B,MAAMwP,QAAwBC,QAAQC,IACpC1P,EAAM4B,IAAI/D,MAAO+M,IACf,MAAM+E,QAAYzR,EAAI,iBAAiB0M,EAAKX,aAAc,CACxD9L,QAAS,CAAEC,cAAe,UAAUN,QAQ/B,OANP0U,QAAQD,IACN,yBACA3H,EAAKX,WACL,IACA0F,GAEK,CACL1F,WAAYW,EAAKX,WACjB/G,IAAKyM,EAAIzM,KAAO0H,EAAK1H,KAAO,GAC5BkH,KAAMuF,EAAI9F,cAAgB,GAC1BJ,MAAOtH,OAAOwN,EAAIjG,gBAAkB,EACpCtG,SAAUwH,EAAKxH,aAIrBG,EAAkB1D,IACV+P,MAAAA,EAAc,IAAIC,IAAIhQ,EAAK+B,IAAWoI,GAAA,CAACA,EAAEC,WAAYD,KAC3D,IAAA,MAAWqF,KAAMG,EAAiB,CAChC,MAAMM,EAAWF,EAAYjI,IAAI0H,EAAGpF,YAChC6F,EACFA,EAAS1M,UAAYiM,EAAGjM,SAEZjE,EAAAA,IAAIkQ,EAAGpF,WAAY,IAAKoF,GACtC,CAEF,OAAOhR,MAAM0R,KAAKH,EAAYI,kBAEzBzR,GACCjB,QAAAA,MAAM,6CAA8CiB,GAE5DgF,EAAkB1D,IACV+P,MAAAA,EAAc,IAAIC,IAAIhQ,EAAK+B,IAAWoI,GAAA,CAACA,EAAEC,WAAYD,KAC3D,IAAA,MAAWqF,KAAMrP,EAAO,CACtB,MAAM8P,EAAWF,EAAYjI,IAAI0H,EAAGpF,YAChC6F,EACFA,EAAS1M,UAAYiM,EAAGjM,SAEZjE,EAAAA,IAAIkQ,EAAGpF,WAAY,IAC1BoF,EACHjF,KAAM,GACNX,MAAO,GAEX,CAEF,OAAOpL,MAAM0R,KAAKH,EAAYI,WAC/B,OAMb"}