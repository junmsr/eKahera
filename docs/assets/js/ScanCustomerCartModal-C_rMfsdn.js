import{j as e}from"./utils-L0j39QIW.js";import{R as t,a as s}from"./vendor-DPJ7iNYg.js";import{C as n}from"./Card-DXlcOk_J.js";import"./Input-DoNyYXSI.js";import{b as a,a as r}from"./index-BlnpEVUf.js";import{B as l,c as o,d as i,e as c,f as d}from"./BaseModal-Cy73DE2S.js";import{S as x}from"./ScannerCard-DJyziL7r.js";import{u}from"./useKeyboardShortcuts-5Dd6maPO.js";const m=t.forwardRef(({sku:t,setSku:s,quantity:r,setQuantity:l,handleAddToCart:o,quantityInputRef:i,className:c=""},d)=>e.jsx(n,{className:`flex-shrink-0 bg-white/80 backdrop-blur-md border border-white/60 shadow-xl hover:shadow-2xl transition-all duration-300 ${c}`,variant:"glass",children:e.jsxs("div",{className:"flex flex-col gap-1 p-1 sm:p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"})})}),e.jsx("span",{className:"font-bold text-sm text-gray-900",children:"Enter SKU Code"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"SKU Code"}),e.jsx("div",{className:"relative",children:e.jsx("input",{ref:d,type:"text",name:"sku",value:t,onChange:e=>s(e.target.value),onKeyPress:e=>{"Enter"===e.key&&t.trim()&&o()},placeholder:"Scan or enter SKU code",className:"w-full pl-3 pr-3 py-2 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 placeholder-gray-400 font-medium"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 whitespace-nowrap",children:"Quantity:"}),e.jsxs("div",{className:"flex items-center gap-1 flex-1",children:[e.jsx("button",{onClick:()=>l(Math.max(1,r-1)),className:"w-8 h-8 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold transition-colors duration-200 flex items-center justify-center",children:"−"}),e.jsx("input",{type:"number",name:"quantity",value:r,min:1,ref:i,onChange:e=>l(Math.max(1,Number(e.target.value)||1)),className:"w-16 px-2 py-1 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-xl text-center text-sm font-semibold focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"}),e.jsx("button",{onClick:()=>l(r+1),className:"w-8 h-8 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold transition-colors duration-200 flex items-center justify-center",children:"+"})]}),e.jsx(a,{label:"Add to Cart",onClick:o,variant:"primary",size:"sm",microinteraction:!0,icon:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),iconPosition:"left"})]})]})]})}));function h({cart:t,handleRemove:s,handleEditQuantity:a,total:r,className:l="",selectedIdx:o=-1,onSelectRow:i,appliedDiscount:c,editingIdx:d=null,editQty:x=1,onEditQtyChange:u,onEditComplete:m}){const h=e=>{const t=e.target.value;(""===t||/^\d+$/.test(t))&&u?.(""===t?"":parseInt(t,10))},p=e=>{const t=""===x?1:Math.max(1,x);a(e,t),m?.()},b=()=>e.jsx("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M15.232 5.232l3.536 3.536M9 13l6.586-6.586a2 2 0 1 1 2.828 2.828L11.828 15.828a4 4 0 0 1-1.414.828l-4.243 1.414 1.414-4.243a4 4 0 0 1 .828-1.414z"})}),g=()=>e.jsx("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})}),f=()=>e.jsx("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5 13l4 4L19 7"})}),y=()=>e.jsx("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})});return e.jsx(n,{className:`flex-1 flex flex-col bg-white/80 backdrop-blur-md border border-white/60 shadow-xl transition-all duration-300 h-full min-h-0 overflow-hidden ${l}`,variant:"glass",children:e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col p-2 sm:p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 pb-2 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsx("h3",{className:"text-sm sm:text-base font-bold text-gray-900",children:"Shopping Cart"})]}),e.jsxs("span",{className:"text-xs font-semibold text-gray-600 bg-gray-100 px-2 py-0.5 rounded-full",children:[t.length," ",1===t.length?"item":"items"]})]}),e.jsx("div",{className:"flex-1 overflow-auto min-h-0 rounded-lg",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-gradient-to-r from-blue-50/90 to-indigo-50/90 backdrop-blur-sm border-b border-blue-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-1.5 px-2 text-left text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"py-1.5 px-2 text-center text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Qty"}),e.jsx("th",{className:"py-1.5 px-2 text-right text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"py-1.5 px-2 text-right text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"py-1.5 px-2 text-center text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:0===t.length?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-2",children:e.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsx("p",{className:"text-gray-500 text-sm font-semibold",children:"Cart is empty"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Scan or enter products"})]})})}):t.map((t,n)=>e.jsxs("tr",{className:"hover:bg-blue-50/50 transition-colors duration-200 group "+(o===n?"bg-blue-100/70 ring-2 ring-blue-300":""),onClick:e=>((e,t)=>{"INPUT"!==t.target.tagName&&i?.(e)})(n,e),children:[e.jsx("td",{className:"py-1.5 px-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-gray-900 group-hover:text-blue-600 transition-colors truncate",children:t.name}),e.jsxs("span",{className:"text-[10px] text-gray-500 truncate",children:["SKU: ",t.sku||"N/A"]})]})}),e.jsx("td",{className:"py-1.5 px-2 text-center",children:d===n?e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:x,onChange:h,onKeyDown:e=>{"Enter"===e.key?p(n):"Escape"===e.key&&m?.()},onBlur:()=>p(n),className:"w-12 h-7 text-center text-xs font-bold border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0,onFocus:e=>e.target.select()}),e.jsx("button",{type:"button",onClick:()=>p(n),className:"p-1 text-green-600 hover:bg-green-100 rounded",title:"Save",children:e.jsx(f,{})}),e.jsx("button",{onClick:()=>m(),className:"p-1 text-red-600 hover:bg-red-100 rounded",title:"Cancel",children:e.jsx(y,{})})]}):e.jsx("div",{className:"flex items-center justify-center gap-1",children:e.jsx("span",{className:"inline-flex items-center justify-center w-7 h-7 rounded-md bg-blue-100 text-blue-700 font-bold text-xs",children:t.quantity})})}),e.jsx("td",{className:"py-1.5 px-2 text-right",children:e.jsxs("span",{className:"text-xs sm:text-sm font-medium text-gray-700",children:["₱",t.price.toFixed(2)]})}),e.jsx("td",{className:"py-1.5 px-2 text-right",children:e.jsxs("span",{className:"text-xs sm:text-sm font-bold text-blue-600",children:["₱",(t.price*(d===n?x:t.quantity)).toFixed(2)]})}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),i?.(n),u(t.quantity)},className:`p-1.5 rounded-md transition-all duration-200 ${o===n?"bg-blue-100 text-blue-700 border-blue-200":"bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200"} border`,title:"Edit (E)",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs font-bold text-blue-600",children:"(E)"}),e.jsx(b,{})]})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),i?.(n),s(n)},className:`p-1.5 rounded-md transition-all duration-200 ${o===n?"bg-red-100 text-red-700 border-red-200":"bg-red-50 text-red-600 hover:bg-red-100 border-red-200"} border`,title:"Delete (D)",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs font-bold text-red-600",children:"(D)"}),e.jsx(g,{})]})})]})})]},n))})]})}),e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[c&&e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"line-through",children:["₱",t.reduce((e,t,s)=>e+t.price*(d===s?x:t.quantity),0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm sm:text-base font-semibold text-gray-700",children:"Total:"}),e.jsxs("span",{className:"text-lg sm:text-xl font-extrabold text-blue-600",children:["₱",r.toFixed(2)]})]})]})})]})})}function p({isOpen:n,onClose:o,sku:i,setSku:c}){const[d,m]=s.useState(null),h=async()=>{if(i)try{const e=localStorage.getItem("business_id"),t=e?`?business_id=${encodeURIComponent(e)}`:"",s=await r(`/api/products/public/sku/${encodeURIComponent(i)}${t}`);m(s?{name:s.product_name,price:Number(s.selling_price||0),sku:s.sku}:null)}catch(e){m(null)}};t.useEffect(()=>{if(!i)return void m(null);const e=setTimeout(()=>{h()},200);return()=>clearTimeout(e)},[i]);const p=e.jsx(a,{label:"Close (Esc)",variant:"secondary",onClick:o,className:"w-full"});return u([{key:"escape",action:o,enabled:n,allowWhileTyping:!0},{key:"enter",action:h,enabled:n,allowWhileTyping:!0}],[n,i]),e.jsxs(l,{isOpen:n,onClose:o,title:"Price Check",subtitle:"Scan or enter SKU/barcode",icon:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),footer:p,size:"md",contentClassName:"space-y-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(x,{onScan:e=>{const t=e?.[0]?.rawValue;t&&c(t)},paused:!1,onResume:()=>{},className:"w-full",textMain:"text-blue-700"})}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter SKU or Barcode"}),e.jsx("input",{type:"text",value:i,onChange:e=>c(e.target.value),className:"w-full border border-gray-300 rounded-lg px-4 py-2 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter SKU or scan barcode"})]}),e.jsxs("div",{className:"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Check price:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Enter"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Close:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Esc"})]})]}),d?e.jsxs("div",{className:"w-full bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200/50",children:[e.jsx("div",{className:"text-lg font-semibold text-blue-900 mb-1",children:d.name}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:["₱",d.price.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["SKU: ",d.sku]})]}):i?e.jsx("div",{className:"text-red-500 text-sm text-center py-4",children:"No product found."}):null]})}function b({isOpen:n,onClose:o,onApplyDiscount:i}){const[c,d]=s.useState(!1),[x,m]=s.useState([]),[h,p]=s.useState(""),[b,g]=s.useState(""),[f,y]=s.useState(null),[j,N]=s.useState(0),[v,w]=s.useState(!1),[k,C]=s.useState(""),[S,E]=s.useState(!1),[M,T]=s.useState("PERCENTAGE"),A=t.useRef(null),P=t.useRef(null),D=t.useRef(null),_=(e,t)=>{if("Escape"===e.key)return e.preventDefault(),e.stopPropagation(),void e.target.blur();if("Enter"===e.key&&c&&h&&b)return e.preventDefault(),e.stopPropagation(),void L();if("value"===t){if([8,9,27,13,37,38,39,40,35,36,46].includes(e.keyCode)||e.ctrlKey&&[65,67,88,86,90,89].includes(e.keyCode)||e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105)return;(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}};s.useEffect(()=>{n&&c&&requestAnimationFrame(()=>{A.current?.focus(),A.current?.select?.()})},[n,c]),s.useEffect(()=>{if(!n)return;(async()=>{w(!0),C("");try{const e=sessionStorage.getItem("auth_token"),t=(await r("/api/discounts",{headers:{Authorization:`Bearer ${e}`}})||[]).map(e=>({label:e.discount_name||`${e.discount_percentage}% off`,value:e.discount_percentage,discount_id:e.discount_id,type:"percentage"}));m(t)}catch(e){C("Failed to load discounts")}finally{w(!1)}})()},[n]);const L=async()=>{if(h&&b){E(!0);try{const e=sessionStorage.getItem("auth_token"),t={discount_name:h,discount_percentage:Number(b)},s=await r("/api/discounts",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t)});m(e=>[...e,{label:s.discount_name||h,value:s.discount_percentage,discount_id:s.discount_id,type:"percentage"}]),p(""),g("")}catch(e){console.error("Failed to add discount:",e),C("Failed to add discount. Please try again.")}finally{E(!1)}}},R=async e=>{if(!e)return;const t=Number(e);if(isNaN(t))return void C("Invalid discount ID");const s=x.find(e=>Number(e.discount_id)===t);if(s){if(window.confirm(`Are you sure you want to delete the discount "${s.label}"?`))try{E(!0),C(""),await r(`/api/discounts/${t}`,{method:"DELETE"}),m(e=>{const s=e.findIndex(e=>Number(e.discount_id)===t),n=e.filter(e=>Number(e.discount_id)!==t);return-1!==s&&(y(e=>e===s?Math.max(0,s-1):e>s?e-1:e),N(e=>e===s?Math.max(0,s-1):e>s?e-1:e)),n})}catch(n){if(console.error("Failed to remove discount:",n),n.message&&n.message.includes("not found"))try{const e=sessionStorage.getItem("auth_token"),t=await r("/api/discounts",{headers:{Authorization:`Bearer ${e}`}});m((t||[]).map(e=>({label:e.discount_name||`${e.discount_percentage}% off`,value:e.discount_percentage,discount_id:e.discount_id,type:"percentage"}))),C("Discount not found. List has been refreshed.")}catch(a){console.error("Failed to refresh discounts:",a),C("Discount not found. Could not refresh list.")}else C(n.message||"Failed to remove discount. Please try again.")}finally{E(!1)}}else C("Discount not found in the list")},W=()=>{d(!1)},F=()=>{if(null==f)return;const e=x[f];e&&(i({type:e.type,value:e.value,label:e.label,discount_id:e.discount_id}),o())},$=e.jsx(a,{label:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsx("span",{children:"Save Settings"}),e.jsx("span",{className:"text-xs font-mono bg-white/20 px-2 py-0.5 rounded",children:"Enter"})]}),variant:"primary",onClick:W,className:"w-full"}),I=e.jsxs("div",{className:"w-full space-y-2",children:[e.jsx(a,{label:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsx("span",{children:"Apply Discount"}),e.jsx("span",{className:"text-xs font-mono bg-white/20 px-2 py-0.5 rounded",children:"Enter"})]}),variant:"primary",onClick:F,disabled:null===f,className:"w-full"}),e.jsx(a,{label:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsx("span",{children:"Manage Discounts"}),e.jsx("span",{className:"text-xs font-mono bg-gray-100 px-2 py-0.5 rounded text-gray-700",children:"M"})]}),variant:"secondary",onClick:()=>d(!0),className:"w-full"})]}),z=e=>{if(!e)return!1;const t=e.tagName?.toLowerCase();return e.isContentEditable||"input"===t||"textarea"===t||"textbox"===e.getAttribute?.("role")};s.useEffect(()=>{if(c&&D.current&&null!==j){const e=D.current.querySelector(`[data-discount-idx="${j}"]`);e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}},[j,c]),s.useEffect(()=>{if(k){const e=setTimeout(()=>C(""),5e3);return()=>clearTimeout(e)}},[k]),u([{key:"escape",action:e=>{z(e?.target)?e.target.blur?.():o()},enabled:n,allowWhileTyping:!0,stopPropagation:!0,preventDefault:!0},{key:"enter",action:e=>{if(!z(e?.target))return c?(e.preventDefault(),void W()):void F();c&&h&&b&&(e.preventDefault(),L())},enabled:n,allowWhileTyping:!0,stopPropagation:!0,preventDefault:!0},{key:"m",action:e=>{z(e?.target)||d(e=>!e)},enabled:n,allowWhileTyping:!1,stopPropagation:!0,preventDefault:!0},...Array.from({length:9}).map((e,t)=>({key:String(t+1),action:e=>{z(e?.target)||!c&&x[t]&&(e=>{const t=x[e];t&&(y(e),i({type:t.type,value:t.value,label:t.label,discount_id:t.discount_id}),o())})(t)},enabled:n&&!c&&x[t],allowWhileTyping:!1,stopPropagation:!0,preventDefault:!0})),{key:"arrowup",action:e=>{z(e?.target)||c||0===x.length||y(e=>null==e?0:e>0?e-1:0)},enabled:n&&!c,allowWhileTyping:!1,stopPropagation:!0,preventDefault:!0},{key:"arrowdown",action:e=>{z(e?.target)||c||0===x.length||y(e=>null==e?0:Math.min(e+1,x.length-1))},enabled:n&&!c,allowWhileTyping:!1,stopPropagation:!0,preventDefault:!0},{key:"n",action:e=>{z(e?.target)&&e.target!==A.current||c&&setTimeout(()=>{A.current?.focus(),A.current?.select?.()},0)},enabled:n&&c,allowWhileTyping:!0,stopPropagation:!1,preventDefault:!1},{key:"v",action:e=>{z(e?.target)&&e.target!==P.current||c&&setTimeout(()=>{P.current?.focus(),P.current?.select?.()},0)},enabled:n&&c,allowWhileTyping:!0,stopPropagation:!1,preventDefault:!1},{key:"arrowup",action:e=>{z(e?.target)||c&&0!==x.length&&N(e=>Math.max(0,e-1))},enabled:n&&c,allowWhileTyping:!1,stopPropagation:!0,preventDefault:!0},{key:"arrowdown",action:e=>{z(e?.target)||c&&0!==x.length&&N(e=>Math.min(x.length-1,(e??0)+1))},enabled:n&&c,allowWhileTyping:!1,stopPropagation:!0,preventDefault:!0},{key:"delete",action:e=>{if(z(e?.target))return;if(!c||0===x.length)return;const t=x[j];t?.discount_id&&R(t.discount_id)},enabled:n&&c,allowWhileTyping:!1,stopPropagation:!0,preventDefault:!0}],[n,c,x,f,F,W,o,j,L]);return e.jsxs(l,{isOpen:n,onClose:o,title:c?"Manage Discounts":"Select Discount",subtitle:c?"Add or remove discount options":"Choose a discount to apply",icon:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),footer:c?$:I,size:"md",contentClassName:"space-y-4",children:[k&&e.jsx("div",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg px-3 py-2",children:k}),c?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{className:"flex-1 px-4 py-2 rounded-lg font-semibold text-sm transition-all "+("PERCENTAGE"===M?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),onClick:()=>T("PERCENTAGE"),children:"Percentage"})}),e.jsx("div",{ref:D,className:"space-y-2 max-h-60 overflow-y-auto pr-2 -mr-2",children:x.map((t,s)=>e.jsxs("div",{"data-discount-idx":s,className:"flex gap-2 items-center bg-gray-50 p-3 rounded-lg transition-all "+(j===s?"ring-2 ring-blue-400 bg-blue-50":"hover:bg-gray-100"),children:[e.jsx("input",{className:"flex-1 bg-transparent outline-none text-sm font-medium",value:t.label,readOnly:!0}),e.jsx("input",{className:"w-20 bg-transparent text-center outline-none text-sm font-medium",value:t.value,readOnly:!0}),e.jsx("button",{className:"text-red-500 hover:text-red-700 transition-colors p-1",onClick:()=>R(t.discount_id),title:"Remove (Del)",type:"button",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},s))}),e.jsxs("div",{className:"space-y-2 p-4 bg-blue-50 rounded-lg border border-blue-200",onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),L())},children:[e.jsx("div",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Add New Discount (N=Name, V=Value, Enter=Add)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Description",value:h,ref:A,onKeyDown:e=>_(e,"desc"),onFocus:()=>d(!0),onChange:e=>p(e.target.value)}),e.jsx("input",{className:"w-24 border border-gray-300 rounded-lg px-3 py-2 text-sm text-center focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"PERCENTAGE"===M?"0%":"0.00",inputMode:"PERCENTAGE"===M?"numeric":"decimal",value:b,ref:P,onKeyDown:e=>_(e,"value"),onFocus:()=>d(!0),onChange:e=>g(e.target.value),type:"number",min:"0"}),e.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-bold",onClick:L,title:"Add (Enter)",type:"button",disabled:S,children:S?"...":"+"})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Select Discount"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Press 1-9 or ↑/↓, Enter to apply"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-4 max-h-64 overflow-y-auto",children:x.map((t,s)=>e.jsxs("button",{className:`p-3 border rounded text-center ${f===s?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"} relative group`,onClick:()=>y(s),children:[e.jsx("div",{className:"absolute -top-2 -right-2 bg-blue-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center font-bold",children:s+1}),e.jsx("div",{className:"font-medium",children:t.label}),e.jsxs("div",{className:"text-sm text-gray-500",children:[t.value,"%"]}),f===s&&e.jsx("div",{className:"absolute bottom-1 right-1 text-xs text-blue-500",children:"Press Enter to apply"})]},`${t.type}-${s}`))})]}),!c&&e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Select discount:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"1-9 / ↑↓"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Apply selected discount:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"Enter"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Manage discounts:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"M"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Close modal:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"Esc"})]})]})}),c&&e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Move selection:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"↑ ↓"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Delete selected:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"Del"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Focus name / value:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"N / V"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Add discount:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"Enter"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Close modal:"}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:"Esc"})]})]})})]})}function g({isOpen:t,onClose:n}){const[a,x]=s.useState("SUMMARY"),[m,h]=s.useState(null),[p,b]=s.useState([]),[g,f]=s.useState([]),[y,j]=s.useState(!1),[N,v]=s.useState(!1),[w,k]=s.useState(""),C=async(e=null)=>{v(!0);try{k("");const t=e?`/stats/cash-transactions?payment_type=${encodeURIComponent(e)}&limit=100`:"/stats/cash-transactions?limit=100",s=await r(t);f(Array.isArray(s)?s:[])}catch(t){k(t.message||"Failed to load transactions")}finally{v(!1)}};s.useEffect(()=>{t&&((async()=>{j(!0);try{k("");const e=await r("/stats/cash-ledger");b(Array.isArray(e)?e:[])}catch(e){k(e.message||"Failed to load cash ledger")}finally{j(!1)}})(),C())},[t]),u([{key:"escape",action:n,enabled:t,allowWhileTyping:!0},{key:"1",action:()=>{x("SUMMARY"),h(null)},enabled:t},{key:"2",action:()=>{x("TRANSACTIONS"),h(null)},enabled:t}],[t,a]);const S=e.jsxs("div",{className:"flex gap-2 border-t border-gray-200/50 pt-4 mt-4",children:[e.jsxs("button",{onClick:()=>{x("SUMMARY"),h(null)},className:"flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-semibold transition-all "+("SUMMARY"===a?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(c,{className:"w-5 h-5"}),e.jsx("span",{children:"Summary (1)"})]}),e.jsxs("button",{onClick:()=>{x("TRANSACTIONS"),h(null)},className:"flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-semibold transition-all "+("TRANSACTIONS"===a?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(d,{className:"w-5 h-5"}),e.jsx("span",{children:"Transactions (2)"})]})]});return e.jsx(l,{isOpen:t,onClose:n,title:"Cash Ledger",subtitle:"View cash balance and payment methods",icon:e.jsx(o,{className:"w-6 h-6 text-white"}),size:"lg",contentClassName:"space-y-4",children:e.jsxs("div",{className:"space-y-6",children:["SUMMARY"===a?(()=>{const t=p.reduce((e,t)=>e+(Number(t.balance)||0),0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-700 text-white rounded-lg shadow-xl px-8 py-8 text-center",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-100 mb-2",children:"Total Cash on Hand"}),e.jsxs("div",{className:"text-5xl font-bold flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-4xl",children:"₱"}),t.toFixed(2)]}),e.jsx("p",{className:"text-blue-100 text-sm mt-3",children:(new Date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center",children:e.jsx(o,{className:"w-5 h-5 text-white"})}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Payment Methods"})]}),e.jsx("div",{className:"space-y-3",children:y?e.jsx("div",{className:"text-sm text-gray-500",children:"Loading..."}):0===p.length?e.jsx("div",{className:"text-sm text-gray-500",children:"No balances available"}):p.map(t=>e.jsx("button",{onClick:async()=>{h(t.name),x("TRANSACTIONS"),await C(t.name)},className:"w-full bg-gradient-to-r from-gray-50 to-gray-100/50 hover:from-blue-50 hover:to-indigo-50/50 rounded-2xl p-4 border border-gray-200/50 hover:border-blue-300 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-lg flex items-center justify-center border border-gray-200 group-hover:border-blue-300 group-hover:bg-blue-50 transition-all",children:e.jsx("svg",{className:"w-5 h-5 text-gray-600 group-hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500",children:"View transactions"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["₱",(Number(t.balance)||0).toFixed(2)]})}),e.jsx(i,{className:"w-5 h-5 text-gray-400 group-hover:text-blue-600 transition-colors"})]})]})},t.name))})]}),w&&e.jsx("div",{className:"text-sm text-red-600",children:w.includes("Server returned an HTML error page")||w.includes("Cannot GET")?"Unable to reach backend API. Check backend server and proxy configuration.":w})]})})():e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 rounded-2xl p-4 border border-indigo-100/50",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-900",children:m?`${m} Transactions`:"All Transactions"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:N?"Loading...":`${g.length} transaction${1!==g.length?"s":""} found`})]}),e.jsx("div",{className:"bg-white rounded-2xl border border-gray-200/50 overflow-hidden",children:N?e.jsx("div",{className:"text-center py-12 text-sm text-gray-500",children:"Loading transactions..."}):0===g.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-300 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No transactions found"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200/50",children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Date & Time"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Amount"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:g.map(t=>e.jsxs("tr",{className:"hover:bg-blue-50/50 transition-colors duration-150",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 font-medium",children:new Date(t.created_at).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 border border-blue-200",children:t.payment_type})}),e.jsxs("td",{className:"px-6 py-4 text-sm text-right font-bold text-green-600",children:["₱",(Number(t.total)||0).toFixed(2)]})]},String(t.transaction_id)))})]})})})]}),S,e.jsxs("div",{className:"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Summary view:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"1"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Transactions view:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"2"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Close:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Esc"})]})]})]})})}function f({isOpen:t,onClose:s,total:n,onSelectPayment:r}){u([{key:"1",action:()=>r("cash"),enabled:t},{key:"2",action:()=>r("gcash"),enabled:t},{key:"3",action:()=>r("maya"),enabled:t},{key:"enter",action:()=>r("cash"),enabled:t},{key:"escape",action:s,enabled:t}],[t]);const o=e.jsxs("div",{className:"w-full flex flex-col gap-3",children:[e.jsx(a,{label:"CASH (1 / Enter)",className:"w-full h-12 text-base font-bold",onClick:()=>r("cash")}),e.jsx(a,{label:"GCASH (2)",className:"w-full h-12 text-base font-bold",onClick:()=>r("gcash")}),e.jsx(a,{label:"MAYA (3)",className:"w-full h-12 text-base font-bold",onClick:()=>r("maya")})]});return e.jsxs(l,{isOpen:t,onClose:s,title:"Checkout",subtitle:"Select payment method",icon:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),footer:o,size:"sm",contentClassName:"text-center",children:[e.jsxs("div",{className:"bg-blue-500 text-white rounded-2xl py-6 px-4 text-center mb-4",children:[e.jsx("div",{className:"text-sm opacity-90 mb-2",children:"Total Amount"}),e.jsxs("div",{className:"text-4xl font-bold",children:["₱",n.toFixed(2)]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Choose your preferred payment method"}),e.jsxs("div",{className:"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Cash:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"1 / Enter"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"GCash:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"2"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Maya:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"3"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Close:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Esc"})]})]})]})}function y({isOpen:t,onClose:s,change:n=0,payable:r=0,onReceipt:o,onNewEntry:i}){u([{key:"escape",action:s,enabled:t,allowWhileTyping:!0},{key:"enter",action:()=>{o&&o()},enabled:t,allowWhileTyping:!0}],[t]);const c=e.jsx("div",{className:"w-full flex flex-col gap-3",children:e.jsx(a,{label:"RECEIPT (Enter)",className:"w-full h-11 text-sm font-semibold bg-blue-700 hover:bg-blue-800 text-white",onClick:()=>{o?o():alert("Receipt")}})});return e.jsxs(l,{isOpen:t,onClose:s,title:"Payment Complete",icon:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),footer:c,size:"sm",contentClassName:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx("div",{className:"w-14 h-14 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-7 w-7 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-400 to-indigo-500 rounded-2xl p-5 text-white",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide opacity-90 mb-2",children:"Change"}),e.jsxs("div",{className:"inline-flex items-baseline gap-2 bg-white text-blue-700 rounded-lg px-4 py-3 shadow-md",children:[e.jsx("span",{className:"text-lg font-bold",children:"₱"}),e.jsx("span",{className:"text-2xl font-bold",children:Number(n).toFixed(2)})]}),e.jsx("div",{className:"mt-4 text-sm opacity-90",children:"Payable"}),e.jsxs("div",{className:"text-sm font-semibold",children:["₱",Number(r).toFixed(2)]})]}),e.jsxs("div",{className:"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Print / open receipt:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Enter"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Close:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Esc"})]})]})]})}function j({isOpen:t,onClose:n,total:r,onConfirm:o}){const[i,c]=s.useState(""),[d,x]=s.useState(!1),[m,h]=s.useState(null),p=s.useRef(null),b=s.useRef(!1),g=e=>{e&&(e.preventDefault(),e.stopPropagation());const t=Number(r).toFixed(2);c(t),b.current=!0,setTimeout(()=>{b.current=!1},200)},f=e=>{e&&(e.preventDefault(),e.stopPropagation());let t=p.current?.value||i;b.current&&(t=Number(r).toFixed(2));const s=(t?.toString()||"").trim();if(!s)return void alert("Please enter an amount.");const n=Number(s);if(isNaN(n)||n<=0)return void alert("Please enter a valid amount.");const a=Math.round(100*n)/100,l=Math.round(100*r)/100;if(a<l)return void alert(`Amount received (₱${a.toFixed(2)}) must be greater than or equal to total (₱${l.toFixed(2)}).`);const o=Math.max(0,a-l);h({change:o,payable:l,received:a}),x(!0)},j=()=>{x(!1),n&&n()},N=()=>{x(!1),c(""),n&&n()},v=()=>{o&&null!=m?.received&&o(Number(m.received))};if(u([{key:"escape",action:n,enabled:t&&!d,allowWhileTyping:!0},{key:"enter",action:e=>{e.preventDefault(),e.stopPropagation(),f(e)},enabled:t&&!d,allowWhileTyping:!0},{key:"e",action:g,enabled:t&&!d,allowWhileTyping:!0}],[t,i,r,d]),!t&&!d)return null;if(d)return e.jsx(y,{isOpen:d,onClose:j,change:m?.change,payable:m?.payable,onNewEntry:N,onReceipt:v});const w=e.jsxs(e.Fragment,{children:[e.jsx(a,{label:"Cancel (Esc)",variant:"secondary",onClick:n,type:"button",className:"flex-1"}),e.jsx(a,{label:"Proceed (Enter)",variant:"primary",type:"button",onClick:f,className:"flex-1"})]});return e.jsxs(l,{isOpen:t,onClose:n,title:"Cash Payment",subtitle:"Enter amount received",icon:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),footer:w,size:"md",contentClassName:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-2xl py-6 px-4 text-center",children:[e.jsx("div",{className:"text-sm opacity-90 mb-2",children:"Total Amount"}),e.jsxs("div",{className:"text-4xl font-bold",children:["₱",r.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount Received"}),e.jsx("input",{ref:p,type:"number",step:"0.01",className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-center text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"₱0.00",value:i,onChange:e=>{const t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&c(t)}})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Quick amounts:"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[100,200,300,400,500,600,700,800,900].map(t=>e.jsx("button",{className:"bg-blue-100 hover:bg-blue-200 text-blue-700 font-bold py-2 rounded-lg transition-colors text-sm",onClick:()=>(e=>c(Number(e).toString()))(t),children:t},t))})]}),e.jsx(a,{label:"Use Exact Amount (E)",className:"w-full h-10 text-sm font-bold bg-slate-600 hover:bg-slate-700 text-white",onClick:g}),e.jsxs("div",{className:"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Use exact total:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"E"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Proceed:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Enter"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Close:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Esc"})]})]})]})}function N({isOpen:t,onClose:n,onImport:o}){const[i,c]=s.useState(!1),[d,m]=s.useState(""),h=sessionStorage.getItem("auth_token"),p=JSON.parse(sessionStorage.getItem("user")||"{}"),b=e.jsx(a,{label:"Close (Esc)",variant:"secondary",onClick:n,className:"w-full"});return u([{key:"escape",action:n,enabled:t}],[t]),e.jsxs(l,{isOpen:t,onClose:n,title:"Scan Customer Cart",subtitle:"Ask customer to show their QR",icon:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),footer:b,size:"lg",contentClassName:"space-y-3",children:[e.jsx("div",{className:"text-blue-800 text-sm font-medium",children:"Ask the customer to show their cart QR code"}),e.jsx("div",{className:"h-[50vh]",children:e.jsx(x,{onScan:async e=>{const t=e?.[0]?.rawValue;if(t){c(!0),m("");try{let e;try{e=JSON.parse(t)}catch(s){throw new Error("Invalid QR payload")}if("cart"===e.t&&e.transaction_id){const{transaction_id:t,business_id:s}=e,l=p?.businessId||p?.business_id;if(s&&l&&Number(s)!==Number(l))throw new Error("This QR code is not valid for this store.");try{const e=await r(`/api/sales/${t}/complete`,{method:"POST",headers:{Authorization:`Bearer ${h}`}});if(e.transaction_id)return n(),void(window.location.href=`/receipt?tn=${e.transaction_number}`);throw new Error("Failed to complete transaction")}catch(a){throw console.error("Error completing transaction:",a),new Error(a.message||"Failed to complete customer transaction")}}else{if("cart"!==e.t||!Array.isArray(e.items))throw new Error("Unsupported QR code format");{const{items:t,b:s}=e,a=p?.businessId||p?.business_id;if(s&&a&&Number(s)!==Number(a))throw new Error("This QR code is not valid for this store.");const l=[];for(const e of t){if(!e?.p||!e?.q)continue;const t=await r(`/api/products/${encodeURIComponent(e.p)}`,{headers:{Authorization:`Bearer ${h}`}});l.push({product_id:t.product_id,sku:t.sku,name:t.product_name,quantity:Number(e.q),price:Number(t.selling_price||0)})}if(0===l.length)throw new Error("No items to import");o(l),n()}}}catch(s){m(s.message||"Failed to process QR code"),console.error("Scan error:",s)}finally{c(!1)}}},paused:i,onResume:()=>c(!1),className:"w-full h-full"})}),d&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:d}),e.jsx("div",{className:"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Close:"}),e.jsx("span",{className:"font-mono bg-white px-2 py-0.5 rounded",children:"Esc"})]})})]})}export{h as C,b as D,p as P,m as S,g as a,f as b,j as c,N as d};
//# sourceMappingURL=ScanCustomerCartModal-C_rMfsdn.js.map
