{"version":3,"file":"MobileScannerView-bfXvKoAa.js","sources":["../../../frontend/src/components/ui/Mobile-Scanner/OrderItemRow.jsx","../../../frontend/src/components/ui/Mobile-Scanner/OrderDrawer.jsx","../../../frontend/src/components/ui/Mobile-Scanner/CheckoutModal.jsx","../../../frontend/src/components/ui/Mobile-Scanner/ActionBar.jsx","../../../frontend/src/components/modals/CustomerCartQRModal.jsx","../../../frontend/src/components/ui/Mobile-Scanner/MobileScannerView.jsx"],"sourcesContent":["import React from 'react';\r\n\r\nfunction OrderItemRow({ item, onIncrement, onDecrement, onRemove }) {\r\n  return (\r\n    <div className=\"grid grid-cols-[40px_1fr_80px_80px] items-center gap-2 py-2\">\r\n      <div className=\"text-sm text-blue-900 font-semibold\">{item.quantity}x</div>\r\n      <div>\r\n        <input\r\n          value={item.name}\r\n          readOnly\r\n          className=\"w-full px-3 py-2 rounded-lg border border-blue-200 bg-white text-blue-900 text-sm shadow-sm focus:outline-none\"\r\n        />\r\n      </div>\r\n      <div className=\"text-right text-sm text-blue-900 font-semibold\">â‚±{item.price.toFixed(2)}</div>\r\n      <div className=\"flex items-center justify-end gap-3\">\r\n        <button onClick={onDecrement} className=\"text-blue-700\">âˆ’</button>\r\n        <button onClick={onIncrement} className=\"text-blue-700\">ï¼‹</button>\r\n        <button onClick={onRemove} className=\"text-red-600\">ðŸ—‘</button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default OrderItemRow;","import React from \"react\";\r\nimport OrderItemRow from \"./OrderItemRow\";\r\n\r\nfunction OrderDrawer({ cart, onIncrement, onDecrement, onRemove }) {\r\n  return (\r\n    <div className=\"w-full\">\r\n      <div className=\"text-blue-900 text-lg font-bold mb-3\">Your Order</div>\r\n      <div className=\"grid grid-cols-[40px_1fr_80px_80px] text-xs text-blue-700 font-semibold px-1 mb-2\">\r\n        <div>QTY</div>\r\n        <div>Item</div>\r\n        <div>Price</div>\r\n        <div className=\"text-right\">Settings</div>\r\n      </div>\r\n      <div className=\"space-y-2 max-h-[45vh] overflow-y-auto pr-1\">\r\n        {cart.length === 0 ? (\r\n          <div className=\"text-blue-500 text-center py-6\">\r\n            Scan items to add them to your order.\r\n          </div>\r\n        ) : (\r\n          cart.map((item) => (\r\n            <OrderItemRow\r\n              key={item.sku}\r\n              item={item}\r\n              onIncrement={() => onIncrement(item.sku)}\r\n              onDecrement={() => onDecrement(item.sku)}\r\n              onRemove={() => onRemove(item.sku)}\r\n            />\r\n          ))\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default OrderDrawer;\r\n","import React from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport Modal from \"../../modals/Modal\";\r\nimport Button from \"../../common/Button\";\r\n\r\nfunction CheckoutModal({\r\n  isOpen,\r\n  onClose,\r\n  total,\r\n  method,\r\n  setMethod,\r\n  onPay,\r\n  cart = [],\r\n}) {\r\n  const itemCount = cart.reduce((sum, item) => sum + (item.quantity || 0), 0);\r\n\r\n  const paymentMethods = [\r\n    {\r\n      id: \"Cash\",\r\n      name: \"Cash\",\r\n      icon: (\r\n        <svg\r\n          className=\"w-6 h-6\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2z\"\r\n          />\r\n        </svg>\r\n      ),\r\n      description: \"Pay with cash at counter\",\r\n    },\r\n    {\r\n      id: \"GCash\",\r\n      name: \"GCash\",\r\n      icon: (\r\n        <svg\r\n          className=\"w-6 h-6\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z\"\r\n          />\r\n        </svg>\r\n      ),\r\n      description: \"Pay online with GCash\",\r\n    },\r\n    {\r\n      id: \"PayMaya\",\r\n      name: \"PayMaya\",\r\n      icon: (\r\n        <svg\r\n          className=\"w-6 h-6\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z\"\r\n          />\r\n        </svg>\r\n      ),\r\n      description: \"Pay online with PayMaya\",\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <Modal isOpen={isOpen} onClose={onClose} title=\"\">\r\n      <motion.div\r\n        className=\"space-y-8 p-2\"\r\n        initial={{ opacity: 0, y: 20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ duration: 0.3 }}\r\n      >\r\n        {/* Cart Summary */}\r\n        <div className=\"bg-blue-50 rounded-xl p-6 border border-blue-100\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\r\n                <svg\r\n                  className=\"w-5 h-5 text-blue-600\"\r\n                  fill=\"none\"\r\n                  stroke=\"currentColor\"\r\n                  viewBox=\"0 0 24 24\"\r\n                >\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z\"\r\n                  />\r\n                </svg>\r\n              </div>\r\n              <div>\r\n                <div className=\"text-sm text-blue-600 font-medium\">\r\n                  Order Summary\r\n                </div>\r\n                <div className=\"text-xs text-blue-500\">\r\n                  {itemCount} item{itemCount !== 1 ? \"s\" : \"\"}\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"text-right\">\r\n              <div className=\"text-sm text-blue-600 font-medium\">Total</div>\r\n              <div className=\"text-lg font-bold text-blue-900\">\r\n                â‚±{total.toFixed(2)}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Payment Methods */}\r\n        <div>\r\n          <h3 className=\"text-lg font-bold text-blue-900 mb-6\">\r\n            Choose Payment Method\r\n          </h3>\r\n          <div className=\"space-y-4\">\r\n            {paymentMethods.map((payment) => (\r\n              <motion.div\r\n                key={payment.id}\r\n                className={`relative p-5 rounded-xl border-2 cursor-pointer transition-all duration-200 ${\r\n                  method === payment.id\r\n                    ? \"border-blue-500 bg-blue-50 shadow-md\"\r\n                    : \"border-gray-200 bg-white\"\r\n                }`}\r\n                onClick={() => setMethod(payment.id)}\r\n                whileTap={{ scale: 0.98 }}\r\n              >\r\n                <div className=\"flex items-center gap-4\">\r\n                  <div\r\n                    className={`w-12 h-12 rounded-full flex items-center justify-center ${\r\n                      method === payment.id\r\n                        ? \"bg-blue-500 text-white\"\r\n                        : \"bg-gray-100 text-gray-600\"\r\n                    }`}\r\n                  >\r\n                    {payment.icon}\r\n                  </div>\r\n                  <div className=\"flex-1\">\r\n                    <div className=\"font-semibold text-blue-900\">\r\n                      {payment.name}\r\n                    </div>\r\n                    <div className=\"text-sm text-gray-600\">\r\n                      {payment.description}\r\n                    </div>\r\n                  </div>\r\n                  <div\r\n                    className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${\r\n                      method === payment.id\r\n                        ? \"border-blue-500 bg-blue-500\"\r\n                        : \"border-gray-300\"\r\n                    }`}\r\n                  >\r\n                    {method === payment.id && (\r\n                      <svg\r\n                        className=\"w-3 h-3 text-white\"\r\n                        fill=\"currentColor\"\r\n                        viewBox=\"0 0 20 20\"\r\n                      >\r\n                        <path\r\n                          fillRule=\"evenodd\"\r\n                          d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\"\r\n                          clipRule=\"evenodd\"\r\n                        />\r\n                      </svg>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </motion.div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Pay Button */}\r\n        <motion.div\r\n          className=\"pt-4\"\r\n          initial={{ opacity: 0, y: 10 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ delay: 0.2 }}\r\n        >\r\n          <Button\r\n            label={`Pay â‚±${total.toFixed(2)}`}\r\n            variant=\"primary\"\r\n            onClick={() => onPay(method || \"Cash\")}\r\n            microinteraction\r\n            className=\"w-full py-3 text-lg font-semibold\"\r\n          />\r\n        </motion.div>\r\n      </motion.div>\r\n    </Modal>\r\n  );\r\n}\r\n\r\nexport default CheckoutModal;\r\n","import React from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport Button from \"../../common/Button\";\r\n\r\nfunction ActionBar({ total, onCancel, onCheckout, disabled = false }) {\r\n  return (\r\n    <motion.div\r\n      className=\"fixed bottom-0 left-0 right-0 px-4 pb-4 sm:pb-6 pt-3 bg-white/95 backdrop-blur-xl border-t border-blue-200/50 shadow-2xl\"\r\n      initial={{ y: 100, opacity: 0 }}\r\n      animate={{ y: 0, opacity: 1 }}\r\n      transition={{ duration: 0.3, ease: \"easeOut\" }}\r\n    >\r\n      <div className=\"max-w-screen-md mx-auto flex items-center justify-between gap-3\">\r\n        <Button\r\n          label=\"Cancel\"\r\n          variant=\"secondary\"\r\n          onClick={onCancel}\r\n          microinteraction\r\n          disabled={disabled}\r\n          className=\"flex-shrink-0\"\r\n        />\r\n        <Button\r\n          label=\"Check Out\"\r\n          variant=\"primary\"\r\n          onClick={onCheckout}\r\n          microinteraction\r\n          disabled={disabled}\r\n          className=\"flex-shrink-0\"\r\n        />\r\n        <motion.div\r\n          className=\"text-right text-sm flex-shrink-0 min-w-[100px]\"\r\n          initial={{ scale: 0.9 }}\r\n          animate={{ scale: 1 }}\r\n          transition={{ delay: 0.2 }}\r\n        >\r\n          <div className=\"text-blue-600 font-medium text-xs sm:text-sm\">\r\n            Order Total:\r\n          </div>\r\n          <div className=\"text-blue-900 font-extrabold text-lg sm:text-xl\">\r\n            â‚±{total.toFixed(2)}\r\n          </div>\r\n        </motion.div>\r\n      </div>\r\n    </motion.div>\r\n  );\r\n}\r\n\r\nexport default ActionBar;\r\n","import React, { useMemo, useEffect, useState } from \"react\";\r\nimport { api } from \"../../lib/api\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport Loader from \"../common/Loader\";\r\n\r\nexport default function CustomerCartQRModal({\r\n  isOpen,\r\n  onClose,\r\n  qrPayload,\r\n  transactionId,\r\n  onTransactionComplete,\r\n}) {\r\n  const [status, setStatus] = useState(\"pending\");\r\n  const [error, setError] = useState(\"\");\r\n\r\n  const payload = useMemo(() => {\r\n    if (qrPayload) return qrPayload;\r\n    return \"{}\"; // Fallback for safety\r\n  }, [qrPayload]);\r\n\r\n  useEffect(() => {\r\n    if (isOpen && transactionId) {\r\n      const interval = setInterval(async () => {\r\n        try {\r\n          const response = await api(`/sales/public/transaction/${transactionId}`);\r\n          if (response.status === 'completed') {\r\n            setStatus('completed');\r\n            clearInterval(interval);\r\n            if (onTransactionComplete) {\r\n              onTransactionComplete(response.tn);\r\n            }\r\n          }\r\n        } catch (err) {\r\n          console.error('Error fetching transaction status:', err);\r\n          setError('Could not fetch transaction status.');\r\n          clearInterval(interval);\r\n        }\r\n      }, 3000); // Poll every 3 seconds\r\n\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [isOpen, transactionId, onTransactionComplete]);\r\n\r\n  // Reset internal state when the modal is closed\r\n  useEffect(() => {\r\n    if (!isOpen) {\r\n      setTimeout(() => {\r\n        setStatus('pending');\r\n        setError('');\r\n      }, 300); // Delay reset to allow for closing animation\r\n    }\r\n  }, [isOpen]);\r\n\r\n  const qrSrc = useMemo(() => {\r\n    const data = encodeURIComponent(payload);\r\n    return `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${data}&qzone=2&format=png&_=${Date.now()}`;\r\n  }, [payload]);\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Show to Cashier\"\r\n      subtitle=\"Let the cashier scan this QR code to finalize payment.\"\r\n      size=\"sm\"\r\n      contentClassName=\"text-center space-y-3\"\r\n    >\r\n      <img\r\n        src={qrSrc}\r\n        alt=\"Customer Cart QR\"\r\n        className=\"w-[300px] h-[300px] border-4 border-blue-200 rounded-2xl bg-white mx-auto shadow-lg\"\r\n      />\r\n\r\n      <div className=\"h-8\">\r\n        {status === 'pending' && (\r\n          <div className=\"flex items-center justify-center space-x-2 text-blue-800 animate-pulse\">\r\n            <Loader size=\"sm\" />\r\n            <span>Waiting for cashier...</span>\r\n          </div>\r\n        )}\r\n        {status === 'completed' && (\r\n          <div className=\"text-green-600 font-bold\">Transaction Complete! Redirecting...</div>\r\n        )}\r\n        {error && <div className=\"text-red-500 text-sm\">{error}</div>}\r\n      </div>\r\n\r\n      <div className=\"pt-4\">\r\n        <button\r\n          onClick={onClose}\r\n          className=\"w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 px-4 rounded-lg transition-colors duration-300\"\r\n        >\r\n          Cancel\r\n        </button>\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n","import React, { useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { useNavigate, Link } from \"react-router-dom\";\r\nimport Background from \"../../layout/Background\";\r\nimport ScannerCard from \"../../ui/POS/ScannerCard\";\r\nimport Card from \"../../common/Card\";\r\nimport OrderDrawer from \"./OrderDrawer\";\r\nimport CheckoutModal from \"./CheckoutModal\";\r\nimport ActionBar from \"./ActionBar\";\r\nimport { api, createGcashCheckout } from \"../../../lib/api\";\r\nimport CustomerCartQRModal from \"../../modals/CustomerCartQRModal\";\r\n\r\nfunction MobileScannerView() {\r\n  const navigate = useNavigate();\r\n  const [cart, setCart] = useState([]);\r\n  const [scannerPaused, setScannerPaused] = useState(false);\r\n  const [showCheckout, setShowCheckout] = useState(false);\r\n  const [paymentMethod, setPaymentMethod] = useState(\"GCash\");\r\n  const [drawerOpen, setDrawerOpen] = useState(true);\r\n  const [loading, setLoading] = useState(false);\r\n  const [checkoutMessage, setCheckoutMessage] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const [showCartQR, setShowCartQR] = useState(false);\r\n  const hasFinalizedRef = useRef(false);\r\n\r\n  const [qrPayload, setQrPayload] = useState(null);\r\n  const [transactionId, setTransactionId] = useState(null);\r\n\r\n  const [storeName, setStoreName] = useState(\"\");\r\n\r\n  const total = useMemo(\r\n    () =>\r\n      cart.reduce(\r\n        (sum, item) =>\r\n          item &&\r\n          typeof item.price === \"number\" &&\r\n          typeof item.quantity === \"number\"\r\n            ? sum + item.price * item.quantity\r\n            : sum,\r\n        0\r\n      ),\r\n    [cart]\r\n  );\r\n\r\n  useEffect(() => {\r\n    const businessId = localStorage.getItem(\"business_id\");\r\n    if (businessId) {\r\n      api(`/api/business/public/${businessId}`)\r\n        .then((data) => {\r\n          setStoreName(data.business_name);\r\n        })\r\n        .catch(() => {\r\n          setError(\"Could not fetch store name.\");\r\n        });\r\n    }\r\n  }, []);\r\n\r\n  // Handle return from online payment (GCash)\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(window.location.search);\r\n    const status = params.get(\"payment\");\r\n    const pending = localStorage.getItem(\"pending_gcash_cart_public\");\r\n    const businessId = localStorage.getItem(\"business_id\");\r\n    if (status === \"success\" && pending && businessId) {\r\n      try {\r\n        const parsed = JSON.parse(pending);\r\n        (async () => {\r\n          if (hasFinalizedRef.current) return;\r\n          const guardKey = \"gcash_finalize_done_public\";\r\n          if (sessionStorage.getItem(guardKey) === \"1\") return;\r\n          hasFinalizedRef.current = true;\r\n          sessionStorage.setItem(guardKey, \"1\");\r\n          try {\r\n            const body = {\r\n              items: parsed.items || [],\r\n              payment_type: \"gcash\",\r\n              money_received: parsed.total || null,\r\n              business_id: Number(businessId),\r\n              transaction_number: parsed.transactionNumber || null,\r\n            };\r\n            const resp = await api(\"/api/sales/public/checkout\", {\r\n              method: \"POST\",\r\n              body: JSON.stringify(body),\r\n            });\r\n            setCart([]);\r\n            const url = new URL(window.location.origin + \"/receipt\");\r\n            url.searchParams.set(\"tn\", resp.transaction_number);\r\n            url.searchParams.set(\"tid\", String(resp.transaction_id));\r\n            url.searchParams.set(\"total\", String(resp.total || 0));\r\n            window.location.href = url.toString();\r\n          } catch (e) {\r\n            setError(\"Failed to record payment\");\r\n          } finally {\r\n            localStorage.removeItem(\"pending_gcash_cart_public\");\r\n            const url = new URL(window.location.href);\r\n            url.searchParams.delete(\"payment\");\r\n            window.history.replaceState({}, \"\", url.toString());\r\n          }\r\n        })();\r\n      } catch (_) {\r\n        localStorage.removeItem(\"pending_gcash_cart_public\");\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  const handleScan = async (result) => {\r\n    const code = result?.[0]?.rawValue;\r\n    if (!code) return;\r\n\r\n    setScannerPaused(true);\r\n    setError(\"\");\r\n    setLoading(true);\r\n\r\n    try {\r\n      // Check if product already exists in cart\r\n      const existingIndex = cart.findIndex((p) => p.sku === code);\r\n      if (existingIndex !== -1) {\r\n        // Just increment quantity for existing item\r\n        setCart((prev) => {\r\n          const updated = [...prev];\r\n          updated[existingIndex] = {\r\n            ...updated[existingIndex],\r\n            quantity: updated[existingIndex].quantity + 1,\r\n          };\r\n          return updated;\r\n        });\r\n        setScannerPaused(false);\r\n        return;\r\n      }\r\n\r\n      // Fetch product from database using public endpoint\r\n      // Prefer stored business_id if available; backend now also supports fallback without it\r\n      const storedBusinessId = localStorage.getItem(\"business_id\");\r\n      const query = storedBusinessId\r\n        ? `?business_id=${encodeURIComponent(storedBusinessId)}`\r\n        : \"\";\r\n      const product = await api(\r\n        `/api/products/public/sku/${encodeURIComponent(code)}${query}`\r\n      );\r\n\r\n      // Enforce that scanned product belongs to the current store\r\n      if (\r\n        product &&\r\n        (!storedBusinessId ||\r\n          Number(product.business_id) === Number(storedBusinessId))\r\n      ) {\r\n        const price = Number(product.selling_price || 0);\r\n        const productName = product.product_name || `Product ${code}`;\r\n\r\n        setCart((prev) => [\r\n          ...prev,\r\n          {\r\n            product_id: product.product_id,\r\n            sku: product.sku,\r\n            name: productName,\r\n            quantity: 1,\r\n            price: price,\r\n          },\r\n        ]);\r\n      } else {\r\n        throw new Error(\"Product not found in this store\");\r\n      }\r\n    } catch (err) {\r\n      setError(\"Product not found\");\r\n\r\n    } finally {\r\n      setLoading(false);\r\n      setScannerPaused(false);\r\n    }\r\n  };\r\n\r\n  const increment = (sku) =>\r\n    setCart((prev) =>\r\n      prev.map((p) => (p.sku === sku ? { ...p, quantity: p.quantity + 1 } : p))\r\n    );\r\n  const decrement = (sku) =>\r\n    setCart((prev) =>\r\n      prev.map((p) =>\r\n        p.sku === sku ? { ...p, quantity: Math.max(1, p.quantity - 1) } : p\r\n      )\r\n    );\r\n  const removeItem = (sku) =>\r\n    setCart((prev) => prev.filter((p) => p.sku !== sku));\r\n\r\n  const handleCopyTn = () => {\r\n    navigator.clipboard.writeText(storeName || \"\");\r\n  };\r\n\r\n  const handleTransactionComplete = (tn) => {\r\n    setShowCartQR(false);\r\n    navigate(`/receipt?tn=${tn}&from=customer`);\r\n  };\r\n\r\n  return (\r\n    <Background variant=\"gradientBlue\" pattern=\"dots\" floatingElements overlay>\r\n      {/* Animated background orbs */}\r\n      <motion.div\r\n        className=\"absolute -top-24 -left-24 w-[28rem] h-[28rem] rounded-full bg-gradient-to-br from-blue-400/15 to-cyan-400/10 blur-3xl\"\r\n        animate={{ scale: [1, 1.08, 1], opacity: [0.35, 0.5, 0.35] }}\r\n        transition={{ duration: 10, repeat: Infinity, ease: \"easeInOut\" }}\r\n      />\r\n      <motion.div\r\n        className=\"absolute bottom-0 -right-24 w-[30rem] h-[30rem] rounded-full bg-gradient-to-bl from-indigo-400/15 to-purple-400/10 blur-3xl\"\r\n        animate={{ scale: [1, 1.12, 1], opacity: [0.3, 0.45, 0.3] }}\r\n        transition={{ duration: 12, repeat: Infinity, ease: \"easeInOut\" }}\r\n      />\r\n\r\n      <div className=\"min-h-screen pb-32 pt-4 sm:pt-6\">\r\n\r\n\r\n        <motion.div\r\n          className=\"px-4 space-y-4 max-w-screen-md mx-auto\"\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ duration: 0.5 }}\r\n        >\r\n          {/* Transaction Number Display */}\r\n          <div className=\"flex items-center justify-center p-2\">\r\n            <button\r\n              onClick={handleCopyTn}\r\n              title=\"Copy store name\"\r\n              className=\"inline-flex items-center gap-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg px-2.5 py-1.5 shadow-sm hover:bg-blue-100 transition-colors\"\r\n            >\r\n              <svg\r\n                className=\"w-4 h-4\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2M8 16h8a2 2 0 002-2v-6m-10 8l-2 2m2-2l2 2\"\r\n                />\r\n              </svg>\r\n              <span className=\"font-mono text-xs sm:text-sm md:text-base font-bold tracking-wider truncate max-w-[50vw]\">\r\n                {storeName || 'Scan Store QR to Begin'}\r\n              </span>\r\n            </button>\r\n          </div>\r\n          {/* Scanner Card */}\r\n          <motion.div\r\n            initial={{ opacity: 0, scale: 0.95 }}\r\n            animate={{ opacity: 1, scale: 1 }}\r\n            transition={{ duration: 0.4, delay: 0.1 }}\r\n          >\r\n            <ScannerCard\r\n              onScan={handleScan}\r\n              paused={scannerPaused}\r\n              onResume={() => setScannerPaused(false)}\r\n              className=\"w-full\"\r\n              textMain=\"text-blue-700\"\r\n            />\r\n          </motion.div>\r\n\r\n          {/* Error Display */}\r\n          <AnimatePresence>\r\n            {error && (\r\n              <motion.div\r\n                initial={{ opacity: 0, y: -10 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                exit={{ opacity: 0, y: -10 }}\r\n                className=\"bg-red-50 border border-red-200 rounded-xl p-4 text-red-700 text-sm shadow-lg backdrop-blur-sm\"\r\n              >\r\n                <div className=\"flex items-center gap-2\">\r\n                  <svg\r\n                    className=\"w-5 h-5 flex-shrink-0\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={2}\r\n                      d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                    />\r\n                  </svg>\r\n                  <span>{error}</span>\r\n                </div>\r\n              </motion.div>\r\n            )}\r\n          </AnimatePresence>\r\n\r\n          {/* Loading Indicator */}\r\n          <AnimatePresence>\r\n            {loading && (\r\n              <motion.div\r\n                initial={{ opacity: 0, y: -10 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                exit={{ opacity: 0, y: -10 }}\r\n                className=\"bg-blue-50 border border-blue-200 rounded-xl p-4 text-blue-700 text-sm text-center shadow-lg backdrop-blur-sm\"\r\n              >\r\n                <div className=\"flex items-center justify-center gap-2\">\r\n                  <motion.div\r\n                    className=\"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full\"\r\n                    animate={{ rotate: 360 }}\r\n                    transition={{\r\n                      duration: 1,\r\n                      repeat: Infinity,\r\n                      ease: \"linear\",\r\n                    }}\r\n                  />\r\n                  <span>Loading product...</span>\r\n                </div>\r\n              </motion.div>\r\n            )}\r\n          </AnimatePresence>\r\n\r\n          {/* Order Drawer */}\r\n          <motion.div\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            transition={{ duration: 0.3 }}\r\n          >\r\n            <Card className=\"w-full\" variant=\"glass\">\r\n              <OrderDrawer\r\n                open={drawerOpen}\r\n                onToggle={() => setDrawerOpen((v) => !v)}\r\n                cart={cart}\r\n                onIncrement={increment}\r\n                onDecrement={decrement}\r\n                onRemove={removeItem}\r\n              />\r\n              {cart.length === 0 && (\r\n                <div className=\"p-4 text-center text-gray-500\">\r\n                  Cart is empty\r\n                </div>\r\n              )}\r\n            </Card>\r\n          </motion.div>\r\n        </motion.div>\r\n\r\n        <ActionBar\r\n          total={total}\r\n          onCancel={async () => {\r\n            const customerUserId = localStorage.getItem(\"customer_user_id\");\r\n            if (customerUserId) {\r\n              try {\r\n                await api(`/api/cleanup/user/${customerUserId}`, {\r\n                  method: \"DELETE\",\r\n                });\r\n              } catch (err) {\r\n              }\r\n            }\r\n            setCart([]);\r\n            navigate(\"/\");\r\n          }}\r\n          onCheckout={() => setShowCheckout(true)}\r\n        />\r\n\r\n        {cart.length > 0 && (\r\n          <CheckoutModal\r\n            isOpen={showCheckout}\r\n            onClose={() => setShowCheckout(false)}\r\n            total={total}\r\n            method={paymentMethod}\r\n            setMethod={setPaymentMethod}\r\n            cart={cart}\r\n            onPay={async (method) => {\r\n              const businessId = localStorage.getItem(\"business_id\");\r\n              if (!businessId) {\r\n                setError(\"No store selected. Please scan the store QR first.\");\r\n                setShowCheckout(false);\r\n                return;\r\n              }\r\n              if (method === \"Cash\") {\r\n                const customerUserId = localStorage.getItem(\"customer_user_id\");\r\n                setShowCheckout(false);\r\n                try {\r\n                  const body = {\r\n                    items: cart.map((i) => ({\r\n                      product_id: i.product_id,\r\n                      sku: i.sku,\r\n                      quantity: i.quantity,\r\n                    })),\r\n                    payment_type: method.toLowerCase(),\r\n                    money_received: total,\r\n                    business_id: Number(businessId),\r\n                    customer_user_id: customerUserId\r\n                      ? Number(customerUserId)\r\n                      : null,\r\n                    transaction_number: localStorage.getItem(\r\n                      \"provisionalTransactionNumber\"\r\n                    ),\r\n                  };\r\n                  const res = await api(\"/api/sales/public/checkout\", {\r\n                    method: \"POST\",\r\n                    body: JSON.stringify(body),\r\n                  });\r\n                  setCart([]);\r\n                  if (res.qr_payload) {\r\n                    setShowCartQR(true);\r\n                    setCheckoutMessage(\"\");\r\n                    setQrPayload(res.qr_payload);\r\n                    setTransactionId(res.transaction_id);\r\n                  } else {\r\n                    setCheckoutMessage(\"Failed to generate payment QR\");\r\n                  }\r\n                } catch (err) {\r\n                  setCheckoutMessage(\"Checkout failed\");\r\n                }\r\n                return;\r\n              }\r\n              if (method === \"GCash\") {\r\n                try {\r\n                  const successUrl =\r\n                    window.location.origin + \"/customer?payment=success\";\r\n                  const cancelUrl =\r\n                    window.location.origin + \"/customer?payment=cancel\";\r\n                  localStorage.setItem(\r\n                    \"pending_gcash_cart_public\",\r\n                    JSON.stringify({\r\n                      items: cart.map((i) => ({\r\n                        product_id: i.product_id,\r\n                        sku: i.sku,\r\n                        quantity: i.quantity,\r\n                      })),\r\n                      total,\r\n                      transactionNumber: localStorage.getItem(\r\n                        \"provisionalTransactionNumber\"\r\n                      ),\r\n                    })\r\n                  );\r\n                  const { checkoutUrl } = await createGcashCheckout({\r\n                    amount: Number(total || 0),\r\n                    description: \"Self-checkout Order\",\r\n                    referenceNumber: `SC-${Date.now()}`,\r\n                    cancelUrl,\r\n                    successUrl,\r\n                  });\r\n                  window.location.href = checkoutUrl;\r\n                } catch (e) {\r\n                  setError(\"Failed to initialize online payment\");\r\n                  localStorage.removeItem(\"pending_gcash_cart_public\");\r\n                } finally {\r\n                  setShowCheckout(false);\r\n                }\r\n                return;\r\n              }\r\n              // default: fallback to immediate record (e.g., PayMaya placeholder)\r\n              try {\r\n                const customerUserId = localStorage.getItem(\"customer_user_id\");\r\n                const body = {\r\n                  items: cart.map((i) => ({\r\n                    product_id: i.product_id,\r\n                    sku: i.sku,\r\n                    quantity: i.quantity,\r\n                  })),\r\n                  payment_type: method,\r\n                  money_received: total,\r\n                  business_id: Number(businessId),\r\n                  customer_user_id: customerUserId\r\n                    ? Number(customerUserId)\r\n                    : null,\r\n                  transaction_number: localStorage.getItem(\r\n                    \"provisionalTransactionNumber\"\r\n                  ),\r\n                };\r\n                const res = await api(\"/api/sales/public/checkout\", {\r\n                  method: \"POST\",\r\n                  body: JSON.stringify(body),\r\n                });\r\n                setCart([]);\r\n                // Show cashier QR for cash payments (returned in qr_payload)\r\n                if (res.qr_payload) {\r\n                  setShowCartQR(true);\r\n                  setCheckoutMessage(\"\");\r\n                  // Pass qr_payload to modal\r\n                  setQrPayload(res.qr_payload);\r\n                  setTransactionId(res.transaction_id);\r\n                } else {\r\n                  // Redirect to receipt after non-GCash online record\r\n                  const url = new URL(window.location.origin + \"/receipt\");\r\n                  url.searchParams.set(\"tn\", res.transaction_number);\r\n                  url.searchParams.set(\"tid\", String(res.transaction_id));\r\n                  url.searchParams.set(\"total\", String(res.total || 0));\r\n                  window.location.href = url.toString();\r\n                }\r\n              } catch (err) {\r\n                setCheckoutMessage(\"Checkout failed\");\r\n              } finally {\r\n                setShowCheckout(false);\r\n              }\r\n            }}\r\n          />\r\n        )}\r\n\r\n        <CustomerCartQRModal\r\n          isOpen={showCartQR}\r\n          onClose={() => setShowCartQR(false)}\r\n          onTransactionComplete={handleTransactionComplete}\r\n          qrPayload={qrPayload}\r\n          transactionId={transactionId}\r\n        />\r\n\r\n        <AnimatePresence>\r\n          {checkoutMessage && (\r\n            <motion.div\r\n              className=\"px-4 mt-4 max-w-screen-md mx-auto\"\r\n              initial={{ opacity: 0, y: -10 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              exit={{ opacity: 0, y: -10 }}\r\n            >\r\n              <div className=\"bg-green-50 border border-green-200 rounded-xl p-4 text-green-700 text-sm shadow-lg backdrop-blur-sm\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <svg\r\n                    className=\"w-5 h-5 flex-shrink-0\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={2}\r\n                      d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                    />\r\n                  </svg>\r\n                  <span>{checkoutMessage}</span>\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n      </div>\r\n    </Background>\r\n  );\r\n}\r\n\r\nexport default MobileScannerView;\r\n"],"names":["OrderItemRow","item","onIncrement","onDecrement","onRemove","jsxs","className","children","quantity","jsx","value","name","readOnly","price","toFixed","onClick","OrderDrawer","cart","length","map","sku","CheckoutModal","isOpen","onClose","total","method","setMethod","onPay","itemCount","reduce","sum","paymentMethods","id","icon","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","description","Modal","title","motion","div","initial","opacity","y","animate","transition","duration","payment","whileTap","scale","fillRule","clipRule","delay","Button","label","variant","microinteraction","ActionBar","onCancel","onCheckout","disabled","ease","CustomerCartQRModal","qrPayload","transactionId","onTransactionComplete","status","setStatus","useState","error","setError","payload","useMemo","useEffect","interval","setInterval","async","response","api","clearInterval","tn","err","setTimeout","qrSrc","encodeURIComponent","Date","now","BaseModal","subtitle","size","contentClassName","src","alt","Loader","MobileScannerView","navigate","useNavigate","setCart","scannerPaused","setScannerPaused","showCheckout","setShowCheckout","paymentMethod","setPaymentMethod","drawerOpen","setDrawerOpen","loading","setLoading","checkoutMessage","setCheckoutMessage","showCartQR","setShowCartQR","hasFinalizedRef","useRef","setQrPayload","setTransactionId","storeName","setStoreName","businessId","localStorage","getItem","then","data","business_name","catch","URLSearchParams","window","location","search","get","pending","parsed","JSON","parse","current","guardKey","sessionStorage","setItem","body","items","payment_type","money_received","business_id","Number","transaction_number","transactionNumber","resp","stringify","url","URL","origin","searchParams","set","String","transaction_id","href","toString","e","removeItem","delete","history","replaceState","_","Background","pattern","floatingElements","overlay","repeat","Infinity","handleCopyTn","clipboard","writeText","ScannerCard","onScan","result","code","rawValue","existingIndex","findIndex","p","prev","updated","storedBusinessId","query","product","Error","selling_price","productName","product_name","product_id","paused","onResume","textMain","AnimatePresence","exit","rotate","Card","open","onToggle","v","Math","max","filter","customerUserId","i","toLowerCase","customer_user_id","res","qr_payload","successUrl","cancelUrl","checkoutUrl","createGcashCheckout","amount","referenceNumber"],"mappings":"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"}