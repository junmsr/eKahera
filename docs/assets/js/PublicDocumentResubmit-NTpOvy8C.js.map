{"version":3,"file":"PublicDocumentResubmit-NTpOvy8C.js","sources":["../../../frontend/src/pages/PublicDocumentResubmit.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\r\nimport { api } from \"../lib/api\";\r\nimport Button from \"../components/common/Button\";\r\nimport Loader from \"../components/common/Loader\";\r\n\r\nconst PublicDocumentResubmit = () => {\r\n  const [searchParams] = useSearchParams();\r\n  const navigate = useNavigate();\r\n  const [email, setEmail] = useState(\"\");\r\n  const [documents, setDocuments] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [verifying, setVerifying] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [selectedFiles, setSelectedFiles] = useState({});\r\n  const [isSubmitting, setIsSubmitting] = useState({});\r\n  const [emailVerified, setEmailVerified] = useState(false);\r\n  const [showVerificationForm, setShowVerificationForm] = useState(true);\r\n\r\n  // Check for email in URL params\r\n  useEffect(() => {\r\n    const emailParam = searchParams.get('email');\r\n    if (emailParam) {\r\n      setEmail(emailParam);\r\n      // Auto-verify if email is in URL\r\n      handleVerifyEmail({ preventDefault: () => {} }, emailParam);\r\n    }\r\n  }, [searchParams]);\r\n\r\n  const handleVerifyEmail = async (e, emailToVerify = null) => {\r\n    e?.preventDefault();\r\n    const emailValue = emailToVerify || email;\r\n    \r\n    if (!emailValue) {\r\n      setError(\"Please enter your email address\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setVerifying(true);\r\n      setError(\"\");\r\n      \r\n      // Call API to verify email and get rejected documents\r\n      const data = await api(`/documents/rejected?email=${encodeURIComponent(emailValue)}`);\r\n      \r\n      if (!data.documents || data.documents.length === 0) {\r\n        setError(\"No rejected documents found for this email address.\");\r\n        return;\r\n      }\r\n      \r\n      setDocuments(data.documents);\r\n      setEmailVerified(true);\r\n      setShowVerificationForm(false);\r\n      \r\n      // Update URL with email parameter\r\n      const newUrl = new URL(window.location);\r\n      newUrl.searchParams.set('email', emailValue);\r\n      window.history.pushState({}, '', newUrl);\r\n      \r\n    } catch (err) {\r\n      console.error(\"Verification error:\", err);\r\n      setError(err.response?.data?.error || \"Failed to verify email. Please try again.\");\r\n    } finally {\r\n      setVerifying(false);\r\n    }\r\n  };\r\n\r\n  const handleFileChange = (documentId, file) => {\r\n    setSelectedFiles(prev => ({\r\n      ...prev,\r\n      [documentId]: file\r\n    }));\r\n  };\r\n\r\n  const handleResubmit = async (documentId) => {\r\n    if (!selectedFiles[documentId]) {\r\n      setError(\"Please select a file to upload\");\r\n      return;\r\n    }\r\n\r\n    const formData = new FormData();\r\n    formData.append('document', selectedFiles[documentId]);\r\n    formData.append('document_id', documentId);\r\n    formData.append('user_email', email);\r\n\r\n    try {\r\n      setIsSubmitting(prev => ({ ...prev, [documentId]: true }));\r\n      \r\n      await api(`/documents/resubmit`, {\r\n        method: 'POST',\r\n        body: formData,\r\n      });\r\n\r\n      // Update the document status in the local state\r\n      setDocuments(prev => \r\n        prev.map(doc => \r\n          doc.document_id === documentId \r\n            ? { ...doc, verification_status: 'pending', verification_notes: '' } \r\n            : doc\r\n        )\r\n      );\r\n      \r\n      // Clear the selected file\r\n      setSelectedFiles(prev => {\r\n        const newFiles = { ...prev };\r\n        delete newFiles[documentId];\r\n        return newFiles;\r\n      });\r\n      \r\n      toast.success(\"Document resubmitted successfully!\");\r\n      \r\n    } catch (error) {\r\n      console.error(\"Failed to resubmit document:\", error);\r\n      setError(error.response?.data?.error || \"Failed to resubmit document. Please try again.\");\r\n    } finally {\r\n      setIsSubmitting(prev => ({ ...prev, [documentId]: false }));\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status) => {\r\n    switch (status) {\r\n      case 'approved': return 'text-green-600 bg-green-100';\r\n      case 'rejected': return 'text-red-600 bg-red-100';\r\n      default: return 'text-yellow-600 bg-yellow-100';\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\r\n        <div className=\"text-center\">\r\n          <Loader size=\"lg\" />\r\n          <p className=\"mt-4 text-gray-600\">Loading document information...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\r\n      <div className=\"max-w-4xl mx-auto\">\r\n        <div className=\"text-center mb-8\">\r\n          <h1 className=\"text-3xl font-bold text-gray-900\">Document Resubmission</h1>\r\n          <p className=\"mt-2 text-lg text-gray-600\">\r\n            Please verify your email to view and resubmit rejected documents\r\n          </p>\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"mb-6 p-4 bg-red-50 border-l-4 border-red-500 text-red-700\">\r\n            <p>{error}</p>\r\n          </div>\r\n        )}\r\n\r\n        {showVerificationForm && (\r\n          <div className=\"bg-white shadow overflow-hidden rounded-lg p-6 mb-8\">\r\n            <h2 className=\"text-xl font-medium text-gray-900 mb-4\">Verify Your Email</h2>\r\n            <p className=\"text-gray-600 mb-6\">\r\n              Please enter the email address associated with your rejected documents.\r\n            </p>\r\n            \r\n            <form onSubmit={handleVerifyEmail} className=\"space-y-4\">\r\n              <div>\r\n                <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  Email Address\r\n                </label>\r\n                <input\r\n                  type=\"email\"\r\n                  id=\"email\"\r\n                  value={email}\r\n                  onChange={(e) => setEmail(e.target.value)}\r\n                  required\r\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"\r\n                  placeholder=\"your.email@example.com\"\r\n                  disabled={verifying}\r\n                />\r\n              </div>\r\n              \r\n              <div className=\"pt-2\">\r\n                <Button \r\n                  type=\"submit\" \r\n                  disabled={verifying || !email}\r\n                  className=\"w-full justify-center\"\r\n                >\r\n                  {verifying ? 'Verifying...' : 'Continue'}\r\n                </Button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        )}\r\n\r\n        {emailVerified && (\r\n          <div className=\"space-y-6\">\r\n            <div className=\"bg-blue-50 border-l-4 border-blue-400 p-4\">\r\n              <div className=\"flex\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <svg className=\"h-5 w-5 text-blue-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                    <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h2a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\r\n                  </svg>\r\n                </div>\r\n                <div className=\"ml-3\">\r\n                  <p className=\"text-sm text-blue-700\">\r\n                    Please upload new versions of your rejected documents. Make sure all documents are clear and up to date.\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {documents.map((doc) => (\r\n              <div key={doc.document_id} className=\"bg-white shadow overflow-hidden rounded-lg\">\r\n                <div className=\"px-4 py-5 sm:px-6 border-b border-gray-200\">\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <div>\r\n                      <h3 className=\"text-lg leading-6 font-medium text-gray-900\">\r\n                        {doc.document_type}\r\n                      </h3>\r\n                      <p className=\"mt-1 max-w-2xl text-sm text-gray-500\">\r\n                        {doc.document_name}\r\n                      </p>\r\n                    </div>\r\n                    <span className={`px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(doc.verification_status)}`}>\r\n                      {doc.verification_status}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n                <div className=\"px-4 py-5 sm:p-6\">\r\n                  {doc.verification_notes && (\r\n                    <div className=\"mb-4\">\r\n                      <h4 className=\"text-sm font-medium text-gray-700\">Rejection Reason:</h4>\r\n                      <p className=\"mt-1 text-sm text-gray-600\">{doc.verification_notes}</p>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  <div className=\"mt-4\">\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                      Upload New Version\r\n                    </label>\r\n                    <div className=\"flex items-center\">\r\n                      <input\r\n                        type=\"file\"\r\n                        id={`file-${doc.document_id}`}\r\n                        onChange={(e) => handleFileChange(doc.document_id, e.target.files[0])}\r\n                        className=\"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\"\r\n                        accept=\".pdf,.jpg,.jpeg,.png\"\r\n                      />\r\n                      <Button\r\n                        type=\"button\"\r\n                        onClick={() => handleResubmit(doc.document_id)}\r\n                        disabled={!selectedFiles[doc.document_id] || isSubmitting[doc.document_id]}\r\n                        className=\"ml-2 whitespace-nowrap\"\r\n                      >\r\n                        {isSubmitting[doc.document_id] ? 'Uploading...' : 'Upload'}\r\n                      </Button>\r\n                    </div>\r\n                    {selectedFiles[doc.document_id] && (\r\n                      <p className=\"mt-2 text-sm text-gray-600\">\r\n                        Selected: {selectedFiles[doc.document_id].name}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PublicDocumentResubmit;\r\n"],"names":["PublicDocumentResubmit","searchParams","useSearchParams","useNavigate","email","setEmail","useState","documents","setDocuments","loading","setLoading","verifying","setVerifying","error","setError","selectedFiles","setSelectedFiles","isSubmitting","setIsSubmitting","emailVerified","setEmailVerified","showVerificationForm","setShowVerificationForm","useEffect","emailParam","get","handleVerifyEmail","preventDefault","async","e","emailToVerify","emailValue","data","api","encodeURIComponent","length","newUrl","URL","window","location","set","history","pushState","err","response","getStatusColor","status","className","children","jsxs","jsx","Loader","size","onSubmit","htmlFor","type","id","value","onChange","target","required","placeholder","disabled","Button","viewBox","fill","fillRule","d","clipRule","map","doc","document_type","document_name","verification_status","verification_notes","document_id","handleFileChange","documentId","file","files","prev","accept","onClick","formData","FormData","append","method","body","newFiles","toast","success","handleResubmit","name"],"mappings":"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"}