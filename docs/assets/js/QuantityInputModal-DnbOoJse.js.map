{"version":3,"file":"QuantityInputModal-DnbOoJse.js","sources":["../../../frontend/src/components/modals/ScanCustomerCartModal.jsx","../../../frontend/src/components/modals/QuantityInputModal.jsx"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport ScannerCard from \"../ui/POS/ScannerCard\";\r\nimport Button from \"../common/Button\";\r\nimport { api } from \"../../lib/api\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nexport default function ScanCustomerCartModal({ isOpen, onClose, onImport }) {\r\n  const [scannerPaused, setScannerPaused] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const token = sessionStorage.getItem(\"auth_token\");\r\n\r\n  const user = JSON.parse(sessionStorage.getItem(\"user\") || \"{}\");\r\n\r\n  const handleScan = async (result) => {\r\n    const code = result?.[0]?.rawValue;\r\n    if (!code) return;\r\n    setScannerPaused(true);\r\n    setError(\"\");\r\n    try {\r\n      let payload;\r\n      try {\r\n        payload = JSON.parse(code);\r\n      } catch (e) {\r\n        throw new Error(\"Invalid QR payload\");\r\n      }\r\n      \r\n      // Check if this is a cart QR code with transaction ID\r\n      if (payload.t === 'cart' && payload.transaction_id) {\r\n        const { transaction_id, business_id: businessId } = payload;\r\n        \r\n        // Verify business ID matches if provided\r\n        const cashierBusinessId = user?.businessId || user?.business_id;\r\n        if (businessId && cashierBusinessId && Number(businessId) !== Number(cashierBusinessId)) {\r\n          throw new Error(\"This QR code is not valid for this store.\");\r\n        }\r\n\r\n        // Load pending transaction items into cart instead of completing immediately\r\n        try {\r\n          const response = await api(`/api/sales/${transaction_id}/pending-items`, {\r\n            method: 'GET',\r\n            headers: { Authorization: `Bearer ${token}` },\r\n          });\r\n          \r\n          if (response.transaction_id && response.items) {\r\n            // Pass items and transaction info to onImport callback\r\n            onImport(response.items, response.transaction_id, null, response.transaction_number);\r\n            onClose();\r\n            return;\r\n          } else {\r\n            throw new Error(\"Failed to load transaction items\");\r\n          }\r\n        } catch (err) {\r\n          console.error('Error loading transaction items:', err);\r\n          throw new Error(err.message || \"Failed to load customer transaction items\");\r\n        }\r\n      }\r\n      // Existing cart import logic for backward compatibility\r\n      else if (payload.t === 'cart' && Array.isArray(payload.items)) {\r\n        const { items: compactItems, b: businessId } = payload;\r\n        const cashierBusinessId = user?.businessId || user?.business_id;\r\n\r\n        if (businessId && cashierBusinessId && Number(businessId) !== Number(cashierBusinessId)) {\r\n          throw new Error(\"This QR code is not valid for this store.\");\r\n        }\r\n\r\n        const fullItems = [];\r\n        for (const it of compactItems) {\r\n          if (!it?.p || !it?.q) continue;\r\n          const product = await api(`/api/products/${encodeURIComponent(it.p)}`, {\r\n            headers: { Authorization: `Bearer ${token}` },\r\n          });\r\n          fullItems.push({\r\n            product_id: product.product_id,\r\n            sku: product.sku,\r\n            name: product.product_name,\r\n            quantity: Number(it.q),\r\n            price: Number(product.selling_price || 0)\r\n          });\r\n        }\r\n        if (fullItems.length === 0) throw new Error(\"No items to import\");\r\n        onImport(fullItems);\r\n        onClose();\r\n      } else {\r\n        throw new Error(\"Unsupported QR code format\");\r\n      }\r\n    } catch (e) {\r\n      setError(e.message || \"Failed to process QR code\");\r\n      console.error('Scan error:', e);\r\n    } finally {\r\n      // Resume scanner after a delay to allow error message to be visible\r\n      setTimeout(() => {\r\n        setScannerPaused(false);\r\n      }, 500);\r\n    }\r\n  };\r\n\r\n  const footerContent = (\r\n    <Button\r\n      label=\"Close (Esc)\"\r\n      variant=\"secondary\"\r\n      onClick={onClose}\r\n      className=\"w-full\"\r\n    />\r\n  );\r\n\r\n  useKeyboardShortcuts(\r\n    [{ key: \"escape\", action: onClose, enabled: isOpen }],\r\n    [isOpen]\r\n  );\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Scan Customer Cart\"\r\n      subtitle=\"Ask customer to show their QR\"\r\n      icon={\r\n        <svg\r\n          className=\"w-5 h-5 text-white\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M12 4v16m8-8H4\"\r\n          />\r\n        </svg>\r\n      }\r\n      footer={footerContent}\r\n      size=\"lg\"\r\n      contentClassName=\"space-y-3\"\r\n    >\r\n      <div className=\"text-blue-800 text-sm font-medium\">\r\n        Ask the customer to show their cart QR code\r\n      </div>\r\n      <div className=\"h-[50vh]\">\r\n        <ScannerCard\r\n          onScan={handleScan}\r\n          paused={scannerPaused}\r\n          onResume={() => setScannerPaused(false)}\r\n          className=\"w-full h-full\"\r\n        />\r\n      </div>\r\n      {error && (\r\n        <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm\">\r\n          {error}\r\n        </div>\r\n      )}\r\n      <div className=\"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Close:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Esc</span>\r\n        </div>\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n","import React, { useState, useEffect, useRef } from \"react\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport Button from \"../common/Button\";\r\nimport { MdScale, MdWaterDrop } from \"react-icons/md\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\n/**\r\n * Quantity Input Modal for Weight/Volume Products\r\n * Shows when adding weight/volume products to cart in POS\r\n */\r\nfunction QuantityInputModal({\r\n  isOpen,\r\n  onClose,\r\n  product,\r\n  onConfirm,\r\n  existingQuantity = 0,\r\n}) {\r\n  const [quantity, setQuantity] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const quantityInputRef = useRef(null);\r\n\r\n  // Reset quantity when modal opens/closes\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setQuantity(\"\");\r\n      setError(\"\");\r\n      // Focus input after a short delay\r\n      setTimeout(() => {\r\n        quantityInputRef.current?.focus();\r\n        quantityInputRef.current?.select();\r\n      }, 100);\r\n    }\r\n  }, [isOpen]);\r\n\r\n  // Get base unit for input (e.g., \"L\", \"mL\", \"g\", \"kg\")\r\n  const getBaseUnit = () => {\r\n    if (!product) return \"\";\r\n    const baseUnit = product.base_unit || \"\";\r\n    return baseUnit;\r\n  };\r\n\r\n  // Get base unit display name (e.g., \"Liters\", \"Milliliters\")\r\n  const getBaseUnitDisplay = () => {\r\n    if (!product) return \"\";\r\n    const baseUnit = product.base_unit || \"\";\r\n    if (baseUnit === 'g') return 'Grams (g)';\r\n    if (baseUnit === 'kg') return 'Kilograms (kg)';\r\n    if (baseUnit === 'mL') return 'Milliliters (mL)';\r\n    if (baseUnit === 'L') return 'Liters (L)';\r\n    return baseUnit;\r\n  };\r\n\r\n  // Calculate price per base unit (e.g., price per liter, price per gram)\r\n  const calculatePricePerBaseUnit = () => {\r\n    if (!product || product.product_type === 'count') {\r\n      return Number(product.selling_price || 0);\r\n    }\r\n    const quantityPerUnit = Number(product.quantity_per_unit || 1);\r\n    const pricePerPackage = Number(product.selling_price || 0);\r\n    if (quantityPerUnit > 0) {\r\n      return pricePerPackage / quantityPerUnit;\r\n    }\r\n    return pricePerPackage;\r\n  };\r\n\r\n  // Calculate total price for given quantity in base units\r\n  const calculatePrice = (qtyInBaseUnits) => {\r\n    if (!product || product.product_type === 'count') {\r\n      return qtyInBaseUnits * Number(product.selling_price || 0);\r\n    }\r\n    return qtyInBaseUnits * calculatePricePerBaseUnit();\r\n  };\r\n\r\n  // Format stock display in base units\r\n  const formatStockDisplay = () => {\r\n    if (!product) return \"0\";\r\n    const stockInBaseUnits = Number(product.stock_quantity || 0);\r\n    \r\n    if (product.product_type === 'count') {\r\n      return `${stockInBaseUnits} pcs`;\r\n    }\r\n    \r\n    // For weight/volume, show in base units with appropriate conversion for readability\r\n    const baseUnit = getBaseUnit();\r\n    let displayValue = stockInBaseUnits;\r\n    let displayUnit = baseUnit;\r\n    \r\n    // Convert to larger units for better readability\r\n    if (baseUnit === 'g' && stockInBaseUnits >= 1000) {\r\n      displayValue = stockInBaseUnits / 1000;\r\n      displayUnit = 'kg';\r\n    } else if (baseUnit === 'mL' && stockInBaseUnits >= 1000) {\r\n      displayValue = stockInBaseUnits / 1000;\r\n      displayUnit = 'L';\r\n    }\r\n    \r\n    // Format with appropriate decimals\r\n    if (displayValue % 1 === 0) {\r\n      return `${displayValue} ${displayUnit}`;\r\n    }\r\n    return `${displayValue.toFixed(2)} ${displayUnit}`;\r\n  };\r\n\r\n  const handleSubmit = (e) => {\r\n    if (e) e.preventDefault();\r\n    \r\n    const qty = Number(quantity);\r\n    \r\n    // Validation\r\n    if (!quantity || quantity.trim() === \"\") {\r\n      setError(\"Please enter a quantity\");\r\n      return;\r\n    }\r\n    \r\n    if (isNaN(qty) || qty <= 0) {\r\n      setError(\"Quantity must be greater than 0\");\r\n      return;\r\n    }\r\n    \r\n    // For weight/volume products, user enters quantity directly in base units (e.g., 0.25L, 1.5L, 250mL)\r\n    // No conversion needed - quantity entered IS the base units\r\n    // For count products, quantity is in pieces (no conversion needed)\r\n    const quantityInBaseUnits = qty;\r\n    \r\n    // Check stock availability\r\n    const availableStock = Number(product.stock_quantity || 0);\r\n    const currentCartQty = existingQuantity || 0; // Already in base units\r\n    \r\n    const totalNeeded = quantityInBaseUnits + currentCartQty;\r\n    \r\n    if (totalNeeded > availableStock) {\r\n      const baseUnit = getBaseUnit();\r\n      setError(`Insufficient stock. Available: ${formatStockDisplay()}, requested: ${qty} ${baseUnit}`);\r\n      return;\r\n    }\r\n    \r\n    // Confirm with quantity in base units\r\n    onConfirm(quantityInBaseUnits);\r\n  };\r\n\r\n  // Keyboard shortcuts\r\n  useKeyboardShortcuts(\r\n    [\r\n      {\r\n        key: \"escape\",\r\n        action: onClose,\r\n        enabled: isOpen,\r\n      },\r\n      {\r\n        key: \"enter\",\r\n        action: handleSubmit,\r\n        enabled: isOpen && quantity,\r\n      },\r\n    ],\r\n    [isOpen, quantity]\r\n  );\r\n\r\n  if (!product) return null;\r\n\r\n  const isWeight = product.product_type === 'weight';\r\n  const isVolume = product.product_type === 'volume';\r\n  const availableStock = formatStockDisplay();\r\n\r\n  const footerContent = (\r\n    <div className=\"flex gap-3 w-full\">\r\n      <Button\r\n        label=\"Cancel\"\r\n        variant=\"secondary\"\r\n        onClick={onClose}\r\n        type=\"button\"\r\n        className=\"flex-1\"\r\n      />\r\n      <Button\r\n        label=\"Add to Cart\"\r\n        variant=\"primary\"\r\n        type=\"submit\"\r\n        onClick={handleSubmit}\r\n        className=\"flex-1\"\r\n      />\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Enter Quantity\"\r\n      subtitle={`How much ${product.product_name} would you like to add?`}\r\n      icon={isWeight ? <MdScale className=\"w-6 h-6 text-white\" /> : <MdWaterDrop className=\"w-6 h-6 text-white\" />}\r\n      size=\"md\"\r\n      footer={footerContent}\r\n      headerIconBgClassName={\r\n        isWeight\r\n          ? \"bg-gradient-to-br from-amber-500 to-orange-600\"\r\n          : \"bg-gradient-to-br from-blue-500 to-cyan-600\"\r\n      }\r\n      contentClassName=\"space-y-6\"\r\n    >\r\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n        {/* Product Info */}\r\n        <div className=\"bg-gradient-to-br from-slate-50 to-blue-50/30 rounded-xl p-4 border border-slate-200\">\r\n          <div className=\"flex items-start gap-3\">\r\n            <div className=\"flex-1\">\r\n              <h3 className=\"font-semibold text-gray-900 mb-1\">\r\n                {product.product_name}\r\n              </h3>\r\n              <p className=\"text-sm text-gray-600\">\r\n                {isWeight && \"Sold by weight\"}\r\n                {isVolume && \"Sold by volume\"}\r\n              </p>\r\n              {product.display_unit && (\r\n                <p className=\"text-xs text-gray-500 mt-1\">\r\n                  Package: {product.display_unit}\r\n                </p>\r\n              )}\r\n            </div>\r\n            <div className=\"text-right\">\r\n              <p className=\"text-lg font-bold text-blue-600\">\r\n                ₱{Number(product.selling_price || 0).toFixed(2)}\r\n              </p>\r\n              <p className=\"text-xs text-gray-500\">\r\n                Available: {availableStock}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Quantity Input */}\r\n        <div className=\"space-y-2\">\r\n          <label className=\"block text-sm font-semibold text-gray-700\">\r\n            Enter Quantity ({getBaseUnitDisplay()})\r\n            <span className=\"text-red-500 ml-1\">*</span>\r\n          </label>\r\n          <div className=\"relative\">\r\n            <input\r\n              ref={quantityInputRef}\r\n              type=\"number\"\r\n              value={quantity}\r\n              onChange={(e) => {\r\n                setQuantity(e.target.value);\r\n                setError(\"\");\r\n              }}\r\n              placeholder={`e.g., 0.25, 1.5, 250`}\r\n              className=\"w-full px-4 py-3 bg-white border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-gray-900 font-medium text-lg\"\r\n              step=\"0.01\"\r\n              min=\"0.01\"\r\n              required\r\n              autoFocus\r\n            />\r\n            <div className=\"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium\">\r\n              {getBaseUnit()}\r\n            </div>\r\n          </div>\r\n          {error && (\r\n            <p className=\"text-sm text-red-600 mt-1\">{error}</p>\r\n          )}\r\n          <p className=\"text-xs text-gray-500 mt-1\">\r\n            Enter the quantity in {getBaseUnitDisplay().toLowerCase()}. You can enter any amount (e.g., 0.25L for 250mL, 1.5L, etc.).\r\n            {product.display_unit && product.quantity_per_unit && (\r\n              <span className=\"block mt-1 text-gray-400\">\r\n                (Each package contains {product.quantity_per_unit} {getBaseUnit()})\r\n              </span>\r\n            )}\r\n          </p>\r\n        </div>\r\n\r\n        {/* Price Preview */}\r\n        {quantity && !isNaN(Number(quantity)) && Number(quantity) > 0 && (\r\n          <div className=\"bg-blue-50 rounded-xl p-4 border border-blue-200\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <span className=\"text-sm font-semibold text-gray-700\">\r\n                Estimated Total:\r\n              </span>\r\n              <span className=\"text-xl font-bold text-blue-600\">\r\n                ₱{calculatePrice(Number(quantity)).toFixed(2)}\r\n              </span>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              {quantity} {getBaseUnit()} × ₱{calculatePricePerBaseUnit().toFixed(2)} per {getBaseUnit()}\r\n            </p>\r\n            {product.product_type !== 'count' && product.quantity_per_unit && (\r\n              <p className=\"text-xs text-gray-400 mt-1\">\r\n                (Price per package: ₱{Number(product.selling_price || 0).toFixed(2)} for {product.quantity_per_unit} {getBaseUnit()})\r\n              </p>\r\n            )}\r\n          </div>\r\n        )}\r\n      </form>\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default QuantityInputModal;\r\n\r\n"],"names":["ScanCustomerCartModal","isOpen","onClose","onImport","scannerPaused","setScannerPaused","useState","error","setError","token","sessionStorage","getItem","user","JSON","parse","footerContent","jsx","Button","label","variant","onClick","className","useKeyboardShortcuts","key","action","enabled","BaseModal","title","subtitle","icon","fill","stroke","viewBox","children","strokeLinecap","strokeLinejoin","strokeWidth","d","footer","size","contentClassName","ScannerCard","onScan","async","result","code","rawValue","payload","e","Error","t","transaction_id","business_id","businessId","cashierBusinessId","Number","response","api","method","headers","Authorization","items","transaction_number","err","message","Array","isArray","compactItems","b","fullItems","it","p","q","product","encodeURIComponent","push","product_id","sku","name","product_name","quantity","price","selling_price","length","setTimeout","paused","onResume","jsxs","QuantityInputModal","onConfirm","existingQuantity","setQuantity","quantityInputRef","useRef","useEffect","current","focus","select","getBaseUnit","baseUnit","base_unit","getBaseUnitDisplay","calculatePricePerBaseUnit","product_type","quantityPerUnit","quantity_per_unit","pricePerPackage","formatStockDisplay","stockInBaseUnits","stock_quantity","displayValue","displayUnit","toFixed","handleSubmit","preventDefault","qty","trim","isNaN","quantityInBaseUnits","availableStock","isWeight","isVolume","type","MdScale","MdWaterDrop","headerIconBgClassName","onSubmit","display_unit","ref","value","onChange","target","placeholder","step","min","required","autoFocus","toLowerCase","qtyInBaseUnits"],"mappings":"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"}