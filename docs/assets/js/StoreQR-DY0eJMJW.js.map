{"version":3,"file":"StoreQR-DY0eJMJW.js","sources":["../../../frontend/src/pages/StoreQR.jsx"],"sourcesContent":["import React, { useMemo, useRef, useState } from 'react';\r\nimport Background from '../components/layout/Background';\r\nimport Navbar from '../components/layout/Navbar';\r\nimport Card from '../components/common/Card';\r\nimport Button from '../components/common/Button';\r\n\r\nexport default function StoreQR() {\r\n\tconst user = useMemo(() => {\r\n\t\ttry { return JSON.parse(sessionStorage.getItem('user') || '{}'); } catch { return {}; }\r\n\t}, []);\r\n\tconst businessId = user?.businessId || user?.business_id;\r\n\tconst [nonce, setNonce] = useState(() => String(Date.now()));\r\n\tconst imgRef = useRef(null);\r\n\r\n\tconst storeUrl = useMemo(() => {\r\n\t\tconst url = new URL(window.location.origin + '/enter-store');\r\n\t\tif (businessId) url.searchParams.set('business_id', String(businessId));\r\n\t\treturn url.toString();\r\n\t}, [businessId]);\r\n\r\n\tconst qrSrc = useMemo(() => {\r\n\t\tconst data = encodeURIComponent(storeUrl);\r\n\t\treturn `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${data}&qzone=2&format=png&_=${nonce}`;\r\n\t}, [storeUrl, nonce]);\r\n\r\n\tconst handleDownload = async () => {\r\n\t\tif (!qrSrc) {\r\n\t\t\talert('QR code not available for download.');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\ttry {\r\n\t\t\t// Fetch the image as a blob to handle CORS\r\n\t\t\tconst response = await fetch(qrSrc);\r\n\t\t\tif (!response.ok) {\r\n\t\t\t\tthrow new Error('Failed to fetch QR code image');\r\n\t\t\t}\r\n\t\t\tconst blob = await response.blob();\r\n\t\t\tconst url = window.URL.createObjectURL(blob);\r\n\t\t\t\r\n\t\t\tconst link = document.createElement('a');\r\n\t\t\tlink.href = url;\r\n\t\t\tlink.download = `store-${businessId || 'qr'}.png`;\r\n\t\t\tdocument.body.appendChild(link);\r\n\t\t\tlink.click();\r\n\t\t\tdocument.body.removeChild(link);\r\n\t\t\t\r\n\t\t\t// Clean up the object URL\r\n\t\t\twindow.URL.revokeObjectURL(url);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Error downloading QR code:', error);\r\n\t\t\talert('Failed to download QR code. Please try again.');\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Background variant=\"gradientBlue\" pattern=\"dots\" overlay floatingElements>\r\n\t\t\t<div className=\"min-h-screen\">\r\n\t\t\t\t<div className=\"pt-20 px-4\">\r\n\t\t\t\t\t<Navbar />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"px-4 mt-6 grid gap-4\">\r\n\t\t\t\t\t<Card className=\"p-6\">\r\n\t\t\t\t\t\t<div className=\"text-2xl font-bold text-blue-900\">Store QR</div>\r\n\t\t\t\t\t\t<div className=\"text-blue-700 mt-1\">Customers scan this once when they enter your store.</div>\r\n\t\t\t\t\t</Card>\r\n\t\t\t\t\t<Card className=\"p-6 flex flex-col items-center gap-4\">\r\n\t\t\t\t\t\t{!businessId ? (\r\n\t\t\t\t\t\t\t<div className=\"text-red-700\">Business ID not found. Please ensure you're logged in as an admin.</div>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t<img ref={imgRef} src={qrSrc} alt=\"Store QR\" className=\"w-[300px] h-[300px] border rounded-xl bg-white\" />\r\n\t\t\t\t\t\t\t\t<div className=\"text-blue-800 break-all text-sm\">{storeUrl}</div>\r\n\t\t\t\t\t\t\t\t<div className=\"flex gap-3\">\r\n\t\t\t\t\t\t\t\t\t<Button label=\"Download PNG\" variant=\"primary\" onClick={handleDownload} />\r\n\t\t\t\t\t\t\t\t\t<Button label=\"Regenerate\" variant=\"secondary\" onClick={() => setNonce(String(Date.now()))} />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</Card>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</Background>\r\n\t);\r\n}\r\n\r\n\r\n"],"names":["StoreQR","user","useMemo","JSON","parse","sessionStorage","getItem","businessId","business_id","nonce","setNonce","useState","String","Date","now","imgRef","useRef","storeUrl","url","URL","window","location","origin","searchParams","set","toString","qrSrc","encodeURIComponent","jsx","Background","variant","pattern","overlay","floatingElements","children","jsxs","className","Navbar","Card","Fragment","ref","src","alt","Button","label","onClick","async","response","fetch","ok","Error","blob","createObjectURL","link","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","error","alert"],"mappings":"2OAMA,SAAwBA,IACjBC,MAAAA,EAAOC,EAAAA,QAAQ,KAChB,IAAE,OAAOC,KAAKC,MAAMC,eAAeC,QAAQ,SAAW,KAAI,CAAW,MAAE,MAAO,CAAC,CAAA,GACjF,IACGC,EAAaN,GAAMM,YAAcN,GAAMO,aACtCC,EAAOC,GAAYC,EAAAA,SAAS,IAAMC,OAAOC,KAAKC,QAC/CC,EAASC,SAAO,MAEhBC,EAAWf,EAAAA,QAAQ,KACxB,MAAMgB,EAAM,IAAIC,IAAIC,OAAOC,SAASC,OAAS,gBAE7C,OADIf,GAAgBgB,EAAAA,aAAaC,IAAI,cAAeZ,OAAOL,IACpDW,EAAIO,YACT,CAAClB,IAEEmB,EAAQxB,EAAAA,QAAQ,IAEd,iEADMyB,mBAAmBV,2BACqER,IACnG,CAACQ,EAAUR,IAgCd,OACEmB,EAAAA,IAAAC,EAAA,CAAWC,QAAQ,eAAeC,QAAQ,OAAOC,SAAO,EAACC,kBAAgB,EACzEC,SAACC,EAAAA,KAAA,MAAA,CAAIC,UAAU,eACdF,SAAA,CAAAN,MAAC,MAAI,CAAAQ,UAAU,aACdF,SAAAN,MAACS,GAAS,KAEXF,EAAAA,KAAC,MAAI,CAAAC,UAAU,uBACdF,SAAA,CAACC,EAAAA,KAAAG,EAAA,CAAKF,UAAU,MACfF,SAAA,CAACN,EAAAA,IAAA,MAAA,CAAIQ,UAAU,mCAAmCF,SAAQ,aACzDN,EAAAA,IAAA,MAAA,CAAIQ,UAAU,qBAAqBF,SAAoD,4DAExFN,EAAAA,IAAAU,EAAA,CAAKF,UAAU,uCACdF,SAAC3B,EAIA4B,OAAAI,EAAAA,SAAA,CAAAL,SAAA,CAACN,EAAAA,IAAA,MAAA,CAAIY,IAAKzB,EAAQ0B,IAAKf,EAAOgB,IAAI,WAAWN,UAAU,mDACtDR,EAAAA,IAAA,MAAA,CAAIQ,UAAU,kCAAmCnB,SAASA,IAC3DkB,EAAAA,KAAC,MAAI,CAAAC,UAAU,aACdF,SAAA,CAAAN,MAACe,GAAOC,MAAM,eAAed,QAAQ,UAAUe,QAjDhCC,UACtB,GAAKpB,EAKD,IAEGqB,MAAAA,QAAiBC,MAAMtB,GACzB,IAACqB,EAASE,GACP,MAAA,IAAIC,MAAM,iCAEXC,MAAAA,QAAaJ,EAASI,OACtBjC,EAAME,OAAOD,IAAIiC,gBAAgBD,GAEjCE,EAAOC,SAASC,cAAc,KACpCF,EAAKG,KAAOtC,EACPuC,EAAAA,SAAW,SAASlD,GAAc,WAC9BmD,SAAAA,KAAKC,YAAYN,GAC1BA,EAAKO,QACIF,SAAAA,KAAKG,YAAYR,GAGnBlC,OAAAA,IAAI2C,gBAAgB5C,SACnB6C,GACAA,QAAAA,MAAM,6BAA8BA,GAC5CC,MAAM,gDAA+C,MAxBrDA,MAAM,0CAgDCpC,EAAAA,IAAAe,EAAA,CAAOC,MAAM,aAAad,QAAQ,YAAYe,QAAS,IAAMnC,EAASE,OAAOC,KAAKC,gBAPpFc,MAAA,MAAA,CAAIQ,UAAU,eAAeF,SAAkE,gFAgBvG"}