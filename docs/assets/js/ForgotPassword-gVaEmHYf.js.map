{"version":3,"file":"ForgotPassword-gVaEmHYf.js","sources":["../../../frontend/src/pages/ForgotPassword.jsx"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport Background from \"../components/layout/Background\";\r\nimport Card from \"../components/common/Card\";\r\nimport SectionHeader from \"../components/layout/SectionHeader\";\r\nimport Input from \"../components/common/Input\";\r\nimport PasswordInput from \"../components/common/PasswordInput\";\r\nimport Button from \"../components/common/Button\";\r\nimport Loader from \"../components/common/Loader\";\r\nimport { api } from \"../lib/api\";\r\n\r\nexport default function ForgotPassword() {\r\n  const navigate = useNavigate();\r\n  const [step, setStep] = useState(\"request\"); // request | reset\r\n  const [form, setForm] = useState({\r\n    email: \"\",\r\n    otp: \"\",\r\n    newPassword: \"\",\r\n    confirmPassword: \"\",\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [status, setStatus] = useState(\"\");\r\n\r\n  const updateField = (e) => {\r\n    setForm((prev) => ({ ...prev, [e.target.name]: e.target.value }));\r\n    setError(\"\");\r\n    setStatus(\"\");\r\n  };\r\n\r\n  const requestReset = async (e) => {\r\n    e.preventDefault();\r\n    if (!form.email) {\r\n      setError(\"Please enter your email address.\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(\"\");\r\n    setStatus(\"\");\r\n    try {\r\n      // First, verify the email exists\r\n      await api(\"/api/auth/forgot-password/check\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify({ email: form.email }),\r\n      });\r\n\r\n      // Then send the reset code\r\n      await api(\"/api/auth/forgot-password/request\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify({ email: form.email }),\r\n      });\r\n\r\n      setStep(\"reset\");\r\n      setStatus(\"Reset code sent to your email.\");\r\n    } catch (err) {\r\n      setError(err.message || \"Failed to start password reset.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const resendCode = async () => {\r\n    if (!form.email) {\r\n      setError(\"Enter your email first to resend the code.\");\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    setError(\"\");\r\n    try {\r\n      await api(\"/otp/resend\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify({ email: form.email, purpose: \"password_reset\" }),\r\n      });\r\n      setStatus(\"A new code was sent (if the email exists).\");\r\n    } catch (err) {\r\n      setError(err.message || \"Failed to resend code.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const resetPassword = async (e) => {\r\n    e.preventDefault();\r\n    if (!form.otp || form.otp.length < 4) {\r\n      setError(\"Enter the 4-character code sent to your email.\");\r\n      return;\r\n    }\r\n    if (!form.newPassword) {\r\n      setError(\"Please enter a new password.\");\r\n      return;\r\n    }\r\n    if (form.newPassword !== form.confirmPassword) {\r\n      setError(\"Passwords do not match.\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(\"\");\r\n    try {\r\n      await api(\"/api/auth/forgot-password/reset\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify({\r\n          email: form.email,\r\n          otp: form.otp,\r\n          newPassword: form.newPassword,\r\n        }),\r\n      });\r\n      setStatus(\"Password updated. Redirecting to login...\");\r\n      setTimeout(() => navigate(\"/login\"), 1200);\r\n    } catch (err) {\r\n      setError(err.message || \"Failed to reset password.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Background variant=\"gradientBlue\" pattern=\"dots\" overlay floatingElements>\r\n      <div className=\"absolute inset-0 bg-gradient-to-br from-blue-50 via-indigo-50/30 to-purple-50/20 pointer-events-none\" />\r\n      <main className=\"flex h-screen items-center justify-center px-2 relative z-10 overflow-hidden\">\r\n        <Card\r\n          variant=\"glass\"\r\n          className=\"w-full max-w-3xl flex flex-col md:flex-row overflow-hidden p-0 animate-fadeIn rounded-2xl shadow-xl\"\r\n        >\r\n          <section className=\"w-full md:w-1/2 flex flex-col justify-center items-center p-6 md:p-10 rounded-l-2xl bg-white/90 backdrop-blur-xl\">\r\n            <div className=\"w-full max-w-md space-y-6\">\r\n              <div className=\"flex items-center justify-between text-sm\">\r\n                <Link to=\"/\" className=\"text-gray-600 hover:text-gray-800 inline-flex items-center gap-2\">\r\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n                  </svg>\r\n                  Back to home\r\n                </Link>\r\n                <Link to=\"/login\" className=\"text-blue-600 hover:underline\">\r\n                  Back to login\r\n                </Link>\r\n              </div>\r\n\r\n              <div className=\"space-y-2 text-center\">\r\n                <SectionHeader variant=\"primary\" size=\"lg\" className=\"text-center\">\r\n                  Forgot Password\r\n                </SectionHeader>\r\n                <p className=\"text-gray-500 text-sm\">\r\n                  Enter your email to receive a one-time code, then set a new password.\r\n                </p>\r\n              </div>\r\n\r\n              <form\r\n                onSubmit={step === \"request\" ? requestReset : resetPassword}\r\n                className=\"w-full flex flex-col gap-4\"\r\n                noValidate\r\n              >\r\n                <Input\r\n                  name=\"email\"\r\n                  value={form.email}\r\n                  onChange={updateField}\r\n                  placeholder=\"Email address\"\r\n                  type=\"email\"\r\n                  required\r\n                />\r\n\r\n                {step === \"reset\" && (\r\n                  <>\r\n                    <Input\r\n                      name=\"otp\"\r\n                      value={form.otp}\r\n                      onChange={(e) =>\r\n                        updateField({\r\n                          target: { name: \"otp\", value: e.target.value.slice(0, 4) },\r\n                        })\r\n                      }\r\n                      placeholder=\"4-character code\"\r\n                      type=\"text\"\r\n                      maxLength={4}\r\n                      required\r\n                    />\r\n                    <PasswordInput\r\n                      name=\"newPassword\"\r\n                      value={form.newPassword}\r\n                      onChange={updateField}\r\n                      placeholder=\"New password\"\r\n                      required\r\n                    />\r\n                    <PasswordInput\r\n                      name=\"confirmPassword\"\r\n                      value={form.confirmPassword}\r\n                      onChange={updateField}\r\n                      placeholder=\"Confirm new password\"\r\n                      required\r\n                    />\r\n                    <p className=\"text-xs text-gray-500\">\r\n                      Password must be at least 12 characters and include uppercase, lowercase, number, and special character.\r\n                    </p>\r\n                  </>\r\n                )}\r\n\r\n                {error && (\r\n                  <div className=\"bg-red-50 border-l-4 border-red-500 rounded-lg p-3 text-sm text-red-700\">\r\n                    {error}\r\n                  </div>\r\n                )}\r\n                {status && (\r\n                  <div className=\"bg-green-50 border-l-4 border-green-500 rounded-lg p-3 text-sm text-green-700\">\r\n                    {status}\r\n                  </div>\r\n                )}\r\n\r\n                <Button\r\n                  type=\"submit\"\r\n                  variant=\"primary\"\r\n                  disabled={loading}\r\n                  className=\"w-full flex items-center justify-center h-12 mt-2 text-lg font-medium transition-all duration-300 hover:shadow-lg hover:scale-[1.02] active:scale-[0.98]\"\r\n                >\r\n                  {loading && <Loader size=\"sm\" className=\"mr-2\" />}\r\n                  {step === \"request\" ? \"Send Reset Code\" : \"Reset Password\"}\r\n                </Button>\r\n              </form>\r\n\r\n              {step === \"reset\" && (\r\n                <div className=\"flex items-center justify-between text-sm text-gray-600\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={resendCode}\r\n                    disabled={loading}\r\n                    className=\"text-blue-600 hover:underline disabled:opacity-60\"\r\n                  >\r\n                    Resend code\r\n                  </button>\r\n                  <span>Didn&apos;t get the email? Check spam too.</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </section>\r\n\r\n          <aside className=\"hidden md:flex items-center rounded-r-2xl bg-gradient-to-br from-indigo-500 via-blue-400 to-sky-400 w-1/2 p-10 relative overflow-hidden\">\r\n            <div className=\"absolute inset-0 opacity-7 -z-10 pointer-events-none\">\r\n              <div className=\"w-full h-full bg-[radial-gradient(circle_at_1px_1px,rgba(255,255,255,0.25)_1px,transparent_0)] bg-[length:24px_24px]\" />\r\n            </div>\r\n            <div className=\"relative z-10 flex flex-col justify-center items-start max-w-sm pl-6 space-y-3 text-white\">\r\n              <h2 className=\"text-3xl font-extrabold leading-tight\">Secure account recovery</h2>\r\n              <p className=\"text-white/90 text-base\">\r\n                Use your email to receive a one-time code and safely choose a new password.\r\n              </p>\r\n              <div className=\"inline-flex items-center gap-2 rounded-full bg-white/15 text-white/90 px-3 py-1 text-xs backdrop-blur-sm ring-1 ring-white/20\">\r\n                <span className=\"inline-block h-2 w-2 rounded-full bg-emerald-300 animate-pulse\" />\r\n                OTP protected\r\n              </div>\r\n            </div>\r\n          </aside>\r\n        </Card>\r\n      </main>\r\n    </Background>\r\n  );\r\n}\r\n\r\n"],"names":["ForgotPassword","navigate","useNavigate","step","setStep","useState","form","setForm","email","otp","newPassword","confirmPassword","loading","setLoading","error","setError","status","setStatus","updateField","e","prev","target","name","value","jsxs","Background","variant","pattern","overlay","floatingElements","children","jsx","className","Card","Link","to","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","SectionHeader","size","onSubmit","async","preventDefault","api","method","body","JSON","stringify","err","message","length","setTimeout","noValidate","Input","onChange","placeholder","type","required","Fragment","slice","maxLength","PasswordInput","Button","disabled","Loader","onClick","purpose"],"mappings":"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"}