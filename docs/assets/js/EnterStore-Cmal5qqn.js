import{j as e}from"./utils-L0j39QIW.js";import{u as s,a as r}from"./vendor-DPJ7iNYg.js";import{B as t,b as a}from"./index-CSk1Jv56.js";import{N as o}from"./Navbar-Cdf61c5h.js";import{C as n}from"./Card-DXlcOk_J.js";import{S as i}from"./ScannerCard-CRpLm7ay.js";import"./Logo-BNMZ1XGv.js";import"./qr-52H9kDsU.js";function c(){const c=s(),[l,m]=r.useState(!1),[d,u]=r.useState("");return e.jsx(t,{variant:"gradientBlue",pattern:"dots",overlay:!0,floatingElements:!0,children:e.jsxs("div",{className:"min-h-screen",children:[e.jsx("div",{className:"pt-20 px-4",children:e.jsx(o,{})}),e.jsxs("div",{className:"px-4 mt-6 grid gap-4",children:[e.jsxs(n,{className:"p-6",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:"Scan Store QR"}),e.jsx("div",{className:"text-blue-700 mt-1",children:"Point your camera at the store QR to start self-checkout."})]}),d?e.jsxs(n,{className:"p-4 border-red-200",children:[e.jsx("div",{className:"text-red-700",children:d}),e.jsx("div",{className:"mt-2",children:e.jsx(a,{label:"Try again",variant:"secondary",onClick:()=>{u(""),m(!1)}})})]}):null,e.jsx("div",{className:"h-[60vh]",children:e.jsx(i,{onScan:async e=>{const s=e?.[0]?.rawValue;if(!s)return;m(!0),u("");const r=function(e){try{const s=new URL(e),r=s.searchParams.get("business_id")||s.searchParams.get("b")||s.searchParams.get("store");if(r)return r}catch(s){}try{const s=JSON.parse(e);if(s&&(s.business_id||s.businessId||s.storeId))return s.business_id||s.businessId||s.storeId}catch(s){}return e}(s);if(!r)return u("Invalid store QR"),void setTimeout(()=>{m(!1)},500);localStorage.setItem("business_id",String(r)),localStorage.removeItem("provisionalTransactionNumber"),localStorage.removeItem("customerCart");const t=(new Date).toISOString().replace(/[-:T.Z]/g,"").slice(0,14),a=Math.floor(1e3+9e3*Math.random()),o=`T-${String(r).padStart(2,"0")}-${t}-${a}`;localStorage.setItem("provisionalTransactionNumber",o);try{const e=await fetch("/api/sales/public/enter-store",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({business_id:r})});if(e.ok){const s=await e.json();s.user_id&&(localStorage.setItem("customer_user_id",String(s.user_id)),console.log("Customer user created:",s.user_id)),s.username&&localStorage.setItem("customer_username",s.username)}else{const s=await e.json().catch(()=>({error:"Failed to create customer"}));console.error("Failed to create customer user:",s)}}catch(n){console.error("Error creating customer user:",n)}c("/customer")},paused:l,onResume:()=>m(!1),className:"w-full h-full"})})]})]})})}export{c as default};
//# sourceMappingURL=EnterStore-Cmal5qqn.js.map
