{"version":3,"file":"ChangePasswordModal-C2-AuAey.js","sources":["../../../frontend/src/components/modals/ChangePasswordModal.jsx"],"sourcesContent":["import React, { useState, useMemo } from \"react\";\r\nimport Button from \"../common/Button\";\r\nimport FormField from \"../common/FormField\";\r\nimport PasswordInput from \"../common/PasswordInput\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport { api } from \"../../lib/api\";\r\n\r\nconst ChangePasswordModal = ({ isOpen, onClose }) => {\r\n  const [formData, setFormData] = useState({\r\n    currentPassword: \"\",\r\n    newPassword: \"\",\r\n    confirmPassword: \"\",\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n  const [message, setMessage] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const [errors, setErrors] = useState({});\r\n  const [touched, setTouched] = useState({});\r\n  \r\n  // Password requirements validation\r\n  const passwordRequirements = useMemo(() => {\r\n    const password = formData.newPassword;\r\n    return {\r\n      minLength: password.length >= 12,\r\n      hasUpperCase: /[A-Z]/.test(password),\r\n      hasLowerCase: /[a-z]/.test(password),\r\n      hasNumber: /\\d/.test(password),\r\n      hasSpecialChar: /[!@#$%^&*(),.?\":{}|<>]/.test(password),\r\n    };\r\n  }, [formData.newPassword]);\r\n  \r\n  const isPasswordValid = useMemo(() => {\r\n    return Object.values(passwordRequirements).every(req => req === true);\r\n  }, [passwordRequirements]);\r\n  \r\n  const isFormValid = useMemo(() => {\r\n    return (\r\n      formData.currentPassword.trim() !== \"\" &&\r\n      isPasswordValid &&\r\n      formData.newPassword === formData.confirmPassword &&\r\n      formData.confirmPassword.trim() !== \"\"\r\n    );\r\n  }, [formData, isPasswordValid]);\r\n\r\n  const handleChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    \r\n    // Clear error when user starts typing\r\n    if (errors[name]) {\r\n      setErrors(prev => ({\r\n        ...prev,\r\n        [name]: \"\"\r\n      }));\r\n    }\r\n  };\r\n\r\n  const handleBlur = (e) => {\r\n    const { name } = e.target;\r\n    setTouched(prev => ({\r\n      ...prev,\r\n      [name]: true\r\n    }));\r\n  };\r\n\r\n  const validateForm = () => {\r\n    const newErrors = {};\r\n    \r\n    if (!formData.currentPassword) {\r\n      newErrors.currentPassword = \"Current password is required\";\r\n    }\r\n    \r\n    if (!formData.newPassword) {\r\n      newErrors.newPassword = \"New password is required\";\r\n    } else if (!isPasswordValid) {\r\n      newErrors.newPassword = \"Password does not meet requirements\";\r\n    }\r\n    \r\n    if (!formData.confirmPassword) {\r\n      newErrors.confirmPassword = \"Please confirm your new password\";\r\n    } else if (formData.newPassword !== formData.confirmPassword) {\r\n      newErrors.confirmPassword = \"Passwords do not match\";\r\n    }\r\n    \r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n    \r\n    setLoading(true);\r\n    setError(\"\");\r\n    setMessage(\"\");\r\n    \r\n    try {\r\n      const response = await api(\"/auth/password\", {\r\n        method: \"PUT\",\r\n        body: JSON.stringify({\r\n          currentPassword: formData.currentPassword,\r\n          newPassword: formData.newPassword,\r\n        }),\r\n      });\r\n      \r\n      if (response?.message) {\r\n        setMessage(response.message || \"Password updated successfully\");\r\n        setFormData({\r\n          currentPassword: \"\",\r\n          newPassword: \"\",\r\n          confirmPassword: \"\",\r\n        });\r\n        // Auto-close after a short delay\r\n        setTimeout(() => {\r\n          onClose();\r\n        }, 1500);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Error updating password:\", err);\r\n      // The api function throws errors - check multiple sources for error message\r\n      let errorMessage = \"Failed to update password\";\r\n      \r\n      // Try to get specific error from response data\r\n      if (err.response?.data?.error) {\r\n        errorMessage = err.response.data.error;\r\n      } else if (err.data?.error) {\r\n        errorMessage = err.data.error;\r\n      } else if (err.message) {\r\n        // For 400 errors, the api function may return generic messages\r\n        // Check if it's a generic one and provide more context\r\n        if (err.message.includes(\"Invalid request\")) {\r\n          errorMessage = \"Please check your current password and try again\";\r\n        } else {\r\n          errorMessage = err.message;\r\n        }\r\n      }\r\n      \r\n      setError(errorMessage);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Change Password\"\r\n      maxWidth=\"md\"\r\n    >\r\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n        {error && (\r\n          <div className=\"bg-red-50 text-red-700 p-3 rounded-md text-sm\">\r\n            {error}\r\n          </div>\r\n        )}\r\n        \r\n        {message && (\r\n          <div className=\"bg-green-50 text-green-700 p-3 rounded-md text-sm\">\r\n            {message}\r\n          </div>\r\n        )}\r\n        \r\n        {/* Current Password */}\r\n        <div className=\"mb-5\">\r\n          <label className=\"block mb-1 font-medium text-blue-800\">\r\n            Current Password\r\n            <span className=\"text-red-500 ml-1\">*</span>\r\n          </label>\r\n          <PasswordInput\r\n            name=\"currentPassword\"\r\n            value={formData.currentPassword}\r\n            onChange={handleChange}\r\n            onBlur={handleBlur}\r\n            error={touched.currentPassword && errors.currentPassword}\r\n            disabled={loading}\r\n            autoComplete=\"current-password\"\r\n            placeholder=\"Enter your current password\"\r\n          />\r\n        </div>\r\n        \r\n        {/* New Password */}\r\n        <div className=\"mb-5\">\r\n          <label className=\"block mb-1 font-medium text-blue-800\">\r\n            New Password\r\n            <span className=\"text-red-500 ml-1\">*</span>\r\n          </label>\r\n          <PasswordInput\r\n            name=\"newPassword\"\r\n            value={formData.newPassword}\r\n            onChange={handleChange}\r\n            onBlur={handleBlur}\r\n            error={touched.newPassword && errors.newPassword}\r\n            disabled={loading}\r\n            autoComplete=\"new-password\"\r\n            placeholder=\"Enter your new password\"\r\n          />\r\n          \r\n          {/* Password Requirements */}\r\n          {formData.newPassword && (\r\n            <div className=\"mt-2 p-3 bg-gray-50 rounded-md border border-gray-200\">\r\n              <p className=\"text-xs font-medium text-gray-700 mb-2\">Password Requirements:</p>\r\n              <ul className=\"space-y-1 text-xs\">\r\n                <li className={`flex items-center ${passwordRequirements.minLength ? 'text-green-600' : 'text-gray-500'}`}>\r\n                  <span className={`mr-2 ${passwordRequirements.minLength ? 'text-green-500' : 'text-gray-400'}`}>\r\n                    {passwordRequirements.minLength ? '✓' : '○'}\r\n                  </span>\r\n                  At least 12 characters\r\n                </li>\r\n                <li className={`flex items-center ${passwordRequirements.hasUpperCase ? 'text-green-600' : 'text-gray-500'}`}>\r\n                  <span className={`mr-2 ${passwordRequirements.hasUpperCase ? 'text-green-500' : 'text-gray-400'}`}>\r\n                    {passwordRequirements.hasUpperCase ? '✓' : '○'}\r\n                  </span>\r\n                  One uppercase letter\r\n                </li>\r\n                <li className={`flex items-center ${passwordRequirements.hasLowerCase ? 'text-green-600' : 'text-gray-500'}`}>\r\n                  <span className={`mr-2 ${passwordRequirements.hasLowerCase ? 'text-green-500' : 'text-gray-400'}`}>\r\n                    {passwordRequirements.hasLowerCase ? '✓' : '○'}\r\n                  </span>\r\n                  One lowercase letter\r\n                </li>\r\n                <li className={`flex items-center ${passwordRequirements.hasNumber ? 'text-green-600' : 'text-gray-500'}`}>\r\n                  <span className={`mr-2 ${passwordRequirements.hasNumber ? 'text-green-500' : 'text-gray-400'}`}>\r\n                    {passwordRequirements.hasNumber ? '✓' : '○'}\r\n                  </span>\r\n                  One number\r\n                </li>\r\n                <li className={`flex items-center ${passwordRequirements.hasSpecialChar ? 'text-green-600' : 'text-gray-500'}`}>\r\n                  <span className={`mr-2 ${passwordRequirements.hasSpecialChar ? 'text-green-500' : 'text-gray-400'}`}>\r\n                    {passwordRequirements.hasSpecialChar ? '✓' : '○'}\r\n                  </span>\r\n                  One special character (!@#$%^&*(),.?\":{}|&lt;&gt;)\r\n                </li>\r\n              </ul>\r\n            </div>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Confirm New Password */}\r\n        <div className=\"mb-5\">\r\n          <label className=\"block mb-1 font-medium text-blue-800\">\r\n            Confirm New Password\r\n            <span className=\"text-red-500 ml-1\">*</span>\r\n          </label>\r\n          <PasswordInput\r\n            name=\"confirmPassword\"\r\n            value={formData.confirmPassword}\r\n            onChange={handleChange}\r\n            onBlur={handleBlur}\r\n            error={touched.confirmPassword && errors.confirmPassword}\r\n            disabled={loading}\r\n            autoComplete=\"new-password\"\r\n            placeholder=\"Confirm your new password\"\r\n          />\r\n        </div>\r\n        \r\n        <div className=\"flex justify-end space-x-3 pt-4\">\r\n          <Button\r\n            type=\"button\"\r\n            variant=\"outline\"\r\n            onClick={onClose}\r\n            disabled={loading}\r\n          >\r\n            Cancel\r\n          </Button>\r\n          <Button\r\n            type=\"submit\"\r\n            loading={loading}\r\n            disabled={loading || !isFormValid}\r\n          >\r\n            Update Password\r\n          </Button>\r\n        </div>\r\n      </form>\r\n    </BaseModal>\r\n  );\r\n};\r\n\r\nexport default ChangePasswordModal;\r\n"],"names":["ChangePasswordModal","isOpen","onClose","formData","setFormData","useState","currentPassword","newPassword","confirmPassword","loading","setLoading","message","setMessage","error","setError","errors","setErrors","touched","setTouched","passwordRequirements","useMemo","password","minLength","length","hasUpperCase","test","hasLowerCase","hasNumber","hasSpecialChar","isPasswordValid","Object","values","every","req","isFormValid","trim","handleChange","e","name","value","target","prev","handleBlur","jsx","BaseModal","title","maxWidth","children","jsxs","onSubmit","async","preventDefault","validateForm","newErrors","keys","response","api","method","body","JSON","stringify","setTimeout","err","errorMessage","data","includes","className","PasswordInput","onChange","onBlur","disabled","autoComplete","placeholder","Button","type","variant","onClick"],"mappings":"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"}