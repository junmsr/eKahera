{"version":3,"file":"CashierPOS-DwGRFNhe.js","sources":["../../../frontend/src/pages/CashierPOS.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport ScannerCard from \"../components/ui/POS/ScannerCard\";\r\nimport SkuFormCard from \"../components/ui/POS/SkuFormCard\";\r\nimport CartTableCard from \"../components/ui/POS/CartTableCard\";\r\nimport Button from \"../components/common/Button\";\r\nimport { api, createGcashCheckout } from \"../lib/api\";\r\nimport PriceCheckModal from \"../components/modals/PriceCheckModal\";\r\nimport DiscountModal from \"../components/modals/DiscountModal\";\r\nimport CashLedgerModal from \"../components/modals/CashLedgerModal\";\r\nimport CheckoutModal from \"../components/modals/CheckoutModal\";\r\nimport CashPaymentModal from \"../components/modals/CashPaymentModal\";\r\nimport ScanCustomerCartModal from \"../components/modals/ScanCustomerCartModal\";\r\nimport ProfileModal from \"../components/modals/ProfileModal\";\r\nimport { BiBell, BiUser } from \"react-icons/bi\";\r\n\r\nfunction CashierPOS() {\r\n  const navigate = useNavigate();\r\n\r\n  const [sku, setSku] = useState(\"\");\r\n  const [priceCheckSku, setPriceCheckSku] = useState(\"\");\r\n  const [quantity, setQuantity] = useState(1);\r\n  const [cart, setCart] = useState([]);\r\n  const [appliedDiscount, setAppliedDiscount] = useState(null);\r\n  const [showDiscount, setShowDiscount] = useState(false);\r\n  const [showPriceCheck, setShowPriceCheck] = useState(false);\r\n  const [showImportCart, setShowImportCart] = useState(false);\r\n  const [showCashLedger, setShowCashLedger] = useState(false);\r\n  const [showCheckout, setShowCheckout] = useState(false);\r\n  const [selectedPayment, setSelectedPayment] = useState(null);\r\n  const [showCashModal, setShowCashModal] = useState(false);\r\n  const [darkMode, setDarkMode] = useState(false);\r\n  const [scannerPaused, setScannerPaused] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [showLogoutConfirm, setShowLogoutConfirm] = useState(false);\r\n  const [transactionNumber, setTransactionNumber] = useState(\"\");\r\n  const [transactionId, setTransactionId] = useState(null);\r\n  const [showNotifications, setShowNotifications] = useState(false);\r\n  const [showProfileModal, setShowProfileModal] = useState(false);\r\n  const notificationRef = useRef(null);\r\n  const [isMobileNavOpen, setIsMobileNavOpen] = useState(false);\r\n  const touchStartXRef = useRef(null);\r\n  const touchActiveRef = useRef(false);\r\n\r\n  const token = sessionStorage.getItem(\"auth_token\");\r\n  const user = JSON.parse(sessionStorage.getItem(\"user\") || \"{}\");\r\n  const hasFinalizedRef = React.useRef(false);\r\n\r\n  // Add keyboard shortcuts for buttons: F4-F8\r\n  useEffect(() => {\r\n    const keyDownHandler = (e) => {\r\n      if (e.repeat) return;\r\n      switch (e.key) {\r\n        case \"F4\":\r\n          e.preventDefault();\r\n          setShowCashLedger(true);\r\n          break;\r\n        case \"F5\":\r\n          e.preventDefault();\r\n          setShowDiscount(true);\r\n          break;\r\n        case \"F6\":\r\n          e.preventDefault();\r\n          setShowPriceCheck(true);\r\n          break;\r\n        case \"F7\":\r\n          e.preventDefault();\r\n          setShowImportCart(true);\r\n          break;\r\n        case \"F8\":\r\n          e.preventDefault();\r\n          if (cart.length > 0) {\r\n            setShowCheckout(true);\r\n          }\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    };\r\n    window.addEventListener(\"keydown\", keyDownHandler);\r\n    return () => window.removeEventListener(\"keydown\", keyDownHandler);\r\n  }, [cart.length]);\r\n\r\n  // Generate a client-side provisional transaction number when POS opens\r\n  useEffect(() => {\r\n    if (!transactionNumber) {\r\n      const businessId = user?.businessId || user?.business_id || \"BIZ\";\r\n      const timePart = new Date()\r\n        .toISOString()\r\n        .replace(/[-:T.Z]/g, \"\")\r\n        .slice(0, 14);\r\n      const randPart = Math.floor(1000 + Math.random() * 9000);\r\n      setTransactionNumber(\r\n        `T-${businessId.toString().padStart(2, \"0\")}-${timePart}-${randPart}`\r\n      );\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(window.location.search);\r\n    const status = params.get(\"payment\");\r\n    const pending = localStorage.getItem(\"pending_gcash_cart\");\r\n    if (status === \"success\" && pending) {\r\n      try {\r\n        const parsed = JSON.parse(pending);\r\n        // finalize checkout using saved items\r\n        (async () => {\r\n          if (hasFinalizedRef.current) return;\r\n          const guardKey = \"gcash_finalize_done\";\r\n          if (sessionStorage.getItem(guardKey) === \"1\") return;\r\n          hasFinalizedRef.current = true;\r\n          sessionStorage.setItem(guardKey, \"1\");\r\n          try {\r\n            setError(\"\");\r\n            const body = {\r\n              items: parsed.items || [],\r\n              payment_type: \"gcash\",\r\n              money_received: parsed.total || null,\r\n              transaction_id: parsed.transactionId || null,\r\n              transaction_number: parsed.transactionNumber || null,\r\n            };\r\n            const resp = await api(\"/api/sales/checkout\", {\r\n              method: \"POST\",\r\n              headers: { Authorization: `Bearer ${token}` },\r\n              body: JSON.stringify(body),\r\n            });\r\n            if (resp?.transaction_number)\r\n              setTransactionNumber(resp.transaction_number);\r\n            if (resp?.transaction_id) setTransactionId(resp.transaction_id);\r\n            setCart([]);\r\n            try {\r\n              const url = new URL(window.location.origin + \"/receipt\");\r\n              if (resp?.transaction_number)\r\n                url.searchParams.set(\"tn\", resp.transaction_number);\r\n              if (resp?.transaction_id)\r\n                url.searchParams.set(\"tid\", String(resp.transaction_id));\r\n              if (resp?.total != null)\r\n                url.searchParams.set(\"total\", String(resp.total));\r\n              navigate(url.pathname + url.search);\r\n            } catch (_) {}\r\n          } catch (e) {\r\n            setError(\"Failed to record GCASH payment\");\r\n          } finally {\r\n            localStorage.removeItem(\"pending_gcash_cart\");\r\n            // remove query param\r\n            const url = new URL(window.location.href);\r\n            url.searchParams.delete(\"payment\");\r\n            window.history.replaceState({}, \"\", url.toString());\r\n          }\r\n        })();\r\n      } catch (_) {\r\n        localStorage.removeItem(\"pending_gcash_cart\");\r\n      }\r\n    } else if (status === \"cancel\") {\r\n      localStorage.removeItem(\"pending_gcash_cart\");\r\n      const url = new URL(window.location.href);\r\n      url.searchParams.delete(\"payment\");\r\n      window.history.replaceState({}, \"\", url.toString());\r\n    }\r\n  }, []);\r\n\r\n  const addSkuToCart = async (skuValue, qty = 1) => {\r\n    if (!skuValue || qty < 1) return;\r\n    setError(\"\");\r\n    try {\r\n      const businessId = user?.businessId || user?.business_id || null;\r\n      const url = businessId\r\n        ? `/api/products/sku/${encodeURIComponent(\r\n            skuValue\r\n          )}?business_id=${businessId}`\r\n        : `/api/products/sku/${encodeURIComponent(skuValue)}`;\r\n\r\n      const product = await api(url, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      const price = Number(product.selling_price || 0);\r\n      const stockQty = Number(product.stock_quantity ?? 0);\r\n      if (stockQty <= 0) {\r\n        setError(\r\n          `Stock for ${product.product_name} (SKU ${product.sku}) is 0.`\r\n        );\r\n        return;\r\n      }\r\n      if (qty > stockQty) {\r\n        setError(\r\n          `Insufficient stock. Available: ${stockQty}, requested: ${qty}.`\r\n        );\r\n        return;\r\n      }\r\n      setCart((prev) => {\r\n        const existingIdx = prev.findIndex(\r\n          (i) => i.product_id === product.product_id\r\n        );\r\n        if (existingIdx >= 0) {\r\n          const next = [...prev];\r\n          const newQty = next[existingIdx].quantity + qty;\r\n          if (newQty > stockQty) {\r\n            setError(\r\n              `Insufficient stock. Available: ${stockQty}, requested: ${newQty}.`\r\n            );\r\n            return prev;\r\n          }\r\n          next[existingIdx] = { ...next[existingIdx], quantity: newQty };\r\n          return next;\r\n        }\r\n        return [\r\n          ...prev,\r\n          {\r\n            product_id: product.product_id,\r\n            sku: product.sku,\r\n            name: product.product_name,\r\n            quantity: qty,\r\n            price,\r\n          },\r\n        ];\r\n      });\r\n      setSku(\"\");\r\n      setQuantity(1);\r\n      setScannerPaused(false);\r\n    } catch (err) {\r\n      setError(\"Product not found\");\r\n    }\r\n  };\r\n\r\n  const handleAddToCart = async () => {\r\n    await addSkuToCart(sku, quantity);\r\n  };\r\n\r\n  const handleRemove = (idx) => setCart(cart.filter((_, i) => i !== idx));\r\n\r\n  const subtotal = cart.reduce(\r\n    (sum, item) => sum + item.price * item.quantity,\r\n    0\r\n  );\r\n\r\n  // Placeholder for appliedDiscount state and discount calculation if needed\r\n  // const [appliedDiscount, setAppliedDiscount] = useState(null);\r\n  // const total = calculateTotalWithDiscount(subtotal, appliedDiscount);\r\n  // For now, total equals subtotal\r\n  const total = subtotal;\r\n\r\n  const completeTransactionCall = async (transId) => {\r\n    if (!transId) return;\r\n    try {\r\n      const resp = await api(`/api/sales/${transId}/complete`, {\r\n        method: \"POST\",\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      return resp;\r\n    } catch (err) {\r\n      console.error(\"Failed to complete transaction:\", err);\r\n      setError(\"Failed to complete transaction\");\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const handleCheckout = async (\r\n    paymentType = \"cash\",\r\n    moneyReceived = total\r\n  ) => {\r\n    if (cart.length === 0) return;\r\n    setError(\"\");\r\n    try {\r\n      const body = {\r\n        transaction_id: transactionId || null,\r\n        transaction_number: transactionNumber || null,\r\n        items: cart.map((i) => ({\r\n          product_id: i.product_id,\r\n          quantity: i.quantity,\r\n        })),\r\n        payment_type: paymentType,\r\n        money_received: moneyReceived,\r\n        ...(appliedDiscount &&\r\n        typeof appliedDiscount.value === \"string\" &&\r\n        appliedDiscount.value.endsWith(\"%\")\r\n          ? { discount_percentage: parseFloat(appliedDiscount.value) }\r\n          : appliedDiscount\r\n          ? { discount_amount: Number(appliedDiscount.value) }\r\n          : {}),\r\n      };\r\n      const resp = await api(\"/api/sales/checkout\", {\r\n        method: \"POST\",\r\n        headers: { Authorization: `Bearer ${token}` },\r\n        body: JSON.stringify(body),\r\n      });\r\n      if (resp?.transaction_number)\r\n        setTransactionNumber(resp.transaction_number);\r\n      if (resp?.transaction_id) setTransactionId(resp.transaction_id);\r\n\r\n      // Removed redundant call to completeTransaction endpoint as checkout already sets status and cashier_user_id\r\n      // if (resp?.transaction_id) {\r\n      //   await completeTransactionCall(resp.transaction_id);\r\n      // }\r\n\r\n      setCart([]);\r\n      try {\r\n        const url = new URL(window.location.origin + \"/receipt\");\r\n        if (resp?.transaction_number)\r\n          url.searchParams.set(\"tn\", resp.transaction_number);\r\n        if (resp?.transaction_id)\r\n          url.searchParams.set(\"tid\", String(resp.transaction_id));\r\n        if (resp?.total != null)\r\n          url.searchParams.set(\"total\", String(resp.total));\r\n        navigate(url.pathname + url.search);\r\n      } catch (_) {}\r\n      // Start a fresh provisional transaction number after successful checkout\r\n      const businessId = user?.businessId || user?.business_id || \"BIZ\";\r\n      const timePart = new Date()\r\n        .toISOString()\r\n        .replace(/[-:T.Z]/g, \"\")\r\n        .slice(0, 14);\r\n      const randPart = Math.floor(1000 + Math.random() * 9000);\r\n      setTransactionNumber(\r\n        `T-${businessId.toString().padStart(2, \"0\")}-${timePart}-${randPart}`\r\n      );\r\n      setAppliedDiscount(null);\r\n      setTransactionId(null);\r\n    } catch (err) {\r\n      setError(\"Checkout failed\");\r\n    }\r\n  };\r\n\r\n  const handleCopyTn = () => {\r\n    navigator.clipboard.writeText(user.store_name);\r\n  };\r\n\r\n  // show confirmation modal first, perform actual logout in confirmLogout\r\n  const handleLogout = () => {\r\n    setShowLogoutConfirm(true);\r\n  };\r\n\r\n  const confirmLogout = () => {\r\n    sessionStorage.removeItem(\"auth_token\");\r\n    sessionStorage.removeItem(\"user\");\r\n    // close modal then navigate home\r\n    setShowLogoutConfirm(false);\r\n    navigate(\"/\");\r\n  };\r\n\r\n  const handleCloseLogoutModal = () => {\r\n    setShowLogoutConfirm(false);\r\n  };\r\n\r\n  const headerActions = (\r\n    <div className=\"flex items-center gap-2\">\r\n      <button\r\n        onClick={() => setShowNotifications(!showNotifications)}\r\n        className=\"p-2 rounded-lg hover:bg-gray-100 transition-colors\"\r\n        title=\"Notifications\"\r\n      >\r\n        <BiBell className=\"w-5 h-5 text-gray-600\" />\r\n      </button>\r\n      <button\r\n        onClick={() => setShowProfileModal(true)}\r\n        className=\"p-2 rounded-lg hover:bg-gray-100 transition-colors\"\r\n        title=\"Profile\"\r\n      >\r\n        <BiUser className=\"w-5 h-5 text-gray-600\" />\r\n      </button>\r\n      <button\r\n        onClick={handleLogout}\r\n        className=\"p-2 rounded-lg hover:bg-red-50 transition-colors\"\r\n        title=\"Logout\"\r\n      >\r\n        <svg\r\n          className=\"w-5 h-5 text-red-600\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h6a2 2 0 012 2v1\"\r\n          />\r\n        </svg>\r\n      </button>\r\n    </div>\r\n  );\r\n\r\n  const cardClass = \"bg-white border border-blue-100 rounded-2xl p-6 shadow-lg\";\r\n\r\n  return (\r\n    <div className=\"bg-white min-h-screen\">\r\n      {/* Main Content */}\r\n      <div className=\"flex-1 flex flex-col min-h-screen\">\r\n        {/* Header */}\r\n        <header className=\"flex items-center gap-2 px-4 sm:px-6 py-3 bg-white/90 backdrop-blur-md shadow-md border-b border-gray-200/50 h-[64px] min-h-[64px] max-h-[64px] sticky top-0 z-30\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <span className=\"text-xl sm:text-2xl font-bold text-gray-900 tracking-tight\">\r\n              POS\r\n            </span>\r\n          </div>\r\n          <div className=\"flex-1 flex items-center justify-center px-2\">\r\n            <button\r\n              onClick={handleCopyTn}\r\n              title=\"Copy store name\"\r\n              className=\"inline-flex items-center gap-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg px-2.5 py-1.5 shadow-sm hover:bg-blue-100 transition-colors\"\r\n            >\r\n              <svg\r\n                className=\"w-4 h-4\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2M8 16h8a2 2 0 002-2v-6m-10 8l-2 2m2-2l2 2\"\r\n                />\r\n              </svg>\r\n              <span className=\"font-mono text-xs sm:text-sm md:text-base font-bold tracking-wider truncate max-w-[50vw]\">\r\n                {user.store_name}\r\n              </span>\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"ml-auto\">{headerActions}</div>\r\n        </header>\r\n\r\n        {/* Main Area */}\r\n        <main className=\"flex-1 bg-gradient-to-br from-gray-50/50 via-blue-50/30 to-indigo-50/50 overflow-y-auto p-2 sm:p-3 md:p-4 pb-55 lg:pb-4\">\r\n          <div className=\"grid gap-2 sm:gap-3 md:gap-4 h-full grid-cols-1 lg:grid-cols-12\">\r\n            {/* Left Column - Scanner, SKU Form, Transaction */}\r\n            <div className=\"lg:col-span-4 flex flex-col gap-2 sm:gap-3 md:gap-4\">\r\n              {/* ScannerCard */}\r\n              <div className=\"flex-shrink-0\">\r\n                <ScannerCard\r\n                  onScan={async (result) => {\r\n                    const code = result?.[0]?.rawValue;\r\n                    if (!code) return;\r\n                    setScannerPaused(true);\r\n                    if (showPriceCheck) {\r\n                      setPriceCheckSku(code);\r\n                    } else {\r\n                      try {\r\n                        let scannedData;\r\n                        try {\r\n                          scannedData = JSON.parse(code);\r\n                        } catch (e) {\r\n                          scannedData = null;\r\n                        }\r\n                        if (\r\n                          scannedData &&\r\n                          scannedData.t === \"cart\" &&\r\n                          Array.isArray(scannedData.items)\r\n                        ) {\r\n                          // set transactionId from scanned data if present\r\n                          if (scannedData.transaction_id) {\r\n                            setTransactionId(scannedData.transaction_id);\r\n                          }\r\n                          // set transaction_number from scanned data if present\r\n                          if (scannedData.transaction_number) {\r\n                            setTransactionNumber(\r\n                              scannedData.transaction_number\r\n                            );\r\n                          }\r\n                          const items = scannedData.items.map((it) => ({\r\n                            product_id: it.p,\r\n                            quantity: it.q,\r\n                            sku: it.sku || \"\",\r\n                          }));\r\n                          try {\r\n                            const fetchedProducts = await Promise.all(\r\n                              items.map(async (item) => {\r\n                                const res = await api(\r\n                                  `/api/products/${item.product_id}`,\r\n                                  {\r\n                                    headers: {\r\n                                      Authorization: `Bearer ${token}`,\r\n                                    },\r\n                                  }\r\n                                );\r\n                                return {\r\n                                  product_id: item.product_id,\r\n                                  sku: res.sku || item.sku || \"\",\r\n                                  name: res.product_name || \"\",\r\n                                  price: Number(res.selling_price) || 0,\r\n                                  quantity: item.quantity,\r\n                                };\r\n                              })\r\n                            );\r\n                            setCart((prev) => {\r\n                              const byProductId = new Map(\r\n                                prev.map((i) => [i.product_id, i])\r\n                              );\r\n                              for (const it of fetchedProducts) {\r\n                                const existing = byProductId.get(it.product_id);\r\n                                if (existing) {\r\n                                  existing.quantity += it.quantity;\r\n                                } else {\r\n                                  byProductId.set(it.product_id, { ...it });\r\n                                }\r\n                              }\r\n                              return Array.from(byProductId.values());\r\n                            });\r\n                            return;\r\n                          } catch (err) {\r\n                            console.error(\r\n                              \"Error fetching product details for scanned cart:\",\r\n                              err\r\n                            );\r\n                            // fallback to merging raw scanned items without product details\r\n                            setCart((prev) => {\r\n                              const byProductId = new Map(\r\n                                prev.map((i) => [i.product_id, i])\r\n                              );\r\n                              for (const it of items) {\r\n                                const existing = byProductId.get(it.product_id);\r\n                                if (existing) {\r\n                                  existing.quantity += it.quantity;\r\n                                } else {\r\n                                  byProductId.set(it.product_id, {\r\n                                    ...it,\r\n                                    name: \"\",\r\n                                    price: 0,\r\n                                  });\r\n                                }\r\n                              }\r\n                              return Array.from(byProductId.values());\r\n                            });\r\n                            return;\r\n                          }\r\n                        }\r\n                        await addSkuToCart(code, 1);\r\n                      } catch (err) {\r\n                        console.error(\"Error processing scanned code:\", err);\r\n                        await addSkuToCart(code, 1);\r\n                      }\r\n                    }\r\n                  }}\r\n                  paused={scannerPaused}\r\n                  onResume={() => setScannerPaused(false)}\r\n                  textMain=\"text-blue-700\"\r\n                />\r\n              </div>\r\n\r\n              {/* SkuFormCard */}\r\n              <div className=\"flex-shrink-0\">\r\n                <SkuFormCard\r\n                  sku={sku}\r\n                  setSku={setSku}\r\n                  quantity={quantity}\r\n                  setQuantity={setQuantity}\r\n                  handleAddToCart={handleAddToCart}\r\n                />\r\n                {error && (\r\n                  <div className=\"bg-red-50 border-l-4 border-red-500 rounded-lg p-3 flex items-start gap-2 mt-3\">\r\n                    <svg\r\n                      className=\"w-4 h-4 text-red-500 flex-shrink-0 mt-0.5\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"\r\n                      />\r\n                    </svg>\r\n                    <p className=\"text-sm font-medium text-red-700\">\r\n                      {(() => {\r\n                        try {\r\n                          const parsed = JSON.parse(error);\r\n                          return parsed.error || parsed.message || error;\r\n                        } catch {\r\n                          return error;\r\n                        }\r\n                      })()}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Right Column - Cart and Actions */}\r\n            <div className=\"lg:col-span-8 flex flex-col gap-2 sm:gap-3 min-h-0\">\r\n              {/* CartTableCard */}\r\n              <div className=\"flex-1 overflow-auto\">\r\n                <CartTableCard\r\n                  cart={cart}\r\n                  handleRemove={handleRemove}\r\n                  total={total}\r\n                  className=\"flex-1 h-full\"\r\n                />\r\n              </div>\r\n\r\n              {/* Action Buttons */}\r\n              <div className=\"grid grid-cols-12 gap-2 sm:gap-3 flex-shrink-0\">\r\n                {/* Grouped Buttons */}\r\n                <div className=\"col-span-8\">\r\n                  <div className=\"grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3\">\r\n                    <Button\r\n                      label=\"CASH LEDGER (F4)\"\r\n                      size=\"md\"\r\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\r\n                      variant=\"secondary\"\r\n                      microinteraction\r\n                      onClick={() => setShowCashLedger(true)}\r\n                      icon={\r\n                        <svg\r\n                          className=\"w-4 h-4\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                          />\r\n                        </svg>\r\n                      }\r\n                      iconPosition=\"left\"\r\n                    />\r\n                    <Button\r\n                      label=\"DISCOUNT (F5)\"\r\n                      size=\"md\"\r\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\r\n                      onClick={() => setShowDiscount(true)}\r\n                      variant=\"secondary\"\r\n                      microinteraction\r\n                      icon={\r\n                        <svg\r\n                          className=\"w-4 h-4\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                          />\r\n                        </svg>\r\n                      }\r\n                      iconPosition=\"left\"\r\n                    />\r\n                    <Button\r\n                      label=\"PRICE CHECK (F6)\"\r\n                      size=\"md\"\r\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\r\n                      onClick={() => setShowPriceCheck(true)}\r\n                      variant=\"secondary\"\r\n                      microinteraction\r\n                      icon={\r\n                        <svg\r\n                          className=\"w-4 h-4\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                          />\r\n                        </svg>\r\n                      }\r\n                      iconPosition=\"left\"\r\n                    />\r\n                    <Button\r\n                      label=\"IMPORT CART (F7)\"\r\n                      size=\"md\"\r\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\r\n                      onClick={() => setShowImportCart(true)}\r\n                      variant=\"secondary\"\r\n                      microinteraction\r\n                      icon={\r\n                        <svg\r\n                          className=\"w-4 h-4\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12\"\r\n                          />\r\n                        </svg>\r\n                      }\r\n                      iconPosition=\"left\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Checkout Button */}\r\n                <div className=\"col-span-4\">\r\n                  <Button\r\n                    label=\"CHECKOUT (F8)\"\r\n                    size=\"md\"\r\n                    className=\"w-full h-full text-sm sm:text-base font-bold\"\r\n                    variant=\"primary\"\r\n                    microinteraction\r\n                    onClick={() => setShowCheckout(true)}\r\n                    disabled={cart.length === 0}\r\n                    icon={\r\n                      <svg\r\n                        className=\"w-5 h-5\"\r\n                        fill=\"none\"\r\n                        stroke=\"currentColor\"\r\n                        viewBox=\"0 0 24 24\"\r\n                      >\r\n                        <path\r\n                          strokeLinecap=\"round\"\r\n                          strokeLinejoin=\"round\"\r\n                          strokeWidth={2}\r\n                          d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                        />\r\n                      </svg>\r\n                    }\r\n                    iconPosition=\"left\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </main>\r\n\r\n        {/* Modals */}\r\n        {showLogoutConfirm && (\r\n          <div className=\"fixed inset-0 z-90 flex items-center justify-center\">\r\n            <div\r\n              className=\"absolute inset-0 bg-black/80 z-90\"\r\n              onClick={handleCloseLogoutModal}\r\n            />\r\n            <div className=\"relative bg-white rounded-xl shadow-xl w-[92%] max-w-md z-100 p-0\">\r\n              {/* Header Section */}\r\n              <div className=\"bg-gradient-to-r from-red-50 via-red-50/80 to-orange-50/50 border-b border-red-100 px-6 py-5 rounded-t-2xl\">\r\n                <div className=\"flex items-center gap-4\">\r\n                  <div className=\"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg\">\r\n                    <svg\r\n                      className=\"w-6 h-6 text-white\"\r\n                      fill=\"none\"\r\n                      stroke=\"white\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeWidth=\"2\"\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"\r\n                      />\r\n                    </svg>\r\n                  </div>\r\n                  <div className=\"flex-1\">\r\n                    <h2 className=\"text-xl font-bold text-gray-900 mb-1\">\r\n                      Confirm Logout\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-600\">\r\n                      Are you sure you want to log out?\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Content Section */}\r\n              <div className=\"p-6\">\r\n                <p className=\"text-sm text-gray-700 mb-6\">\r\n                  You will be redirected to the login page and your session will\r\n                  end.\r\n                </p>\r\n\r\n                {/* Action Buttons */}\r\n                <div className=\"flex justify-end gap-3\">\r\n                  <button\r\n                    onClick={handleCloseLogoutModal}\r\n                    className=\"px-5 py-2.5 rounded-lg text-sm font-semibold text-gray-700 bg-white border-2 border-gray-300 hover:bg-gray-50 hover:border-gray-400 transition-all duration-200\"\r\n                  >\r\n                    Cancel\r\n                  </button>\r\n                  <button\r\n                    onClick={confirmLogout}\r\n                    className=\"px-5 py-2.5 rounded-lg text-sm font-semibold text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 shadow-md hover:shadow-lg transition-all duration-200 flex items-center gap-2\"\r\n                  >\r\n                    <svg\r\n                      className=\"w-5 h-5\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeWidth=\"2\"\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"\r\n                      />\r\n                    </svg>\r\n                    Logout\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n        <DiscountModal\r\n          isOpen={showDiscount}\r\n          onClose={() => setShowDiscount(false)}\r\n          onApplyDiscount={(discount) => {\r\n            // Apply the discount to your transaction/cart here\r\n            // Optionally handle discount state update\r\n            setShowDiscount(false);\r\n          }}\r\n        />\r\n        <PriceCheckModal\r\n          isOpen={showPriceCheck}\r\n          onClose={() => setShowPriceCheck(false)}\r\n          sku={priceCheckSku}\r\n          setSku={setPriceCheckSku}\r\n        />\r\n        <CashLedgerModal\r\n          isOpen={showCashLedger}\r\n          onClose={() => setShowCashLedger(false)}\r\n        />\r\n        <CheckoutModal\r\n          isOpen={showCheckout}\r\n          onClose={() => setShowCheckout(false)}\r\n          total={total}\r\n          onSelectPayment={(method) => {\r\n            setSelectedPayment(method);\r\n            setShowCheckout(false);\r\n            if (method === \"cash\") {\r\n              setShowCashModal(true);\r\n            } else {\r\n              if (method === \"gcash\") {\r\n                (async () => {\r\n                  try {\r\n                    const successUrl =\r\n                      window.location.origin + \"/pos?payment=success\";\r\n                    const cancelUrl =\r\n                      window.location.origin + \"/pos?payment=cancel\";\r\n                    // persist cart to finalize after redirect back\r\n                    localStorage.setItem(\r\n                      \"pending_gcash_cart\",\r\n                      JSON.stringify({\r\n                        items: cart.map((i) => ({\r\n                          product_id: i.product_id,\r\n                          quantity: i.quantity,\r\n                        })),\r\n                        total,\r\n                        transactionId: transactionId,\r\n                        transactionNumber: transactionNumber,\r\n                      })\r\n                    );\r\n                    const { checkoutUrl } = await createGcashCheckout({\r\n                      amount: Number(total || 0),\r\n                      description: \"POS Order\",\r\n                      referenceNumber: transactionNumber || `POS-${Date.now()}`,\r\n                      cancelUrl,\r\n                      successUrl,\r\n                    });\r\n                    window.location.href = checkoutUrl;\r\n                  } catch (e) {\r\n                    setError(\"Failed to init GCash\");\r\n                    localStorage.removeItem(\"pending_gcash_cart\");\r\n                  }\r\n                })();\r\n              } else {\r\n                // For MAYA or others, fall back to existing checkout flow\r\n                handleCheckout(method);\r\n              }\r\n            }\r\n          }}\r\n        />\r\n        <CashPaymentModal\r\n          isOpen={showCashModal}\r\n          onClose={() => setShowCashModal(false)}\r\n          total={total}\r\n          onConfirm={(amountReceived) => {\r\n            handleCheckout(\"cash\", amountReceived);\r\n            setShowCashModal(false);\r\n          }}\r\n        />\r\n        <ScanCustomerCartModal\r\n          isOpen={showImportCart}\r\n          onClose={() => setShowImportCart(false)}\r\n          onImport={async (items) => {\r\n            try {\r\n              console.log(\"Scanned items:\", items);\r\n              // Fetch product details by product_id for all scanned items concurrently\r\n              const fetchedProducts = await Promise.all(\r\n                items.map(async (item) => {\r\n                  const res = await api(`/api/products/${item.product_id}`, {\r\n                    headers: { Authorization: `Bearer ${token}` },\r\n                  });\r\n                  console.log(\r\n                    \"Fetched product for id\",\r\n                    item.product_id,\r\n                    \":\",\r\n                    res\r\n                  );\r\n                  return {\r\n                    product_id: item.product_id,\r\n                    sku: res.sku || item.sku || \"\",\r\n                    name: res.product_name || \"\",\r\n                    price: Number(res.selling_price) || 0,\r\n                    quantity: item.quantity,\r\n                  };\r\n                })\r\n              );\r\n              setCart((prev) => {\r\n                const bySku = new Map(prev.map((i) => [i.sku, i]));\r\n                for (const it of fetchedProducts) {\r\n                  const existing = bySku.get(it.sku);\r\n                  if (existing) existing.quantity += it.quantity;\r\n                  else bySku.set(it.sku, { ...it });\r\n                }\r\n                return Array.from(bySku.values());\r\n              });\r\n            } catch (e) {\r\n              console.error(\"Error fetching products for scanned items:\", e);\r\n              // Fallback to use raw items if fetch fails\r\n              setCart((prev) => {\r\n                const bySku = new Map(prev.map((i) => [i.sku, i]));\r\n                for (const it of items) {\r\n                  const existing = bySku.get(it.sku);\r\n                  if (existing) existing.quantity += it.quantity;\r\n                  else bySku.set(it.sku, { ...it });\r\n                }\r\n                return Array.from(bySku.values());\r\n              });\r\n            }\r\n          }}\r\n        />\r\n        <ProfileModal\r\n          isOpen={showProfileModal}\r\n          onClose={() => setShowProfileModal(false)}\r\n          userData={user}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default CashierPOS;\r\n"],"names":["CashierPOS","navigate","useNavigate","sku","setSku","useState","priceCheckSku","setPriceCheckSku","quantity","setQuantity","cart","setCart","appliedDiscount","setAppliedDiscount","showDiscount","setShowDiscount","showPriceCheck","setShowPriceCheck","showImportCart","setShowImportCart","showCashLedger","setShowCashLedger","showCheckout","setShowCheckout","selectedPayment","setSelectedPayment","showCashModal","setShowCashModal","darkMode","setDarkMode","scannerPaused","setScannerPaused","error","setError","showLogoutConfirm","setShowLogoutConfirm","transactionNumber","setTransactionNumber","transactionId","setTransactionId","showNotifications","setShowNotifications","showProfileModal","setShowProfileModal","useRef","isMobileNavOpen","setIsMobileNavOpen","token","sessionStorage","getItem","user","JSON","parse","hasFinalizedRef","React","useEffect","keyDownHandler","e","repeat","key","preventDefault","length","addEventListener","window","removeEventListener","businessId","business_id","timePart","Date","toISOString","replace","slice","randPart","Math","floor","random","toString","padStart","status","URLSearchParams","location","search","get","pending","localStorage","parsed","current","guardKey","setItem","body","items","payment_type","money_received","total","transaction_id","transaction_number","resp","api","method","headers","Authorization","stringify","url","URL","origin","searchParams","set","String","pathname","_","removeItem","href","delete","history","replaceState","addSkuToCart","async","skuValue","qty","encodeURIComponent","product","price","Number","selling_price","stockQty","stock_quantity","product_name","prev","existingIdx","findIndex","i","product_id","next","newQty","name","err","reduce","sum","item","handleCheckout","paymentType","moneyReceived","map","value","endsWith","discount_percentage","parseFloat","discount_amount","handleCloseLogoutModal","headerActions","jsxs","className","children","jsx","onClick","title","BiBell","BiUser","handleLogout","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","handleCopyTn","clipboard","writeText","store_name","ScannerCard","onScan","result","code","rawValue","scannedData","t","Array","isArray","it","p","q","fetchedProducts","Promise","all","res","byProductId","Map","existing","from","values","paused","onResume","textMain","SkuFormCard","handleAddToCart","message","CartTableCard","handleRemove","filter","idx","Button","label","size","variant","microinteraction","icon","iconPosition","disabled","confirmLogout","DiscountModal","isOpen","onClose","onApplyDiscount","discount","PriceCheckModal","CashLedgerModal","CheckoutModal","onSelectPayment","successUrl","cancelUrl","checkoutUrl","createGcashCheckout","amount","description","referenceNumber","now","CashPaymentModal","onConfirm","amountReceived","ScanCustomerCartModal","onImport","log","console","bySku","ProfileModal","userData"],"mappings":"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"}