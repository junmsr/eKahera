{"version":3,"file":"DocumentResubmitPage-DYMOBaYk.js","sources":["../../../frontend/src/pages/DocumentResubmitPage.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useParams, useSearchParams, useNavigate } from \"react-router-dom\";\r\nimport { api } from \"../lib/api\";\r\nimport Button from \"../components/common/Button\";\r\nimport Loader from \"../components/common/Loader\";\r\n\r\nconst DocumentResubmitPage = () => {\r\n  const { documentId } = useParams();\r\n  const [searchParams] = useSearchParams();\r\n  const navigate = useNavigate();\r\n  const [document, setDocument] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(\"\");\r\n  const [success, setSuccess] = useState(\"\");\r\n  const [file, setFile] = useState(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [userEmail, setUserEmail] = useState(\"\");\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // Check if user is already logged in\r\n    const token = sessionStorage.getItem('auth_token');\r\n    const storedUser = sessionStorage.getItem('user');\r\n    \r\n    if (token && storedUser) {\r\n      setIsAuthenticated(true);\r\n      const user = JSON.parse(storedUser);\r\n      setUserEmail(user.email || '');\r\n    } else {\r\n      // If not logged in, use email from URL if provided\r\n      const email = searchParams.get('email');\r\n      if (email) {\r\n        setUserEmail(email);\r\n      } else {\r\n        // If no email in URL and not logged in, redirect to login\r\n        navigate('/login', { state: { from: window.location.pathname } });\r\n        return;\r\n      }\r\n    }\r\n\r\n    const fetchDocument = async () => {\r\n      try {\r\n        setLoading(true);\r\n        const data = await api(`/documents/${documentId}/info`);\r\n        \r\n        if (data.verification_status !== 'rejected') {\r\n          setError(\"This document is not marked as rejected and cannot be resubmitted.\");\r\n        } else {\r\n          setDocument(data);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Failed to fetch document:\", err);\r\n        setError(\"Failed to load document. Please check the link and try again.\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    if (documentId) {\r\n      fetchDocument();\r\n    } else {\r\n      setError(\"No document ID provided\");\r\n      setLoading(false);\r\n    }\r\n  }, [documentId, searchParams]);\r\n\r\n  const handleFileChange = (e) => {\r\n    const selectedFile = e.target.files[0];\r\n    if (selectedFile) {\r\n      setFile(selectedFile);\r\n      setError(\"\");\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    \r\n    if (!file) {\r\n      setError(\"Please select a file to upload\");\r\n      return;\r\n    }\r\n\r\n    const formData = new FormData();\r\n    formData.append('document', file);\r\n    formData.append('document_id', documentId);\r\n    \r\n    // Only add user_email if user is not authenticated\r\n    if (!isAuthenticated && userEmail) {\r\n      formData.append('user_email', userEmail);\r\n    }\r\n\r\n    try {\r\n      setIsSubmitting(true);\r\n      setError(\"\");\r\n      \r\n      const token = sessionStorage.getItem('auth_token');\r\n      const headers = {\r\n        'Accept': 'application/json',\r\n      };\r\n      \r\n      // Add authorization header if user is authenticated\r\n      if (token) {\r\n        headers['Authorization'] = `Bearer ${token}`;\r\n      }\r\n\r\n      const response = await fetch(`${process.env.REACT_APP_API_URL || ''}/api/documents/resubmit`, {\r\n        method: 'POST',\r\n        body: formData,\r\n        headers: headers,\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to resubmit document');\r\n      }\r\n\r\n      toast.success(\"Document resubmitted successfully!\");\r\n      setSuccess(\"Document resubmitted successfully!\");\r\n      setFile(null);\r\n      document.verification_status = 'pending';\r\n      document.verification_notes = null;\r\n      \r\n      setTimeout(() => {\r\n        navigate('/login');\r\n      }, 2000);\r\n    } catch (error) {\r\n      console.error(\"Resubmission error:\", error);\r\n      setError(error.message || \"Failed to resubmit document. Please try again.\");\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\r\n        <div className=\"text-center\">\r\n          <Loader size=\"lg\" />\r\n          <p className=\"mt-4 text-gray-600\">Loading document information...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\r\n      <div className=\"max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden p-6\">\r\n        <div className=\"text-center mb-6\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">Document Resubmission</h1>\r\n          <p className=\"mt-2 text-sm text-gray-600\">\r\n            {document ? `Please upload a new version of your ${document.document_type}` : \"Document Resubmission\"}\r\n          </p>\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"mb-4 p-4 bg-red-50 border-l-4 border-red-500 text-red-700\">\r\n            <p>{error}</p>\r\n          </div>\r\n        )}\r\n\r\n        {success ? (\r\n          <div className=\"mb-4 p-4 bg-green-50 border-l-4 border-green-500 text-green-700\">\r\n            <p>{success}</p>\r\n            <p className=\"mt-2\">You will be redirected to the login page shortly...</p>\r\n          </div>\r\n        ) : (\r\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            {!userEmail && (\r\n              <div>\r\n                <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                  Your Email Address\r\n                </label>\r\n                <input\r\n                  type=\"email\"\r\n                  id=\"email\"\r\n                  value={userEmail}\r\n                  onChange={(e) => setUserEmail(e.target.value)}\r\n                  required\r\n                  className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\r\n                  placeholder=\"your.email@example.com\"\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Document: {document?.document_type}\r\n              </label>\r\n              <p className=\"text-sm text-gray-500 mb-4\">\r\n                Status: <span className=\"font-medium text-red-600\">Rejected</span>\r\n                {document?.verification_notes && (\r\n                  <span className=\"block mt-1 text-sm text-gray-600\">\r\n                    <span className=\"font-medium\">Note:</span> {document.verification_notes}\r\n                  </span>\r\n                )}\r\n              </p>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                Upload New Version\r\n              </label>\r\n              <div className=\"mt-1 flex items-center\">\r\n                <input\r\n                  type=\"file\"\r\n                  onChange={handleFileChange}\r\n                  accept=\".pdf,.jpg,.jpeg,.png\"\r\n                  className=\"block w-full text-sm text-gray-500\r\n                    file:mr-4 file:py-2 file:px-4\r\n                    file:rounded-md file:border-0\r\n                    file:text-sm file:font-semibold\r\n                    file:bg-blue-50 file:text-blue-700\r\n                    hover:file:bg-blue-100\"\r\n                  required\r\n                />\r\n              </div>\r\n              {file && (\r\n                <p className=\"mt-2 text-sm text-green-600\">\r\n                  Selected: {file.name} ({(file.size / 1024).toFixed(2)} KB)\r\n                </p>\r\n              )}\r\n              <p className=\"mt-1 text-xs text-gray-500\">\r\n                Accepted formats: .pdf, .jpg, .jpeg, .png (Max: 5MB)\r\n              </p>\r\n            </div>\r\n\r\n            <div className=\"pt-4 space-y-3\">\r\n              <Button\r\n                type=\"submit\"\r\n                disabled={!file || isSubmitting || !userEmail}\r\n                className=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n              >\r\n                {isSubmitting ? 'Uploading...' : 'Resubmit Document'}\r\n              </Button>\r\n              \r\n              <Button\r\n                type=\"button\"\r\n                onClick={() => navigate('/login')}\r\n                variant=\"outline\"\r\n                className=\"w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\r\n              >\r\n                Back to Login\r\n              </Button>\r\n            </div>\r\n          </form>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DocumentResubmitPage;"],"names":["DocumentResubmitPage","documentId","useParams","searchParams","useSearchParams","navigate","useNavigate","document","setDocument","useState","loading","setLoading","error","setError","success","setSuccess","file","setFile","isSubmitting","setIsSubmitting","userEmail","setUserEmail","isAuthenticated","setIsAuthenticated","useEffect","token","sessionStorage","getItem","storedUser","user","JSON","parse","email","get","state","from","window","location","pathname","async","data","api","verification_status","err","fetchDocument","className","children","jsxs","jsx","Loader","size","document_type","onSubmit","e","preventDefault","formData","FormData","append","headers","Accept","response","fetch","process","REACT_APP_API_URL","method","body","json","ok","Error","toast","verification_notes","setTimeout","message","htmlFor","type","id","value","onChange","target","required","placeholder","selectedFile","files","accept","name","toFixed","Button","disabled","onClick","variant"],"mappings":"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"}