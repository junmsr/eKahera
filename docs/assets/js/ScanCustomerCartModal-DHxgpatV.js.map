{"version":3,"file":"ScanCustomerCartModal-DHxgpatV.js","sources":["../../../frontend/src/components/ui/POS/SkuFormCard.jsx","../../../frontend/src/hooks/useBarcodeScanner.js","../../../frontend/src/components/ui/POS/CartTableCard.jsx","../../../frontend/src/components/modals/PriceCheckModal.jsx","../../../frontend/src/components/modals/DiscountModal.jsx","../../../frontend/src/components/modals/CashLedgerModal.jsx","../../../frontend/src/components/modals/CheckoutModal.jsx","../../../frontend/src/components/modals/CashPaymentCompleteModal.jsx","../../../frontend/src/components/modals/CashPaymentModal.jsx","../../../frontend/src/components/modals/ScanCustomerCartModal.jsx"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\r\nimport Card from \"../../common/Card\";\r\nimport FormField from \"../../common/FormField\";\r\nimport Input from \"../../common/Input\";\r\nimport Button from \"../../common/Button\";\r\nimport { useBarcodeScanner } from \"../../../hooks/useBarcodeScanner\";\r\n\r\n/**\r\n * SKU Form Card Component\r\n * Form for entering SKU codes and quantities\r\n */\r\nexport default React.forwardRef(\r\n  (\r\n    {\r\n      sku,\r\n      setSku,\r\n      quantity,\r\n      setQuantity,\r\n      handleAddToCart,\r\n      quantityInputRef,\r\n      className = \"\",\r\n    },\r\n    ref\r\n  ) => {\r\n    // Track if we're processing a barcode scan to prevent double-firing\r\n    const isProcessingScanRef = useRef(false);\r\n\r\n    // Handle hardware barcode scanner input - auto-submit when scanner sends Enter quickly\r\n    useBarcodeScanner((scannedCode) => {\r\n      if (scannedCode && scannedCode.trim()) {\r\n        isProcessingScanRef.current = true;\r\n        // Set the SKU and immediately add to cart\r\n        setSku(scannedCode.trim());\r\n        // Use a small delay to ensure state update, then add to cart\r\n        setTimeout(() => {\r\n          handleAddToCart();\r\n          // Reset flag after processing\r\n          setTimeout(() => {\r\n            isProcessingScanRef.current = false;\r\n          }, 200);\r\n        }, 100);\r\n      }\r\n    }, { inputSelector: 'input[name=\"sku\"]' });\r\n\r\n    return (\r\n      <Card\r\n        className={`flex-shrink-0 bg-white/80 backdrop-blur-md border border-white/60 shadow-xl hover:shadow-2xl transition-all duration-300 ${className}`}\r\n        variant=\"glass\"\r\n      >\r\n        <div className=\"flex flex-col gap-1 p-1 sm:p-2\">\r\n          <div className=\"flex items-center gap-2 mb-0.5\">\r\n            <div className=\"w-6 h-6 bg-blue-100 rounded-xl flex items-center justify-center\">\r\n              <svg\r\n                className=\"w-3 h-3 text-blue-600\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\r\n                />\r\n              </svg>\r\n            </div>\r\n            <span className=\"font-bold text-sm text-gray-900\">\r\n              Enter SKU Code\r\n            </span>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <div>\r\n              <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700 mb-1\">\r\n                <span>SKU Code</span>\r\n                <span className=\"hidden sm:inline-block text-xs font-bold px-1.5 py-0.5 rounded border bg-gray-100 border-gray-300 text-gray-600\">\r\n                  `\r\n                </span>\r\n              </label>\r\n              <div className=\"relative\">\r\n                <input\r\n                  ref={ref}\r\n                  type=\"text\"\r\n                  name=\"sku\"\r\n                  value={sku}\r\n                  onChange={(e) => setSku(e.target.value)}\r\n                  onKeyPress={(e) => {\r\n                    // Only handle manual Enter key presses (not barcode scanner)\r\n                    // The useBarcodeScanner hook handles scanner input\r\n                    if (e.key === \"Enter\" && sku.trim() && !isProcessingScanRef.current) {\r\n                      handleAddToCart();\r\n                    }\r\n                  }}\r\n                  autoComplete=\"off\"\r\n                  autoFocus={false}\r\n                  placeholder=\"Scan or enter SKU code (Press ` to focus)\"\r\n                  className=\"w-full pl-3 pr-3 py-2 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 placeholder-gray-400 font-medium\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-2\">\r\n              <label className=\"text-sm font-semibold text-gray-700 whitespace-nowrap\">\r\n                Quantity:\r\n              </label>\r\n              <div className=\"flex items-center gap-1 flex-1\">\r\n                <button\r\n                  onClick={() => setQuantity(Math.max(1, quantity - 1))}\r\n                  className=\"w-8 h-8 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold transition-colors duration-200 flex items-center justify-center\"\r\n                >\r\n                  −\r\n                </button>\r\n                <input\r\n                  type=\"number\"\r\n                  name=\"quantity\"\r\n                  value={quantity}\r\n                  min={1}\r\n                  ref={quantityInputRef}\r\n                  onChange={(e) =>\r\n                    setQuantity(Math.max(1, Number(e.target.value) || 1))\r\n                  }\r\n                  className=\"w-16 px-2 py-1 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-xl text-center text-sm font-semibold focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200\"\r\n                />\r\n                <button\r\n                  onClick={() => setQuantity(quantity + 1)}\r\n                  className=\"w-8 h-8 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold transition-colors duration-200 flex items-center justify-center\"\r\n                >\r\n                  +\r\n                </button>\r\n              </div>\r\n              <Button\r\n                label={\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span>Add to Cart</span>\r\n                    <span className=\"hidden sm:inline-block text-xs font-bold px-1.5 py-0.5 rounded border bg-white/20 border-white/40 text-white\">\r\n                      F4\r\n                    </span>\r\n                  </div>\r\n                }\r\n                onClick={handleAddToCart}\r\n                variant=\"primary\"\r\n                size=\"sm\"\r\n                microinteraction\r\n                icon={\r\n                  <svg\r\n                    className=\"w-3 h-3\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={2}\r\n                      d=\"M12 4v16m8-8H4\"\r\n                    />\r\n                  </svg>\r\n                }\r\n                iconPosition=\"left\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Card>\r\n    );\r\n  }\r\n);\r\n","import { useRef, useEffect } from 'react';\r\n\r\n/**\r\n * Hook to detect hardware barcode scanner input\r\n * Hardware scanners typically send characters very quickly (< 50ms between chars)\r\n * followed by Enter key. This hook helps auto-submit when a scanner is detected.\r\n * \r\n * @param {Function} onScan - Callback when barcode is detected (receives the scanned code)\r\n * @param {Object} options - Configuration options\r\n * @param {number} options.maxDelay - Maximum delay between characters to consider it a scanner (default: 100ms)\r\n * @param {string} options.inputSelector - CSS selector for the input to monitor (optional)\r\n */\r\nexport function useBarcodeScanner(onScan, options = {}) {\r\n  const { maxDelay = 100, inputSelector } = options;\r\n  const lastCharTimeRef = useRef(0);\r\n  const inputValueRef = useRef('');\r\n\r\n  useEffect(() => {\r\n    if (!onScan || typeof onScan !== 'function') {\r\n      return;\r\n    }\r\n\r\n    const handleKeyDown = (e) => {\r\n      // Only handle if target is an input field (or matches selector if provided)\r\n      const target = e.target;\r\n      if (target.tagName !== 'INPUT' && target.tagName !== 'TEXTAREA') {\r\n        return;\r\n      }\r\n\r\n      if (inputSelector && !target.matches(inputSelector)) {\r\n        return;\r\n      }\r\n\r\n      const now = Date.now();\r\n      const timeSinceLastChar = now - lastCharTimeRef.current;\r\n\r\n      // Track the current input value\r\n      inputValueRef.current = target.value || '';\r\n\r\n      // If Enter is pressed\r\n      if (e.key === 'Enter') {\r\n        const currentInput = target.value?.trim() || '';\r\n        \r\n        if (currentInput) {\r\n          // If Enter comes very quickly after the last character (< 200ms), it's likely a scanner\r\n          // Hardware scanners typically send Enter within 50-150ms of the last character\r\n          if (timeSinceLastChar < 200) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            \r\n            // Clear tracking\r\n            lastCharTimeRef.current = 0;\r\n            inputValueRef.current = '';\r\n            \r\n            // Call the scan handler\r\n            onScan(currentInput);\r\n            \r\n            return;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Track character input timing\r\n      // Only track printable characters (not modifiers or special keys)\r\n      if (e.key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey) {\r\n        lastCharTimeRef.current = now;\r\n      }\r\n    };\r\n\r\n    // Use capture phase to catch events early, before React's synthetic events\r\n    // This ensures we can prevent default and stop propagation before React handlers fire\r\n    document.addEventListener('keydown', handleKeyDown, true);\r\n\r\n    return () => {\r\n      document.removeEventListener('keydown', handleKeyDown, true);\r\n    };\r\n  }, [onScan, maxDelay, inputSelector]);\r\n}\r\n","import React, { useState, useEffect, useRef } from \"react\";\r\nimport Card from \"../../common/Card\";\r\nimport Button from \"../../common/Button\";\r\n\r\n/**\r\n * Cart Table Card Component\r\n * Displays cart items in a table format with totals\r\n */\r\nfunction CartTableCard({\r\n  cart,\r\n  handleRemove,\r\n  handleEditQuantity,\r\n  total,\r\n  className = \"\",\r\n  selectedIdx = -1,\r\n  onSelectRow,\r\n  appliedDiscount,\r\n  editingIdx = null,\r\n  editQty = 1,\r\n  onEditQtyChange,\r\n  onEditComplete,\r\n  onStartEdit,\r\n}) {\r\n\r\n  // Handle row click to select item\r\n  const handleRowClick = (idx, e) => {\r\n    if (e.target.tagName !== 'INPUT') { // Don't select row when clicking on input\r\n      onSelectRow?.(idx);\r\n    }\r\n  };\r\n  \r\n  // Handle quantity input change\r\n  const handleQtyChange = (e) => {\r\n    const value = e.target.value;\r\n    // Allow empty string (for backspace/delete) or positive numbers\r\n    if (value === '' || /^\\d+$/.test(value)) {\r\n      onEditQtyChange?.(value === '' ? '' : parseInt(value, 10));\r\n    }\r\n  };\r\n  \r\n  // Handle quantity save\r\n  const handleSaveQuantity = (idx) => {\r\n    const qty = editQty === '' ? 1 : Math.max(1, editQty);\r\n    handleEditQuantity(idx, qty);\r\n    onEditComplete?.();\r\n  };\r\n\r\n  const EditIcon = () => (\r\n    <svg\r\n      width=\"16\"\r\n      height=\"16\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      strokeWidth=\"2\"\r\n      viewBox=\"0 0 24 24\"\r\n    >\r\n      <path d=\"M15.232 5.232l3.536 3.536M9 13l6.586-6.586a2 2 0 1 1 2.828 2.828L11.828 15.828a4 4 0 0 1-1.414.828l-4.243 1.414 1.414-4.243a4 4 0 0 1 .828-1.414z\" />\r\n    </svg>\r\n  );\r\n\r\n  const DeleteIcon = () => (\r\n    <svg\r\n      width=\"16\"\r\n      height=\"16\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      strokeWidth=\"2\"\r\n      viewBox=\"0 0 24 24\"\r\n    >\r\n      <path d=\"M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z\" />\r\n    </svg>\r\n  );\r\n  \r\n  const CheckIcon = () => (\r\n    <svg\r\n      width=\"16\"\r\n      height=\"16\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      strokeWidth=\"2\"\r\n      viewBox=\"0 0 24 24\"\r\n    >\r\n      <path d=\"M5 13l4 4L19 7\" />\r\n    </svg>\r\n  );\r\n  \r\n  const XIcon = () => (\r\n    <svg\r\n      width=\"16\"\r\n      height=\"16\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      strokeWidth=\"2\"\r\n      viewBox=\"0 0 24 24\"\r\n    >\r\n      <path d=\"M18 6L6 18M6 6l12 12\" />\r\n    </svg>\r\n  );\r\n\r\n  return (\r\n    <Card\r\n      className={`flex-1 flex flex-col bg-white/80 backdrop-blur-md border border-white/60 shadow-xl transition-all duration-300 h-full min-h-0 overflow-hidden ${className}`}\r\n      variant=\"glass\"\r\n    >\r\n      <div className=\"flex-1 min-h-0 flex flex-col p-2 sm:p-3\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between mb-2 pb-2 border-b border-gray-200\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <div className=\"w-7 h-7 bg-blue-100 rounded-lg flex items-center justify-center\">\r\n              <svg\r\n                className=\"w-4 h-4 text-blue-600\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"\r\n                />\r\n              </svg>\r\n            </div>\r\n            <h3 className=\"text-sm sm:text-base font-bold text-gray-900\">\r\n              Shopping Cart\r\n            </h3>\r\n          </div>\r\n          <span className=\"text-xs font-semibold text-gray-600 bg-gray-100 px-2 py-0.5 rounded-full\">\r\n            {cart.length} {cart.length === 1 ? \"item\" : \"items\"}\r\n          </span>\r\n        </div>\r\n\r\n        {/* Table Container */}\r\n        <div className=\"flex-1 overflow-auto min-h-0 rounded-lg\">\r\n          <table className=\"w-full\">\r\n            <thead className=\"sticky top-0 z-10 bg-gradient-to-r from-blue-50/90 to-indigo-50/90 backdrop-blur-sm border-b border-blue-100\">\r\n              <tr>\r\n                <th className=\"py-1.5 px-2 text-left text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider\">\r\n                  Product\r\n                </th>\r\n                <th className=\"py-1.5 px-2 text-center text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider\">\r\n                  Qty\r\n                </th>\r\n                <th className=\"py-1.5 px-2 text-right text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider\">\r\n                  Price\r\n                </th>\r\n                <th className=\"py-1.5 px-2 text-right text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider\">\r\n                  Total\r\n                </th>\r\n                <th className=\"py-1.5 px-2 text-center text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider\">\r\n                  Actions\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"divide-y divide-gray-100\">\r\n              {cart.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan={5} className=\"text-center py-8\">\r\n                    <div className=\"flex flex-col items-center justify-center\">\r\n                      <div className=\"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-2\">\r\n                        <svg\r\n                          className=\"w-6 h-6 text-gray-400\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"\r\n                          />\r\n                        </svg>\r\n                      </div>\r\n                      <p className=\"text-gray-500 text-sm font-semibold\">\r\n                        Cart is empty\r\n                      </p>\r\n                      <p className=\"text-gray-400 text-xs mt-1\">\r\n                        Scan or enter products\r\n                      </p>\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                cart.map((item, idx) => (\r\n                  <tr\r\n                    key={idx}\r\n                    className={`hover:bg-blue-50/50 transition-colors duration-200 group ${selectedIdx === idx ? \"bg-blue-100/70 ring-2 ring-blue-300\" : \"\"}`}\r\n                    onClick={(e) => handleRowClick(idx, e)}\r\n                  >\r\n                    <td className=\"py-1.5 px-2\">\r\n                      <div className=\"flex flex-col\">\r\n                        <span className=\"text-xs sm:text-sm font-semibold text-gray-900 group-hover:text-blue-600 transition-colors truncate\">\r\n                          {item.name}\r\n                        </span>\r\n                        <span className=\"text-[10px] text-gray-500 truncate\">\r\n                          SKU: {item.sku || \"N/A\"}\r\n                        </span>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"py-1.5 px-2 text-center\">\r\n                      {editingIdx === idx ? (\r\n                        <div className=\"flex items-center justify-center gap-1\">\r\n                          <input\r\n                            type=\"text\"\r\n                            inputMode=\"numeric\"\r\n                            pattern=\"[0-9]*\"\r\n                            value={editQty}\r\n                            onChange={handleQtyChange}\r\n                            onKeyDown={(e) => {\r\n                              if (e.key === \"Enter\") {\r\n                                handleSaveQuantity(idx);\r\n                              } else if (e.key === \"Escape\") {\r\n                                onEditComplete?.();\r\n                              }\r\n                            }}\r\n                            onBlur={() => handleSaveQuantity(idx)}\r\n                            className=\"w-12 h-7 text-center text-xs font-bold border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                            autoFocus\r\n                            onFocus={(e) => e.target.select()}\r\n                          />\r\n                          <button\r\n                            type=\"button\"\r\n                            onClick={() => handleSaveQuantity(idx)}\r\n                            className=\"p-1 text-green-600 hover:bg-green-100 rounded\"\r\n                            title=\"Save\"\r\n                          >\r\n                            <CheckIcon />\r\n                          </button>\r\n                          <button\r\n                            onClick={() => onEditComplete()}\r\n                            className=\"p-1 text-red-600 hover:bg-red-100 rounded\"\r\n                            title=\"Cancel\"\r\n                          >\r\n                            <XIcon />\r\n                          </button>\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"flex items-center justify-center gap-1\">\r\n                          <span className=\"inline-flex items-center justify-center w-7 h-7 rounded-md bg-blue-100 text-blue-700 font-bold text-xs\">\r\n                            {item.quantity}\r\n                          </span>\r\n                        </div>\r\n                      )}\r\n                    </td>\r\n                    <td className=\"py-1.5 px-2 text-right\">\r\n                      <span className=\"text-xs sm:text-sm font-medium text-gray-700\">\r\n                        ₱{item.price.toFixed(2)}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"py-1.5 px-2 text-right\">\r\n                      <span className=\"text-xs sm:text-sm font-bold text-blue-600\">\r\n                        ₱\r\n                        {(\r\n                          item.price *\r\n                          (editingIdx === idx ? editQty : item.quantity)\r\n                        ).toFixed(2)}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"py-1.5 px-2\">\r\n                      <div className=\"flex items-center justify-center gap-1\">\r\n                        <button\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            onSelectRow?.(idx);\r\n                            onEditQtyChange?.(item.quantity);\r\n                            onStartEdit?.(idx);\r\n                          }}\r\n                          className={`p-1.5 rounded-md transition-all duration-200 ${selectedIdx === idx ? 'bg-blue-100 text-blue-700 border-blue-200' : 'bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200'} border`}\r\n                          title=\"Edit (F1)\"\r\n                          \r\n                        >\r\n                          <div className=\"flex items-center gap-1\">\r\n                            {(\r\n                              <span className=\"hidden sm:inline-block text-[10px] font-bold text-blue-700 bg-blue-100 border border-blue-200 px-1.5 py-0.5 rounded\">F1</span>\r\n                            )}\r\n                            <EditIcon />\r\n                          </div>\r\n                        </button>\r\n                        <button\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            onSelectRow?.(idx);\r\n                            handleRemove(idx);\r\n                          }}\r\n                          className={`p-1.5 rounded-md transition-all duration-200 ${selectedIdx === idx ? 'bg-red-100 text-red-700 border-red-200' : 'bg-red-50 text-red-600 hover:bg-red-100 border-red-200'} border`}\r\n                          title=\"Delete (F2)\"\r\n                        >\r\n                          <div className=\"flex items-center gap-1\">\r\n                            {(\r\n                              <span className=\"hidden sm:inline-block text-[10px] font-bold text-red-700 bg-red-100 border border-red-200 px-1.5 py-0.5 rounded\">F2</span>\r\n                            )}\r\n                            <DeleteIcon />\r\n                          </div>\r\n                        </button>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        {/* Total Footer */}\r\n        <div className=\"mt-2 pt-2 border-t border-gray-200\">\r\n          <div className=\"flex flex-col gap-1\">\r\n            {appliedDiscount && (\r\n              <div className=\"flex justify-between items-center text-xs text-gray-500\">\r\n                <span>Subtotal:</span>\r\n                <span className=\"line-through\">\r\n                  ₱\r\n                  {cart\r\n                    .reduce(\r\n                      (sum, item, idx) =>\r\n                        sum +\r\n                        item.price * (editingIdx === idx ? editQty : item.quantity),\r\n                      0\r\n                    )\r\n                    .toFixed(2)}\r\n                </span>\r\n              </div>\r\n            )}\r\n            <div className=\"flex justify-between items-center\">\r\n              <span className=\"text-sm sm:text-base font-semibold text-gray-700\">\r\n                Total:\r\n              </span>\r\n              <span className=\"text-lg sm:text-xl font-extrabold text-blue-600\">\r\n                ₱{total.toFixed(2)}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Card>\r\n  );\r\n}\r\n\r\nexport default CartTableCard;\r\n","import React, { useState } from \"react\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport Button from \"../common/Button\";\r\nimport { api } from \"../../lib/api\";\r\nimport ScannerCard from \"../ui/POS/ScannerCard\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nfunction PriceCheckModal({ isOpen, onClose, sku, setSku }) {\r\n  const [product, setProduct] = useState(null);\r\n\r\n  const handleCheck = async () => {\r\n    if (!sku) return;\r\n    try {\r\n      const businessId = localStorage.getItem(\"business_id\");\r\n      const query = businessId\r\n        ? `?business_id=${encodeURIComponent(businessId)}`\r\n        : \"\";\r\n      const res = await api(\r\n        `/api/products/public/sku/${encodeURIComponent(sku)}${query}`\r\n      );\r\n      if (res) {\r\n        setProduct({\r\n          name: res.product_name,\r\n          price: Number(res.selling_price || 0),\r\n          sku: res.sku,\r\n        });\r\n      } else {\r\n        setProduct(null);\r\n      }\r\n    } catch (_) {\r\n      setProduct(null);\r\n    }\r\n  };\r\n\r\n  // Auto-fetch on SKU change\r\n  React.useEffect(() => {\r\n    if (!sku) {\r\n      setProduct(null);\r\n      return;\r\n    }\r\n    const t = setTimeout(() => {\r\n      handleCheck();\r\n    }, 200);\r\n    return () => clearTimeout(t);\r\n  }, [sku]);\r\n\r\n  const footerContent = (\r\n    <Button\r\n      label=\"Close (Esc)\"\r\n      variant=\"secondary\"\r\n      onClick={onClose}\r\n      className=\"w-full\"\r\n    />\r\n  );\r\n\r\n  useKeyboardShortcuts(\r\n    [\r\n      {\r\n        key: \"escape\",\r\n        action: onClose,\r\n        enabled: isOpen,\r\n        allowWhileTyping: true,\r\n      },\r\n      {\r\n        key: \"enter\",\r\n        action: handleCheck,\r\n        enabled: isOpen,\r\n        allowWhileTyping: true,\r\n      },\r\n    ],\r\n    [isOpen, sku]\r\n  );\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Price Check\"\r\n      subtitle=\"Scan or enter SKU/barcode\"\r\n      icon={\r\n        <svg\r\n          className=\"w-5 h-5 text-white\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n          />\r\n        </svg>\r\n      }\r\n      footer={footerContent}\r\n      size=\"md\"\r\n      contentClassName=\"space-y-4\"\r\n    >\r\n      {/* Scanner */}\r\n      <div className=\"w-full\">\r\n        <ScannerCard\r\n          onScan={(result) => {\r\n            const code = result?.[0]?.rawValue;\r\n            if (code) {\r\n              setSku(code);\r\n            }\r\n          }}\r\n          paused={false}\r\n          onResume={() => {}}\r\n          className=\"w-full\"\r\n          textMain=\"text-blue-700\"\r\n        />\r\n      </div>\r\n\r\n      {/* Manual Input */}\r\n      <div className=\"w-full\">\r\n        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n          Enter SKU or Barcode\r\n        </label>\r\n        <input\r\n          type=\"text\"\r\n          value={sku}\r\n          onChange={(e) => setSku(e.target.value)}\r\n          className=\"w-full border border-gray-300 rounded-lg px-4 py-2 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n          placeholder=\"Enter SKU or scan barcode\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Check price:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Enter</span>\r\n        </div>\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Close:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Esc</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Results */}\r\n      {product ? (\r\n        <div className=\"w-full bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200/50\">\r\n          <div className=\"text-lg font-semibold text-blue-900 mb-1\">\r\n            {product.name}\r\n          </div>\r\n          <div className=\"text-3xl font-bold text-blue-600 mb-2\">\r\n            ₱{product.price.toFixed(2)}\r\n          </div>\r\n          <div className=\"text-xs text-gray-500\">SKU: {product.sku}</div>\r\n        </div>\r\n      ) : sku ? (\r\n        <div className=\"text-red-500 text-sm text-center py-4\">\r\n          No product found.\r\n        </div>\r\n      ) : null}\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default PriceCheckModal;\r\n","import React, { useEffect, useState, useCallback } from \"react\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport Button from \"../common/Button\";\r\nimport { api } from \"../../lib/api\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nfunction DiscountModal({ isOpen, onClose, onApplyDiscount }) {\r\n  const [showSettings, setShowSettings] = useState(false);\r\n  const [discounts, setDiscounts] = useState([]);\r\n\r\n  const [newDesc, setNewDesc] = useState(\"\");\r\n  const [newValue, setNewValue] = useState(\"\");\r\n  const [selectedIdx, setSelectedIdx] = useState(null);\r\n  const [settingsSelectedIdx, setSettingsSelectedIdx] = useState(0);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [saving, setSaving] = useState(false);\r\n  const [settingsTab, setSettingsTab] = useState(\"PERCENTAGE\");\r\n  \r\n  // State for the custom delete confirmation modal\r\n  const [deleteConfirmation, setDeleteConfirmation] = useState({ \r\n    isOpen: false, \r\n    id: null, \r\n    label: '' \r\n  });\r\n  \r\n  const descInputRef = React.useRef(null);\r\n  const valueInputRef = React.useRef(null);\r\n  const discountListRef = React.useRef(null);\r\n\r\n  // Helper function to check if the event target is a form input\r\n  const isTypingTarget = (el) => {\r\n    if (!el) return false;\r\n    const tag = el.tagName?.toLowerCase();\r\n    return (\r\n      el.isContentEditable ||\r\n      tag === \"input\" ||\r\n      tag === \"textarea\" ||\r\n      el.getAttribute?.(\"role\") === \"textbox\"\r\n    );\r\n  };\r\n\r\n  const handleInputKeyDown = (e, field) => {\r\n    // Handle Escape key first so it always blurs without closing the modal\r\n    if (e.key === \"Escape\") {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      e.target.blur();\r\n      return;\r\n    }\r\n\r\n    // Handle Enter key - add discount if both fields have values\r\n    if (e.key === \"Enter\" && showSettings) {\r\n      if (newDesc && newValue) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        handleAddDiscount();\r\n        return;\r\n      }\r\n    }\r\n\r\n    // For the value field, only allow numbers and control keys\r\n    if (field === 'value') {\r\n      // Allow: backspace, delete, tab, escape, enter, arrows, home, end\r\n      if ([8, 9, 27, 13, 37, 38, 39, 40, 35, 36, 46].includes(e.keyCode) ||\r\n          // Allow: Ctrl+A, Ctrl+C, Ctrl+X, Ctrl+V, Ctrl+Z, Ctrl+Y\r\n          (e.ctrlKey && [65, 67, 88, 86, 90, 89].includes(e.keyCode)) ||\r\n          // Allow: numbers on top of keyboard and numpad\r\n          (e.keyCode >= 48 && e.keyCode <= 57) ||\r\n          (e.keyCode >= 96 && e.keyCode <= 105)) {\r\n        // Let it happen, don't do anything\r\n        return;\r\n      }\r\n      // Ensure that it is a number and stop the keypress\r\n      if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {\r\n        e.preventDefault();\r\n      }\r\n    }\r\n  };\r\n\r\n  // When switching to settings view, focus the name field for immediate typing\r\n  useEffect(() => {\r\n    if (isOpen && showSettings) {\r\n      requestAnimationFrame(() => {\r\n        descInputRef.current?.focus();\r\n        descInputRef.current?.select?.();\r\n      });\r\n    }\r\n  }, [isOpen, showSettings]);\r\n\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    const fetchDiscounts = async () => {\r\n      setLoading(true);\r\n      setError(\"\");\r\n      try {\r\n        const token = sessionStorage.getItem(\"auth_token\");\r\n        const data = await api(\"/api/discounts\", {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        const discountList = (data || []).map(d => ({\r\n          label: d.discount_name || `${d.discount_percentage}% off`,\r\n          value: d.discount_percentage,\r\n          discount_id: d.discount_id,\r\n          type: \"percentage\"\r\n        }));\r\n        \r\n        setDiscounts(discountList);\r\n      } catch (e) {\r\n        setError(\"Failed to load discounts\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchDiscounts();\r\n  }, [isOpen]);\r\n\r\n  const handleAddDiscount = async () => {\r\n    if (!newDesc || !newValue) return;\r\n    setSaving(true);\r\n    try {\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n      const payload = { \r\n        discount_name: newDesc, \r\n        discount_percentage: Number(newValue) \r\n      };\r\n      \r\n      const created = await api(\"/api/discounts\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify(payload),\r\n      });\r\n      \r\n      setDiscounts(prev => [\r\n        ...prev,\r\n        {\r\n          label: created.discount_name || newDesc,\r\n          value: created.discount_percentage,\r\n          discount_id: created.discount_id,\r\n          type: \"percentage\"\r\n        }\r\n      ]);\r\n      \r\n      setNewDesc(\"\");\r\n      setNewValue(\"\");\r\n    } catch (e) {\r\n      console.error(\"Failed to add discount:\", e);\r\n      setError(\"Failed to add discount. Please try again.\");\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * REFACTORED: This function now only sets the state to open the custom confirmation modal.\r\n   * It no longer uses window.confirm.\r\n   */\r\n  const handleRemove = async (discountId) => {\r\n    if (!discountId) return;\r\n    \r\n    const id = Number(discountId);\r\n    if (isNaN(id)) {\r\n      setError(\"Invalid discount ID\");\r\n      return;\r\n    }\r\n    \r\n    const discountToDelete = discounts.find(d => Number(d.discount_id) === id);\r\n    if (!discountToDelete) {\r\n      setError(\"Discount not found in the list\");\r\n      return;\r\n    }\r\n    \r\n    // Open custom confirmation modal\r\n    setDeleteConfirmation({ isOpen: true, id: id, label: discountToDelete.label });\r\n  };\r\n\r\n  const cancelDelete = useCallback(() => {\r\n    setDeleteConfirmation({ isOpen: false, id: null, label: '' });\r\n  }, []);\r\n\r\n  const confirmDelete = async () => {\r\n    const id = deleteConfirmation.id;\r\n    if (!id) return;\r\n\r\n    try {\r\n      setSaving(true);\r\n      setError(\"\");\r\n      \r\n      // Make the API call to delete the discount\r\n      await api(`/api/discounts/${id}`, {\r\n        method: \"DELETE\",\r\n      });\r\n      \r\n      // Update local state to remove the deleted discount\r\n      setDiscounts(prev => {\r\n        const deletedIndex = prev.findIndex(d => Number(d.discount_id) === id);\r\n        const newDiscounts = prev.filter(d => Number(d.discount_id) !== id);\r\n        \r\n        // Adjust selected indices if needed\r\n        if (deletedIndex !== -1) {\r\n          setSelectedIdx(prevIdx => {\r\n            if (prevIdx === deletedIndex) return Math.max(0, deletedIndex - 1);\r\n            if (prevIdx > deletedIndex) return prevIdx - 1;\r\n            return prevIdx;\r\n          });\r\n          \r\n          setSettingsSelectedIdx(prevIdx => {\r\n            if (prevIdx === deletedIndex) return Math.max(0, deletedIndex - 1);\r\n            if (prevIdx > deletedIndex) return prevIdx - 1;\r\n            return prevIdx;\r\n          });\r\n        }\r\n        \r\n        return newDiscounts;\r\n      });\r\n      \r\n      cancelDelete(); // Close the confirmation modal\r\n      \r\n    } catch (error) {\r\n      console.error(\"Failed to remove discount:\", error);\r\n      \r\n      // Handle 404 - discount not found\r\n      if (error.message && error.message.includes(\"not found\")) {\r\n        // Refresh the discount list from the server\r\n        try {\r\n          const token = sessionStorage.getItem(\"auth_token\");\r\n          const data = await api(\"/api/discounts\", {\r\n            headers: { Authorization: `Bearer ${token}` },\r\n          });\r\n          setDiscounts((data || []).map(d => ({\r\n            label: d.discount_name || `${d.discount_percentage}% off`,\r\n            value: d.discount_percentage,\r\n            discount_id: d.discount_id,\r\n            type: \"percentage\"\r\n          })));\r\n          setError(\"Discount not found. List has been refreshed.\");\r\n          cancelDelete(); // Close the confirmation modal even on 404\r\n        } catch (refreshError) {\r\n          console.error(\"Failed to refresh discounts:\", refreshError);\r\n          setError(\"Discount not found. Could not refresh list.\");\r\n        }\r\n      } else {\r\n        // For other errors\r\n        setError(error.message || \"Failed to remove discount. Please try again.\");\r\n      }\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleSaveSettings = () => {\r\n    setShowSettings(false);\r\n  };\r\n\r\n  const handleApplyDiscount = () => {\r\n    if (selectedIdx == null) return;\r\n    const discount = discounts[selectedIdx];\r\n    if (!discount) return;\r\n    onApplyDiscount({\r\n      type: discount.type,\r\n      value: discount.value,\r\n      label: discount.label,\r\n      discount_id: discount.discount_id,\r\n    });\r\n    onClose();\r\n  };\r\n\r\n  const applyDiscountByIndex = (idx) => {\r\n    const discount = discounts[idx];\r\n    if (!discount) return;\r\n    setSelectedIdx(idx);\r\n    onApplyDiscount({\r\n      type: discount.type,\r\n      value: discount.value,\r\n      label: discount.label,\r\n      discount_id: discount.discount_id,\r\n    });\r\n    onClose();\r\n  };\r\n\r\n  // Settings Footer\r\n  const settingsFooterContent = (\r\n    <Button\r\n      label={\r\n        <div className=\"w-full flex items-center justify-between\">\r\n          <span>Save Settings</span>\r\n          <span className=\"text-xs font-mono bg-white/20 px-2 py-0.5 rounded\">\r\n            Enter\r\n          </span>\r\n        </div>\r\n      }\r\n      variant=\"primary\"\r\n      onClick={handleSaveSettings}\r\n      className=\"w-full\"\r\n    />\r\n  );\r\n\r\n  // Main Footer\r\n  const mainFooterContent = (\r\n    <div className=\"w-full space-y-2\">\r\n      <Button\r\n        label={\r\n          <div className=\"w-full flex items-center justify-between\">\r\n            <span>Apply Discount</span>\r\n            <span className=\"text-xs font-mono bg-white/20 px-2 py-0.5 rounded\">\r\n              Enter\r\n            </span>\r\n          </div>\r\n        }\r\n        variant=\"primary\"\r\n        onClick={handleApplyDiscount}\r\n        disabled={selectedIdx === null}\r\n        className=\"w-full\"\r\n      />\r\n      <Button\r\n        label={\r\n          <div className=\"w-full flex items-center justify-between\">\r\n            <span>Manage Discounts</span>\r\n            <span className=\"text-xs font-mono bg-gray-100 px-2 py-0.5 rounded text-gray-700\">\r\n              M\r\n            </span>\r\n          </div>\r\n        }\r\n        variant=\"secondary\"\r\n        onClick={() => setShowSettings(true)}\r\n        className=\"w-full\"\r\n      />\r\n    </div>\r\n  );\r\n\r\n\r\n  // Scroll selected discount into view\r\n  useEffect(() => {\r\n    if (showSettings && discountListRef.current && settingsSelectedIdx !== null) {\r\n      const container = discountListRef.current;\r\n      const selectedElement = container.querySelector(`[data-discount-idx=\"${settingsSelectedIdx}\"]`);\r\n      if (selectedElement) {\r\n        selectedElement.scrollIntoView({\r\n          behavior: 'smooth',\r\n          block: 'nearest',\r\n          inline: 'nearest'\r\n        });\r\n      }\r\n    }\r\n  }, [settingsSelectedIdx, showSettings]);\r\n\r\n  // Auto-clear error messages after 5 seconds\r\n  useEffect(() => {\r\n    if (error) {\r\n      const timer = setTimeout(() => setError(\"\"), 5000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [error]);\r\n\r\n  // Handle keyboard shortcuts\r\n  useKeyboardShortcuts(\r\n    [\r\n      // Escape key - close modal or confirmation modal\r\n      {\r\n        key: \"escape\",\r\n        action: (e) => {\r\n          if (deleteConfirmation.isOpen) {\r\n            cancelDelete();\r\n            return;\r\n          }\r\n          if (isTypingTarget(e?.target)) {\r\n            e.target.blur?.();\r\n            return;\r\n          }\r\n          onClose();\r\n        },\r\n        enabled: isOpen,\r\n        allowWhileTyping: true,\r\n        stopPropagation: true,\r\n        preventDefault: true\r\n      },\r\n      // Enter key - apply, save settings, or add discount depending on context\r\n      {\r\n        key: \"enter\",\r\n        action: (e) => {\r\n          // If confirmation modal is open, confirm deletion\r\n          if (deleteConfirmation.isOpen) {\r\n            e.preventDefault();\r\n            confirmDelete();\r\n            return;\r\n          }\r\n          \r\n          // If we're in an input field, let the default behavior happen (but check for add discount)\r\n          if (isTypingTarget(e?.target)) {\r\n            // If we're in settings view and both fields have content, add a new discount\r\n            if (showSettings && newDesc && newValue) {\r\n              e.preventDefault();\r\n              handleAddDiscount();\r\n            }\r\n            return;\r\n          }\r\n          \r\n          // In settings view, save settings\r\n          if (showSettings) {\r\n            e.preventDefault();\r\n            handleSaveSettings();\r\n            return;\r\n          }\r\n          \r\n          // In main view, apply the selected discount\r\n          handleApplyDiscount();\r\n        },\r\n        enabled: isOpen,\r\n        allowWhileTyping: true,\r\n        stopPropagation: true,\r\n        preventDefault: true\r\n      },\r\n      // M key - toggle manage discounts\r\n      {\r\n        key: \"m\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target) || deleteConfirmation.isOpen) return;\r\n          setShowSettings((prev) => !prev);\r\n        },\r\n        enabled: isOpen,\r\n        allowWhileTyping: false,\r\n        stopPropagation: true,\r\n        preventDefault: true\r\n      },\r\n      // Number keys 1-9 - select and apply discount (only when not typing)\r\n      ...Array.from({ length: 9 }).map((_, i) => ({\r\n        key: String(i + 1),\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target) || deleteConfirmation.isOpen) return;\r\n          if (!showSettings && discounts[i]) {\r\n            applyDiscountByIndex(i);\r\n          }\r\n        },\r\n        enabled: isOpen && !showSettings && discounts[i],\r\n        allowWhileTyping: false,\r\n        stopPropagation: true,\r\n        preventDefault: true\r\n      })),\r\n      // Arrow navigation for main list (ignore while typing)\r\n      {\r\n        key: \"arrowup\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target) || deleteConfirmation.isOpen) return;\r\n          if (showSettings || discounts.length === 0) return;\r\n          setSelectedIdx((prev) => {\r\n            if (prev == null) return 0;\r\n            return prev > 0 ? prev - 1 : 0;\r\n          });\r\n        },\r\n        enabled: isOpen && !showSettings,\r\n        allowWhileTyping: false,\r\n        stopPropagation: true,\r\n        preventDefault: true,\r\n      },\r\n      {\r\n        key: \"arrowdown\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target) || deleteConfirmation.isOpen) return;\r\n          if (showSettings || discounts.length === 0) return;\r\n          setSelectedIdx((prev) => {\r\n            if (prev == null) return 0;\r\n            return Math.min(prev + 1, discounts.length - 1);\r\n          });\r\n        },\r\n        enabled: isOpen && !showSettings,\r\n        allowWhileTyping: false,\r\n        stopPropagation: true,\r\n        preventDefault: true,\r\n      },\r\n      // Focus description field\r\n      {\r\n        key: \"n\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target) && e.target !== descInputRef.current) return;\r\n          if (!showSettings || deleteConfirmation.isOpen) return;\r\n          setTimeout(() => {\r\n            descInputRef.current?.focus();\r\n            descInputRef.current?.select?.();\r\n          }, 0);\r\n        },\r\n        enabled: isOpen && showSettings,\r\n        allowWhileTyping: true,\r\n        stopPropagation: false,\r\n        preventDefault: false,\r\n      },\r\n      // Focus value field\r\n      {\r\n        key: \"v\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target) && e.target !== valueInputRef.current) return;\r\n          if (!showSettings || deleteConfirmation.isOpen) return;\r\n          setTimeout(() => {\r\n            valueInputRef.current?.focus();\r\n            valueInputRef.current?.select?.();\r\n          }, 0);\r\n        },\r\n        enabled: isOpen && showSettings,\r\n        allowWhileTyping: true,\r\n        stopPropagation: false,\r\n        preventDefault: false,\r\n      },\r\n      // Manage: navigate rows (ignore while typing in inputs)\r\n      {\r\n        key: \"arrowup\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target) || deleteConfirmation.isOpen) return;\r\n          if (!showSettings || discounts.length === 0) return;\r\n          setSettingsSelectedIdx((prev) => Math.max(0, prev - 1));\r\n        },\r\n        enabled: isOpen && showSettings,\r\n        allowWhileTyping: false,\r\n        stopPropagation: true,\r\n        preventDefault: true,\r\n      },\r\n      {\r\n        key: \"arrowdown\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target) || deleteConfirmation.isOpen) return;\r\n          if (!showSettings || discounts.length === 0) return;\r\n          setSettingsSelectedIdx((prev) =>\r\n            Math.min(discounts.length - 1, (prev ?? 0) + 1)\r\n          );\r\n        },\r\n        enabled: isOpen && showSettings,\r\n        allowWhileTyping: false,\r\n        stopPropagation: true,\r\n        preventDefault: true,\r\n      },\r\n      // Manage: delete focused row (ignore while typing)\r\n      {\r\n        key: \"delete\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target) || deleteConfirmation.isOpen) return;\r\n          if (!showSettings || discounts.length === 0) return;\r\n          const target = discounts[settingsSelectedIdx];\r\n          if (target?.discount_id) handleRemove(target.discount_id);\r\n        },\r\n        enabled: isOpen && showSettings,\r\n        allowWhileTyping: false,\r\n        stopPropagation: true,\r\n        preventDefault: true,\r\n      },\r\n    ],\r\n    [\r\n      isOpen,\r\n      showSettings,\r\n      discounts,\r\n      selectedIdx,\r\n      handleApplyDiscount,\r\n      handleSaveSettings,\r\n      onClose,\r\n      settingsSelectedIdx,\r\n      handleAddDiscount,\r\n      deleteConfirmation.isOpen,\r\n      confirmDelete,\r\n      cancelDelete,\r\n    ]\r\n  );\r\n\r\n  // Main Discount Modal\r\n  const renderMain = () => {\r\n    return (\r\n      <div className=\"space-y-4\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h3 className=\"text-lg font-medium\">Select Discount</h3>\r\n        </div>\r\n        <div className=\"grid grid-cols-3 gap-2 mb-4 max-h-64 overflow-y-auto\">\r\n          {discounts.map((d, idx) => (\r\n            <button\r\n              key={`${d.type}-${idx}`}\r\n              className={`p-3 border rounded text-center ${\r\n                selectedIdx === idx\r\n                  ? \"border-blue-500 bg-blue-50\"\r\n                  : \"border-gray-200 hover:bg-gray-50\"\r\n              } relative group`}\r\n              onClick={() => setSelectedIdx(idx)}\r\n            >\r\n              <div className=\"font-medium\">{d.label}</div>\r\n              <div className=\"text-sm text-gray-500\">{d.value}%</div>\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Settings Modal Content\r\n  const renderSettings = () => (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"flex gap-2\">\r\n        <button\r\n          className={`flex-1 px-4 py-2 rounded-lg font-semibold text-sm transition-all ${\r\n            settingsTab === \"PERCENTAGE\" ? \"bg-blue-600 text-white\" : \"bg-gray-200 text-gray-700\"\r\n          }`}\r\n          onClick={() => setSettingsTab(\"PERCENTAGE\")}\r\n        >\r\n          Percentage\r\n        </button>\r\n      </div>\r\n\r\n      {/* Discount List */}\r\n      <div \r\n        ref={discountListRef}\r\n        className=\"space-y-2 max-h-60 overflow-y-auto pr-2 -mr-2\"\r\n      >\r\n        {discounts.map((d, idx) => (\r\n          <div\r\n            key={idx}\r\n            data-discount-idx={idx}\r\n            className={`flex gap-2 items-center bg-gray-50 p-3 rounded-lg transition-all ${\r\n              settingsSelectedIdx === idx ? \"ring-2 ring-blue-400 bg-blue-50\" : \"hover:bg-gray-100\"\r\n            }`}\r\n          >\r\n            <input\r\n              className=\"flex-1 bg-transparent outline-none text-sm font-medium\"\r\n              value={d.label}\r\n              readOnly\r\n            />\r\n            <input\r\n              className=\"w-20 bg-transparent text-center outline-none text-sm font-medium\"\r\n              value={d.value}\r\n              readOnly\r\n            />\r\n            <button\r\n              className=\"text-red-500 hover:text-red-700 transition-colors p-1\"\r\n              onClick={() => handleRemove(d.discount_id)}\r\n              title=\"Remove (Del)\"\r\n              type=\"button\"\r\n            >\r\n              <svg\r\n                xmlns=\"http://www.w3.org/2000/svg\"\r\n                className=\"w-5 h-5\"\r\n                fill=\"none\"\r\n                viewBox=\"0 0 24 24\"\r\n                stroke=\"currentColor\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M6 18L18 6M6 6l12 12\"\r\n                />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Add new discount */}\r\n      <div\r\n        className=\"space-y-2 p-4 bg-blue-50 rounded-lg border border-blue-200\"\r\n        onKeyDown={(e) => {\r\n          if (e.key === \"Enter\") {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            handleAddDiscount();\r\n          }\r\n        }}\r\n      >\r\n        <div className=\"text-sm font-semibold text-blue-900 mb-2\">\r\n          Add New Discount (N=Name, V=Value, Enter=Add)\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <input\r\n            className=\"flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n            placeholder=\"Description\"\r\n            value={newDesc}\r\n            ref={descInputRef}\r\n            onKeyDown={(e) => handleInputKeyDown(e, 'desc')}\r\n            onFocus={() => setShowSettings(true)} // Ensure we're in settings mode when focused\r\n            onChange={(e) => setNewDesc(e.target.value)}\r\n          />\r\n          <input\r\n            className=\"w-24 border border-gray-300 rounded-lg px-3 py-2 text-sm text-center focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n            placeholder={settingsTab === \"PERCENTAGE\" ? \"0%\" : \"0.00\"}\r\n            inputMode={settingsTab === \"PERCENTAGE\" ? \"numeric\" : \"decimal\"}\r\n            value={newValue}\r\n            ref={valueInputRef}\r\n            onKeyDown={(e) => handleInputKeyDown(e, 'value')}\r\n            onFocus={() => setShowSettings(true)} // Ensure we're in settings mode when focused\r\n            onChange={(e) => setNewValue(e.target.value)}\r\n            type=\"number\"\r\n            min=\"0\"\r\n          />\r\n          <button\r\n            className=\"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-bold\"\r\n            onClick={handleAddDiscount}\r\n            title=\"Add (Enter)\"\r\n            type=\"button\"\r\n            disabled={saving}\r\n          >\r\n            {saving ? \"...\" : \"+\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <>\r\n      {/* Primary Discount Modal */}\r\n      <BaseModal\r\n        isOpen={isOpen && !deleteConfirmation.isOpen} // Only open if delete modal is not open\r\n        onClose={onClose}\r\n        title={showSettings ? \"Manage Discounts\" : \"Select Discount\"}\r\n        subtitle={\r\n          showSettings\r\n            ? \"Add or remove discount options\"\r\n            : \"Choose a discount to apply\"\r\n        }\r\n        icon={\r\n          <svg\r\n            className=\"w-5 h-5 text-white\"\r\n            fill=\"none\"\r\n            stroke=\"currentColor\"\r\n            viewBox=\"0 0 24 24\"\r\n          >\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\"\r\n            />\r\n          </svg>\r\n        }\r\n        footer={showSettings ? settingsFooterContent : mainFooterContent}\r\n        size=\"md\"\r\n        contentClassName=\"space-y-4\"\r\n      >\r\n        {error && (\r\n          <div className=\"text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg px-3 py-2\">\r\n            {error}\r\n          </div>\r\n        )}\r\n        {showSettings ? renderSettings() : renderMain()}\r\n        \r\n        {/* Keyboard Shortcuts Guide */}\r\n        <div className=\"mt-4 pt-3 border-t border-gray-200\">\r\n          <div className=\"text-xs text-gray-500 space-y-1\">\r\n            {showSettings ? (\r\n              <>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span>Move selection:</span>\r\n                  <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">↑ ↓</span>\r\n                </div>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span>Delete selected:</span>\r\n                  <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">Del</span>\r\n                </div>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span>Focus name / value:</span>\r\n                  <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">N / V</span>\r\n                </div>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span>Add/Save:</span>\r\n                  <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">Enter</span>\r\n                </div>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span>Select discount:</span>\r\n                  <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">1-9 / ↑↓</span>\r\n                </div>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span>Apply selected:</span>\r\n                  <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">Enter</span>\r\n                </div>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span>Manage discounts:</span>\r\n                  <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">M</span>\r\n                </div>\r\n              </>\r\n            )}\r\n            <div className=\"flex items-center justify-between pt-1 border-t border-gray-100 mt-1\">\r\n              <span>Close modal:</span>\r\n              <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">Esc</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </BaseModal>\r\n\r\n      {/* Custom Delete Confirmation Modal */}\r\n      <BaseModal\r\n        isOpen={deleteConfirmation.isOpen}\r\n        onClose={cancelDelete}\r\n        title=\"Confirm Discount Deletion\"\r\n        subtitle=\"This action cannot be undone.\"\r\n        size=\"sm\"\r\n        footer={\r\n          <div className=\"flex justify-end space-x-2 w-full\">\r\n            <Button \r\n              label=\"Cancel\" \r\n              variant=\"secondary\" \r\n              onClick={cancelDelete} \r\n              disabled={saving}\r\n            />\r\n            <Button \r\n              label={saving ? \"Deleting...\" : \"Delete Discount\"} \r\n              variant=\"danger\" \r\n              onClick={confirmDelete} \r\n              disabled={saving}\r\n            />\r\n          </div>\r\n        }\r\n      >\r\n        <div className=\"p-4 bg-red-50 border border-red-200 rounded-lg\">\r\n          <p className=\"text-sm text-red-700\">\r\n            Are you sure you want to permanently delete the discount: \r\n            <strong className=\"block mt-1 text-base font-semibold\">{deleteConfirmation.label}</strong>\r\n          </p>\r\n        </div>\r\n      </BaseModal>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default DiscountModal;","import React, { useState, useEffect } from \"react\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport Button from \"../common/Button\";\r\nimport { api } from \"../../lib/api\";\r\nimport {\r\n  MdAccountBalanceWallet,\r\n  MdSwapHoriz,\r\n  MdDescription,\r\n  MdChevronRight,\r\n} from \"react-icons/md\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nfunction CashLedgerModal({ isOpen, onClose }) {\r\n  // Tab state: \"SUMMARY\" or \"TRANSACTIONS\"\r\n  const [tab, setTab] = useState(\"SUMMARY\");\r\n  // Track which payment type is selected for filtered transactions view\r\n  const [selectedPaymentType, setSelectedPaymentType] = useState(null);\r\n\r\n  // Live data from backend\r\n  const [ledger, setLedger] = useState([]); // [{ name, balance }]\r\n  const [transactions, setTransactions] = useState([]);\r\n  const [loadingSummary, setLoadingSummary] = useState(false);\r\n  const [loadingTx, setLoadingTx] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n\r\n\r\n  // Fetch summary balances\r\n  const fetchLedger = async () => {\r\n    setLoadingSummary(true);\r\n    try {\r\n      setError(\"\");\r\n      const data = await api('/stats/cash-ledger');\r\n      // Expecting [{ name, balance }]\r\n      setLedger(Array.isArray(data) ? data : []);\r\n    } catch (err) {\r\n      setError(err.message || 'Failed to load cash ledger');\r\n    } finally {\r\n      setLoadingSummary(false);\r\n    }\r\n  };\r\n\r\n  // Fetch transactions (optionally filtered)\r\n  const fetchTransactions = async (paymentType = null) => {\r\n    setLoadingTx(true);\r\n    try {\r\n      setError(\"\");\r\n      const q = paymentType ? `/stats/cash-transactions?payment_type=${encodeURIComponent(paymentType)}&limit=100` : `/stats/cash-transactions?limit=100`;\r\n      const data = await api(q);\r\n      setTransactions(Array.isArray(data) ? data : []);\r\n    } catch (err) {\r\n      setError(err.message || 'Failed to load transactions');\r\n    } finally {\r\n      setLoadingTx(false);\r\n    }\r\n  };\r\n\r\n  // Load when modal opens\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    fetchLedger();\r\n    fetchTransactions();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [isOpen]);\r\n\r\n  useKeyboardShortcuts(\r\n    [\r\n      {\r\n        key: \"escape\",\r\n        action: onClose,\r\n        enabled: isOpen,\r\n        allowWhileTyping: true,\r\n      },\r\n      {\r\n        key: \"1\",\r\n        action: () => {\r\n          setTab(\"SUMMARY\");\r\n          setSelectedPaymentType(null);\r\n        },\r\n        enabled: isOpen,\r\n      },\r\n      {\r\n        key: \"2\",\r\n        action: () => {\r\n          setTab(\"TRANSACTIONS\");\r\n          setSelectedPaymentType(null);\r\n        },\r\n        enabled: isOpen,\r\n      },\r\n    ],\r\n    [isOpen, tab]\r\n  );\r\n\r\n  // Summary Page Component\r\n  const renderSummary = () => {\r\n    const totalCash = ledger.reduce((sum, type) => sum + (Number(type.balance) || 0), 0);\r\n\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        {/* Total Cash Display */}\r\n        <div className=\"bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-700 text-white rounded-lg shadow-xl px-8 py-8 text-center\">\r\n          <p className=\"text-sm font-semibold text-blue-100 mb-2\">Total Cash on Hand</p>\r\n          <div className=\"text-5xl font-bold flex items-center justify-center gap-2\">\r\n            <span className=\"text-4xl\">₱</span>\r\n            {totalCash.toFixed(2)}\r\n          </div>\r\n          <p className=\"text-blue-100 text-sm mt-3\">\r\n            {new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}\r\n          </p>\r\n        </div>\r\n\r\n        {/* Payment Types Section */}\r\n        <div>\r\n          <div className=\"flex items-center gap-2 mb-4\">\r\n            <div className=\"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center\">\r\n              <MdAccountBalanceWallet className=\"w-5 h-5 text-white\" />\r\n            </div>\r\n            <h3 className=\"font-semibold text-gray-900\">Payment Methods</h3>\r\n          </div>\r\n          <div className=\"space-y-3\">\r\n            {loadingSummary ? (\r\n              <div className=\"text-sm text-gray-500\">Loading...</div>\r\n            ) : ledger.length === 0 ? (\r\n              <div className=\"text-sm text-gray-500\">No balances available</div>\r\n            ) : (\r\n              ledger.map((type) => (\r\n                <button\r\n                  key={type.name}\r\n                  onClick={async () => {\r\n                    setSelectedPaymentType(type.name);\r\n                    setTab('TRANSACTIONS');\r\n                    await fetchTransactions(type.name);\r\n                  }}\r\n                  className=\"w-full bg-gradient-to-r from-gray-50 to-gray-100/50 hover:from-blue-50 hover:to-indigo-50/50 rounded-2xl p-4 border border-gray-200/50 hover:border-blue-300 transition-all duration-200 group\"\r\n                >\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-3 flex-1\">\r\n                      <div className=\"w-10 h-10 bg-white rounded-lg flex items-center justify-center border border-gray-200 group-hover:border-blue-300 group-hover:bg-blue-50 transition-all\">\r\n                        <svg className=\"w-5 h-5 text-gray-600 group-hover:text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                        </svg>\r\n                      </div>\r\n                      <div className=\"text-left\">\r\n                        <p className=\"font-semibold text-gray-900\">{type.name}</p>\r\n                        <p className=\"text-xs text-gray-500\">View transactions</p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"text-right\">\r\n                        <p className=\"text-lg font-bold text-blue-600\">₱{(Number(type.balance) || 0).toFixed(2)}</p>\r\n                      </div>\r\n                      <MdChevronRight className=\"w-5 h-5 text-gray-400 group-hover:text-blue-600 transition-colors\" />\r\n                    </div>\r\n                  </div>\r\n                </button>\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n        {error && (\r\n          <div className=\"text-sm text-red-600\">\r\n            {error.includes('Server returned an HTML error page') || error.includes('Cannot GET')\r\n              ? 'Unable to reach backend API. Check backend server and proxy configuration.'\r\n              : error}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Transactions Page\r\n  const renderTransactions = () => {\r\n    return (\r\n      <div className=\"space-y-4\">\r\n        {/* Transactions Title */}\r\n        <div className=\"bg-gradient-to-r from-indigo-50 to-blue-50 rounded-2xl p-4 border border-indigo-100/50\">\r\n          <h3 className=\"font-bold text-lg text-gray-900\">{selectedPaymentType ? `${selectedPaymentType} Transactions` : 'All Transactions'}</h3>\r\n          <p className=\"text-sm text-gray-600 mt-1\">{loadingTx ? 'Loading...' : `${transactions.length} transaction${transactions.length !== 1 ? 's' : ''} found`}</p>\r\n        </div>\r\n\r\n        {/* Transactions Table */}\r\n        <div className=\"bg-white rounded-2xl border border-gray-200/50 overflow-hidden\">\r\n          {loadingTx ? (\r\n            <div className=\"text-center py-12 text-sm text-gray-500\">Loading transactions...</div>\r\n          ) : transactions.length === 0 ? (\r\n            <div className=\"text-center py-12\">\r\n              <svg className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n              </svg>\r\n              <p className=\"text-gray-500 font-medium\">No transactions found</p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"w-full\">\r\n                <thead>\r\n                  <tr className=\"bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200/50\">\r\n                    <th className=\"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider\">Date & Time</th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider\">Type</th>\r\n                    <th className=\"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider\">Amount</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"divide-y divide-gray-100\">\r\n                  {transactions.map((tx) => (\r\n                    <tr key={String(tx.transaction_id)} className=\"hover:bg-blue-50/50 transition-colors duration-150\">\r\n                      <td className=\"px-6 py-4 text-sm text-gray-600 font-medium\">{new Date(tx.created_at).toLocaleString()}</td>\r\n                      <td className=\"px-6 py-4 text-sm\"><span className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 border border-blue-200\">{tx.payment_type}</span></td>\r\n                      <td className=\"px-6 py-4 text-sm text-right font-bold text-green-600\">₱{(Number(tx.total) || 0).toFixed(2)}</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Tab button content\r\n  const tabContent = (\r\n    <div className=\"flex gap-2 border-t border-gray-200/50 pt-4 mt-4\">\r\n      <button\r\n        onClick={() => {\r\n          setTab(\"SUMMARY\");\r\n          setSelectedPaymentType(null);\r\n        }}\r\n        className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-semibold transition-all ${\r\n          tab === \"SUMMARY\"\r\n            ? \"bg-blue-600 text-white shadow-md\"\r\n            : \"bg-gray-100 text-gray-700 hover:bg-gray-200\"\r\n        }`}\r\n      >\r\n        <MdDescription className=\"w-5 h-5\" />\r\n        <span>Summary (1)</span>\r\n      </button>\r\n      <button\r\n        onClick={() => {\r\n          setTab(\"TRANSACTIONS\");\r\n          setSelectedPaymentType(null);\r\n        }}\r\n        className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-semibold transition-all ${\r\n          tab === \"TRANSACTIONS\"\r\n            ? \"bg-blue-600 text-white shadow-md\"\r\n            : \"bg-gray-100 text-gray-700 hover:bg-gray-200\"\r\n        }`}\r\n      >\r\n        <MdSwapHoriz className=\"w-5 h-5\" />\r\n        <span>Transactions (2)</span>\r\n      </button>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Cash Ledger\"\r\n      subtitle=\"View cash balance and payment methods\"\r\n      icon={<MdAccountBalanceWallet className=\"w-6 h-6 text-white\" />}\r\n      size=\"lg\"\r\n      contentClassName=\"space-y-4\"\r\n    >\r\n      <div className=\"space-y-6\">\r\n        {tab === \"SUMMARY\" ? renderSummary() : renderTransactions()}\r\n        {tabContent}\r\n        <div className=\"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <span>Summary view:</span>\r\n            <span className=\"font-mono bg-white px-2 py-0.5 rounded\">1</span>\r\n          </div>\r\n          <div className=\"flex items-center justify-between\">\r\n            <span>Transactions view:</span>\r\n            <span className=\"font-mono bg-white px-2 py-0.5 rounded\">2</span>\r\n          </div>\r\n          <div className=\"flex items-center justify-between\">\r\n            <span>Close:</span>\r\n            <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Esc</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default CashLedgerModal;\r\n","import React from \"react\";\r\nimport Button from \"../common/Button\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nfunction CheckoutModal({ isOpen, onClose, total, onSelectPayment }) {\r\n  useKeyboardShortcuts(\r\n    [\r\n      { key: \"1\", action: () => onSelectPayment(\"cash\"), enabled: isOpen },\r\n      { key: \"2\", action: () => onSelectPayment(\"gcash\"), enabled: isOpen },\r\n      { key: \"3\", action: () => onSelectPayment(\"maya\"), enabled: isOpen },\r\n      { key: \"enter\", action: () => onSelectPayment(\"cash\"), enabled: isOpen },\r\n      { key: \"escape\", action: onClose, enabled: isOpen },\r\n    ],\r\n    [isOpen]\r\n  );\r\n\r\n  const footerContent = (\r\n    <div className=\"w-full flex flex-col gap-3\">\r\n      <Button\r\n        label=\"CASH (1 / Enter)\"\r\n        className=\"w-full h-12 text-base font-bold\"\r\n        onClick={() => onSelectPayment(\"cash\")}\r\n      />\r\n      <Button\r\n        label=\"GCASH (2)\"\r\n        className=\"w-full h-12 text-base font-bold\"\r\n        onClick={() => onSelectPayment(\"gcash\")}\r\n      />\r\n      <Button\r\n        label=\"MAYA (3)\"\r\n        className=\"w-full h-12 text-base font-bold\"\r\n        onClick={() => onSelectPayment(\"maya\")}\r\n      />\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Checkout\"\r\n      subtitle=\"Select payment method\"\r\n      icon={\r\n        <svg\r\n          className=\"w-5 h-5 text-white\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"\r\n          />\r\n        </svg>\r\n      }\r\n      footer={footerContent}\r\n      size=\"sm\"\r\n      contentClassName=\"text-center\"\r\n    >\r\n      <div className=\"bg-blue-500 text-white rounded-2xl py-6 px-4 text-center mb-4\">\r\n        <div className=\"text-sm opacity-90 mb-2\">Total Amount</div>\r\n        <div className=\"text-4xl font-bold\">₱{total.toFixed(2)}</div>\r\n      </div>\r\n      <p className=\"text-gray-600 text-sm mb-4\">\r\n        Choose your preferred payment method\r\n      </p>\r\n      <div className=\"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 space-y-1\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Cash:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">1 / Enter</span>\r\n        </div>\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>GCash:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">2</span>\r\n        </div>\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Maya:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">3</span>\r\n        </div>\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Close:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Esc</span>\r\n        </div>\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default CheckoutModal;\r\n","import React from \"react\";\r\nimport Button from \"../common/Button\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nfunction CashPaymentCompleteModal({\r\n  isOpen,\r\n  onClose,\r\n  change = 0,\r\n  payable = 0,\r\n  onReceipt,\r\n  onNewEntry,\r\n}) {\r\n  useKeyboardShortcuts(\r\n    [\r\n      {\r\n        key: \"escape\",\r\n        action: onClose,\r\n        enabled: isOpen,\r\n        allowWhileTyping: true,\r\n      },\r\n      {\r\n        key: \"enter\",\r\n        action: () => {\r\n          if (onReceipt) onReceipt();\r\n        },\r\n        enabled: isOpen,\r\n        allowWhileTyping: true,\r\n      },\r\n    ],\r\n    [isOpen]\r\n  );\r\n\r\n  const footerContent = (\r\n    <div className=\"w-full flex flex-col gap-3\">\r\n      <Button\r\n        label=\"RECEIPT (Enter)\"\r\n        className=\"w-full h-11 text-sm font-semibold bg-blue-700 hover:bg-blue-800 text-white\"\r\n        onClick={() => {\r\n          if (onReceipt) onReceipt();\r\n          else alert(\"Receipt\");\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Payment Complete\"\r\n      icon={\r\n        <svg\r\n          className=\"w-5 h-5 text-white\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M5 13l4 4L19 7\"\r\n          />\r\n        </svg>\r\n      }\r\n      footer={footerContent}\r\n      size=\"sm\"\r\n      contentClassName=\"text-center space-y-4\"\r\n    >\r\n      {/* Success Check Icon */}\r\n      <div className=\"flex justify-center mb-2\">\r\n        <div className=\"w-14 h-14 rounded-full bg-green-100 flex items-center justify-center\">\r\n          <svg\r\n            xmlns=\"http://www.w3.org/2000/svg\"\r\n            className=\"h-7 w-7 text-green-600\"\r\n            fill=\"none\"\r\n            viewBox=\"0 0 24 24\"\r\n            stroke=\"currentColor\"\r\n          >\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              d=\"M5 13l4 4L19 7\"\r\n            />\r\n          </svg>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Change Amount */}\r\n      <div className=\"bg-gradient-to-br from-blue-400 to-indigo-500 rounded-2xl p-5 text-white\">\r\n        <div className=\"text-xs uppercase tracking-wide opacity-90 mb-2\">\r\n          Change\r\n        </div>\r\n\r\n        <div className=\"inline-flex items-baseline gap-2 bg-white text-blue-700 rounded-lg px-4 py-3 shadow-md\">\r\n          <span className=\"text-lg font-bold\">₱</span>\r\n          <span className=\"text-2xl font-bold\">\r\n            {Number(change).toFixed(2)}\r\n          </span>\r\n        </div>\r\n\r\n        <div className=\"mt-4 text-sm opacity-90\">Payable</div>\r\n        <div className=\"text-sm font-semibold\">\r\n          ₱{Number(payable).toFixed(2)}\r\n        </div>\r\n      </div>\r\n      <div className=\"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 space-y-1\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Print / open receipt:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Enter</span>\r\n        </div>\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Close:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Esc</span>\r\n        </div>\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default CashPaymentCompleteModal;\r\n","import React, { useState, useRef } from \"react\";\r\nimport Button from \"../common/Button\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport CashPaymentCompleteModal from \"./CashPaymentCompleteModal\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nfunction CashPaymentModal({ isOpen, onClose, total, onConfirm }) {\r\n  const [amountReceived, setAmountReceived] = useState(\"\");\r\n  const [showComplete, setShowComplete] = useState(false);\r\n  const [completeData, setCompleteData] = useState(null);\r\n  const [showErrorModal, setShowErrorModal] = useState(false);\r\n  const [errorMessage, setErrorMessage] = useState(\"\");\r\n  const amountInputRef = useRef(null);\r\n  const justSetExactAmount = useRef(false);\r\n\r\n  const handleQuickAmount = (val) => setAmountReceived(Number(val).toString());\r\n\r\n  const handleExactAmount = (e) => {\r\n    if (e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n    // Set as a number to avoid string formatting issues\r\n    const exactAmount = Number(total).toFixed(2);\r\n    setAmountReceived(exactAmount);\r\n    justSetExactAmount.current = true;\r\n    // Reset the flag after a short delay\r\n    setTimeout(() => {\r\n      justSetExactAmount.current = false;\r\n    }, 200);\r\n  };\r\n\r\n  const handleProceed = (e) => {\r\n    if (e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n    \r\n    // Get the current value from the input element directly (more reliable than state)\r\n    const inputValue = amountInputRef.current?.value || amountReceived;\r\n    \r\n    // If we just set exact amount, use the total directly\r\n    let amountToUse = inputValue;\r\n    if (justSetExactAmount.current) {\r\n      amountToUse = Number(total).toFixed(2);\r\n    }\r\n    \r\n    // Trim and parse the input value\r\n    const trimmedAmount = (amountToUse?.toString() || \"\").trim();\r\n    if (!trimmedAmount) {\r\n      alert(\"Please enter an amount.\");\r\n      return;\r\n    }\r\n    const received = Number(trimmedAmount);\r\n    if (isNaN(received) || received <= 0) {\r\n      alert(\"Please enter a valid amount.\");\r\n      return;\r\n    }\r\n    // Round both values to 2 decimal places to avoid floating-point precision issues\r\n    const receivedRounded = Math.round(received * 100) / 100;\r\n    const totalRounded = Math.round(total * 100) / 100;\r\n    if (receivedRounded < totalRounded) {\r\n      setErrorMessage(`Amount received (₱${receivedRounded.toFixed(2)}) must be greater than or equal to total (₱${totalRounded.toFixed(2)}).`);\r\n      setShowErrorModal(true);\r\n      return;\r\n    }\r\n    // compute change and show completion modal; delay calling parent onConfirm\r\n    // so cashier can view the completion screen before the app navigates\r\n    const change = Math.max(0, receivedRounded - totalRounded);\r\n    setCompleteData({ change, payable: totalRounded, received: receivedRounded });\r\n    setShowComplete(true);\r\n  };\r\n  \r\n  // Handle completion modal close\r\n  const handleCompleteClose = () => {\r\n    setShowComplete(false);\r\n    if (onClose) onClose();\r\n  };\r\n  \r\n  // Handle new entry from completion modal\r\n  const handleNewEntry = () => {\r\n    setShowComplete(false);\r\n    setAmountReceived(\"\");\r\n    if (onClose) onClose();\r\n  };\r\n  \r\n  // Handle receipt printing from completion modal\r\n  const handleReceipt = () => {\r\n    if (onConfirm && completeData?.received != null) {\r\n      onConfirm(Number(completeData.received));\r\n    }\r\n  };\r\n\r\n  // Error modal shortcuts\r\n  useKeyboardShortcuts(\r\n    [\r\n      {\r\n        key: \"escape\",\r\n        action: () => setShowErrorModal(false),\r\n        enabled: showErrorModal,\r\n        allowWhileTyping: true,\r\n      },\r\n      {\r\n        key: \"enter\",\r\n        action: (e) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          setShowErrorModal(false);\r\n        },\r\n        enabled: showErrorModal,\r\n        allowWhileTyping: true,\r\n      },\r\n    ],\r\n    [showErrorModal]\r\n  );\r\n\r\n  // Only set up keyboard shortcuts when not showing completion modal\r\n  // Hooks must be called before any early returns\r\n  useKeyboardShortcuts(\r\n    [\r\n      {\r\n        key: \"escape\",\r\n        action: onClose,\r\n        enabled: isOpen && !showComplete && !showErrorModal,\r\n        allowWhileTyping: true,\r\n      },\r\n      {\r\n        key: \"enter\",\r\n        action: (e) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          handleProceed(e);\r\n        },\r\n        enabled: isOpen && !showComplete && !showErrorModal,\r\n        allowWhileTyping: true,\r\n      },\r\n      {\r\n        key: \"e\",\r\n        action: handleExactAmount,\r\n        enabled: isOpen && !showComplete && !showErrorModal,\r\n        allowWhileTyping: true,\r\n      },\r\n    ],\r\n    [isOpen, amountReceived, total, showComplete, showErrorModal]\r\n  );\r\n  \r\n  // Early return if not open and not showing completion modal\r\n  if (!isOpen && !showComplete) return null;\r\n  \r\n  // Render completion modal if needed\r\n  if (showComplete) {\r\n    return (\r\n      <CashPaymentCompleteModal\r\n        isOpen={showComplete}\r\n        onClose={handleCompleteClose}\r\n        change={completeData?.change}\r\n        payable={completeData?.payable}\r\n        onNewEntry={handleNewEntry}\r\n        onReceipt={handleReceipt}\r\n      />\r\n    );\r\n  }\r\n\r\n  const footerContent = (\r\n    <>\r\n      <Button\r\n        label=\"Cancel (Esc)\"\r\n        variant=\"secondary\"\r\n        onClick={onClose}\r\n        type=\"button\"\r\n        className=\"flex-1\"\r\n      />\r\n      <Button\r\n        label=\"Proceed (Enter)\"\r\n        variant=\"primary\"\r\n        type=\"button\"\r\n        onClick={handleProceed}\r\n        className=\"flex-1\"\r\n      />\r\n    </>\r\n  );\r\n\r\n  return (\r\n    <>\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Cash Payment\"\r\n      subtitle=\"Enter amount received\"\r\n      icon={\r\n        <svg\r\n          className=\"w-5 h-5 text-white\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n          />\r\n        </svg>\r\n      }\r\n      footer={footerContent}\r\n      size=\"md\"\r\n      contentClassName=\"space-y-4\"\r\n    >\r\n      {/* Total Amount */}\r\n      <div className=\"bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-2xl py-6 px-4 text-center\">\r\n        <div className=\"text-sm opacity-90 mb-2\">Total Amount</div>\r\n        <div className=\"text-4xl font-bold\">₱{total.toFixed(2)}</div>\r\n      </div>\r\n\r\n      {/* Input */}\r\n      <div>\r\n        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n          Amount Received\r\n        </label>\r\n        <input\r\n          ref={amountInputRef}\r\n          type=\"number\"\r\n          step=\"0.01\"\r\n          className=\"w-full border border-gray-300 rounded-lg px-3 py-2 text-center text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n          placeholder=\"₱0.00\"\r\n          value={amountReceived}\r\n          onChange={(e) => {\r\n            // Allow empty string or valid numbers\r\n            const value = e.target.value;\r\n            if (value === '' || /^\\d*\\.?\\d*$/.test(value)) {\r\n              setAmountReceived(value);\r\n            }\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      {/* Quick Select Buttons */}\r\n      <div>\r\n        <p className=\"text-xs text-gray-600 mb-2\">Quick amounts:</p>\r\n        <div className=\"grid grid-cols-3 gap-2\">\r\n          {[100, 200, 300, 400, 500, 600, 700, 800, 900].map((val) => (\r\n            <button\r\n              key={val}\r\n              className=\"bg-blue-100 hover:bg-blue-200 text-blue-700 font-bold py-2 rounded-lg transition-colors text-sm\"\r\n              onClick={() => handleQuickAmount(val)}\r\n            >\r\n              {val}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Exact Amount Button */}\r\n      <Button\r\n        label=\"Use Exact Amount (E)\"\r\n        className=\"w-full h-10 text-sm font-bold bg-slate-600 hover:bg-slate-700 text-white\"\r\n        onClick={handleExactAmount}\r\n      />\r\n      <div className=\"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 space-y-1\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Use exact total:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">E</span>\r\n        </div>\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Proceed:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Enter</span>\r\n        </div>\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Close:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Esc</span>\r\n        </div>\r\n      </div>\r\n    </BaseModal>\r\n\r\n    {/* Error Modal */}\r\n    <BaseModal\r\n        isOpen={showErrorModal}\r\n        onClose={() => setShowErrorModal(false)}\r\n        title=\"Insufficient Amount\"\r\n        size=\"sm\"\r\n        headerIconBgClassName=\"bg-red-500\"\r\n        icon={\r\n          <svg className=\"w-5 h-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" />\r\n          </svg>\r\n        }\r\n        footer={\r\n          <Button\r\n            label=\"OK (Enter)\"\r\n            variant=\"primary\"\r\n            onClick={() => setShowErrorModal(false)}\r\n            className=\"w-full bg-red-600 hover:bg-red-700\"\r\n          />\r\n        }\r\n      >\r\n        <div className=\"text-center py-4\">\r\n          <p className=\"text-gray-700 text-lg font-medium\">{errorMessage}</p>\r\n          <p className=\"text-gray-500 text-sm mt-2\">Please enter a valid amount.</p>\r\n        </div>\r\n      </BaseModal>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default CashPaymentModal;\r\n","import React, { useState } from \"react\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport ScannerCard from \"../ui/POS/ScannerCard\";\r\nimport Button from \"../common/Button\";\r\nimport { api } from \"../../lib/api\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nexport default function ScanCustomerCartModal({ isOpen, onClose, onImport }) {\r\n  const [scannerPaused, setScannerPaused] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const token = sessionStorage.getItem(\"auth_token\");\r\n\r\n  const user = JSON.parse(sessionStorage.getItem(\"user\") || \"{}\");\r\n\r\n  const handleScan = async (result) => {\r\n    const code = result?.[0]?.rawValue;\r\n    if (!code) return;\r\n    setScannerPaused(true);\r\n    setError(\"\");\r\n    try {\r\n      let payload;\r\n      try {\r\n        payload = JSON.parse(code);\r\n      } catch (e) {\r\n        throw new Error(\"Invalid QR payload\");\r\n      }\r\n      \r\n      // Check if this is a cart QR code with transaction ID\r\n      if (payload.t === 'cart' && payload.transaction_id) {\r\n        const { transaction_id, business_id: businessId } = payload;\r\n        \r\n        // Verify business ID matches if provided\r\n        const cashierBusinessId = user?.businessId || user?.business_id;\r\n        if (businessId && cashierBusinessId && Number(businessId) !== Number(cashierBusinessId)) {\r\n          throw new Error(\"This QR code is not valid for this store.\");\r\n        }\r\n\r\n        // Complete the existing transaction instead of creating a new one\r\n        try {\r\n          const response = await api(`/api/sales/${transaction_id}/complete`, {\r\n            method: 'POST',\r\n            headers: { Authorization: `Bearer ${token}` },\r\n          });\r\n          \r\n          if (response.transaction_id) {\r\n            // Transaction completed successfully - navigate to receipt\r\n            onClose();\r\n            // Navigate to receipt page for cashier\r\n            window.location.href = `/receipt?tn=${response.transaction_number}`;\r\n            return;\r\n          } else {\r\n            throw new Error(\"Failed to complete transaction\");\r\n          }\r\n        } catch (err) {\r\n          console.error('Error completing transaction:', err);\r\n          throw new Error(err.message || \"Failed to complete customer transaction\");\r\n        }\r\n      }\r\n      // Existing cart import logic for backward compatibility\r\n      else if (payload.t === 'cart' && Array.isArray(payload.items)) {\r\n        const { items: compactItems, b: businessId } = payload;\r\n        const cashierBusinessId = user?.businessId || user?.business_id;\r\n\r\n        if (businessId && cashierBusinessId && Number(businessId) !== Number(cashierBusinessId)) {\r\n          throw new Error(\"This QR code is not valid for this store.\");\r\n        }\r\n\r\n        const fullItems = [];\r\n        for (const it of compactItems) {\r\n          if (!it?.p || !it?.q) continue;\r\n          const product = await api(`/api/products/${encodeURIComponent(it.p)}`, {\r\n            headers: { Authorization: `Bearer ${token}` },\r\n          });\r\n          fullItems.push({\r\n            product_id: product.product_id,\r\n            sku: product.sku,\r\n            name: product.product_name,\r\n            quantity: Number(it.q),\r\n            price: Number(product.selling_price || 0)\r\n          });\r\n        }\r\n        if (fullItems.length === 0) throw new Error(\"No items to import\");\r\n        onImport(fullItems);\r\n        onClose();\r\n      } else {\r\n        throw new Error(\"Unsupported QR code format\");\r\n      }\r\n    } catch (e) {\r\n      setError(e.message || \"Failed to process QR code\");\r\n      console.error('Scan error:', e);\r\n    } finally {\r\n      // Resume scanner after a delay to allow error message to be visible\r\n      setTimeout(() => {\r\n        setScannerPaused(false);\r\n      }, 500);\r\n    }\r\n  };\r\n\r\n  const footerContent = (\r\n    <Button\r\n      label=\"Close (Esc)\"\r\n      variant=\"secondary\"\r\n      onClick={onClose}\r\n      className=\"w-full\"\r\n    />\r\n  );\r\n\r\n  useKeyboardShortcuts(\r\n    [{ key: \"escape\", action: onClose, enabled: isOpen }],\r\n    [isOpen]\r\n  );\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Scan Customer Cart\"\r\n      subtitle=\"Ask customer to show their QR\"\r\n      icon={\r\n        <svg\r\n          className=\"w-5 h-5 text-white\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M12 4v16m8-8H4\"\r\n          />\r\n        </svg>\r\n      }\r\n      footer={footerContent}\r\n      size=\"lg\"\r\n      contentClassName=\"space-y-3\"\r\n    >\r\n      <div className=\"text-blue-800 text-sm font-medium\">\r\n        Ask the customer to show their cart QR code\r\n      </div>\r\n      <div className=\"h-[50vh]\">\r\n        <ScannerCard\r\n          onScan={handleScan}\r\n          paused={scannerPaused}\r\n          onResume={() => setScannerPaused(false)}\r\n          className=\"w-full h-full\"\r\n        />\r\n      </div>\r\n      {error && (\r\n        <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm\">\r\n          {error}\r\n        </div>\r\n      )}\r\n      <div className=\"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Close:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Esc</span>\r\n        </div>\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n"],"names":["SkuFormCard","React","forwardRef","sku","setSku","quantity","setQuantity","handleAddToCart","quantityInputRef","className","ref","isProcessingScanRef","useRef","onScan","options","maxDelay","inputSelector","lastCharTimeRef","inputValueRef","useEffect","handleKeyDown","e","target","tagName","matches","now","Date","timeSinceLastChar","current","value","key","currentInput","trim","preventDefault","stopPropagation","length","ctrlKey","metaKey","altKey","document","addEventListener","removeEventListener","useBarcodeScanner","scannedCode","setTimeout","jsx","Card","variant","children","jsxs","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","type","name","onChange","onKeyPress","autoComplete","autoFocus","placeholder","onClick","Math","max","min","Number","Button","label","size","microinteraction","icon","iconPosition","CartTableCard","cart","handleRemove","handleEditQuantity","total","selectedIdx","onSelectRow","appliedDiscount","editingIdx","editQty","onEditQtyChange","onEditComplete","onStartEdit","handleRowClick","handleQtyChange","test","parseInt","handleSaveQuantity","idx","qty","EditIcon","width","height","DeleteIcon","CheckIcon","XIcon","colSpan","map","item","inputMode","pattern","onKeyDown","onBlur","onFocus","select","title","price","toFixed","reduce","sum","PriceCheckModal","isOpen","onClose","product","setProduct","useState","handleCheck","async","businessId","localStorage","getItem","query","encodeURIComponent","res","api","product_name","selling_price","_","t","clearTimeout","footerContent","useKeyboardShortcuts","action","enabled","allowWhileTyping","BaseModal","subtitle","footer","contentClassName","ScannerCard","result","code","rawValue","paused","onResume","textMain","DiscountModal","onApplyDiscount","showSettings","setShowSettings","discounts","setDiscounts","newDesc","setNewDesc","newValue","setNewValue","setSelectedIdx","settingsSelectedIdx","setSettingsSelectedIdx","loading","setLoading","error","setError","saving","setSaving","settingsTab","setSettingsTab","deleteConfirmation","setDeleteConfirmation","id","descInputRef","valueInputRef","discountListRef","isTypingTarget","el","tag","toLowerCase","isContentEditable","getAttribute","handleInputKeyDown","field","blur","handleAddDiscount","includes","keyCode","shiftKey","requestAnimationFrame","focus","token","sessionStorage","discountList","headers","Authorization","discount_name","discount_percentage","discount_id","fetchDiscounts","payload","created","method","body","JSON","stringify","prev","discountId","isNaN","discountToDelete","find","cancelDelete","useCallback","confirmDelete","deletedIndex","findIndex","newDiscounts","filter","prevIdx","message","data","refreshError","handleSaveSettings","handleApplyDiscount","discount","settingsFooterContent","mainFooterContent","disabled","selectedElement","querySelector","scrollIntoView","behavior","block","inline","timer","Array","from","i","String","applyDiscountByIndex","Fragment","readOnly","xmlns","CashLedgerModal","tab","setTab","selectedPaymentType","setSelectedPaymentType","ledger","setLedger","transactions","setTransactions","loadingSummary","setLoadingSummary","loadingTx","setLoadingTx","fetchTransactions","paymentType","q","isArray","err","fetchLedger","tabContent","MdDescription","MdSwapHoriz","MdAccountBalanceWallet","renderSummary","totalCash","balance","toLocaleDateString","weekday","year","month","day","MdChevronRight","tx","created_at","toLocaleString","payment_type","transaction_id","CheckoutModal","onSelectPayment","CashPaymentCompleteModal","change","payable","onReceipt","onNewEntry","CashPaymentModal","onConfirm","amountReceived","setAmountReceived","showComplete","setShowComplete","completeData","setCompleteData","showErrorModal","setShowErrorModal","errorMessage","setErrorMessage","amountInputRef","justSetExactAmount","handleExactAmount","exactAmount","handleProceed","amountToUse","trimmedAmount","toString","alert","received","receivedRounded","round","totalRounded","handleCompleteClose","handleNewEntry","handleReceipt","step","val","handleQuickAmount","headerIconBgClassName","ScanCustomerCartModal","onImport","scannerPaused","setScannerPaused","user","parse","Error","business_id","cashierBusinessId","response","window","location","href","transaction_number","items","compactItems","b","fullItems","it","p","push","product_id"],"mappings":"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"}