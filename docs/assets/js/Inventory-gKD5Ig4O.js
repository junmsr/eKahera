import{j as e}from"./utils-BnCj7yKo.js";import{a as t}from"./vendor-BZrj58oz.js";import{P as s}from"./PageLayout-BDjxz-BI.js";import{N as r}from"./Nav-Admin-CjcDScE1.js";import{I as i}from"./Inventory-DS4UXkMs.js";import{M as o}from"./Modal-DN9ByPMZ.js";import{a as n,c as a,b as l}from"./index-EFVr_f9Q.js";import{E as c}from"./jspdf.es.min-DD5NndP4.js";import{d}from"./dayjs.min-DVXthx_5.js";import"./BaseModal-C-8Qp-dk.js";import"./Input-D3kbgyHK.js";import"./qr-DN-bNBye.js";import{u}from"./useDebounce-CoebmKoV.js";import"./Navbar-B0P6rb1A.js";import"./Logo-D8ieW5c6.js";import"./PrivacyPolicyModal-BXX2vyb1.js";import"./Card-fMjg4IWJ.js";import"./FormField-1uEQplD4.js";import"./ScannerCard-D8nNyNYr.js";const m=[],p=[],h=10;function g(e){const t={"Grocery Store":["Fresh Produce","Meat & Poultry","Seafood","Dairy & Eggs","Bread & Bakery","Snacks & Chips","Beverages","Canned & Packaged Goods","Frozen Food","Rice, Pasta & Grains","Condiments & Spices","Cleaning Supplies","Household Essentials","Baby Products","Pet Supplies"],Pharmacy:["Prescription Medicines","OTC Medicines","Vitamins & Supplements","First Aid Supplies","Medical Devices","Personal Care","Hygiene Products","Beauty & Cosmetics","Baby Care","Adult Care","PPE & Sanitizers"],"Clothing Store":["Men’s Clothing","Women’s Clothing","Kids’ Clothing","Baby Clothing","Footwear","Bags & Accessories","Underwear & Socks"],"Electronics Store":["Mobile Devices","Computers & Laptops","Computer Accessories","Phone Accessories","Audio Devices","Cameras & Photography","Home Appliances","Personal Appliances","Gaming Consoles & Accessories","Cables, Adapters & Chargers"],Bookstore:["Fiction Books","Non-Fiction Books","Educational Books","Children’s Books","Comics & Manga","School Supplies","Art Materials","Office Supplies","Stationery & Gifts"],"Convenience Store":["Snacks","Beverages","Ready-to-Eat Food","Instant Noodles / Cup Meals","Frozen Food","Basic Grocery Items","Toiletries","Basic OTC Medicines","Household Essentials","Phone Load","Ice Cream & Desserts","Tobacco & Lighters"],Others:["General"]};return t[e]||t.Others}function x({isOpen:t,onClose:s,successCount:r,errors:i}){if(!t)return null;const o=i&&i.length>0;return e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:s,"aria-hidden":"true"}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col z-10",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:`bg-gradient-to-r ${o?"from-yellow-50 via-yellow-50/80 to-orange-50/50 border-b border-yellow-100":"from-green-50 via-green-50/80 to-emerald-50/50 border-b border-green-100"} px-6 py-5 rounded-t-2xl flex items-center justify-between`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 bg-gradient-to-br ${o?"from-yellow-500 to-orange-600":"from-green-500 to-emerald-600"} rounded-xl flex items-center justify-center shadow-lg`,children:o?e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}):e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:o?"Import Completed with Warnings":"Import Successful"}),e.jsx("p",{className:"text-sm text-gray-600",children:o?"Some products were imported with errors":"All products imported successfully"})]})]}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-all duration-200 p-2 rounded-xl",type:"button","aria-label":"Close modal",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"overflow-y-auto flex-1 px-6 py-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:`bg-gradient-to-r ${o?"from-yellow-50 to-orange-50":"from-green-50 to-emerald-50"} border-l-4 ${o?"border-yellow-500":"border-green-500"} rounded-lg p-4`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex-shrink-0 w-10 h-10 ${o?"bg-yellow-100":"bg-green-100"} rounded-full flex items-center justify-center`,children:e.jsx("span",{className:"text-lg font-bold "+(o?"text-yellow-700":"text-green-700"),children:r})}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm font-semibold "+(o?"text-yellow-800":"text-green-800"),children:[r," ",1===r?"product":"products"," imported successfully"]})})]})}),o&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-red-800 mb-2",children:[i.length," ",1===i.length?"error":"errors"," encountered:"]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto space-y-1",children:[i.slice(0,10).map((t,s)=>e.jsx("p",{className:"text-xs text-red-700 font-mono bg-red-100 px-2 py-1 rounded",children:t},s)),i.length>10&&e.jsxs("p",{className:"text-xs text-red-600 italic mt-2",children:["... and ",i.length-10," more error",i.length-10>1?"s":""]})]})]})]})}),e.jsx("div",{className:"sticky bottom-0 px-6 py-4 bg-gradient-to-t from-slate-50 via-white to-transparent border-t border-slate-200/10 flex justify-end gap-3 backdrop-blur-sm",children:e.jsx(l,{onClick:s,variant:"primary",children:"OK"})})]})]})}function y({isOpen:s,onClose:r,onImport:i,loading:o,error:n}){const[a,c]=t.useState(null),[d,u]=t.useState(!1),[m,p]=t.useState(null),h=t.useRef(null);return s?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:r,"aria-hidden":"true"}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-xl max-h-[90vh] overflow-hidden flex flex-col z-10",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 via-blue-50/80 to-indigo-50/50 border-b border-blue-100 px-6 py-5 rounded-t-2xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Import Products from CSV"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Upload a CSV file to import products"})]})]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-all duration-200 p-2 rounded-xl",type:"button",disabled:o,"aria-label":"Close modal",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"overflow-y-auto flex-1 px-6 py-6",children:d?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"bg-gradient-to-r from-red-50 via-red-50/80 to-orange-50/50 border-l-4 border-red-500 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Warning"}),e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:"This action cannot be undone. Importing products will add them to your inventory."}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Are you sure you want to proceed with importing ",e.jsx("strong",{children:a?.name}),"?"]})]})]})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Select CSV File"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors",children:[e.jsx("input",{ref:h,type:"file",accept:".csv,text/csv",onChange:e=>{const t=e.target.files[0];if(!t)return;if(!t.name.toLowerCase().endsWith(".csv")&&"text/csv"!==t.type)return void alert("Please select a CSV file");c(t),u(!1),p(null);const s=new FileReader;s.onload=e=>{p(e.target.result)},s.onerror=()=>{alert("Failed to read file"),c(null)},s.readAsText(t)},className:"hidden",id:"csv-file-input",disabled:o}),e.jsxs("label",{htmlFor:"csv-file-input",className:"cursor-pointer flex flex-col items-center gap-2",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("span",{className:"text-sm text-gray-600",children:a?a.name:"Click to browse or drag and drop"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Only CSV files are accepted"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-800 mb-2",children:"Required CSV Columns:"}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[e.jsx("li",{children:"• sku"}),e.jsx("li",{children:"• name"}),e.jsx("li",{children:"• category"}),e.jsx("li",{children:"• description"}),e.jsx("li",{children:"• product sold by"}),e.jsx("li",{children:"• unit size"}),e.jsx("li",{children:"• unit"}),e.jsx("li",{children:"• quantity"}),e.jsx("li",{children:"• cost price"}),e.jsx("li",{children:"• selling price"}),e.jsx("li",{children:"• low stock alert"})]})]}),n&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-red-700",children:n})})]})}),e.jsx("div",{className:"sticky bottom-0 px-6 py-4 bg-gradient-to-t from-slate-50 via-white to-transparent border-t border-slate-200/10 flex justify-end gap-3 backdrop-blur-sm",children:d?e.jsxs(e.Fragment,{children:[e.jsx(l,{onClick:()=>{u(!1)},variant:"secondary",disabled:o,children:"Cancel"}),e.jsx(l,{onClick:()=>{m&&(i(m),u(!1),c(null),p(null),h.current&&(h.current.value=""))},variant:"danger",disabled:o,loading:o,children:"Proceed"})]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{onClick:r,variant:"secondary",disabled:o,children:"Cancel"}),e.jsx(l,{onClick:()=>{a&&m?u(!0):alert("Please select a CSV file first")},variant:"primary",disabled:!a||o,loading:o,children:"Import"})]})})]})]}):null}function b(){const[b,_]=t.useState(m),[v,f]=t.useState(()=>{try{let t=null;try{t="undefined"!=typeof window&&sessionStorage.getItem("business_type")||null}catch(e){t=null}if(!t&&"undefined"!=typeof window)try{const s=sessionStorage.getItem("user")||localStorage.getItem("user");if(s){const r=JSON.parse(s);if(t=r?.business?.business_type||r?.business_type||null,t)try{sessionStorage.setItem("business_type",t)}catch(e){}}}catch(e){t=null}t=t||"Others";return(g(t)||[]).map((e,t)=>({id:t+1,name:e}))}catch{return p}}),[k,j]=t.useState(!1),[w,N]=t.useState(!1),[S,C]=t.useState(null),[L,F]=t.useState({sku:"",name:"",category:"",customCategory:"",description:"",quantity:"",cost_price:"",selling_price:"",low_stock_level:h}),[P,q]=t.useState({sku:"",quantity:""}),[T,M]=t.useState(!1),[I,O]=t.useState(""),E=u(I,400),[$,z]=t.useState(10),[B,W]=t.useState(1),[A,D]=t.useState(""),[V,U]=t.useState(!1),[R,K]=t.useState(null),[Y,G]=t.useState(!1),[Q,H]=t.useState(null),[J,X]=t.useState(!1),[Z,ee]=t.useState(!1),[te,se]=t.useState(!1),[re,ie]=t.useState(!1),[oe,ne]=t.useState({successCount:0,errors:[]});t.useEffect(()=>{(async()=>{try{M(!0),D("");const t=sessionStorage.getItem("auth_token"),s=await n("/api/auth/profile",{headers:a(t)}),r=s?.business?.business_type||"Others";try{"undefined"!=typeof window&&sessionStorage.setItem("business_type",r)}catch(e){console.debug("Could not persist business_type",e)}const i=g(r);f(i.map((e,t)=>({id:t+1,name:e})));const o=await n("/api/inventory",{headers:a(t),params:{limit:1e3,offset:0}}),l=(o?.products||o||[]||[]).map(e=>({id:String(e.id||""),name:e.name||"-",category:e.category||"-",quantity:Number(e.quantity||0),cost_price:Number(e.cost_price||0),selling_price:Number(e.selling_price||0),sku:e.sku||"",description:e.description||"",low_stock_level:Number(e.low_stock_level??h),product_type:e.product_type||"count",quantity_per_unit:Number(e.quantity_per_unit||1),base_unit:e.base_unit||"pc",display_unit:e.display_unit||null}));_(l)}catch(t){D("Failed to load inventory"),_([])}finally{M(!1)}})()},[]);const ae=(e,t,s,r)=>{if(!e||0===e)return 0;if("count"===t||!t)return e;if("volume"===t&&"L"===r){const t=e/1e3;if(s&&s>0){const i=t/s;return i>1e5&&console.error(`[Inventory Conversion Error] Unusually large display quantity calculated: ${i.toFixed(2)}. quantityInBaseUnits: ${e}, quantityPerUnit: ${s}, baseUnit: ${r}. This suggests incorrect data storage.`),i}return t}return s&&s>0?e/s:e},le=b.map(e=>e.id),ce=le.filter((e,t)=>le.indexOf(e)!==t);ce.length>0&&console.warn("⚠️ Found duplicate products in array:",ce);const de=b.reduce((e,t)=>{const s=ae(t.quantity,t.product_type,t.quantity_per_unit,t.base_unit),r=Number(t.cost_price||0),i=r*s;return"volume"===t.product_type&&"L"===t.base_unit&&console.log(`[Inventory Value Debug] Product: ${t.name} (ID: ${t.id})`,{quantity_in_stock_base_units:t.quantity,quantity_per_unit:t.quantity_per_unit,base_unit:t.base_unit,display_qty_calculated:s,cost_price:r,item_value:i}),i>1e6&&(console.error(`❌ CRITICAL: Unusually high inventory value for product "${t.name}" (ID: ${t.id}): ₱${i.toLocaleString()}`),console.error(`   Details: quantity=${t.quantity}, cost_price=${r}, displayQty=${s.toFixed(2)}, quantity_per_unit=${t.quantity_per_unit}, base_unit=${t.base_unit}`),console.error("   This suggests incorrect data. Please check the product's quantity_in_stock in the database.")),e+i},0);console.log(`[Inventory Total Debug] Total inventory value: ₱${de.toLocaleString()}`),console.log(`[Inventory Total Debug] Number of products: ${b.length}`);const ue=b.map(e=>{const t=ae(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit),s=t*(e.cost_price||0);return{id:e.id,name:e.name,quantity:e.quantity,displayQty:parseFloat(t.toFixed(2)),costPrice:e.cost_price,value:s,product_type:e.product_type,base_unit:e.base_unit,quantity_per_unit:e.quantity_per_unit}}).sort((e,t)=>t.value-e.value);console.log("[Inventory Total Debug] Breakdown by product (sorted by value):",ue);const me=b.reduce((e,t)=>e+ae(t.quantity,t.product_type,t.quantity_per_unit,t.base_unit)*(t.cost_price||0),0);console.log(`[Inventory Total Debug] Sum verification: ₱${me.toLocaleString()}`),Math.abs(de-me)>.01&&console.error(`❌ DISCREPANCY DETECTED: Calculated total (${de}) doesn't match sum verification (${me})`),de>1e6&&(console.warn(`⚠️ WARNING: Total inventory value is unusually high: ₱${de.toLocaleString()}`),console.warn("   Top 3 products by value:",ue.slice(0,3)));const pe=b.filter(e=>ae(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit)<Number(e.low_stock_level??h)).length,he=[{label:"TOTAL ITEMS",value:b.length,icon:e.jsx("svg",{width:"32",height:"32",fill:"none",stroke:"#2563eb",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),color:"text-blue-800",sub:"Total products in inventory"},{label:"INVENTORY VALUE",value:de,icon:e.jsx("svg",{width:"32",height:"32",fill:"none",stroke:"#2563eb",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),color:"text-green-700",formatValue:e=>(console.log(`[Format Value] Formatting inventory value: ${e} -> ₱${e.toLocaleString(void 0,{minimumFractionDigits:2})}`),`₱${e.toLocaleString(void 0,{minimumFractionDigits:2})}`),sub:"Total value of all stock"},{label:"AVAILABLE CATEGORIES",value:v.length,icon:e.jsx("svg",{width:"32",height:"32",fill:"none",stroke:"#2563eb",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M4 7h16M4 12h16M4 17h16"})}),color:"text-blue-500",sub:"Product categories"},{label:"LOW STOCK ALERTS",value:pe,icon:e.jsx("svg",{width:"32",height:"32",fill:"none",stroke:"#2563eb",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),color:"text-orange-600",sub:"Items needing restock"}],[ge,xe]=t.useState("name"),[ye,be]=t.useState("asc"),[_e,ve]=t.useState(null),[fe,ke]=t.useState(null),je=t.useMemo(()=>{let e=b.filter(e=>e.name.toLowerCase().includes(E.toLowerCase())||e.category.toLowerCase().includes(E.toLowerCase())||e.description.toLowerCase().includes(E.toLowerCase()));return _e&&(e=e.filter(e=>e.category===_e)),fe&&("out_of_stock"===fe?e=e.filter(e=>0===ae(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit)):"low_stock"===fe?e=e.filter(e=>{const t=ae(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit),s=Number(e.low_stock_level??h);return t>0&&t<s}):"in_stock"===fe&&(e=e.filter(e=>ae(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit)>=Number(e.low_stock_level??h)))),e.sort((e,t)=>{let s,r;if("name"===ge)s=(e.name||"").toLowerCase(),r=(t.name||"").toLowerCase();else if("category"===ge)s=(e.category||"").toLowerCase(),r=(t.category||"").toLowerCase();else if("quantity"===ge)s=ae(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit),r=ae(t.quantity,t.product_type,t.quantity_per_unit,t.base_unit);else{if("selling_price"!==ge)return 0;s=Number(e.selling_price||0),r=Number(t.selling_price||0)}return s<r?"asc"===ye?-1:1:s>r?"asc"===ye?1:-1:0}),e},[b,E,_e,fe,ge,ye]),we=Math.ceil(je.length/$)||1,Ne=je.slice((B-1)*$,B*$),Se=t.useCallback(()=>{C(null),F({sku:"",name:"",category:"",customCategory:"",description:"",quantity:"",cost_price:"",selling_price:"",low_stock_level:h,product_sold_by:"Per Piece",unit_size:"",unit:""}),j(!0)},[]),Ce=t.useCallback(e=>{C(e);let t="Per Piece";"weight"===e.product_type?t="By Weight":"volume"===e.product_type&&(t="By Volume"),F({...e,name:e.name||"",sku:e.sku||"",category:e.category||"",description:e.description||"",cost_price:e.cost_price||"",selling_price:e.selling_price||"",low_stock_level:"number"==typeof e.low_stock_level?e.low_stock_level:h,product_sold_by:t,unit_size:e.quantity_per_unit?String(e.quantity_per_unit):"",unit:e.base_unit&&"pc"!==e.base_unit?e.base_unit:"weight"===e.product_type?"g":"volume"===e.product_type?"mL":""}),j(!0)},[]),Le=t.useCallback(e=>{q({sku:e?.sku||"",quantity:""}),N(!0)},[]),Fe=t.useCallback(e=>{const{name:t,value:s}=e.target;("clearError"===t||A&&"clearError"!==t)&&D(""),"clearError"!==t&&F(e=>{const r={...e,[t]:s};return"product_sold_by"===t&&("By Weight"===s||"By Volume"===s?(r.unit&&""!==r.unit||(r.unit="By Weight"===s?"g":"mL"),r.unit_size&&""!==r.unit_size||(S&&S.quantity_per_unit?r.unit_size=String(S.quantity_per_unit):r.unit_size="By Weight"===s?"100":"250")):"Per Piece"===s&&(r.unit_size="",r.unit="")),r})},[A,S]),Pe=t.useCallback(async e=>{e.preventDefault();try{M(!0),D("");const e=sessionStorage.getItem("auth_token");S?await n(`/api/inventory/${S.id}`,{method:"PUT",headers:{"Content-Type":"application/json",...a(e)},body:JSON.stringify({product_name:(L.name||"").trim(),cost_price:Number(L.cost_price)||0,selling_price:Number(L.selling_price)||0,sku:(L.sku||"").trim(),low_stock_level:Number(L.low_stock_level)||h,category:"Others"===L.category?(L.customCategory||"").trim():(L.category||"").trim(),description:(L.description||"").trim(),product_sold_by:L.product_sold_by||"Per Piece",unit_size:L.unit_size?Number(L.unit_size):void 0,unit:L.unit||void 0})}):await n("/api/products",{method:"POST",headers:{"Content-Type":"application/json",...a(e)},body:JSON.stringify({product_category_id:null,category:"Others"===L.category?(L.customCategory||"").trim():(L.category||"").trim(),product_name:(L.name||"").trim(),name:(L.name||"").trim(),description:(L.description||"").trim(),cost_price:Number(L.cost_price)||0,selling_price:Number(L.selling_price)||0,price:Number(L.selling_price)||0,sku:(L.sku||"").trim()||`SKU-${Date.now()}`,quantity:Number(L.quantity)||0,low_stock_level:Number(L.low_stock_level)||h,product_sold_by:L.product_sold_by||"Per Piece",unit_size:L.unit_size?Number(L.unit_size):void 0,unit:L.unit||void 0})});const t=await n("/api/inventory",{headers:a(e),params:{limit:1e3,offset:0}}),s=(t?.products||t||[]||[]).map(e=>({id:String(e.id||""),name:e.name||"-",category:e.category||"-",quantity:Number(e.quantity||0),cost_price:Number(e.cost_price||0),selling_price:Number(e.selling_price||0),sku:e.sku||"",description:e.description||"",low_stock_level:Number(e.low_stock_level??h),product_type:e.product_type||"count",quantity_per_unit:Number(e.quantity_per_unit||1),base_unit:e.base_unit||"pc",display_unit:e.display_unit||null}));_(s),j(!1)}catch(t){let e="Failed to save product";try{const s=t.response?.data||t.data||{},r=t.response?.status;409===r||"Product with this SKU already exists"===s.error?(e=s.message||`A product with SKU "${L.sku?.trim()||"this SKU"}" already exists. Please use a different SKU.`,s.existingProduct&&(e=`SKU "${L.sku?.trim()}" is already in use by "${s.existingProduct.product_name}". Please use a different SKU code.`)):s.error||s.message?e=s.message||s.error:t.message&&(e=t.message)}catch(s){e=t.message||"Failed to save product",console.error("Error parsing error response:",s)}D(e)}finally{M(!1)}},[S,L]),qe=t.useCallback(async e=>{e.preventDefault();try{M(!0),D("");const e=sessionStorage.getItem("auth_token");await n("/api/products/add-stock-by-sku",{method:"POST",headers:a(e),body:JSON.stringify({sku:P.sku,quantity:Number(P.quantity)})});const t=await n("/api/inventory",{headers:a(e),params:{limit:1e3,offset:0}}),s=(t?.products||t||[]||[]).map(e=>({id:String(e.id||""),name:e.name||"-",category:e.category||"-",quantity:Number(e.quantity||0),cost_price:Number(e.cost_price||0),selling_price:Number(e.selling_price||0),sku:e.sku||"",description:e.description||"",low_stock_level:Number(e.low_stock_level??h),product_type:e.product_type||"count",quantity_per_unit:Number(e.quantity_per_unit||1),base_unit:e.base_unit||"pc",display_unit:e.display_unit||null}));_(s),N(!1)}catch(t){D("Failed to add stock")}finally{M(!1)}},[P]),Te=t.useCallback(e=>{const t=b.find(t=>String(t.id)===String(e));t&&(H(t),G(!0))},[b]),Me=t.useCallback(async()=>{if(Q)try{M(!0),D("");const t=sessionStorage.getItem("auth_token");try{await n(`/api/products/${Q.id}`,{method:"DELETE",headers:a(t)})}catch(e){console.log("Trying fallback delete endpoint..."),await n(`/api/inventory/${Q.id}`,{method:"DELETE",headers:a(t)})}_(e=>e.filter(e=>e.id!==Q.id)),G(!1),H(null)}catch(e){console.error("Error deleting product:",e),D(e.response?.data?.error||"Failed to delete product. Please try again.")}finally{M(!1)}},[Q]),Ie=t.useCallback(e=>{e<1||e>we||W(e)},[we]),Oe=t.useCallback(e=>{z(Number(e.target.value)),W(1)},[]),Ee=t.useCallback(e=>{O(e.target.value),W(1)},[]),$e=t.useCallback(async e=>{try{se(!0),D("");const s=sessionStorage.getItem("auth_token"),r=e.split("\n").filter(e=>e.trim().length>0);if(r.length<2)throw new Error("CSV file must contain at least a header row and one data row");const i=r[0].split(",").map(e=>e.trim().toLowerCase()),o=["sku","name","category","description","product sold by","unit size","unit","quantity","cost price","selling price","low stock alert"].filter(e=>!i.includes(e));if(o.length>0)throw new Error(`Missing required columns: ${o.join(", ")}`);const l=[],c=[];for(let e=1;e<r.length;e++){const s=r[e].trim();if(s)try{const t=[];let r="",o=!1;for(let e=0;e<s.length;e++){const i=s[e];'"'===i?o=!o:","!==i||o?r+=i:(t.push(r.trim()),r="")}if(t.push(r.trim()),t.length!==i.length){c.push(`Row ${e+1}: Column count mismatch`);continue}if(!t.some(e=>e&&e.trim().length>0))continue;const n={};i.forEach((e,s)=>{n[e]=t[s]||""});const a=n.sku?.trim()||`SKU-${Date.now()}-${e}`,d=n.name?.trim();if(!d){c.push(`Row ${e+1}: Name is required`);continue}const u=n.category?.trim()||"",m=n.description?.trim()||"";let p=n["product sold by"]?.trim()||"Per Piece",g="Per Piece";const x=p.toLowerCase();g="per piece"===x||"per_piece"===x||"count"===x||"piece"===x?"Per Piece":"by weight"===x||"by_weight"===x||"weight"===x||"per weight"===x?"By Weight":"by volume"===x||"by_volume"===x||"volume"===x||"per volume"===x?"By Volume":p;let y=n["unit size"]?.trim()||"",b=n.unit?.trim()||"",_="",v="";if(y){const e=y.match(/^([\d.]+)\s*(kg|g|L|mL|liter|liters|litre|litres|kilogram|kilograms)$/i);if(e){_=e[1];const t=e[2].toLowerCase();"kg"===t||"kilogram"===t||"kilograms"===t?v="kg":"g"===t||"gram"===t||"grams"===t?v="g":"l"===t||"liter"===t||"liters"===t||"litre"===t||"litres"===t?v="L":"ml"!==t&&"milliliter"!==t&&"milliliters"!==t&&"millilitre"!==t&&"millilitres"!==t||(v="mL")}else if(_=y,b){const e=b.toLowerCase();v="kg"===e||"kilogram"===e||"kilograms"===e?"kg":"g"===e||"gram"===e||"grams"===e?"g":"l"===e||"liter"===e||"liters"===e||"litre"===e||"litres"===e?"L":"ml"===e||"milliliter"===e||"milliliters"===e||"millilitre"===e||"millilitres"===e?"mL":b}}else if(b){const e=b.toLowerCase();v="kg"===e||"kilogram"===e||"kilograms"===e?"kg":"g"===e||"gram"===e||"grams"===e?"g":"l"===e||"liter"===e||"liters"===e||"litre"===e||"litres"===e?"L":"ml"===e||"milliliter"===e||"milliliters"===e||"millilitre"===e||"millilitres"===e?"mL":b}"Per Piece"===g&&(_="",v="");const f=Number(n.quantity?.trim()||0),k=Number(n["cost price"]?.trim()||0),j=Number(n["selling price"]?.trim()||0),w=Number(n["low stock alert"]?.trim()||h);if(f<=0){c.push(`Row ${e+1}: Quantity must be greater than 0`);continue}if(j<k){c.push(`Row ${e+1}: Selling price must be greater than or equal to cost price`);continue}l.push({sku:a,name:d,category:u,description:m,product_sold_by:g,unit_size:_?Number(_):void 0,unit:v||void 0,quantity:f,cost_price:k,selling_price:j,low_stock_level:w})}catch(t){c.push(`Row ${e+1}: ${t.message||"Invalid data"}`)}}if(c.length>0&&0===l.length)throw new Error(`Import failed:\n${c.join("\n")}`);if(0===l.length)throw new Error("No valid products found in CSV file");const d=await n("/api/products/bulk-import",{method:"POST",headers:{"Content-Type":"application/json",...a(s)},body:JSON.stringify({products:l})}),u=await n("/api/inventory",{headers:a(s),params:{limit:1e3,offset:0}}),m=(u?.products||u||[]||[]).map(e=>({id:String(e.id||""),name:e.name||"-",category:e.category||"-",quantity:Number(e.quantity||0),cost_price:Number(e.cost_price||0),selling_price:Number(e.selling_price||0),sku:e.sku||"",description:e.description||"",low_stock_level:Number(e.low_stock_level??h),product_type:e.product_type||"count",quantity_per_unit:Number(e.quantity_per_unit||1),base_unit:e.base_unit||"pc",display_unit:e.display_unit||null}));_(m),ee(!1);const p=d?.errors||[],g=[...c,...p.map(e=>`Row ${e.index+1}: ${e.error}`)],x=d?.success?.length||l.length;ne({successCount:x,errors:g}),ie(!0)}catch(t){const e=t.response?.data?.error||t.message||"Failed to import products";D(e),console.error("CSV import error:",t)}finally{se(!1)}},[]),ze=t.useCallback(async()=>{X(!0);try{const e=sessionStorage.getItem("auth_token"),t=await n("/auth/profile",{headers:a(e)}),s=t?.business||{},r=s.business_name||"Store",i=s.branch_name||null;[s.house_number,s.barangay,s.city,s.province].filter(Boolean).join(", ");if(!je||0===je.length)return void alert("No inventory data found to export.");const o=(e,t)=>0===e?"Out of Stock":e>0&&e<=t?"Low Stock":"In Stock",l=je.length;let u=0,m=0,p=0;const g=[],x=[];let y=0;je.forEach(e=>{const t=ae(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit),s=Number(e.quantity||0),r=Number(e.low_stock_level||h),i=Number(e.cost_price||0);u+=t;y+=i*t;const n=o(s,r);"Low Stock"===n?(m++,g.push({...e,displayQty:t,status:n})):"Out of Stock"===n&&(p++,x.push({...e,displayQty:t,status:n}))});const b=new c("p","mm","a4"),_=b.internal.pageSize.getWidth(),v=b.internal.pageSize.getHeight(),f=20,k=_-2*f;let j=f,w=1;const N=e=>j+e>v-f&&(b.addPage(),w++,j=f,!0),S=(e,t=12)=>{N(15),b.setFontSize(t),b.setFont("helvetica","bold"),b.setTextColor(0,0,0),b.text(e,f,j),j+=8},C=e=>`PHP ${Number(e||0).toFixed(2)}`,L=(e,t)=>{let s=String(e||"");if(b.getTextWidth(s)>t-2){for(;b.getTextWidth(s+"...")>t-2&&s.length>0;)s=s.slice(0,-1);s+="..."}return s},F=()=>{const e=b.internal.getNumberOfPages();for(let t=1;t<=e;t++){b.setPage(t),b.setFontSize(8),b.setFont("helvetica","normal"),b.setTextColor(100,100,100);const s=`Page ${t} of ${e} | Generated by eKahera POS System | System-generated report`,r=b.getTextWidth(s);b.text(s,(_-r)/2,v-10)}};b.setFontSize(20),b.setFont("helvetica","bold"),b.setTextColor(0,0,0);const P=b.getTextWidth(r);if(b.text(r,(_-P)/2,j),j+=8,i){b.setFontSize(14),b.setFont("helvetica","normal");const e=b.getTextWidth(i);b.text(i,(_-e)/2,j),j+=7}b.setFontSize(16),b.setFont("helvetica","bold");const q="Inventory Summary",T=b.getTextWidth(q);b.text(q,(_-T)/2,j),j+=6,b.setFontSize(10),b.setFont("helvetica","normal");const M=`Generated: ${d().format("MMM D, YYYY h:mm A")}`,I=b.getTextWidth(M);b.text(M,(_-I)/2,j),j+=5,b.setFontSize(9),b.setTextColor(100,100,100);const O="System: eKahera POS",E=b.getTextWidth(O);b.text(O,(_-E)/2,j),j+=10,b.setLineWidth(.5),b.setDrawColor(200,200,200),b.line(f,j,_-f,j),j+=8,S("INVENTORY SUMMARY",14),b.setFontSize(9),b.setFont("helvetica","normal"),b.setTextColor(0,0,0);const $=[["Total Number of Products",String(l)],["Total Quantity in Stock (Units)",String(Math.round(u))],["Low-Stock Items",String(m)],["Out-of-Stock Items",String(p)]],z=f,B=_-f-60;$.forEach(([e,t])=>{N(8),b.setFont("helvetica","normal"),b.text(e+":",z,j),b.setFont("helvetica","bold"),b.text(t,B,j),j+=7}),j+=5,S("INVENTORY STATUS",14);const W=[.2*k,.11*k,.13*k,.12*k,.12*k,.12*k,.2*k],A=[f];for(let n=1;n<W.length;n++)A.push(A[n-1]+W[n-1]);b.setFontSize(8),b.setFont("helvetica","bold"),b.setTextColor(0,0,0);const D=j;b.text("Product Name",A[0],D),b.text("SKU",A[1],D),b.text("Category",A[2],D),b.text("Unit",A[3],D),b.text("Quantity",A[4],D),b.text("Reorder Level",A[5],D),b.text("Status",A[6],D),j+=8,b.setLineWidth(.5),b.setDrawColor(0,0,0),b.line(f,j-2,_-f,j-2),j+=4,b.setFont("helvetica","normal"),b.setFontSize(7),je.forEach(e=>{N(10);const t=Number(e.quantity||0),s=Number(e.low_stock_level||h),r=o(t,s);"Out of Stock"===r?b.setTextColor(200,0,0):"Low Stock"===r?b.setTextColor(255,140,0):b.setTextColor(0,0,0);const i=e.name||"",n=e.sku||"N/A",a=e.category||"Uncategorized",l=(c=e).display_unit?c.display_unit:"count"===c.product_type?"pc":"weight"===c.product_type||"volume"===c.product_type?c.quantity_per_unit&&c.base_unit?`${c.quantity_per_unit} ${c.base_unit}`:c.base_unit||"pc":"pc";var c;const d=((e,t,s,r)=>{if(!e||0===e)return"0";if("count"===t||!t)return`${Math.round(e)}`;if("volume"===t&&"L"===r){const t=e/1e3;return t%1==0?t.toFixed(0):t.toFixed(2)}let i=e,o=r||"g";return"g"===r&&e>=1e3?(i=e/1e3,o="kg"):"mL"===r&&e>=1e3&&(i=e/1e3,o="L"),`${i%1==0?i.toFixed(0):i.toFixed(2)} ${o}`})(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit),u=String(s);b.text(L(i,W[0]),A[0],j),b.text(L(n,W[1]),A[1],j),b.text(L(a,W[2]),A[2],j),b.text(L(l,W[3]),A[3],j),b.text(L(d,W[4]),A[4],j),b.text(L(u,W[5]),A[5],j),b.text(L(r,W[6]),A[6],j),b.setTextColor(0,0,0),j+=7}),j+=5,(g.length>0||x.length>0)&&(N(20),S("LOW-STOCK & OUT-OF-STOCK ITEMS",14),x.length>0&&(b.setFontSize(10),b.setFont("helvetica","bold"),b.setTextColor(200,0,0),b.text("OUT OF STOCK ITEMS",f,j),j+=7,b.setFontSize(8),b.setFont("helvetica","bold"),b.setTextColor(0,0,0),b.text("Product Name",f+5,j),b.text("Current Quantity",f+80,j),b.text("Reorder Level",f+130,j),j+=5,b.setLineWidth(.3),b.line(f,j-2,_-f,j-2),j+=4,b.setFont("helvetica","normal"),x.forEach(e=>{N(8),b.setTextColor(200,0,0),b.text(L(e.name||"",70),f+5,j),b.text(String(Math.round(e.displayQty||0)),f+80,j),b.text(String(e.low_stock_level||h),f+130,j),j+=6}),j+=3),g.length>0&&(b.setFontSize(10),b.setFont("helvetica","bold"),b.setTextColor(255,140,0),b.text("LOW STOCK ITEMS",f,j),j+=7,b.setFontSize(8),b.setFont("helvetica","bold"),b.setTextColor(0,0,0),b.text("Product Name",f+5,j),b.text("Current Quantity",f+80,j),b.text("Reorder Level",f+130,j),j+=5,b.setLineWidth(.3),b.line(f,j-2,_-f,j-2),j+=4,b.setFont("helvetica","normal"),g.forEach(e=>{N(8),b.setTextColor(255,140,0),b.text(L(e.name||"",70),f+5,j),b.text(String(Math.round(e.displayQty||0)),f+80,j),b.text(String(e.low_stock_level||h),f+130,j),j+=6}),j+=5),b.setTextColor(0,0,0)),N(30),S("INVENTORY VALUATION",14);const V=[.35*k,.2*k,.2*k,.25*k],U=[f];for(let n=1;n<V.length;n++)U.push(U[n-1]+V[n-1]);b.setFontSize(9),b.setFont("helvetica","bold");const R=j;b.text("Product Name",U[0],R),b.text("Cost Price",U[1],R),b.text("Quantity",U[2],R),b.text("Stock Value",U[3],R),j+=8,b.setLineWidth(.5),b.line(f,j-2,_-f,j-2),j+=4,b.setFont("helvetica","normal"),b.setFontSize(8),je.forEach(e=>{N(8);const t=ae(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit),s=Number(e.cost_price||0),r=s*t;b.text(L(e.name||"",V[0]),U[0],j),b.text(C(s),U[1],j),b.text(String(Math.round(t)),U[2],j),b.text(C(r),U[3],j),j+=6}),N(10),j+=3,b.setLineWidth(.5),b.line(f,j,_-f,j),j+=5,b.setFont("helvetica","bold"),b.setFontSize(10),b.text("Total Inventory Value:",f,j),b.text(C(y),_-f-60,j),j+=8,F();const K=`Inventory-Report-${d().format("YYYY-MM-DD")}.pdf`;b.save(K)}catch(e){console.error("Error exporting inventory PDF:",e),alert("Failed to generate inventory report. Please try again or contact support.")}finally{X(!1)}},[je]),Be=e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-end gap-3 sm:gap-4 mb-4 sm:mb-0 w-full",children:e.jsxs("div",{className:"flex items-center justify-end gap-2 sm:gap-3 w-auto",children:[e.jsxs(l,{onClick:Se,variant:"primary",microinteraction:!0,className:"bg-blue-600 text-md text-white font-semibold rounded-lg shadow hover:bg-blue-700 transition gap-1 sm:gap-2 flex items-center justify-center sm:justify-start !py-2 !px-2 sm:!px-2 shrink-0 min-w-[40px] sm:min-w-[40px] lg:min-w-0",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"hidden sm:block",children:"Add Product"}),e.jsx("span",{className:"sm:inline"})]}),e.jsx(l,{onClick:()=>ee(!0),variant:"secondary",disabled:te||T,className:"text-sm flex items-center justify-center sm:justify-start gap-1 sm:gap-2 shrink-0 !py-2 !px-2 sm:!px-2 min-w-[40px] sm:min-w-[40px] lg:min-w-0",children:te?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"hidden sm:inline",children:"Importing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("span",{className:"hidden sm:inline",children:"Import"})]})}),e.jsx(l,{onClick:ze,variant:"secondary",disabled:J||T,className:"text-sm flex items-center justify-center sm:justify-start gap-1 sm:gap-2 shrink-0 !py-2 !px-2 sm:!px-2 min-w-[40px] sm:min-w-[40px] lg:min-w-0",children:J?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"hidden sm:inline",children:"Exporting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})]})})]})});return e.jsxs(s,{title:"INVENTORY",sidebar:e.jsx(r,{}),isSidebarOpen:V,headerActions:Be,setSidebarOpen:U,showHeader:!0,showNavbar:!1,showFooter:!1,children:[e.jsx(i,{products:Ne,allProducts:je,stats:he,page:B,entriesPerPage:$,totalPages:we,onPageChange:Ie,onEntriesChange:Oe,search:I,onSearchChange:Ee,onEdit:Ce,onDelete:Te,onAddProduct:Se,onStockEntry:Le,categories:v,selectedCategory:_e,onCategoryFilter:e=>{ve(e),W(1)},stockFilter:fe,onStockFilter:e=>{ke(e),W(1)},sortBy:ge,sortOrder:ye,onSort:(e,t)=>{xe(e),be(t),W(1)}}),A&&!k&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-4 flex items-start gap-3 mt-4 shadow-sm",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-800 mb-1",children:A.includes("already exists")||A.includes("SKU")?"Duplicate Product":"Error"}),e.jsx("p",{className:"text-sm text-red-700",children:(()=>{try{const e=JSON.parse(A);return e.error||e.message||A}catch{return A}})()}),A.includes("already exists")&&e.jsx("p",{className:"text-xs text-red-600 mt-2 italic",children:"Please use a different SKU code or update the existing product instead."})]}),e.jsx("button",{onClick:()=>D(""),className:"flex-shrink-0 text-red-400 hover:text-red-600 transition-colors","aria-label":"Close error",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx(o,{isOpen:k,onClose:()=>{j(!1),D("")},variant:"product",title:S?"Edit Product":"Add New Product",editingProduct:S,productForm:L,onChange:Fe,categories:v,onSubmit:Pe,loading:T,error:A}),e.jsx(o,{isOpen:w,onClose:()=>N(!1),title:"Stock Entry",variant:"stock",editingProduct:null,stockForm:P,onChange:e=>q({...P,[e.target.name]:e.target.value}),onSubmit:qe,loading:T}),e.jsx(o,{isOpen:Y,onClose:()=>G(!1),title:"",size:"sm",children:e.jsxs("div",{className:"p-0",children:[e.jsx("div",{className:"bg-gradient-to-r from-red-50 via-red-50/80 to-orange-50/50 border-b border-red-100 px-6 py-5 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"Confirm Deletion"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Are you sure you want to delete this product?"})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:["You are about to delete:"," ",e.jsx("strong",{className:"text-red-700",children:Q?.name})]}),e.jsx("p",{className:"text-sm text-gray-700 mb-6",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(l,{onClick:()=>G(!1),variant:"secondary",disabled:T,children:"Cancel"}),e.jsx(l,{onClick:Me,variant:"danger",loading:T,children:"Delete"})]})]})]})}),e.jsx(y,{isOpen:Z,onClose:()=>{ee(!1),D("")},onImport:$e,loading:te,error:A}),e.jsx(x,{isOpen:re,onClose:()=>ie(!1),successCount:oe.successCount,errors:oe.errors})]})}export{b as default};
//# sourceMappingURL=Inventory-gKD5Ig4O.js.map
