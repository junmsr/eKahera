{"version":3,"file":"ScanCustomerCartModal-CtPSvYKH.js","sources":["../../../frontend/src/components/ui/POS/SkuFormCard.jsx","../../../frontend/src/components/ui/POS/CartTableCard.jsx","../../../frontend/src/components/modals/PriceCheckModal.jsx","../../../frontend/src/components/modals/DiscountModal.jsx","../../../frontend/src/components/modals/CashLedgerModal.jsx","../../../frontend/src/components/modals/CheckoutModal.jsx","../../../frontend/src/components/modals/CashPaymentCompleteModal.jsx","../../../frontend/src/components/modals/CashPaymentModal.jsx","../../../frontend/src/components/modals/ScanCustomerCartModal.jsx"],"sourcesContent":["import React from \"react\";\r\nimport Card from \"../../common/Card\";\r\nimport FormField from \"../../common/FormField\";\r\nimport Input from \"../../common/Input\";\r\nimport Button from \"../../common/Button\";\r\n\r\n/**\r\n * SKU Form Card Component\r\n * Form for entering SKU codes and quantities\r\n */\r\nexport default React.forwardRef(\r\n  (\r\n    {\r\n      sku,\r\n      setSku,\r\n      quantity,\r\n      setQuantity,\r\n      handleAddToCart,\r\n      quantityInputRef,\r\n      className = \"\",\r\n    },\r\n    ref\r\n  ) => {\r\n    return (\r\n      <Card\r\n        className={`flex-shrink-0 bg-white/80 backdrop-blur-md border border-white/60 shadow-xl hover:shadow-2xl transition-all duration-300 ${className}`}\r\n        variant=\"glass\"\r\n      >\r\n        <div className=\"flex flex-col gap-1 p-1 sm:p-2\">\r\n          <div className=\"flex items-center gap-2 mb-0.5\">\r\n            <div className=\"w-6 h-6 bg-blue-100 rounded-xl flex items-center justify-center\">\r\n              <svg\r\n                className=\"w-3 h-3 text-blue-600\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\r\n                />\r\n              </svg>\r\n            </div>\r\n            <span className=\"font-bold text-sm text-gray-900\">\r\n              Enter SKU Code\r\n            </span>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <div>\r\n              <label className=\"block text-sm font-semibold text-gray-700 mb-1\">\r\n                SKU Code\r\n              </label>\r\n              <div className=\"relative\">\r\n                <input\r\n                  ref={ref}\r\n                  type=\"text\"\r\n                  name=\"sku\"\r\n                  value={sku}\r\n                  onChange={(e) => setSku(e.target.value)}\r\n                  onKeyPress={(e) => {\r\n                    if (e.key === \"Enter\" && sku.trim()) {\r\n                      handleAddToCart();\r\n                    }\r\n                  }}\r\n                  placeholder=\"Scan or enter SKU code\"\r\n                  className=\"w-full pl-3 pr-3 py-2 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 placeholder-gray-400 font-medium\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-2\">\r\n              <label className=\"text-sm font-semibold text-gray-700 whitespace-nowrap\">\r\n                Quantity:\r\n              </label>\r\n              <div className=\"flex items-center gap-1 flex-1\">\r\n                <button\r\n                  onClick={() => setQuantity(Math.max(1, quantity - 1))}\r\n                  className=\"w-8 h-8 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold transition-colors duration-200 flex items-center justify-center\"\r\n                >\r\n                  −\r\n                </button>\r\n                <input\r\n                  type=\"number\"\r\n                  name=\"quantity\"\r\n                  value={quantity}\r\n                  min={1}\r\n                  ref={quantityInputRef}\r\n                  onChange={(e) =>\r\n                    setQuantity(Math.max(1, Number(e.target.value) || 1))\r\n                  }\r\n                  className=\"w-16 px-2 py-1 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-xl text-center text-sm font-semibold focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200\"\r\n                />\r\n                <button\r\n                  onClick={() => setQuantity(quantity + 1)}\r\n                  className=\"w-8 h-8 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold transition-colors duration-200 flex items-center justify-center\"\r\n                >\r\n                  +\r\n                </button>\r\n              </div>\r\n              <Button\r\n                label=\"Add to Cart\"\r\n                onClick={handleAddToCart}\r\n                variant=\"primary\"\r\n                size=\"sm\"\r\n                microinteraction\r\n                icon={\r\n                  <svg\r\n                    className=\"w-3 h-3\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={2}\r\n                      d=\"M12 4v16m8-8H4\"\r\n                    />\r\n                  </svg>\r\n                }\r\n                iconPosition=\"left\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Card>\r\n    );\r\n  }\r\n);\r\n","import React, { useState, useEffect, useRef } from \"react\";\r\nimport Card from \"../../common/Card\";\r\nimport Button from \"../../common/Button\";\r\n\r\n/**\r\n * Cart Table Card Component\r\n * Displays cart items in a table format with totals\r\n */\r\nfunction CartTableCard({\r\n  cart,\r\n  handleRemove,\r\n  handleEditQuantity,\r\n  total,\r\n  className = \"\",\r\n  selectedIdx = -1,\r\n  onSelectRow,\r\n  appliedDiscount,\r\n  editingIdx = null,\r\n  editQty = 1,\r\n  onEditQtyChange,\r\n  onEditComplete,\r\n}) {\r\n\r\n  // Handle row click to select item\r\n  const handleRowClick = (idx, e) => {\r\n    if (e.target.tagName !== 'INPUT') { // Don't select row when clicking on input\r\n      onSelectRow?.(idx);\r\n    }\r\n  };\r\n  \r\n  // Handle quantity input change\r\n  const handleQtyChange = (e) => {\r\n    const value = e.target.value;\r\n    // Allow empty string (for backspace/delete) or positive numbers\r\n    if (value === '' || /^\\d+$/.test(value)) {\r\n      onEditQtyChange?.(value === '' ? '' : parseInt(value, 10));\r\n    }\r\n  };\r\n  \r\n  // Handle quantity save\r\n  const handleSaveQuantity = (idx) => {\r\n    const qty = editQty === '' ? 1 : Math.max(1, editQty);\r\n    handleEditQuantity(idx, qty);\r\n    onEditComplete?.();\r\n  };\r\n\r\n  const EditIcon = () => (\r\n    <svg\r\n      width=\"16\"\r\n      height=\"16\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      strokeWidth=\"2\"\r\n      viewBox=\"0 0 24 24\"\r\n    >\r\n      <path d=\"M15.232 5.232l3.536 3.536M9 13l6.586-6.586a2 2 0 1 1 2.828 2.828L11.828 15.828a4 4 0 0 1-1.414.828l-4.243 1.414 1.414-4.243a4 4 0 0 1 .828-1.414z\" />\r\n    </svg>\r\n  );\r\n\r\n  const DeleteIcon = () => (\r\n    <svg\r\n      width=\"16\"\r\n      height=\"16\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      strokeWidth=\"2\"\r\n      viewBox=\"0 0 24 24\"\r\n    >\r\n      <path d=\"M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z\" />\r\n    </svg>\r\n  );\r\n  \r\n  const CheckIcon = () => (\r\n    <svg\r\n      width=\"16\"\r\n      height=\"16\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      strokeWidth=\"2\"\r\n      viewBox=\"0 0 24 24\"\r\n    >\r\n      <path d=\"M5 13l4 4L19 7\" />\r\n    </svg>\r\n  );\r\n  \r\n  const XIcon = () => (\r\n    <svg\r\n      width=\"16\"\r\n      height=\"16\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      strokeWidth=\"2\"\r\n      viewBox=\"0 0 24 24\"\r\n    >\r\n      <path d=\"M18 6L6 18M6 6l12 12\" />\r\n    </svg>\r\n  );\r\n\r\n  return (\r\n    <Card\r\n      className={`flex-1 flex flex-col bg-white/80 backdrop-blur-md border border-white/60 shadow-xl transition-all duration-300 h-full min-h-0 overflow-hidden ${className}`}\r\n      variant=\"glass\"\r\n    >\r\n      <div className=\"flex-1 min-h-0 flex flex-col p-2 sm:p-3\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between mb-2 pb-2 border-b border-gray-200\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <div className=\"w-7 h-7 bg-blue-100 rounded-lg flex items-center justify-center\">\r\n              <svg\r\n                className=\"w-4 h-4 text-blue-600\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"\r\n                />\r\n              </svg>\r\n            </div>\r\n            <h3 className=\"text-sm sm:text-base font-bold text-gray-900\">\r\n              Shopping Cart\r\n            </h3>\r\n          </div>\r\n          <span className=\"text-xs font-semibold text-gray-600 bg-gray-100 px-2 py-0.5 rounded-full\">\r\n            {cart.length} {cart.length === 1 ? \"item\" : \"items\"}\r\n          </span>\r\n        </div>\r\n\r\n        {/* Table Container */}\r\n        <div className=\"flex-1 overflow-auto min-h-0 rounded-lg\">\r\n          <table className=\"w-full\">\r\n            <thead className=\"sticky top-0 z-10 bg-gradient-to-r from-blue-50/90 to-indigo-50/90 backdrop-blur-sm border-b border-blue-100\">\r\n              <tr>\r\n                <th className=\"py-1.5 px-2 text-left text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider\">\r\n                  Product\r\n                </th>\r\n                <th className=\"py-1.5 px-2 text-center text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider\">\r\n                  Qty\r\n                </th>\r\n                <th className=\"py-1.5 px-2 text-right text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider\">\r\n                  Price\r\n                </th>\r\n                <th className=\"py-1.5 px-2 text-right text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider\">\r\n                  Total\r\n                </th>\r\n                <th className=\"py-1.5 px-2 text-center text-[10px] sm:text-xs font-bold text-gray-700 uppercase tracking-wider\">\r\n                  Actions\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"divide-y divide-gray-100\">\r\n              {cart.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan={5} className=\"text-center py-8\">\r\n                    <div className=\"flex flex-col items-center justify-center\">\r\n                      <div className=\"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mb-2\">\r\n                        <svg\r\n                          className=\"w-6 h-6 text-gray-400\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"\r\n                          />\r\n                        </svg>\r\n                      </div>\r\n                      <p className=\"text-gray-500 text-sm font-semibold\">\r\n                        Cart is empty\r\n                      </p>\r\n                      <p className=\"text-gray-400 text-xs mt-1\">\r\n                        Scan or enter products\r\n                      </p>\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                cart.map((item, idx) => (\r\n                  <tr\r\n                    key={idx}\r\n                    className={`hover:bg-blue-50/50 transition-colors duration-200 group ${selectedIdx === idx ? \"bg-blue-100/70 ring-2 ring-blue-300\" : \"\"}`}\r\n                    onClick={(e) => handleRowClick(idx, e)}\r\n                  >\r\n                    <td className=\"py-1.5 px-2\">\r\n                      <div className=\"flex flex-col\">\r\n                        <span className=\"text-xs sm:text-sm font-semibold text-gray-900 group-hover:text-blue-600 transition-colors truncate\">\r\n                          {item.name}\r\n                        </span>\r\n                        <span className=\"text-[10px] text-gray-500 truncate\">\r\n                          SKU: {item.sku || \"N/A\"}\r\n                        </span>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"py-1.5 px-2 text-center\">\r\n                      {editingIdx === idx ? (\r\n                        <div className=\"flex items-center justify-center gap-1\">\r\n                          <input\r\n                            type=\"text\"\r\n                            inputMode=\"numeric\"\r\n                            pattern=\"[0-9]*\"\r\n                            value={editQty}\r\n                            onChange={handleQtyChange}\r\n                            onKeyDown={(e) => {\r\n                              if (e.key === \"Enter\") {\r\n                                handleSaveQuantity(idx);\r\n                              } else if (e.key === \"Escape\") {\r\n                                onEditComplete?.();\r\n                              }\r\n                            }}\r\n                            onBlur={() => handleSaveQuantity(idx)}\r\n                            className=\"w-12 h-7 text-center text-xs font-bold border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                            autoFocus\r\n                            onFocus={(e) => e.target.select()}\r\n                          />\r\n                          <button\r\n                            type=\"button\"\r\n                            onClick={() => handleSaveQuantity(idx)}\r\n                            className=\"p-1 text-green-600 hover:bg-green-100 rounded\"\r\n                            title=\"Save\"\r\n                          >\r\n                            <CheckIcon />\r\n                          </button>\r\n                          <button\r\n                            onClick={() => onEditComplete()}\r\n                            className=\"p-1 text-red-600 hover:bg-red-100 rounded\"\r\n                            title=\"Cancel\"\r\n                          >\r\n                            <XIcon />\r\n                          </button>\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"flex items-center justify-center gap-1\">\r\n                          <span className=\"inline-flex items-center justify-center w-7 h-7 rounded-md bg-blue-100 text-blue-700 font-bold text-xs\">\r\n                            {item.quantity}\r\n                          </span>\r\n                        </div>\r\n                      )}\r\n                    </td>\r\n                    <td className=\"py-1.5 px-2 text-right\">\r\n                      <span className=\"text-xs sm:text-sm font-medium text-gray-700\">\r\n                        ₱{item.price.toFixed(2)}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"py-1.5 px-2 text-right\">\r\n                      <span className=\"text-xs sm:text-sm font-bold text-blue-600\">\r\n                        ₱\r\n                        {(\r\n                          item.price *\r\n                          (editingIdx === idx ? editQty : item.quantity)\r\n                        ).toFixed(2)}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"py-1.5 px-2\">\r\n                      <div className=\"flex items-center justify-center gap-1\">\r\n                        <button\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            onSelectRow?.(idx);\r\n                            onEditQtyChange(item.quantity);\r\n                          }}\r\n                          className={`p-1.5 rounded-md transition-all duration-200 ${selectedIdx === idx ? 'bg-blue-100 text-blue-700 border-blue-200' : 'bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200'} border`}\r\n                          title=\"Edit (E)\"\r\n                          \r\n                        >\r\n                          <div className=\"flex items-center gap-1\">\r\n                            {(\r\n                              <span className=\"text-xs font-bold text-blue-600\">(E)</span>\r\n                            )}\r\n                            <EditIcon />\r\n                          </div>\r\n                        </button>\r\n                        <button\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            onSelectRow?.(idx);\r\n                            handleRemove(idx);\r\n                          }}\r\n                          className={`p-1.5 rounded-md transition-all duration-200 ${selectedIdx === idx ? 'bg-red-100 text-red-700 border-red-200' : 'bg-red-50 text-red-600 hover:bg-red-100 border-red-200'} border`}\r\n                          title=\"Delete (D)\"\r\n                        >\r\n                          <div className=\"flex items-center gap-1\">\r\n                            {(\r\n                              <span className=\"text-xs font-bold text-red-600\">(D)</span>\r\n                            )}\r\n                            <DeleteIcon />\r\n                          </div>\r\n                        </button>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        {/* Total Footer */}\r\n        <div className=\"mt-2 pt-2 border-t border-gray-200\">\r\n          <div className=\"flex flex-col gap-1\">\r\n            {appliedDiscount && (\r\n              <div className=\"flex justify-between items-center text-xs text-gray-500\">\r\n                <span>Subtotal:</span>\r\n                <span className=\"line-through\">\r\n                  ₱\r\n                  {cart\r\n                    .reduce(\r\n                      (sum, item, idx) =>\r\n                        sum +\r\n                        item.price * (editingIdx === idx ? editQty : item.quantity),\r\n                      0\r\n                    )\r\n                    .toFixed(2)}\r\n                </span>\r\n              </div>\r\n            )}\r\n            <div className=\"flex justify-between items-center\">\r\n              <span className=\"text-sm sm:text-base font-semibold text-gray-700\">\r\n                Total:\r\n              </span>\r\n              <span className=\"text-lg sm:text-xl font-extrabold text-blue-600\">\r\n                ₱{total.toFixed(2)}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Card>\r\n  );\r\n}\r\n\r\nexport default CartTableCard;\r\n","import React, { useState } from \"react\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport Button from \"../common/Button\";\r\nimport { api } from \"../../lib/api\";\r\nimport ScannerCard from \"../ui/POS/ScannerCard\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nfunction PriceCheckModal({ isOpen, onClose, sku, setSku }) {\r\n  const [product, setProduct] = useState(null);\r\n\r\n  const handleCheck = async () => {\r\n    if (!sku) return;\r\n    try {\r\n      const businessId = localStorage.getItem(\"business_id\");\r\n      const query = businessId\r\n        ? `?business_id=${encodeURIComponent(businessId)}`\r\n        : \"\";\r\n      const res = await api(\r\n        `/api/products/public/sku/${encodeURIComponent(sku)}${query}`\r\n      );\r\n      if (res) {\r\n        setProduct({\r\n          name: res.product_name,\r\n          price: Number(res.selling_price || 0),\r\n          sku: res.sku,\r\n        });\r\n      } else {\r\n        setProduct(null);\r\n      }\r\n    } catch (_) {\r\n      setProduct(null);\r\n    }\r\n  };\r\n\r\n  // Auto-fetch on SKU change\r\n  React.useEffect(() => {\r\n    if (!sku) {\r\n      setProduct(null);\r\n      return;\r\n    }\r\n    const t = setTimeout(() => {\r\n      handleCheck();\r\n    }, 200);\r\n    return () => clearTimeout(t);\r\n  }, [sku]);\r\n\r\n  const footerContent = (\r\n    <Button\r\n      label=\"Close (Esc)\"\r\n      variant=\"secondary\"\r\n      onClick={onClose}\r\n      className=\"w-full\"\r\n    />\r\n  );\r\n\r\n  useKeyboardShortcuts(\r\n    [\r\n      {\r\n        key: \"escape\",\r\n        action: onClose,\r\n        enabled: isOpen,\r\n        allowWhileTyping: true,\r\n      },\r\n      {\r\n        key: \"enter\",\r\n        action: handleCheck,\r\n        enabled: isOpen,\r\n        allowWhileTyping: true,\r\n      },\r\n    ],\r\n    [isOpen, sku]\r\n  );\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Price Check\"\r\n      subtitle=\"Scan or enter SKU/barcode\"\r\n      icon={\r\n        <svg\r\n          className=\"w-5 h-5 text-white\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n          />\r\n        </svg>\r\n      }\r\n      footer={footerContent}\r\n      size=\"md\"\r\n      contentClassName=\"space-y-4\"\r\n    >\r\n      {/* Scanner */}\r\n      <div className=\"w-full\">\r\n        <ScannerCard\r\n          onScan={(result) => {\r\n            const code = result?.[0]?.rawValue;\r\n            if (code) {\r\n              setSku(code);\r\n            }\r\n          }}\r\n          paused={false}\r\n          onResume={() => {}}\r\n          className=\"w-full\"\r\n          textMain=\"text-blue-700\"\r\n        />\r\n      </div>\r\n\r\n      {/* Manual Input */}\r\n      <div className=\"w-full\">\r\n        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n          Enter SKU or Barcode\r\n        </label>\r\n        <input\r\n          type=\"text\"\r\n          value={sku}\r\n          onChange={(e) => setSku(e.target.value)}\r\n          className=\"w-full border border-gray-300 rounded-lg px-4 py-2 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n          placeholder=\"Enter SKU or scan barcode\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Check price:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Enter</span>\r\n        </div>\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Close:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Esc</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Results */}\r\n      {product ? (\r\n        <div className=\"w-full bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200/50\">\r\n          <div className=\"text-lg font-semibold text-blue-900 mb-1\">\r\n            {product.name}\r\n          </div>\r\n          <div className=\"text-3xl font-bold text-blue-600 mb-2\">\r\n            ₱{product.price.toFixed(2)}\r\n          </div>\r\n          <div className=\"text-xs text-gray-500\">SKU: {product.sku}</div>\r\n        </div>\r\n      ) : sku ? (\r\n        <div className=\"text-red-500 text-sm text-center py-4\">\r\n          No product found.\r\n        </div>\r\n      ) : null}\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default PriceCheckModal;\r\n","import React, { useEffect, useState } from \"react\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport Button from \"../common/Button\";\r\nimport { api } from \"../../lib/api\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nfunction DiscountModal({ isOpen, onClose, onApplyDiscount }) {\r\n  const [showSettings, setShowSettings] = useState(false);\r\n  const [discounts, setDiscounts] = useState([]);\r\n\r\n  const [newDesc, setNewDesc] = useState(\"\");\r\n  const [newValue, setNewValue] = useState(\"\");\r\n  const [selectedIdx, setSelectedIdx] = useState(null);\r\n  const [settingsSelectedIdx, setSettingsSelectedIdx] = useState(0);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [saving, setSaving] = useState(false);\r\n  const [settingsTab, setSettingsTab] = useState(\"PERCENTAGE\");\r\n  const descInputRef = React.useRef(null);\r\n  const valueInputRef = React.useRef(null);\r\n  const discountListRef = React.useRef(null);\r\n\r\n  const handleInputKeyDown = (e, field) => {\r\n    // Handle Escape key first so it always blurs without closing the modal\r\n    if (e.key === \"Escape\") {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      e.target.blur();\r\n      return;\r\n    }\r\n\r\n    // Handle Enter key - add discount if both fields have values\r\n    if (e.key === \"Enter\" && showSettings) {\r\n      if (newDesc && newValue) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        handleAddDiscount();\r\n        return;\r\n      }\r\n    }\r\n\r\n    // For the value field, only allow numbers and control keys\r\n    if (field === 'value') {\r\n      // Allow: backspace, delete, tab, escape, enter, arrows, home, end\r\n      if ([8, 9, 27, 13, 37, 38, 39, 40, 35, 36, 46].includes(e.keyCode) ||\r\n          // Allow: Ctrl+A, Ctrl+C, Ctrl+X, Ctrl+V, Ctrl+Z, Ctrl+Y\r\n          (e.ctrlKey && [65, 67, 88, 86, 90, 89].includes(e.keyCode)) ||\r\n          // Allow: numbers on top of keyboard and numpad\r\n          (e.keyCode >= 48 && e.keyCode <= 57) ||\r\n          (e.keyCode >= 96 && e.keyCode <= 105)) {\r\n        // Let it happen, don't do anything\r\n        return;\r\n      }\r\n      // Ensure that it is a number and stop the keypress\r\n      if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {\r\n        e.preventDefault();\r\n      }\r\n    }\r\n  };\r\n\r\n  // When switching to settings view, focus the name field for immediate typing\r\n  useEffect(() => {\r\n    if (isOpen && showSettings) {\r\n      requestAnimationFrame(() => {\r\n        descInputRef.current?.focus();\r\n        descInputRef.current?.select?.();\r\n      });\r\n    }\r\n  }, [isOpen, showSettings]);\r\n\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    const fetchDiscounts = async () => {\r\n      setLoading(true);\r\n      setError(\"\");\r\n      try {\r\n        const token = sessionStorage.getItem(\"auth_token\");\r\n        const data = await api(\"/api/discounts\", {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        const discountList = (data || []).map(d => ({\r\n          label: d.discount_name || `${d.discount_percentage}% off`,\r\n          value: d.discount_percentage,\r\n          discount_id: d.discount_id,\r\n          type: \"percentage\"\r\n        }));\r\n        \r\n        setDiscounts(discountList);\r\n      } catch (e) {\r\n        setError(\"Failed to load discounts\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchDiscounts();\r\n  }, [isOpen]);\r\n\r\n  const handleAddDiscount = async () => {\r\n    if (!newDesc || !newValue) return;\r\n    setSaving(true);\r\n    try {\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n      const payload = { \r\n        discount_name: newDesc, \r\n        discount_percentage: Number(newValue) \r\n      };\r\n      \r\n      const created = await api(\"/api/discounts\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify(payload),\r\n      });\r\n      \r\n      setDiscounts(prev => [\r\n        ...prev,\r\n        {\r\n          label: created.discount_name || newDesc,\r\n          value: created.discount_percentage,\r\n          discount_id: created.discount_id,\r\n          type: \"percentage\"\r\n        }\r\n      ]);\r\n      \r\n      setNewDesc(\"\");\r\n      setNewValue(\"\");\r\n    } catch (e) {\r\n      console.error(\"Failed to add discount:\", e);\r\n      setError(\"Failed to add discount. Please try again.\");\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n   const handleRemove = async (discountId) => {\r\n    if (!discountId) return;\r\n    \r\n    // Ensure discountId is a number\r\n    const id = Number(discountId);\r\n    if (isNaN(id)) {\r\n      setError(\"Invalid discount ID\");\r\n      return;\r\n    }\r\n    \r\n    // Find the discount being deleted for better error messages\r\n    const discountToDelete = discounts.find(d => Number(d.discount_id) === id);\r\n    if (!discountToDelete) {\r\n      setError(\"Discount not found in the list\");\r\n      return;\r\n    }\r\n    \r\n    // Confirm before deleting\r\n    if (!window.confirm(`Are you sure you want to delete the discount \"${discountToDelete.label}\"?`)) {\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      setSaving(true);\r\n      setError(\"\");\r\n      \r\n      // Make the API call to delete the discount\r\n      await api(`/api/discounts/${id}`, {\r\n        method: \"DELETE\",\r\n      });\r\n      \r\n      // Update local state to remove the deleted discount\r\n      setDiscounts(prev => {\r\n        const deletedIndex = prev.findIndex(d => Number(d.discount_id) === id);\r\n        const newDiscounts = prev.filter(d => Number(d.discount_id) !== id);\r\n        \r\n        // Adjust selected indices if needed\r\n        if (deletedIndex !== -1) {\r\n          setSelectedIdx(prevIdx => {\r\n            if (prevIdx === deletedIndex) return Math.max(0, deletedIndex - 1);\r\n            if (prevIdx > deletedIndex) return prevIdx - 1;\r\n            return prevIdx;\r\n          });\r\n          \r\n          setSettingsSelectedIdx(prevIdx => {\r\n            if (prevIdx === deletedIndex) return Math.max(0, deletedIndex - 1);\r\n            if (prevIdx > deletedIndex) return prevIdx - 1;\r\n            return prevIdx;\r\n          });\r\n        }\r\n        \r\n        return newDiscounts;\r\n      });\r\n      \r\n    } catch (error) {\r\n      console.error(\"Failed to remove discount:\", error);\r\n      \r\n      // Handle 404 - discount not found\r\n      if (error.message && error.message.includes(\"not found\")) {\r\n        // Refresh the discount list from the server\r\n        try {\r\n          const token = sessionStorage.getItem(\"auth_token\");\r\n          const data = await api(\"/api/discounts\", {\r\n            headers: { Authorization: `Bearer ${token}` },\r\n          });\r\n          setDiscounts((data || []).map(d => ({\r\n            label: d.discount_name || `${d.discount_percentage}% off`,\r\n            value: d.discount_percentage,\r\n            discount_id: d.discount_id,\r\n            type: \"percentage\"\r\n          })));\r\n          setError(\"Discount not found. List has been refreshed.\");\r\n        } catch (refreshError) {\r\n          console.error(\"Failed to refresh discounts:\", refreshError);\r\n          setError(\"Discount not found. Could not refresh list.\");\r\n        }\r\n      } else {\r\n        // For other errors\r\n        setError(error.message || \"Failed to remove discount. Please try again.\");\r\n      }\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleSaveSettings = () => {\r\n    setShowSettings(false);\r\n  };\r\n\r\n  const handleApplyDiscount = () => {\r\n    if (selectedIdx == null) return;\r\n    const discount = discounts[selectedIdx];\r\n    if (!discount) return;\r\n    onApplyDiscount({\r\n      type: discount.type,\r\n      value: discount.value,\r\n      label: discount.label,\r\n      discount_id: discount.discount_id,\r\n    });\r\n    onClose();\r\n  };\r\n\r\n  const applyDiscountByIndex = (idx) => {\r\n    const discount = discounts[idx];\r\n    if (!discount) return;\r\n    setSelectedIdx(idx);\r\n    onApplyDiscount({\r\n      type: discount.type,\r\n      value: discount.value,\r\n      label: discount.label,\r\n      discount_id: discount.discount_id,\r\n    });\r\n    onClose();\r\n  };\r\n\r\n  // Settings Footer\r\n  const settingsFooterContent = (\r\n    <Button\r\n      label={\r\n        <div className=\"w-full flex items-center justify-between\">\r\n          <span>Save Settings</span>\r\n          <span className=\"text-xs font-mono bg-white/20 px-2 py-0.5 rounded\">\r\n            Enter\r\n          </span>\r\n        </div>\r\n      }\r\n      variant=\"primary\"\r\n      onClick={handleSaveSettings}\r\n      className=\"w-full\"\r\n    />\r\n  );\r\n\r\n  // Main Footer\r\n  const mainFooterContent = (\r\n    <div className=\"w-full space-y-2\">\r\n      <Button\r\n        label={\r\n          <div className=\"w-full flex items-center justify-between\">\r\n            <span>Apply Discount</span>\r\n            <span className=\"text-xs font-mono bg-white/20 px-2 py-0.5 rounded\">\r\n              Enter\r\n            </span>\r\n          </div>\r\n        }\r\n        variant=\"primary\"\r\n        onClick={handleApplyDiscount}\r\n        disabled={selectedIdx === null}\r\n        className=\"w-full\"\r\n      />\r\n      <Button\r\n        label={\r\n          <div className=\"w-full flex items-center justify-between\">\r\n            <span>Manage Discounts</span>\r\n            <span className=\"text-xs font-mono bg-gray-100 px-2 py-0.5 rounded text-gray-700\">\r\n              M\r\n            </span>\r\n          </div>\r\n        }\r\n        variant=\"secondary\"\r\n        onClick={() => setShowSettings(true)}\r\n        className=\"w-full\"\r\n      />\r\n    </div>\r\n  );\r\n\r\n  // Helper function to check if the event target is a form input\r\n  const isTypingTarget = (el) => {\r\n    if (!el) return false;\r\n    const tag = el.tagName?.toLowerCase();\r\n    return (\r\n      el.isContentEditable ||\r\n      tag === \"input\" ||\r\n      tag === \"textarea\" ||\r\n      el.getAttribute?.(\"role\") === \"textbox\"\r\n    );\r\n  };\r\n\r\n  // Scroll selected discount into view\r\n  useEffect(() => {\r\n    if (showSettings && discountListRef.current && settingsSelectedIdx !== null) {\r\n      const container = discountListRef.current;\r\n      const selectedElement = container.querySelector(`[data-discount-idx=\"${settingsSelectedIdx}\"]`);\r\n      if (selectedElement) {\r\n        selectedElement.scrollIntoView({\r\n          behavior: 'smooth',\r\n          block: 'nearest',\r\n          inline: 'nearest'\r\n        });\r\n      }\r\n    }\r\n  }, [settingsSelectedIdx, showSettings]);\r\n\r\n  // Auto-clear error messages after 5 seconds\r\n  useEffect(() => {\r\n    if (error) {\r\n      const timer = setTimeout(() => setError(\"\"), 5000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [error]);\r\n\r\n  // Handle keyboard shortcuts\r\n  useKeyboardShortcuts(\r\n    [\r\n      // Escape key - close modal\r\n      {\r\n        key: \"escape\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target)) {\r\n            e.target.blur?.();\r\n            return;\r\n          }\r\n          onClose();\r\n        },\r\n        enabled: isOpen,\r\n        allowWhileTyping: true,\r\n        stopPropagation: true,\r\n        preventDefault: true\r\n      },\r\n      // Enter key - apply, save settings, or add discount depending on context\r\n      {\r\n        key: \"enter\",\r\n        action: (e) => {\r\n          // If we're in an input field, let the default behavior happen\r\n          if (isTypingTarget(e?.target)) {\r\n            // If we're in settings view and both fields have content, add a new discount\r\n            if (showSettings && newDesc && newValue) {\r\n              e.preventDefault();\r\n              handleAddDiscount();\r\n            }\r\n            return;\r\n          }\r\n          \r\n          // In settings view, save settings\r\n          if (showSettings) {\r\n            e.preventDefault();\r\n            handleSaveSettings();\r\n            return;\r\n          }\r\n          \r\n          // In main view, apply the selected discount\r\n          handleApplyDiscount();\r\n        },\r\n        enabled: isOpen,\r\n        allowWhileTyping: true,\r\n        stopPropagation: true,\r\n        preventDefault: true\r\n      },\r\n      // M key - toggle manage discounts\r\n      {\r\n        key: \"m\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target)) return;\r\n          setShowSettings((prev) => !prev);\r\n        },\r\n        enabled: isOpen,\r\n        allowWhileTyping: false,\r\n        stopPropagation: true,\r\n        preventDefault: true\r\n      },\r\n      // Number keys 1-9 - select and apply discount (only when not typing)\r\n      ...Array.from({ length: 9 }).map((_, i) => ({\r\n        key: String(i + 1),\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target)) return;\r\n          if (!showSettings && discounts[i]) {\r\n            applyDiscountByIndex(i);\r\n          }\r\n        },\r\n        enabled: isOpen && !showSettings && discounts[i],\r\n        allowWhileTyping: false,\r\n        stopPropagation: true,\r\n        preventDefault: true\r\n      })),\r\n      // Arrow navigation for main list (ignore while typing)\r\n      {\r\n        key: \"arrowup\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target)) return;\r\n          if (showSettings || discounts.length === 0) return;\r\n          setSelectedIdx((prev) => {\r\n            if (prev == null) return 0;\r\n            return prev > 0 ? prev - 1 : 0;\r\n          });\r\n        },\r\n        enabled: isOpen && !showSettings,\r\n        allowWhileTyping: false,\r\n        stopPropagation: true,\r\n        preventDefault: true,\r\n      },\r\n      {\r\n        key: \"arrowdown\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target)) return;\r\n          if (showSettings || discounts.length === 0) return;\r\n          setSelectedIdx((prev) => {\r\n            if (prev == null) return 0;\r\n            return Math.min(prev + 1, discounts.length - 1);\r\n          });\r\n        },\r\n        enabled: isOpen && !showSettings,\r\n        allowWhileTyping: false,\r\n        stopPropagation: true,\r\n        preventDefault: true,\r\n      },\r\n      // Focus description field\r\n      {\r\n        key: \"n\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target) && e.target !== descInputRef.current) return;\r\n          if (!showSettings) return;\r\n          setTimeout(() => {\r\n            descInputRef.current?.focus();\r\n            descInputRef.current?.select?.();\r\n          }, 0);\r\n        },\r\n        enabled: isOpen && showSettings,\r\n        allowWhileTyping: true,\r\n        stopPropagation: false,\r\n        preventDefault: false,\r\n      },\r\n      // Focus value field\r\n      {\r\n        key: \"v\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target) && e.target !== valueInputRef.current) return;\r\n          if (!showSettings) return;\r\n          setTimeout(() => {\r\n            valueInputRef.current?.focus();\r\n            valueInputRef.current?.select?.();\r\n          }, 0);\r\n        },\r\n        enabled: isOpen && showSettings,\r\n        allowWhileTyping: true,\r\n        stopPropagation: false,\r\n        preventDefault: false,\r\n      },\r\n      // Manage: navigate rows (ignore while typing in inputs)\r\n      {\r\n        key: \"arrowup\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target)) return;\r\n          if (!showSettings || discounts.length === 0) return;\r\n          setSettingsSelectedIdx((prev) => Math.max(0, prev - 1));\r\n        },\r\n        enabled: isOpen && showSettings,\r\n        allowWhileTyping: false,\r\n        stopPropagation: true,\r\n        preventDefault: true,\r\n      },\r\n      {\r\n        key: \"arrowdown\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target)) return;\r\n          if (!showSettings || discounts.length === 0) return;\r\n          setSettingsSelectedIdx((prev) =>\r\n            Math.min(discounts.length - 1, (prev ?? 0) + 1)\r\n          );\r\n        },\r\n        enabled: isOpen && showSettings,\r\n        allowWhileTyping: false,\r\n        stopPropagation: true,\r\n        preventDefault: true,\r\n      },\r\n      // Manage: delete focused row (ignore while typing)\r\n      {\r\n        key: \"delete\",\r\n        action: (e) => {\r\n          if (isTypingTarget(e?.target)) return;\r\n          if (!showSettings || discounts.length === 0) return;\r\n          const target = discounts[settingsSelectedIdx];\r\n          if (target?.discount_id) handleRemove(target.discount_id);\r\n        },\r\n        enabled: isOpen && showSettings,\r\n        allowWhileTyping: false,\r\n        stopPropagation: true,\r\n        preventDefault: true,\r\n      },\r\n    ],\r\n    [\r\n      isOpen,\r\n      showSettings,\r\n      discounts,\r\n      selectedIdx,\r\n      handleApplyDiscount,\r\n      handleSaveSettings,\r\n      onClose,\r\n      settingsSelectedIdx,\r\n      handleAddDiscount,\r\n  ]\r\n  );\r\n\r\n  // Main Discount Modal\r\n  const renderMain = () => {\r\n    return (\r\n      <div className=\"space-y-4\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h3 className=\"text-lg font-medium\">Select Discount</h3>\r\n          <span className=\"text-sm text-gray-500\">Press 1-9 or ↑/↓, Enter to apply</span>\r\n        </div>\r\n        <div className=\"grid grid-cols-3 gap-2 mb-4 max-h-64 overflow-y-auto\">\r\n          {discounts.map((d, idx) => (\r\n            <button\r\n              key={`${d.type}-${idx}`}\r\n              className={`p-3 border rounded text-center ${\r\n                selectedIdx === idx\r\n                  ? \"border-blue-500 bg-blue-50\"\r\n                  : \"border-gray-200 hover:bg-gray-50\"\r\n              } relative group`}\r\n              onClick={() => setSelectedIdx(idx)}\r\n            >\r\n              <div className=\"absolute -top-2 -right-2 bg-blue-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center font-bold\">\r\n                {idx + 1}\r\n              </div>\r\n              <div className=\"font-medium\">{d.label}</div>\r\n              <div className=\"text-sm text-gray-500\">{d.value}%</div>\r\n              {selectedIdx === idx && (\r\n                <div className=\"absolute bottom-1 right-1 text-xs text-blue-500\">\r\n                  Press Enter to apply\r\n                </div>\r\n              )}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Settings Modal Content\r\n  const renderSettings = () => (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"flex gap-2\">\r\n        <button\r\n          className={`flex-1 px-4 py-2 rounded-lg font-semibold text-sm transition-all ${\r\n            settingsTab === \"PERCENTAGE\" ? \"bg-blue-600 text-white\" : \"bg-gray-200 text-gray-700\"\r\n          }`}\r\n          onClick={() => setSettingsTab(\"PERCENTAGE\")}\r\n        >\r\n          Percentage\r\n        </button>\r\n      </div>\r\n\r\n      {/* Discount List */}\r\n       <div \r\n        ref={discountListRef}\r\n        className=\"space-y-2 max-h-60 overflow-y-auto pr-2 -mr-2\"\r\n      >\r\n        {discounts.map((d, idx) => (\r\n          <div\r\n            key={idx}\r\n            data-discount-idx={idx}\r\n            className={`flex gap-2 items-center bg-gray-50 p-3 rounded-lg transition-all ${\r\n              settingsSelectedIdx === idx ? \"ring-2 ring-blue-400 bg-blue-50\" : \"hover:bg-gray-100\"\r\n            }`}\r\n          >\r\n            <input\r\n              className=\"flex-1 bg-transparent outline-none text-sm font-medium\"\r\n              value={d.label}\r\n              readOnly\r\n            />\r\n            <input\r\n              className=\"w-20 bg-transparent text-center outline-none text-sm font-medium\"\r\n              value={d.value}\r\n              readOnly\r\n            />\r\n            <button\r\n              className=\"text-red-500 hover:text-red-700 transition-colors p-1\"\r\n              onClick={() => handleRemove(d.discount_id)}\r\n              title=\"Remove (Del)\"\r\n              type=\"button\"\r\n            >\r\n              <svg\r\n                xmlns=\"http://www.w3.org/2000/svg\"\r\n                className=\"w-5 h-5\"\r\n                fill=\"none\"\r\n                viewBox=\"0 0 24 24\"\r\n                stroke=\"currentColor\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M6 18L18 6M6 6l12 12\"\r\n                />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Add new discount */}\r\n      <div\r\n        className=\"space-y-2 p-4 bg-blue-50 rounded-lg border border-blue-200\"\r\n        onKeyDown={(e) => {\r\n          if (e.key === \"Enter\") {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            handleAddDiscount();\r\n          }\r\n        }}\r\n      >\r\n        <div className=\"text-sm font-semibold text-blue-900 mb-2\">\r\n          Add New Discount (N=Name, V=Value, Enter=Add)\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <input\r\n            className=\"flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n            placeholder=\"Description\"\r\n            value={newDesc}\r\n            ref={descInputRef}\r\n            onKeyDown={(e) => handleInputKeyDown(e, 'desc')}\r\n            onFocus={() => setShowSettings(true)} // Ensure we're in settings mode when focused\r\n            onChange={(e) => setNewDesc(e.target.value)}\r\n          />\r\n          <input\r\n            className=\"w-24 border border-gray-300 rounded-lg px-3 py-2 text-sm text-center focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n            placeholder={settingsTab === \"PERCENTAGE\" ? \"0%\" : \"0.00\"}\r\n            inputMode={settingsTab === \"PERCENTAGE\" ? \"numeric\" : \"decimal\"}\r\n            value={newValue}\r\n            ref={valueInputRef}\r\n            onKeyDown={(e) => handleInputKeyDown(e, 'value')}\r\n            onFocus={() => setShowSettings(true)} // Ensure we're in settings mode when focused\r\n            onChange={(e) => setNewValue(e.target.value)}\r\n            type=\"number\"\r\n            min=\"0\"\r\n          />\r\n          <button\r\n            className=\"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-bold\"\r\n            onClick={handleAddDiscount}\r\n            title=\"Add (Enter)\"\r\n            type=\"button\"\r\n            disabled={saving}\r\n          >\r\n            {saving ? \"...\" : \"+\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title={showSettings ? \"Manage Discounts\" : \"Select Discount\"}\r\n      subtitle={\r\n        showSettings\r\n          ? \"Add or remove discount options\"\r\n          : \"Choose a discount to apply\"\r\n      }\r\n      icon={\r\n        <svg\r\n          className=\"w-5 h-5 text-white\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\"\r\n          />\r\n        </svg>\r\n      }\r\n      footer={showSettings ? settingsFooterContent : mainFooterContent}\r\n      size=\"md\"\r\n      contentClassName=\"space-y-4\"\r\n    >\r\n      {error && (\r\n        <div className=\"text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg px-3 py-2\">\r\n          {error}\r\n        </div>\r\n      )}\r\n      {showSettings ? renderSettings() : renderMain()}\r\n      {!showSettings && (\r\n        <div className=\"mt-4 pt-3 border-t border-gray-200\">\r\n          <div className=\"text-xs text-gray-500 space-y-1\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <span>Select discount:</span>\r\n              <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">1-9 / ↑↓</span>\r\n            </div>\r\n            <div className=\"flex items-center justify-between\">\r\n              <span>Apply selected discount:</span>\r\n              <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">Enter</span>\r\n            </div>\r\n            <div className=\"flex items-center justify-between\">\r\n              <span>Manage discounts:</span>\r\n              <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">M</span>\r\n            </div>\r\n            <div className=\"flex items-center justify-between\">\r\n              <span>Close modal:</span>\r\n              <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">Esc</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {showSettings && (\r\n        <div className=\"mt-4 pt-3 border-t border-gray-200\">\r\n          <div className=\"text-xs text-gray-500 space-y-1\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <span>Move selection:</span>\r\n              <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">↑ ↓</span>\r\n            </div>\r\n            <div className=\"flex items-center justify-between\">\r\n              <span>Delete selected:</span>\r\n              <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">Del</span>\r\n            </div>\r\n            <div className=\"flex items-center justify-between\">\r\n              <span>Focus name / value:</span>\r\n              <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">N / V</span>\r\n            </div>\r\n            <div className=\"flex items-center justify-between\">\r\n              <span>Add discount:</span>\r\n              <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">Enter</span>\r\n            </div>\r\n            <div className=\"flex items-center justify-between\">\r\n              <span>Close modal:</span>\r\n              <span className=\"font-mono bg-gray-100 px-2 py-0.5 rounded\">Esc</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default DiscountModal;","import React, { useState, useEffect } from \"react\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport Button from \"../common/Button\";\r\nimport { api } from \"../../lib/api\";\r\nimport {\r\n  MdAccountBalanceWallet,\r\n  MdSwapHoriz,\r\n  MdDescription,\r\n  MdChevronRight,\r\n} from \"react-icons/md\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nfunction CashLedgerModal({ isOpen, onClose }) {\r\n  // Tab state: \"SUMMARY\" or \"TRANSACTIONS\"\r\n  const [tab, setTab] = useState(\"SUMMARY\");\r\n  // Track which payment type is selected for filtered transactions view\r\n  const [selectedPaymentType, setSelectedPaymentType] = useState(null);\r\n\r\n  // Live data from backend\r\n  const [ledger, setLedger] = useState([]); // [{ name, balance }]\r\n  const [transactions, setTransactions] = useState([]);\r\n  const [loadingSummary, setLoadingSummary] = useState(false);\r\n  const [loadingTx, setLoadingTx] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n\r\n\r\n  // Fetch summary balances\r\n  const fetchLedger = async () => {\r\n    setLoadingSummary(true);\r\n    try {\r\n      setError(\"\");\r\n      const data = await api('/stats/cash-ledger');\r\n      // Expecting [{ name, balance }]\r\n      setLedger(Array.isArray(data) ? data : []);\r\n    } catch (err) {\r\n      setError(err.message || 'Failed to load cash ledger');\r\n    } finally {\r\n      setLoadingSummary(false);\r\n    }\r\n  };\r\n\r\n  // Fetch transactions (optionally filtered)\r\n  const fetchTransactions = async (paymentType = null) => {\r\n    setLoadingTx(true);\r\n    try {\r\n      setError(\"\");\r\n      const q = paymentType ? `/stats/cash-transactions?payment_type=${encodeURIComponent(paymentType)}&limit=100` : `/stats/cash-transactions?limit=100`;\r\n      const data = await api(q);\r\n      setTransactions(Array.isArray(data) ? data : []);\r\n    } catch (err) {\r\n      setError(err.message || 'Failed to load transactions');\r\n    } finally {\r\n      setLoadingTx(false);\r\n    }\r\n  };\r\n\r\n  // Load when modal opens\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    fetchLedger();\r\n    fetchTransactions();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [isOpen]);\r\n\r\n  useKeyboardShortcuts(\r\n    [\r\n      {\r\n        key: \"escape\",\r\n        action: onClose,\r\n        enabled: isOpen,\r\n        allowWhileTyping: true,\r\n      },\r\n      {\r\n        key: \"1\",\r\n        action: () => {\r\n          setTab(\"SUMMARY\");\r\n          setSelectedPaymentType(null);\r\n        },\r\n        enabled: isOpen,\r\n      },\r\n      {\r\n        key: \"2\",\r\n        action: () => {\r\n          setTab(\"TRANSACTIONS\");\r\n          setSelectedPaymentType(null);\r\n        },\r\n        enabled: isOpen,\r\n      },\r\n    ],\r\n    [isOpen, tab]\r\n  );\r\n\r\n  // Summary Page Component\r\n  const renderSummary = () => {\r\n    const totalCash = ledger.reduce((sum, type) => sum + (Number(type.balance) || 0), 0);\r\n\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        {/* Total Cash Display */}\r\n        <div className=\"bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-700 text-white rounded-lg shadow-xl px-8 py-8 text-center\">\r\n          <p className=\"text-sm font-semibold text-blue-100 mb-2\">Total Cash on Hand</p>\r\n          <div className=\"text-5xl font-bold flex items-center justify-center gap-2\">\r\n            <span className=\"text-4xl\">₱</span>\r\n            {totalCash.toFixed(2)}\r\n          </div>\r\n          <p className=\"text-blue-100 text-sm mt-3\">\r\n            {new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}\r\n          </p>\r\n        </div>\r\n\r\n        {/* Payment Types Section */}\r\n        <div>\r\n          <div className=\"flex items-center gap-2 mb-4\">\r\n            <div className=\"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center\">\r\n              <MdAccountBalanceWallet className=\"w-5 h-5 text-white\" />\r\n            </div>\r\n            <h3 className=\"font-semibold text-gray-900\">Payment Methods</h3>\r\n          </div>\r\n          <div className=\"space-y-3\">\r\n            {loadingSummary ? (\r\n              <div className=\"text-sm text-gray-500\">Loading...</div>\r\n            ) : ledger.length === 0 ? (\r\n              <div className=\"text-sm text-gray-500\">No balances available</div>\r\n            ) : (\r\n              ledger.map((type) => (\r\n                <button\r\n                  key={type.name}\r\n                  onClick={async () => {\r\n                    setSelectedPaymentType(type.name);\r\n                    setTab('TRANSACTIONS');\r\n                    await fetchTransactions(type.name);\r\n                  }}\r\n                  className=\"w-full bg-gradient-to-r from-gray-50 to-gray-100/50 hover:from-blue-50 hover:to-indigo-50/50 rounded-2xl p-4 border border-gray-200/50 hover:border-blue-300 transition-all duration-200 group\"\r\n                >\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-3 flex-1\">\r\n                      <div className=\"w-10 h-10 bg-white rounded-lg flex items-center justify-center border border-gray-200 group-hover:border-blue-300 group-hover:bg-blue-50 transition-all\">\r\n                        <svg className=\"w-5 h-5 text-gray-600 group-hover:text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                        </svg>\r\n                      </div>\r\n                      <div className=\"text-left\">\r\n                        <p className=\"font-semibold text-gray-900\">{type.name}</p>\r\n                        <p className=\"text-xs text-gray-500\">View transactions</p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"text-right\">\r\n                        <p className=\"text-lg font-bold text-blue-600\">₱{(Number(type.balance) || 0).toFixed(2)}</p>\r\n                      </div>\r\n                      <MdChevronRight className=\"w-5 h-5 text-gray-400 group-hover:text-blue-600 transition-colors\" />\r\n                    </div>\r\n                  </div>\r\n                </button>\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n        {error && (\r\n          <div className=\"text-sm text-red-600\">\r\n            {error.includes('Server returned an HTML error page') || error.includes('Cannot GET')\r\n              ? 'Unable to reach backend API. Check backend server and proxy configuration.'\r\n              : error}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Transactions Page\r\n  const renderTransactions = () => {\r\n    return (\r\n      <div className=\"space-y-4\">\r\n        {/* Transactions Title */}\r\n        <div className=\"bg-gradient-to-r from-indigo-50 to-blue-50 rounded-2xl p-4 border border-indigo-100/50\">\r\n          <h3 className=\"font-bold text-lg text-gray-900\">{selectedPaymentType ? `${selectedPaymentType} Transactions` : 'All Transactions'}</h3>\r\n          <p className=\"text-sm text-gray-600 mt-1\">{loadingTx ? 'Loading...' : `${transactions.length} transaction${transactions.length !== 1 ? 's' : ''} found`}</p>\r\n        </div>\r\n\r\n        {/* Transactions Table */}\r\n        <div className=\"bg-white rounded-2xl border border-gray-200/50 overflow-hidden\">\r\n          {loadingTx ? (\r\n            <div className=\"text-center py-12 text-sm text-gray-500\">Loading transactions...</div>\r\n          ) : transactions.length === 0 ? (\r\n            <div className=\"text-center py-12\">\r\n              <svg className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n              </svg>\r\n              <p className=\"text-gray-500 font-medium\">No transactions found</p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"w-full\">\r\n                <thead>\r\n                  <tr className=\"bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200/50\">\r\n                    <th className=\"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider\">Date & Time</th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider\">Type</th>\r\n                    <th className=\"px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider\">Amount</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"divide-y divide-gray-100\">\r\n                  {transactions.map((tx) => (\r\n                    <tr key={String(tx.transaction_id)} className=\"hover:bg-blue-50/50 transition-colors duration-150\">\r\n                      <td className=\"px-6 py-4 text-sm text-gray-600 font-medium\">{new Date(tx.created_at).toLocaleString()}</td>\r\n                      <td className=\"px-6 py-4 text-sm\"><span className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 border border-blue-200\">{tx.payment_type}</span></td>\r\n                      <td className=\"px-6 py-4 text-sm text-right font-bold text-green-600\">₱{(Number(tx.total) || 0).toFixed(2)}</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Tab button content\r\n  const tabContent = (\r\n    <div className=\"flex gap-2 border-t border-gray-200/50 pt-4 mt-4\">\r\n      <button\r\n        onClick={() => {\r\n          setTab(\"SUMMARY\");\r\n          setSelectedPaymentType(null);\r\n        }}\r\n        className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-semibold transition-all ${\r\n          tab === \"SUMMARY\"\r\n            ? \"bg-blue-600 text-white shadow-md\"\r\n            : \"bg-gray-100 text-gray-700 hover:bg-gray-200\"\r\n        }`}\r\n      >\r\n        <MdDescription className=\"w-5 h-5\" />\r\n        <span>Summary (1)</span>\r\n      </button>\r\n      <button\r\n        onClick={() => {\r\n          setTab(\"TRANSACTIONS\");\r\n          setSelectedPaymentType(null);\r\n        }}\r\n        className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-semibold transition-all ${\r\n          tab === \"TRANSACTIONS\"\r\n            ? \"bg-blue-600 text-white shadow-md\"\r\n            : \"bg-gray-100 text-gray-700 hover:bg-gray-200\"\r\n        }`}\r\n      >\r\n        <MdSwapHoriz className=\"w-5 h-5\" />\r\n        <span>Transactions (2)</span>\r\n      </button>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Cash Ledger\"\r\n      subtitle=\"View cash balance and payment methods\"\r\n      icon={<MdAccountBalanceWallet className=\"w-6 h-6 text-white\" />}\r\n      size=\"lg\"\r\n      contentClassName=\"space-y-4\"\r\n    >\r\n      <div className=\"space-y-6\">\r\n        {tab === \"SUMMARY\" ? renderSummary() : renderTransactions()}\r\n        {tabContent}\r\n        <div className=\"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <span>Summary view:</span>\r\n            <span className=\"font-mono bg-white px-2 py-0.5 rounded\">1</span>\r\n          </div>\r\n          <div className=\"flex items-center justify-between\">\r\n            <span>Transactions view:</span>\r\n            <span className=\"font-mono bg-white px-2 py-0.5 rounded\">2</span>\r\n          </div>\r\n          <div className=\"flex items-center justify-between\">\r\n            <span>Close:</span>\r\n            <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Esc</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default CashLedgerModal;\r\n","import React from \"react\";\r\nimport Button from \"../common/Button\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nfunction CheckoutModal({ isOpen, onClose, total, onSelectPayment }) {\r\n  useKeyboardShortcuts(\r\n    [\r\n      { key: \"1\", action: () => onSelectPayment(\"cash\"), enabled: isOpen },\r\n      { key: \"2\", action: () => onSelectPayment(\"gcash\"), enabled: isOpen },\r\n      { key: \"3\", action: () => onSelectPayment(\"maya\"), enabled: isOpen },\r\n      { key: \"enter\", action: () => onSelectPayment(\"cash\"), enabled: isOpen },\r\n      { key: \"escape\", action: onClose, enabled: isOpen },\r\n    ],\r\n    [isOpen]\r\n  );\r\n\r\n  const footerContent = (\r\n    <div className=\"w-full flex flex-col gap-3\">\r\n      <Button\r\n        label=\"CASH (1 / Enter)\"\r\n        className=\"w-full h-12 text-base font-bold\"\r\n        onClick={() => onSelectPayment(\"cash\")}\r\n      />\r\n      <Button\r\n        label=\"GCASH (2)\"\r\n        className=\"w-full h-12 text-base font-bold\"\r\n        onClick={() => onSelectPayment(\"gcash\")}\r\n      />\r\n      <Button\r\n        label=\"MAYA (3)\"\r\n        className=\"w-full h-12 text-base font-bold\"\r\n        onClick={() => onSelectPayment(\"maya\")}\r\n      />\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Checkout\"\r\n      subtitle=\"Select payment method\"\r\n      icon={\r\n        <svg\r\n          className=\"w-5 h-5 text-white\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"\r\n          />\r\n        </svg>\r\n      }\r\n      footer={footerContent}\r\n      size=\"sm\"\r\n      contentClassName=\"text-center\"\r\n    >\r\n      <div className=\"bg-blue-500 text-white rounded-2xl py-6 px-4 text-center mb-4\">\r\n        <div className=\"text-sm opacity-90 mb-2\">Total Amount</div>\r\n        <div className=\"text-4xl font-bold\">₱{total.toFixed(2)}</div>\r\n      </div>\r\n      <p className=\"text-gray-600 text-sm mb-4\">\r\n        Choose your preferred payment method\r\n      </p>\r\n      <div className=\"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 space-y-1\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Cash:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">1 / Enter</span>\r\n        </div>\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>GCash:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">2</span>\r\n        </div>\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Maya:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">3</span>\r\n        </div>\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Close:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Esc</span>\r\n        </div>\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default CheckoutModal;\r\n","import React from \"react\";\r\nimport Button from \"../common/Button\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nfunction CashPaymentCompleteModal({\r\n  isOpen,\r\n  onClose,\r\n  change = 0,\r\n  payable = 0,\r\n  onReceipt,\r\n  onNewEntry,\r\n}) {\r\n  useKeyboardShortcuts(\r\n    [\r\n      {\r\n        key: \"escape\",\r\n        action: onClose,\r\n        enabled: isOpen,\r\n        allowWhileTyping: true,\r\n      },\r\n      {\r\n        key: \"enter\",\r\n        action: () => {\r\n          if (onReceipt) onReceipt();\r\n        },\r\n        enabled: isOpen,\r\n        allowWhileTyping: true,\r\n      },\r\n    ],\r\n    [isOpen]\r\n  );\r\n\r\n  const footerContent = (\r\n    <div className=\"w-full flex flex-col gap-3\">\r\n      <Button\r\n        label=\"RECEIPT (Enter)\"\r\n        className=\"w-full h-11 text-sm font-semibold bg-blue-700 hover:bg-blue-800 text-white\"\r\n        onClick={() => {\r\n          if (onReceipt) onReceipt();\r\n          else alert(\"Receipt\");\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Payment Complete\"\r\n      icon={\r\n        <svg\r\n          className=\"w-5 h-5 text-white\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M5 13l4 4L19 7\"\r\n          />\r\n        </svg>\r\n      }\r\n      footer={footerContent}\r\n      size=\"sm\"\r\n      contentClassName=\"text-center space-y-4\"\r\n    >\r\n      {/* Success Check Icon */}\r\n      <div className=\"flex justify-center mb-2\">\r\n        <div className=\"w-14 h-14 rounded-full bg-green-100 flex items-center justify-center\">\r\n          <svg\r\n            xmlns=\"http://www.w3.org/2000/svg\"\r\n            className=\"h-7 w-7 text-green-600\"\r\n            fill=\"none\"\r\n            viewBox=\"0 0 24 24\"\r\n            stroke=\"currentColor\"\r\n          >\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              d=\"M5 13l4 4L19 7\"\r\n            />\r\n          </svg>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Change Amount */}\r\n      <div className=\"bg-gradient-to-br from-blue-400 to-indigo-500 rounded-2xl p-5 text-white\">\r\n        <div className=\"text-xs uppercase tracking-wide opacity-90 mb-2\">\r\n          Change\r\n        </div>\r\n\r\n        <div className=\"inline-flex items-baseline gap-2 bg-white text-blue-700 rounded-lg px-4 py-3 shadow-md\">\r\n          <span className=\"text-lg font-bold\">₱</span>\r\n          <span className=\"text-2xl font-bold\">\r\n            {Number(change).toFixed(2)}\r\n          </span>\r\n        </div>\r\n\r\n        <div className=\"mt-4 text-sm opacity-90\">Payable</div>\r\n        <div className=\"text-sm font-semibold\">\r\n          ₱{Number(payable).toFixed(2)}\r\n        </div>\r\n      </div>\r\n      <div className=\"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 space-y-1\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Print / open receipt:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Enter</span>\r\n        </div>\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Close:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Esc</span>\r\n        </div>\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default CashPaymentCompleteModal;\r\n","import React, { useState, useRef } from \"react\";\r\nimport Button from \"../common/Button\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport CashPaymentCompleteModal from \"./CashPaymentCompleteModal\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nfunction CashPaymentModal({ isOpen, onClose, total, onConfirm }) {\r\n  const [amountReceived, setAmountReceived] = useState(\"\");\r\n  const [showComplete, setShowComplete] = useState(false);\r\n  const [completeData, setCompleteData] = useState(null);\r\n  const amountInputRef = useRef(null);\r\n  const justSetExactAmount = useRef(false);\r\n\r\n  const handleQuickAmount = (val) => setAmountReceived(Number(val).toString());\r\n\r\n  const handleExactAmount = (e) => {\r\n    if (e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n    // Set as a number to avoid string formatting issues\r\n    const exactAmount = Number(total).toFixed(2);\r\n    setAmountReceived(exactAmount);\r\n    justSetExactAmount.current = true;\r\n    // Reset the flag after a short delay\r\n    setTimeout(() => {\r\n      justSetExactAmount.current = false;\r\n    }, 200);\r\n  };\r\n\r\n  const handleProceed = (e) => {\r\n    if (e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n    \r\n    // Get the current value from the input element directly (more reliable than state)\r\n    const inputValue = amountInputRef.current?.value || amountReceived;\r\n    \r\n    // If we just set exact amount, use the total directly\r\n    let amountToUse = inputValue;\r\n    if (justSetExactAmount.current) {\r\n      amountToUse = Number(total).toFixed(2);\r\n    }\r\n    \r\n    // Trim and parse the input value\r\n    const trimmedAmount = (amountToUse?.toString() || \"\").trim();\r\n    if (!trimmedAmount) {\r\n      alert(\"Please enter an amount.\");\r\n      return;\r\n    }\r\n    const received = Number(trimmedAmount);\r\n    if (isNaN(received) || received <= 0) {\r\n      alert(\"Please enter a valid amount.\");\r\n      return;\r\n    }\r\n    // Round both values to 2 decimal places to avoid floating-point precision issues\r\n    const receivedRounded = Math.round(received * 100) / 100;\r\n    const totalRounded = Math.round(total * 100) / 100;\r\n    if (receivedRounded < totalRounded) {\r\n      alert(`Amount received (₱${receivedRounded.toFixed(2)}) must be greater than or equal to total (₱${totalRounded.toFixed(2)}).`);\r\n      return;\r\n    }\r\n    // compute change and show completion modal; delay calling parent onConfirm\r\n    // so cashier can view the completion screen before the app navigates\r\n    const change = Math.max(0, receivedRounded - totalRounded);\r\n    setCompleteData({ change, payable: totalRounded, received: receivedRounded });\r\n    setShowComplete(true);\r\n  };\r\n  \r\n  // Handle completion modal close\r\n  const handleCompleteClose = () => {\r\n    setShowComplete(false);\r\n    if (onClose) onClose();\r\n  };\r\n  \r\n  // Handle new entry from completion modal\r\n  const handleNewEntry = () => {\r\n    setShowComplete(false);\r\n    setAmountReceived(\"\");\r\n    if (onClose) onClose();\r\n  };\r\n  \r\n  // Handle receipt printing from completion modal\r\n  const handleReceipt = () => {\r\n    if (onConfirm && completeData?.received != null) {\r\n      onConfirm(Number(completeData.received));\r\n    }\r\n  };\r\n\r\n  // Only set up keyboard shortcuts when not showing completion modal\r\n  // Hooks must be called before any early returns\r\n  useKeyboardShortcuts(\r\n    [\r\n      {\r\n        key: \"escape\",\r\n        action: onClose,\r\n        enabled: isOpen && !showComplete,\r\n        allowWhileTyping: true,\r\n      },\r\n      {\r\n        key: \"enter\",\r\n        action: (e) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          handleProceed(e);\r\n        },\r\n        enabled: isOpen && !showComplete,\r\n        allowWhileTyping: true,\r\n      },\r\n      {\r\n        key: \"e\",\r\n        action: handleExactAmount,\r\n        enabled: isOpen && !showComplete,\r\n        allowWhileTyping: true,\r\n      },\r\n    ],\r\n    [isOpen, amountReceived, total, showComplete]\r\n  );\r\n  \r\n  // Early return if not open and not showing completion modal\r\n  if (!isOpen && !showComplete) return null;\r\n  \r\n  // Render completion modal if needed\r\n  if (showComplete) {\r\n    return (\r\n      <CashPaymentCompleteModal\r\n        isOpen={showComplete}\r\n        onClose={handleCompleteClose}\r\n        change={completeData?.change}\r\n        payable={completeData?.payable}\r\n        onNewEntry={handleNewEntry}\r\n        onReceipt={handleReceipt}\r\n      />\r\n    );\r\n  }\r\n\r\n  const footerContent = (\r\n    <>\r\n      <Button\r\n        label=\"Cancel (Esc)\"\r\n        variant=\"secondary\"\r\n        onClick={onClose}\r\n        type=\"button\"\r\n        className=\"flex-1\"\r\n      />\r\n      <Button\r\n        label=\"Proceed (Enter)\"\r\n        variant=\"primary\"\r\n        type=\"button\"\r\n        onClick={handleProceed}\r\n        className=\"flex-1\"\r\n      />\r\n    </>\r\n  );\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Cash Payment\"\r\n      subtitle=\"Enter amount received\"\r\n      icon={\r\n        <svg\r\n          className=\"w-5 h-5 text-white\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n          />\r\n        </svg>\r\n      }\r\n      footer={footerContent}\r\n      size=\"md\"\r\n      contentClassName=\"space-y-4\"\r\n    >\r\n      {/* Total Amount */}\r\n      <div className=\"bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-2xl py-6 px-4 text-center\">\r\n        <div className=\"text-sm opacity-90 mb-2\">Total Amount</div>\r\n        <div className=\"text-4xl font-bold\">₱{total.toFixed(2)}</div>\r\n      </div>\r\n\r\n      {/* Input */}\r\n      <div>\r\n        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n          Amount Received\r\n        </label>\r\n        <input\r\n          ref={amountInputRef}\r\n          type=\"number\"\r\n          step=\"0.01\"\r\n          className=\"w-full border border-gray-300 rounded-lg px-3 py-2 text-center text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n          placeholder=\"₱0.00\"\r\n          value={amountReceived}\r\n          onChange={(e) => {\r\n            // Allow empty string or valid numbers\r\n            const value = e.target.value;\r\n            if (value === '' || /^\\d*\\.?\\d*$/.test(value)) {\r\n              setAmountReceived(value);\r\n            }\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      {/* Quick Select Buttons */}\r\n      <div>\r\n        <p className=\"text-xs text-gray-600 mb-2\">Quick amounts:</p>\r\n        <div className=\"grid grid-cols-3 gap-2\">\r\n          {[100, 200, 300, 400, 500, 600, 700, 800, 900].map((val) => (\r\n            <button\r\n              key={val}\r\n              className=\"bg-blue-100 hover:bg-blue-200 text-blue-700 font-bold py-2 rounded-lg transition-colors text-sm\"\r\n              onClick={() => handleQuickAmount(val)}\r\n            >\r\n              {val}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Exact Amount Button */}\r\n      <Button\r\n        label=\"Use Exact Amount (E)\"\r\n        className=\"w-full h-10 text-sm font-bold bg-slate-600 hover:bg-slate-700 text-white\"\r\n        onClick={handleExactAmount}\r\n      />\r\n      <div className=\"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 space-y-1\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Use exact total:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">E</span>\r\n        </div>\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Proceed:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Enter</span>\r\n        </div>\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Close:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Esc</span>\r\n        </div>\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default CashPaymentModal;\r\n","import React, { useState } from \"react\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport ScannerCard from \"../ui/POS/ScannerCard\";\r\nimport Button from \"../common/Button\";\r\nimport { api } from \"../../lib/api\";\r\nimport { useKeyboardShortcuts } from \"../../hooks/useKeyboardShortcuts\";\r\n\r\nexport default function ScanCustomerCartModal({ isOpen, onClose, onImport }) {\r\n  const [scannerPaused, setScannerPaused] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const token = sessionStorage.getItem(\"auth_token\");\r\n\r\n  const user = JSON.parse(sessionStorage.getItem(\"user\") || \"{}\");\r\n\r\n  const handleScan = async (result) => {\r\n    const code = result?.[0]?.rawValue;\r\n    if (!code) return;\r\n    setScannerPaused(true);\r\n    setError(\"\");\r\n    try {\r\n      let payload;\r\n      try {\r\n        payload = JSON.parse(code);\r\n      } catch (e) {\r\n        throw new Error(\"Invalid QR payload\");\r\n      }\r\n      \r\n      // Check if this is a cart QR code with transaction ID\r\n      if (payload.t === 'cart' && payload.transaction_id) {\r\n        const { transaction_id, business_id: businessId } = payload;\r\n        \r\n        // Verify business ID matches if provided\r\n        const cashierBusinessId = user?.businessId || user?.business_id;\r\n        if (businessId && cashierBusinessId && Number(businessId) !== Number(cashierBusinessId)) {\r\n          throw new Error(\"This QR code is not valid for this store.\");\r\n        }\r\n\r\n        // Complete the existing transaction instead of creating a new one\r\n        try {\r\n          const response = await api(`/api/sales/${transaction_id}/complete`, {\r\n            method: 'POST',\r\n            headers: { Authorization: `Bearer ${token}` },\r\n          });\r\n          \r\n          if (response.transaction_id) {\r\n            // Transaction completed successfully - navigate to receipt\r\n            onClose();\r\n            // Navigate to receipt page for cashier\r\n            window.location.href = `/receipt?tn=${response.transaction_number}`;\r\n            return;\r\n          } else {\r\n            throw new Error(\"Failed to complete transaction\");\r\n          }\r\n        } catch (err) {\r\n          console.error('Error completing transaction:', err);\r\n          throw new Error(err.message || \"Failed to complete customer transaction\");\r\n        }\r\n      }\r\n      // Existing cart import logic for backward compatibility\r\n      else if (payload.t === 'cart' && Array.isArray(payload.items)) {\r\n        const { items: compactItems, b: businessId } = payload;\r\n        const cashierBusinessId = user?.businessId || user?.business_id;\r\n\r\n        if (businessId && cashierBusinessId && Number(businessId) !== Number(cashierBusinessId)) {\r\n          throw new Error(\"This QR code is not valid for this store.\");\r\n        }\r\n\r\n        const fullItems = [];\r\n        for (const it of compactItems) {\r\n          if (!it?.p || !it?.q) continue;\r\n          const product = await api(`/api/products/${encodeURIComponent(it.p)}`, {\r\n            headers: { Authorization: `Bearer ${token}` },\r\n          });\r\n          fullItems.push({\r\n            product_id: product.product_id,\r\n            sku: product.sku,\r\n            name: product.product_name,\r\n            quantity: Number(it.q),\r\n            price: Number(product.selling_price || 0)\r\n          });\r\n        }\r\n        if (fullItems.length === 0) throw new Error(\"No items to import\");\r\n        onImport(fullItems);\r\n        onClose();\r\n      } else {\r\n        throw new Error(\"Unsupported QR code format\");\r\n      }\r\n    } catch (e) {\r\n      setError(e.message || \"Failed to process QR code\");\r\n      console.error('Scan error:', e);\r\n    } finally {\r\n      setScannerPaused(false);\r\n    }\r\n  };\r\n\r\n  const footerContent = (\r\n    <Button\r\n      label=\"Close (Esc)\"\r\n      variant=\"secondary\"\r\n      onClick={onClose}\r\n      className=\"w-full\"\r\n    />\r\n  );\r\n\r\n  useKeyboardShortcuts(\r\n    [{ key: \"escape\", action: onClose, enabled: isOpen }],\r\n    [isOpen]\r\n  );\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Scan Customer Cart\"\r\n      subtitle=\"Ask customer to show their QR\"\r\n      icon={\r\n        <svg\r\n          className=\"w-5 h-5 text-white\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n            strokeWidth={2}\r\n            d=\"M12 4v16m8-8H4\"\r\n          />\r\n        </svg>\r\n      }\r\n      footer={footerContent}\r\n      size=\"lg\"\r\n      contentClassName=\"space-y-3\"\r\n    >\r\n      <div className=\"text-blue-800 text-sm font-medium\">\r\n        Ask the customer to show their cart QR code\r\n      </div>\r\n      <div className=\"h-[50vh]\">\r\n        <ScannerCard\r\n          onScan={handleScan}\r\n          paused={scannerPaused}\r\n          onResume={() => setScannerPaused(false)}\r\n          className=\"w-full h-full\"\r\n        />\r\n      </div>\r\n      {error && (\r\n        <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm\">\r\n          {error}\r\n        </div>\r\n      )}\r\n      <div className=\"text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Close:</span>\r\n          <span className=\"font-mono bg-white px-2 py-0.5 rounded\">Esc</span>\r\n        </div>\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n"],"names":["SkuFormCard","React","forwardRef","sku","setSku","quantity","setQuantity","handleAddToCart","quantityInputRef","className","ref","jsx","Card","variant","children","jsxs","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","type","name","value","onChange","e","target","onKeyPress","key","trim","placeholder","onClick","Math","max","min","Number","Button","label","size","microinteraction","icon","iconPosition","CartTableCard","cart","handleRemove","handleEditQuantity","total","selectedIdx","onSelectRow","appliedDiscount","editingIdx","editQty","onEditQtyChange","onEditComplete","handleRowClick","handleQtyChange","test","parseInt","handleSaveQuantity","idx","qty","EditIcon","width","height","DeleteIcon","CheckIcon","XIcon","length","colSpan","map","item","tagName","inputMode","pattern","onKeyDown","onBlur","autoFocus","onFocus","select","title","price","toFixed","stopPropagation","reduce","sum","PriceCheckModal","isOpen","onClose","product","setProduct","useState","handleCheck","async","businessId","localStorage","getItem","query","encodeURIComponent","res","api","product_name","selling_price","_","useEffect","t","setTimeout","clearTimeout","footerContent","useKeyboardShortcuts","action","enabled","allowWhileTyping","BaseModal","subtitle","footer","contentClassName","ScannerCard","onScan","result","code","rawValue","paused","onResume","textMain","DiscountModal","onApplyDiscount","showSettings","setShowSettings","discounts","setDiscounts","newDesc","setNewDesc","newValue","setNewValue","setSelectedIdx","settingsSelectedIdx","setSettingsSelectedIdx","loading","setLoading","error","setError","saving","setSaving","settingsTab","setSettingsTab","descInputRef","useRef","valueInputRef","discountListRef","handleInputKeyDown","field","preventDefault","blur","handleAddDiscount","includes","keyCode","ctrlKey","shiftKey","requestAnimationFrame","current","focus","token","sessionStorage","discountList","headers","Authorization","discount_name","discount_percentage","discount_id","fetchDiscounts","payload","created","method","body","JSON","stringify","prev","discountId","id","isNaN","discountToDelete","find","window","confirm","deletedIndex","findIndex","newDiscounts","filter","prevIdx","message","data","refreshError","handleSaveSettings","handleApplyDiscount","discount","settingsFooterContent","mainFooterContent","disabled","isTypingTarget","el","tag","toLowerCase","isContentEditable","getAttribute","selectedElement","querySelector","scrollIntoView","behavior","block","inline","timer","Array","from","i","String","applyDiscountByIndex","readOnly","xmlns","CashLedgerModal","tab","setTab","selectedPaymentType","setSelectedPaymentType","ledger","setLedger","transactions","setTransactions","loadingSummary","setLoadingSummary","loadingTx","setLoadingTx","fetchTransactions","paymentType","q","isArray","err","fetchLedger","tabContent","MdDescription","MdSwapHoriz","MdAccountBalanceWallet","renderSummary","totalCash","balance","Date","toLocaleDateString","weekday","year","month","day","MdChevronRight","tx","created_at","toLocaleString","payment_type","transaction_id","CheckoutModal","onSelectPayment","CashPaymentCompleteModal","change","payable","onReceipt","onNewEntry","CashPaymentModal","onConfirm","amountReceived","setAmountReceived","showComplete","setShowComplete","completeData","setCompleteData","amountInputRef","justSetExactAmount","handleExactAmount","exactAmount","handleProceed","amountToUse","trimmedAmount","toString","alert","received","receivedRounded","round","totalRounded","handleCompleteClose","handleNewEntry","handleReceipt","Fragment","step","val","handleQuickAmount","ScanCustomerCartModal","onImport","scannerPaused","setScannerPaused","user","parse","Error","business_id","cashierBusinessId","response","location","href","transaction_number","items","compactItems","b","fullItems","it","p","push","product_id"],"mappings":"kXAUA,MAAAA,EAAeC,EAAMC,WACnB,EAEIC,MACAC,SACAC,WACAC,cACAC,kBACAC,mBACAC,YAAY,IAEdC,IAGEC,EAAAA,IAACC,EACC,CAAAH,UAAW,4HAA4HA,IACvII,QAAQ,QAERC,SAAAC,OAAC,MAAI,CAAAN,UAAU,iCACbK,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,iCACbK,SAAA,CAACH,EAAAA,IAAA,MAAA,CAAIF,UAAU,kEACbK,SAACH,EAAAA,IAAA,MAAA,CACCF,UAAU,wBACVO,KAAK,OACLC,OAAO,eACPC,QAAQ,YAERJ,SAACH,EAAAA,IAAA,OAAA,CACCQ,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,4CAIPX,EAAAA,IAAA,OAAA,CAAKF,UAAU,kCAAkCK,SAElD,sBAGFC,EAAAA,KAAC,MAAI,CAAAN,UAAU,YACbK,SAAA,CAAAC,OAAC,MACC,CAAAD,SAAA,CAACH,EAAAA,IAAA,QAAA,CAAMF,UAAU,iDAAiDK,SAElE,aACAH,EAAAA,IAAC,OAAIF,UAAU,WACbK,eAAC,QACC,CAAAJ,MACAa,KAAK,OACLC,KAAK,MACLC,MAAOtB,EACPuB,SAAiBtB,GAAAA,EAAOuB,EAAEC,OAAOH,OACjCI,WAAmBF,IACH,UAAVA,EAAEG,KAAmB3B,EAAI4B,QACXxB,KAGpByB,YAAY,yBACZvB,UAAU,0NAKhBM,EAAAA,KAAC,MAAI,CAAAN,UAAU,0BACbK,SAAA,CAACH,EAAAA,IAAA,QAAA,CAAMF,UAAU,wDAAwDK,SAEzE,cACAC,EAAAA,KAAC,MAAI,CAAAN,UAAU,iCACbK,SAAA,CAAAH,EAAAA,IAAC,SACC,CAAAsB,QAAS,IAAM3B,EAAY4B,KAAKC,IAAI,EAAG9B,EAAW,IAClDI,UAAU,2IACXK,SAED,MACAH,EAAAA,IAAC,QACC,CAAAY,KAAK,SACLC,KAAK,WACLC,MAAOpB,EACP+B,IAAK,EACL1B,IAAKF,EACLkB,SACEpB,GAAAA,EAAY4B,KAAKC,IAAI,EAAGE,OAAOV,EAAEC,OAAOH,QAAU,IAEpDhB,UAAU,uMAEZE,EAAAA,IAAC,SACC,CAAAsB,QAAS,IAAM3B,EAAYD,EAAW,GACtCI,UAAU,2IACXK,SAED,eAEDwB,EACC,CAAAC,MAAM,cACNN,QAAS1B,EACTM,QAAQ,UACR2B,KAAK,KACLC,kBAAgB,EAChBC,KACG/B,EAAAA,IAAA,MAAA,CACCF,UAAU,UACVO,KAAK,OACLC,OAAO,eACPC,QAAQ,YAERJ,SAACH,EAAAA,IAAA,OAAA,CACCQ,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,qBAIRqB,aAAa,qBCnH7B,SAASC,GAAcC,KACrBA,EAAAA,aACAC,EAAAA,mBACAC,EAAAA,MACAC,EAAAA,UACAvC,EAAY,GAAAwC,YACZA,GAAc,EAAAC,YACdA,EAAAA,gBACAC,EAAAA,WACAC,EAAa,KAAAC,QACbA,EAAU,EAAAC,gBACVA,EAAAA,eACAC,IAIMC,MAOAC,EAAyB9B,IACvBF,MAAAA,EAAQE,EAAEC,OAAOH,OAET,KAAVA,GAAgB,QAAQiC,KAAKjC,KAC/B6B,IAA4B,KAAV7B,EAAe,GAAKkC,SAASlC,EAAO,MAKpDmC,EAA8BC,IAClC,MAAMC,EAAkB,KAAZT,EAAiB,EAAInB,KAAKC,IAAI,EAAGkB,GAC7CN,EAAmBc,EAAKC,GACPP,OAGbQ,EAAWA,IACdpD,MAAA,MAAA,CACCqD,MAAM,KACNC,OAAO,KACPjD,KAAK,OACLC,OAAO,eACPI,YAAY,IACZH,QAAQ,YAERJ,eAAC,OAAK,CAAAQ,EAAE,wJAIN4C,EAAaA,IAChBvD,MAAA,MAAA,CACCqD,MAAM,KACNC,OAAO,KACPjD,KAAK,OACLC,OAAO,eACPI,YAAY,IACZH,QAAQ,YAERJ,eAAC,OAAK,CAAAQ,EAAE,mFAIN6C,EAAYA,IACfxD,MAAA,MAAA,CACCqD,MAAM,KACNC,OAAO,KACPjD,KAAK,OACLC,OAAO,eACPI,YAAY,IACZH,QAAQ,YAERJ,eAAC,OAAK,CAAAQ,EAAE,qBAIN8C,EAAQA,IACXzD,MAAA,MAAA,CACCqD,MAAM,KACNC,OAAO,KACPjD,KAAK,OACLC,OAAO,eACPI,YAAY,IACZH,QAAQ,YAERJ,eAAC,OAAK,CAAAQ,EAAE,2BAKV,OAAAX,EAAAA,IAACC,EACC,CAAAH,UAAW,iJAAiJA,IAC5JI,QAAQ,QAERC,SAAAC,OAAC,MAAI,CAAAN,UAAU,0CAEbK,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,uEACbK,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,0BACbK,SAAA,CAACH,EAAAA,IAAA,MAAA,CAAIF,UAAU,kEACbK,SAACH,EAAAA,IAAA,MAAA,CACCF,UAAU,wBACVO,KAAK,OACLC,OAAO,eACPC,QAAQ,YAERJ,SAACH,EAAAA,IAAA,OAAA,CACCQ,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,6JAIPX,EAAAA,IAAA,KAAA,CAAGF,UAAU,+CAA+CK,SAE7D,qBAEFC,EAAAA,KAAC,OAAK,CAAAN,UAAU,2EACboC,SAAAA,CAAKwB,EAAAA,OAAO,IAAkB,IAAhBxB,EAAKwB,OAAe,OAAS,oBAK/C,MAAI,CAAA5D,UAAU,0CACbK,SAACC,EAAAA,KAAA,QAAA,CAAMN,UAAU,SACfK,SAAA,CAAAH,MAAC,QAAM,CAAAF,UAAU,+GACfK,SAAAC,EAAAA,KAAC,KACC,CAAAD,SAAA,CAACH,EAAAA,IAAA,KAAA,CAAGF,UAAU,gGAAgGK,SAE9G,YACCH,EAAAA,IAAA,KAAA,CAAGF,UAAU,kGAAkGK,SAEhH,QACCH,EAAAA,IAAA,KAAA,CAAGF,UAAU,iGAAiGK,SAE/G,UACCH,EAAAA,IAAA,KAAA,CAAGF,UAAU,iGAAiGK,SAE/G,UACCH,EAAAA,IAAA,KAAA,CAAGF,UAAU,kGAAkGK,SAEhH,uBAGH,QAAM,CAAAL,UAAU,2BACdoC,SAAgB,IAAXwB,EAAAA,OACH1D,MAAA,KAAA,CACCG,SAACH,MAAA,KAAA,CAAG2D,QAAS,EAAG7D,UAAU,mBACxBK,SAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,4CACbK,SAAA,CAACH,EAAAA,IAAA,MAAA,CAAIF,UAAU,2EACbK,SAACH,EAAAA,IAAA,MAAA,CACCF,UAAU,wBACVO,KAAK,OACLC,OAAO,eACPC,QAAQ,YAERJ,SAACH,EAAAA,IAAA,OAAA,CACCQ,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,6JAIPX,EAAAA,IAAA,IAAA,CAAEF,UAAU,sCAAsCK,SAEnD,kBACCH,EAAAA,IAAA,IAAA,CAAEF,UAAU,6BAA6BK,SAE1C,kCAKN+B,EAAK0B,IAAI,CAACC,EAAMX,IACd9C,EAAAA,KAAC,KAEC,CAAAN,UAAW,6DAA4DwC,IAAgBY,EAAM,sCAAwC,IACrI5B,QAAgBuB,GAnKXA,EAACK,EAAKlC,KACF,UAArBA,EAAEC,OAAO6C,SACXvB,IAAcW,IAiKgBL,CAAeK,EAAKlC,GAEpCb,SAAA,CAAAH,EAAAA,IAAC,MAAGF,UAAU,cACZK,SAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,gBACbK,SAAA,CAAAH,EAAAA,IAAC,OAAK,CAAAF,UAAU,sGACb+D,SAAAA,EAAKhD,OAERT,EAAAA,KAAC,OAAK,CAAAN,UAAU,qCAAqCK,SAAA,CAAA,QAC7C0D,EAAKrE,KAAO,cAIxBQ,EAAAA,IAAC,MAAGF,UAAU,0BACX2C,aAAeS,EACd9C,EAAAA,KAAC,MAAI,CAAAN,UAAU,yCACbK,SAAA,CAAAH,EAAAA,IAAC,QACC,CAAAY,KAAK,OACLmD,UAAU,UACVC,QAAQ,SACRlD,MAAO4B,EACP3B,SAAU+B,EACVmB,UAAkBjD,IACF,UAAVA,EAAEG,IACJ8B,EAAmBC,GACA,WAAVlC,EAAEG,KACMyB,OAGrBsB,OAAQ,IAAMjB,EAAmBC,GACjCpD,UAAU,4HACVqE,WAAS,EACTC,QAAUpD,GAAMA,EAAEC,OAAOoD,WAE1BrE,EAAAA,IAAA,SAAA,CACCY,KAAK,SACLU,QAAS,IAAM2B,EAAmBC,GAClCpD,UAAU,gDACVwE,MAAM,OAENnE,SAAAH,EAAAA,IAACwD,GAAY,KAEdxD,EAAAA,IAAA,SAAA,CACCsB,QAAS,IAAMsB,IACf9C,UAAU,4CACVwE,MAAM,SAENnE,SAACH,EAAAA,IAAAyD,EAAA,CAAQ,QAIbzD,EAAAA,IAAC,MAAI,CAAAF,UAAU,yCACbK,SAAAH,EAAAA,IAAC,OAAK,CAAAF,UAAU,yGACb+D,SAAAA,EAAKnE,qBAKb,KAAG,CAAAI,UAAU,yBACZK,SAACC,EAAAA,KAAA,OAAA,CAAKN,UAAU,+CAA+CK,SAAA,CAAA,IAC3D0D,EAAKU,MAAMC,QAAQ,cAGxB,KAAG,CAAA1E,UAAU,yBACZK,SAACC,EAAAA,KAAA,OAAA,CAAKN,UAAU,6CAA6CK,SAAA,CAAA,KAGzD0D,EAAKU,OACJ9B,IAAeS,EAAMR,EAAUmB,EAAKnE,WACrC8E,QAAQ,cAGb,KAAG,CAAA1E,UAAU,cACZK,SAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,yCACbK,SAAA,CAACH,EAAAA,IAAA,SAAA,CACCsB,QAAgBN,IACdA,EAAEyD,kBACFlC,IAAcW,GACdP,EAAgBkB,EAAKnE,WAEvBI,UAAW,gDAAgDwC,IAAgBY,EAAM,4CAA8C,sEAC/HoB,MAAM,WAGNnE,SAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,0BAEXK,SAAA,CAACH,EAAAA,IAAA,OAAA,CAAKF,UAAU,kCAAkCK,SAAG,cAEtDiD,EAAW,CAAA,QAGhBpD,EAAAA,IAAC,SACC,CAAAsB,QAAgBN,IACdA,EAAEyD,kBACFlC,IAAcW,GACdf,EAAae,IAEfpD,UAAW,gDAAgDwC,IAAgBY,EAAM,yCAA2C,kEAC5HoB,MAAM,aAENnE,SAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,0BAEXK,SAAA,CAACH,EAAAA,IAAA,OAAA,CAAKF,UAAU,iCAAiCK,SAAG,cAErDoD,EAAa,CAAA,eAzGjBL,iBAsHhB,MAAI,CAAApD,UAAU,qCACbK,SAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,sBACZ0C,SAAAA,CACCA,GAAApC,EAAAA,KAAC,MAAI,CAAAN,UAAU,0DACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAS,cACfC,EAAAA,KAAC,OAAK,CAAAN,UAAU,eAAeK,SAAA,CAAA,IAE5B+B,EACEwC,OACC,CAACC,EAAKd,EAAMX,IACVyB,EACAd,EAAKU,OAAS9B,IAAeS,EAAMR,EAAUmB,EAAKnE,UACpD,GAED8E,QAAQ,SAIjBpE,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAACH,EAAAA,IAAA,OAAA,CAAKF,UAAU,mDAAmDK,SAEnE,WACAC,EAAAA,KAAC,OAAK,CAAAN,UAAU,kDAAkDK,SAAA,CAAA,IAC9DkC,EAAMmC,QAAQ,kBAQhC,CCvUA,SAASI,GAAgBC,OAAEA,EAAAA,QAAQC,EAAAA,IAAStF,EAAAA,OAAKC,IAC/C,MAAOsF,EAASC,GAAcC,EAAAA,SAAS,MAEjCC,EAAcC,UAClB,GAAK3F,EACD,IACI4F,MAAAA,EAAaC,aAAaC,QAAQ,eAClCC,EAAQH,EACV,gBAAgBI,mBAAmBJ,KACnC,GACEK,QAAYC,EAChB,4BAA4BF,mBAAmBhG,KAAO+F,KAG3CP,EADTS,EACS,CACT5E,KAAM4E,EAAIE,aACVpB,MAAO7C,OAAO+D,EAAIG,eAAiB,GACnCpG,IAAKiG,EAAIjG,KAGA,YAENqG,GACPb,EAAW,KAAI,GAKnB1F,EAAMwG,UAAU,KACd,IAAKtG,EAEH,YADAwF,EAAW,MAGPe,MAAAA,EAAIC,WAAW,KACPd,KACX,KACI,MAAA,IAAMe,aAAaF,IACzB,CAACvG,IAEE0G,MAAAA,EACHlG,EAAAA,IAAA2B,EAAA,CACCC,MAAM,cACN1B,QAAQ,YACRoB,QAASwD,EACThF,UAAU,WAsBd,OAlBAqG,EACE,CACE,CACEhF,IAAK,SACLiF,OAAQtB,EACRuB,QAASxB,EACTyB,kBAAkB,GAEpB,CACEnF,IAAK,QACLiF,OAAQlB,EACRmB,QAASxB,EACTyB,kBAAkB,IAGtB,CAACzB,EAAQrF,WAIR+G,EACC,CAAA1B,SACAC,UACAR,MAAM,cACNkC,SAAS,4BACTzE,KACE/B,EAAAA,IAAC,OACCF,UAAU,qBACVO,KAAK,OACLC,OAAO,eACPC,QAAQ,YAERJ,SAAAH,EAAAA,IAAC,QACCQ,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,oDAIR8F,OAAQP,EACRrE,KAAK,KACL6E,iBAAiB,YAGjBvG,SAAA,CAAAH,EAAAA,IAAC,OAAIF,UAAU,SACbK,SAACH,EAAAA,IAAA2G,EAAA,CACCC,OAAoBC,IACZC,MAAAA,EAAOD,IAAS,IAAIE,SACtBD,GACFrH,EAAOqH,IAGXE,QAAQ,EACRC,SAAU,OACVnH,UAAU,SACVoH,SAAS,oBAKb9G,EAAAA,KAAC,MAAI,CAAAN,UAAU,SACbK,SAAA,CAACH,EAAAA,IAAA,QAAA,CAAMF,UAAU,+CAA+CK,SAEhE,+BACC,QACC,CAAAS,KAAK,OACLE,MAAOtB,EACPuB,SAAWC,GAAMvB,EAAOuB,EAAEC,OAAOH,OACjChB,UAAU,uIACVuB,YAAY,iCAIhBjB,EAAAA,KAAC,MAAI,CAAAN,UAAU,+EACbK,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAY,iBACjBH,EAAAA,IAAA,OAAA,CAAKF,UAAU,yCAAyCK,SAAK,aAEhEC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAM,WACXH,EAAAA,IAAA,OAAA,CAAKF,UAAU,yCAAyCK,SAAG,cAK/D4E,EACC3E,EAAAA,KAAC,MAAI,CAAAN,UAAU,8FACbK,SAAA,CAAAH,EAAAA,IAAC,MAAI,CAAAF,UAAU,2CACZiF,SAAAA,EAAQlE,OAEXT,EAAAA,KAAC,MAAI,CAAAN,UAAU,wCAAwCK,SAAA,CAAA,IACnD4E,EAAQR,MAAMC,QAAQ,MAE1BpE,EAAAA,KAAC,MAAI,CAAAN,UAAU,wBAAwBK,SAAA,CAAA,QAAM4E,EAAQvF,UAErDA,EACFQ,EAAAA,IAAC,OAAIF,UAAU,wCAAwCK,+BAGrD,OAGV,CCvJA,SAASgH,GAActC,OAAEA,EAAAA,QAAQC,EAAAA,gBAASsC,IACxC,MAAOC,EAAcC,GAAmBrC,EAAAA,UAAS,IAC1CsC,EAAWC,GAAgBvC,EAAAA,SAAS,KAEpCwC,EAASC,GAAczC,EAAAA,SAAS,KAChC0C,EAAUC,GAAe3C,EAAAA,SAAS,KAClC3C,EAAauF,GAAkB5C,EAAAA,SAAS,OACxC6C,EAAqBC,GAA0B9C,EAAAA,SAAS,IACxD+C,EAASC,GAAchD,EAAAA,UAAS,IAChCiD,EAAOC,GAAYlD,EAAAA,SAAS,KAC5BmD,EAAQC,GAAapD,EAAAA,UAAS,IAC9BqD,EAAaC,GAAkBtD,EAAAA,SAAS,cACzCuD,EAAelJ,EAAMmJ,OAAO,MAC5BC,EAAgBpJ,EAAMmJ,OAAO,MAC7BE,EAAkBrJ,EAAMmJ,OAAO,MAE/BG,EAAqBA,CAAC5H,EAAG6H,KAEzB7H,GAAU,WAAVA,EAAEG,IAIJ,OAHAH,EAAE8H,iBACF9H,EAAEyD,uBACFzD,EAAEC,OAAO8H,OAKP/H,GAAU,UAAVA,EAAEG,KAAmBkG,GACnBI,GAAWE,EAIb,OAHA3G,EAAE8H,iBACF9H,EAAEyD,uBACgBuE,IAMtB,GAAc,UAAVH,EAAmB,CAErB,GAAI,CAAC,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAII,SAASjI,EAAEkI,UAErDlI,EAAEmI,SAAW,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAAIF,SAASjI,EAAEkI,UAEjDlI,EAAEkI,SAAW,IAAMlI,EAAEkI,SAAW,IAChClI,EAAEkI,SAAW,IAAMlI,EAAEkI,SAAW,IAEnC,QAGGlI,EAAEoI,UAAapI,EAAEkI,QAAU,IAAMlI,EAAEkI,QAAU,MAASlI,EAAEkI,QAAU,IAAMlI,EAAEkI,QAAU,MACvFlI,EAAE8H,gBACJ,GAKJhD,EAAAA,UAAU,KACJjB,GAAUwC,GACZgC,sBAAsB,KACpBb,EAAac,SAASC,QACtBf,EAAac,SAASjF,cAGzB,CAACQ,EAAQwC,IAEZvB,EAAAA,UAAU,KACR,IAAKjB,EAAQ,OACUM,WACrB8C,GAAW,GACXE,EAAS,IACL,IACIqB,MAAAA,EAAQC,eAAenE,QAAQ,cAI/BoE,SAHahE,EAAI,iBAAkB,CACvCiE,QAAS,CAAEC,cAAe,UAAUJ,QAER,IAAI5F,IAAUjD,IAAA,CAC1CiB,MAAOjB,EAAEkJ,eAAiB,GAAGlJ,EAAEmJ,2BAC/BhJ,MAAOH,EAAEmJ,oBACTC,YAAapJ,EAAEoJ,YACfnJ,KAAM,gBAGR4G,EAAakC,SACN1I,GACPmH,EAAS,2BAA0B,CAC3B,QACRF,GAAW,EAAK,GAGL+B,IACd,CAACnF,IAEJ,MAAMmE,EAAoB7D,UACpB,GAACsC,GAAYE,EAAb,CACJU,GAAU,GACN,IACImB,MAAAA,EAAQC,eAAenE,QAAQ,cAC/B2E,EAAU,CACdJ,cAAepC,EACfqC,oBAAqBpI,OAAOiG,IAGxBuC,QAAgBxE,EAAI,iBAAkB,CAC1CyE,OAAQ,OACRR,QAAS,CACPC,cAAe,UAAUJ,IACzB,eAAgB,oBAElBY,KAAMC,KAAKC,UAAUL,KAGVM,EAAAA,GAAQ,IAChBA,EACH,CACE3I,MAAOsI,EAAQL,eAAiBpC,EAChC3G,MAAOoJ,EAAQJ,oBACfC,YAAaG,EAAQH,YACrBnJ,KAAM,gBAIV8G,EAAW,IACXE,EAAY,UACL5G,GACCkH,QAAAA,MAAM,0BAA2BlH,GACzCmH,EAAS,4CAA2C,CAC5C,QACRE,GAAU,EAAK,CAlCU,GAsCtBlG,EAAegD,MAAOqF,IAC3B,IAAKA,EAAY,OAGXC,MAAAA,EAAK/I,OAAO8I,GACdE,GAAAA,MAAMD,GAER,YADAtC,EAAS,uBAKLwC,MAAAA,EAAmBpD,EAAUqD,KAAKjK,GAAKe,OAAOf,EAAEoJ,eAAiBU,GACvE,GAAKE,GAML,GAAKE,OAAOC,QAAQ,iDAAiDH,EAAiB/I,WAIlF,IACFyG,GAAU,GACVF,EAAS,UAGHzC,EAAI,kBAAkB+E,IAAM,CAChCN,OAAQ,WAIV3C,EAAqB+C,IACbQ,MAAAA,EAAeR,EAAKS,UAAUrK,GAAKe,OAAOf,EAAEoJ,eAAiBU,GAC7DQ,EAAeV,EAAKW,OAAOvK,GAAKe,OAAOf,EAAEoJ,eAAiBU,GAiBzDQ,OAdkB,IAArBF,IACFlD,EAA0BsD,GACpBA,IAAYJ,EAAqBxJ,KAAKC,IAAI,EAAGuJ,EAAe,GAC5DI,EAAUJ,EAAqBI,EAAU,EACtCA,GAGTpD,EAAkCoD,GAC5BA,IAAYJ,EAAqBxJ,KAAKC,IAAI,EAAGuJ,EAAe,GAC5DI,EAAUJ,EAAqBI,EAAU,EACtCA,IAIJF,UAGF/C,GAIP,GAHQA,QAAAA,MAAM,6BAA8BA,GAGxCA,EAAMkD,SAAWlD,EAAMkD,QAAQnC,SAAS,aAEtC,IACIO,MAAAA,EAAQC,eAAenE,QAAQ,cAC/B+F,QAAa3F,EAAI,iBAAkB,CACvCiE,QAAS,CAAEC,cAAe,UAAUJ,OAEtChC,GAAc6D,GAAQ,IAAIzH,IAAUjD,IAAA,CAClCiB,MAAOjB,EAAEkJ,eAAiB,GAAGlJ,EAAEmJ,2BAC/BhJ,MAAOH,EAAEmJ,oBACTC,YAAapJ,EAAEoJ,YACfnJ,KAAM,iBAERuH,EAAS,sDACFmD,GACCpD,QAAAA,MAAM,+BAAgCoD,GAC9CnD,EAAS,8CAA6C,MAI/CD,EAAAA,EAAMkD,SAAW,+CAC5B,CACQ,QACR/C,GAAU,EAAK,OApEfF,EAAS,mCAwEPoD,EAAqBA,KACzBjE,GAAgB,IAGZkE,EAAsBA,KAC1B,GAAmB,MAAflJ,EAAqB,OACnBmJ,MAAAA,EAAWlE,EAAUjF,GACtBmJ,IACWrE,EAAA,CACdxG,KAAM6K,EAAS7K,KACfE,MAAO2K,EAAS3K,MAChBc,MAAO6J,EAAS7J,MAChBmI,YAAa0B,EAAS1B,cAEhBjF,MAiBJ4G,EACH1L,EAAAA,IAAA2B,EAAA,CACCC,MACGxB,OAAA,MAAA,CAAIN,UAAU,2CACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAa,kBAClBH,EAAAA,IAAA,OAAA,CAAKF,UAAU,oDAAoDK,SAEpE,aAGJD,QAAQ,UACRoB,QAASiK,EACTzL,UAAU,WAKR6L,EACJvL,EAAAA,KAAC,MAAI,CAAAN,UAAU,mBACbK,SAAA,CAAAH,MAAC2B,EACC,CAAAC,MACGxB,EAAAA,KAAA,MAAA,CAAIN,UAAU,2CACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAc,mBACnBH,EAAAA,IAAA,OAAA,CAAKF,UAAU,oDAAoDK,SAEpE,aAGJD,QAAQ,UACRoB,QAASkK,EACTI,SAA0B,OAAhBtJ,EACVxC,UAAU,iBAEX6B,EACC,CAAAC,MACGxB,EAAAA,KAAA,MAAA,CAAIN,UAAU,2CACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAgB,qBACrBH,EAAAA,IAAA,OAAA,CAAKF,UAAU,kEAAkEK,SAElF,SAGJD,QAAQ,YACRoB,QAAS,IAAMgG,GAAgB,GAC/BxH,UAAU,cAMV+L,EAAyBC,IACzB,IAACA,EAAW,OAAA,EACVC,MAAAA,EAAMD,EAAGhI,SAASkI,cAEtBF,OAAAA,EAAGG,mBACK,UAARF,GACQ,aAARA,GAC8B,YAA9BD,EAAGI,eAAe,SAKtBpG,EAAAA,UAAU,KACR,GAAIuB,GAAgBsB,EAAgBW,SAAmC,OAAxBxB,EAA8B,CAC3E,MACMqE,EADYxD,EAAgBW,QACA8C,cAAc,uBAAuBtE,OACnEqE,GACFA,EAAgBE,eAAe,CAC7BC,SAAU,SACVC,MAAO,UACPC,OAAQ,WAEZ,GAED,CAAC1E,EAAqBT,IAGzBvB,EAAAA,UAAU,KACR,GAAIoC,EAAO,CACT,MAAMuE,EAAQzG,WAAW,IAAMmC,EAAS,IAAK,KACtC,MAAA,IAAMlC,aAAawG,EAAK,GAEhC,CAACvE,IAIF/B,EAAA,CAEE,CACEhF,IAAK,SACLiF,OAAepF,IACT6K,EAAe7K,GAAGC,QACpBD,EAAEC,OAAO8H,SAGHjE,KAEVuB,QAASxB,EACTyB,kBAAkB,EAClB7B,iBAAiB,EACjBqE,gBAAgB,GAGlB,CACE3H,IAAK,QACLiF,OAAepF,IAET6K,IAAAA,EAAe7K,GAAGC,QAUtB,OAAIoG,GACFrG,EAAE8H,sBACiByC,UAKDC,IAfdnE,GAAgBI,GAAWE,IAC7B3G,EAAE8H,iBACgBE,MAexB3C,QAASxB,EACTyB,kBAAkB,EAClB7B,iBAAiB,EACjBqE,gBAAgB,GAGlB,CACE3H,IAAK,IACLiF,OAAepF,IACT6K,EAAe7K,GAAGC,SACLsJ,EAAAA,IAAUA,IAE7BlE,QAASxB,EACTyB,kBAAkB,EAClB7B,iBAAiB,EACjBqE,gBAAgB,MAGf4D,MAAMC,KAAK,CAAEjJ,OAAQ,IAAKE,IAAI,CAACiC,EAAG+G,KAAO,CAC1CzL,IAAK0L,OAAOD,EAAI,GAChBxG,OAAepF,IACT6K,EAAe7K,GAAGC,UACjBoG,GAAgBE,EAAUqF,IAlKT1J,CAAQA,IAC9BuI,MAAAA,EAAWlE,EAAUrE,GACtBuI,IACL5D,EAAe3E,GACCkE,EAAA,CACdxG,KAAM6K,EAAS7K,KACfE,MAAO2K,EAAS3K,MAChBc,MAAO6J,EAAS7J,MAChBmI,YAAa0B,EAAS1B,cAEhBjF,MAyJAgI,CAAqBF,IAGzBvG,QAASxB,IAAWwC,GAAgBE,EAAUqF,GAC9CtG,kBAAkB,EAClB7B,iBAAiB,EACjBqE,gBAAgB,KAGlB,CACE3H,IAAK,UACLiF,OAAepF,IACT6K,EAAe7K,GAAGC,SAClBoG,GAAqC,IAArBE,EAAU7D,QAC9BmE,EAAyB0C,GACX,MAARA,EAAqB,EAClBA,EAAO,EAAIA,EAAO,EAAI,IAGjClE,QAASxB,IAAWwC,EACpBf,kBAAkB,EAClB7B,iBAAiB,EACjBqE,gBAAgB,GAElB,CACE3H,IAAK,YACLiF,OAAepF,IACT6K,EAAe7K,GAAGC,SAClBoG,GAAqC,IAArBE,EAAU7D,QAC9BmE,EAAyB0C,GACX,MAARA,EAAqB,EAClBhJ,KAAKE,IAAI8I,EAAO,EAAGhD,EAAU7D,OAAS,KAGjD2C,QAASxB,IAAWwC,EACpBf,kBAAkB,EAClB7B,iBAAiB,EACjBqE,gBAAgB,GAGlB,CACE3H,IAAK,IACLiF,OAAepF,IACT6K,EAAe7K,GAAGC,SAAWD,EAAEC,SAAWuH,EAAac,SACtDjC,GACLrB,WAAW,KACTwC,EAAac,SAASC,QACtBf,EAAac,SAASjF,YACrB,IAELgC,QAASxB,GAAUwC,EACnBf,kBAAkB,EAClB7B,iBAAiB,EACjBqE,gBAAgB,GAGlB,CACE3H,IAAK,IACLiF,OAAepF,IACT6K,EAAe7K,GAAGC,SAAWD,EAAEC,SAAWyH,EAAcY,SACvDjC,GACLrB,WAAW,KACT0C,EAAcY,SAASC,QACvBb,EAAcY,SAASjF,YACtB,IAELgC,QAASxB,GAAUwC,EACnBf,kBAAkB,EAClB7B,iBAAiB,EACjBqE,gBAAgB,GAGlB,CACE3H,IAAK,UACLiF,OAAepF,IACT6K,EAAe7K,GAAGC,SACjBoG,GAAqC,IAArBE,EAAU7D,QAC/BqE,KAAiCxG,KAAKC,IAAI,EAAG+I,EAAO,KAEtDlE,QAASxB,GAAUwC,EACnBf,kBAAkB,EAClB7B,iBAAiB,EACjBqE,gBAAgB,GAElB,CACE3H,IAAK,YACLiF,OAAepF,IACT6K,EAAe7K,GAAGC,SACjBoG,GAAqC,IAArBE,EAAU7D,QACP6G,EAAAA,GACtBhJ,KAAKE,IAAI8F,EAAU7D,OAAS,GAAI6G,GAAQ,GAAK,KAGjDlE,QAASxB,GAAUwC,EACnBf,kBAAkB,EAClB7B,iBAAiB,EACjBqE,gBAAgB,GAGlB,CACE3H,IAAK,SACLiF,OAAepF,IACT6K,GAAAA,EAAe7K,GAAGC,QAAS,OAC/B,IAAKoG,GAAqC,IAArBE,EAAU7D,OAAc,OACvCzC,MAAAA,EAASsG,EAAUO,GACrB7G,GAAQ8I,aAA0B9I,EAAAA,EAAO8I,cAE/C1D,QAASxB,GAAUwC,EACnBf,kBAAkB,EAClB7B,iBAAiB,EACjBqE,gBAAgB,IAGpB,CACEjE,EACAwC,EACAE,EACAjF,EACAkJ,EACAD,EACAzG,EACAgD,EACAkB,IAwJJ,cACGzC,EACC,CAAA1B,SACAC,UACAR,MAAO+C,EAAe,mBAAqB,kBAC3Cb,SACEa,EACI,iCACA,6BAENtF,KACG/B,MAAA,MAAA,CACCF,UAAU,qBACVO,KAAK,OACLC,OAAO,eACPC,QAAQ,YAERJ,eAAC,OACC,CAAAK,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,mIAIR8F,OAAQY,EAAeqE,EAAwBC,EAC/C9J,KAAK,KACL6E,iBAAiB,YAEhBwB,SAAAA,CAAAA,GACElI,EAAAA,IAAA,MAAA,CAAIF,UAAU,4EACZoI,SACHA,IAEDb,EAhJFjH,OAAA,MAAA,CAAIN,UAAU,YACbK,SAAA,CAAAH,EAAAA,IAAC,OAAIF,UAAU,aACbK,eAAC,SACC,CAAAL,UAAW,qEACO,eAAhBwI,EAA+B,yBAA2B,6BAE5DhH,QAAS,IAAMiH,EAAe,cAC/BpI,0BAMFH,EAAAA,IAAC,OACAD,IAAK4I,EACL7I,UAAU,gDAETyH,SAAAA,EAAU3D,IAAI,CAACjD,EAAGuC,IAChB9C,OAAA,MAAA,CAEC,oBAAmB8C,EACnBpD,UAAW,qEACTgI,IAAwB5E,EAAM,kCAAoC,qBAGpE/C,SAAA,CAAAH,MAAC,SACCF,UAAU,yDACVgB,MAAOH,EAAEiB,MACTmL,UAAQ,IAEV/M,MAAC,SACCF,UAAU,mEACVgB,MAAOH,EAAEG,MACTiM,UAAQ,UAET,SACC,CAAAjN,UAAU,wDACVwB,QAAS,IAAMa,EAAaxB,EAAEoJ,aAC9BzF,MAAM,eACN1D,KAAK,SAELT,SAAAH,EAAAA,IAAC,OACCgN,MAAM,6BACNlN,UAAU,UACVO,KAAK,OACLE,QAAQ,YACRD,OAAO,eAEPH,SAACH,EAAAA,IAAA,OAAA,CACCQ,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,+BAjCHuC,MA0CV9C,EAAAA,KAAA,MAAA,CACCN,UAAU,6DACVmE,UAAkBjD,IACF,UAAVA,EAAEG,MACJH,EAAE8H,iBACF9H,EAAEyD,kBACgBuE,MAItB7I,SAAA,CAACH,EAAAA,IAAA,MAAA,CAAIF,UAAU,2CAA2CK,SAE1D,kDACAC,EAAAA,KAAC,MAAI,CAAAN,UAAU,aACbK,SAAA,CAAAH,EAAAA,IAAC,QAAA,CACCF,UAAU,iHACVuB,YAAY,cACZP,MAAO2G,EACP1H,IAAKyI,EACLvE,UAAYjD,GAAM4H,EAAmB5H,EAAG,QACxCoD,QAAS,IAAMkD,GAAgB,GAC/BvG,SAAWC,GAAM0G,EAAW1G,EAAEC,OAAOH,SAEvCd,EAAAA,IAAC,QAAA,CACCF,UAAU,2HACVuB,YAA6B,eAAhBiH,EAA+B,KAAO,OACnDvE,UAA2B,eAAhBuE,EAA+B,UAAY,UACtDxH,MAAO6G,EACP5H,IAAK2I,EACLzE,UAAYjD,GAAM4H,EAAmB5H,EAAG,SACxCoD,QAAS,IAAMkD,GAAgB,GAC/BvG,SAAWC,GAAM4G,EAAY5G,EAAEC,OAAOH,OACtCF,KAAK,SACLa,IAAI,MAELzB,EAAAA,IAAA,SAAA,CACCF,UAAU,4FACVwB,QAAS0H,EACT1E,MAAM,cACN1D,KAAK,SACLgL,SAAUxD,EAETA,SAAAA,EAAS,MAAQ,eA1IxBhI,EAAAA,KAAC,MAAI,CAAAN,UAAU,YACbK,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,yCACbK,SAAA,CAACH,EAAAA,IAAA,KAAA,CAAGF,UAAU,sBAAsBK,SAAe,oBAClDH,EAAAA,IAAA,OAAA,CAAKF,UAAU,wBAAwBK,SAAgC,wCAE1EH,EAAAA,IAAC,OAAIF,UAAU,uDACZyH,WAAU3D,IAAI,CAACjD,EAAGuC,IAChB9C,EAAAA,KAAA,SAAA,CAECN,UAAW,kCACTwC,IAAgBY,EACZ,6BACA,oDAEN5B,QAAS,IAAMuG,EAAe3E,GAE9B/C,SAAA,CAAAH,EAAAA,IAAC,MAAI,CAAAF,UAAU,0HACZoD,SAAAA,EAAM,IAERlD,EAAAA,IAAA,MAAA,CAAIF,UAAU,cAAea,WAAEiB,QAChCxB,EAAAA,KAAC,MAAI,CAAAN,UAAU,wBAAyBa,SAAAA,CAAEG,EAAAA,MAAM,OAC/CwB,IAAgBY,GACflD,EAAAA,IAAC,MAAI,CAAAF,UAAU,kDAAkDK,SAEjE,2BAhBG,GAAGQ,EAAEC,QAAQsC,YA4KxBmE,GACCrH,EAAAA,IAAA,MAAA,CAAIF,UAAU,qCACbK,SAAAC,EAAAA,KAAC,MAAI,CAAAN,UAAU,kCACbK,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAgB,qBACrBH,EAAAA,IAAA,OAAA,CAAKF,UAAU,4CAA4CK,SAAQ,gBAEtEC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAwB,6BAC7BH,EAAAA,IAAA,OAAA,CAAKF,UAAU,4CAA4CK,SAAK,aAEnEC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAiB,sBACtBH,EAAAA,IAAA,OAAA,CAAKF,UAAU,4CAA4CK,SAAC,SAE/DC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAY,iBACjBH,EAAAA,IAAA,OAAA,CAAKF,UAAU,4CAA4CK,SAAG,gBAKtEkH,SACE,MAAI,CAAAvH,UAAU,qCACbK,SAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,kCACbK,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAe,oBACpBH,EAAAA,IAAA,OAAA,CAAKF,UAAU,4CAA4CK,SAAG,WAEjEC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAgB,qBACrBH,EAAAA,IAAA,OAAA,CAAKF,UAAU,4CAA4CK,SAAG,WAEjEC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAmB,wBACxBH,EAAAA,IAAA,OAAA,CAAKF,UAAU,4CAA4CK,SAAK,aAEnEC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAa,kBAClBH,EAAAA,IAAA,OAAA,CAAKF,UAAU,4CAA4CK,SAAK,aAEnEC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAY,iBACjBH,EAAAA,IAAA,OAAA,CAAKF,UAAU,4CAA4CK,SAAG,kBAO7E,CC5uBA,SAAS8M,GAAgBpI,OAAEA,EAAAA,QAAQC,IAEjC,MAAOoI,EAAKC,GAAUlI,EAAAA,SAAS,YAExBmI,EAAqBC,GAA0BpI,EAAAA,SAAS,OAGxDqI,EAAQC,GAAatI,EAAAA,SAAS,KAC9BuI,EAAcC,GAAmBxI,EAAAA,SAAS,KAC1CyI,EAAgBC,GAAqB1I,EAAAA,UAAS,IAC9C2I,EAAWC,GAAgB5I,EAAAA,UAAS,IACpCiD,EAAOC,GAAYlD,EAAAA,SAAS,IAmB7B6I,EAAoB3I,MAAO4I,EAAc,QAC7CF,GAAa,GACT,IACF1F,EAAS,IACT,MAAM6F,EAAID,EAAc,yCAAyCvI,mBAAmBuI,eAA2B,qCACzG1C,QAAa3F,EAAIsI,GACvBP,EAAgBf,MAAMuB,QAAQ5C,GAAQA,EAAO,UACtC6C,GACEA,EAAAA,EAAI9C,SAAW,8BAA6B,CAC7C,QACRyC,GAAa,EAAK,GAKtB/H,EAAAA,UAAU,KACHjB,IA/BaM,WAClBwI,GAAkB,GACd,IACFxF,EAAS,IACHkD,MAAAA,QAAa3F,EAAI,sBAEvB6H,EAAUb,MAAMuB,QAAQ5C,GAAQA,EAAO,UAChC6C,GACEA,EAAAA,EAAI9C,SAAW,6BAA4B,CAC5C,QACRuC,GAAkB,EAAK,GAsBbQ,GACML,MAEjB,CAACjJ,IAEJsB,EACE,CACE,CACEhF,IAAK,SACLiF,OAAQtB,EACRuB,QAASxB,EACTyB,kBAAkB,GAEpB,CACEnF,IAAK,IACLiF,OAAQA,KACN+G,EAAO,WACPE,EAAuB,OAEzBhH,QAASxB,GAEX,CACE1D,IAAK,IACLiF,OAAQA,KACN+G,EAAO,gBACPE,EAAuB,OAEzBhH,QAASxB,IAGb,CAACA,EAAQqI,IAIX,MA6HMkB,EACJhO,EAAAA,KAAC,MAAI,CAAAN,UAAU,mDACbK,SAAA,CAACC,OAAA,SAAA,CACCkB,QAAS,KACP6L,EAAO,WACPE,EAAuB,OAEzBvN,UAAW,+FACD,YAARoN,EACI,mCACA,+CAGN/M,SAAA,CAACH,EAAAA,IAAAqO,EAAA,CAAcvO,UAAU,YACzBE,EAAAA,IAAC,QAAKG,SAAW,mBAEnBC,OAAC,SACC,CAAAkB,QAAS,KACP6L,EAAO,gBACPE,EAAuB,OAEzBvN,UAAW,+FACD,iBAARoN,EACI,mCACA,+CAGN/M,SAAA,CAACH,EAAAA,IAAAsO,EAAA,CAAYxO,UAAU,YACvBE,EAAAA,IAAC,QAAKG,SAAgB,2BAM1B,OAAAH,MAACuG,GACC1B,SACAC,UACAR,MAAM,cACNkC,SAAS,wCACTzE,KAAM/B,EAAAA,IAACuO,GAAuBzO,UAAU,uBACxC+B,KAAK,KACL6E,iBAAiB,YAEjBvG,SAAAC,EAAAA,KAAC,MAAI,CAAAN,UAAU,YACZoN,SAAAA,CAAQ,YAAAA,EAzKOsB,MACpB,MAAMC,EAAYnB,EAAO5I,OAAO,CAACC,EAAK/D,IAAS+D,GAAOjD,OAAOd,EAAK8N,UAAY,GAAI,GAGhF,OAAAtO,EAAAA,KAAC,MAAI,CAAAN,UAAU,YAEbK,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,mHACbK,SAAA,CAACH,EAAAA,IAAA,IAAA,CAAEF,UAAU,2CAA2CK,SAAkB,uBAC1EC,EAAAA,KAAC,MAAI,CAAAN,UAAU,4DACbK,SAAA,CAACH,EAAAA,IAAA,OAAA,CAAKF,UAAU,WAAWK,SAAC,MAC3BsO,EAAUjK,QAAQ,MAErBxE,MAAC,KAAEF,UAAU,6BACVK,cAAIwO,MAAOC,mBAAmB,QAAS,CAAEC,QAAS,OAAQC,KAAM,UAAWC,MAAO,OAAQC,IAAK,wBAKnG,MACC,CAAA7O,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,+BACbK,SAAA,CAAAH,EAAAA,IAAC,OAAIF,UAAU,sGACbK,eAACoO,EAAuB,CAAAzO,UAAU,yBAEnCE,EAAAA,IAAA,KAAA,CAAGF,UAAU,8BAA8BK,SAAe,uBAE7DH,EAAAA,IAAC,MAAI,CAAAF,UAAU,YACZ4N,SAAAA,EACE1N,EAAAA,IAAA,MAAA,CAAIF,UAAU,wBAAwBK,SAAU,eAC7B,IAAlBmN,EAAO5J,OACR1D,EAAAA,IAAA,MAAA,CAAIF,UAAU,wBAAwBK,SAAqB,0BAE5DmN,EAAO1J,IACLhD,GAAAZ,EAAAA,IAAC,SAEC,CAAAsB,QAAS6D,UACPkI,EAAuBzM,EAAKC,MAC5BsM,EAAO,sBACDW,EAAkBlN,EAAKC,OAE/Bf,UAAU,iMAEVK,SAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,oCACbK,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,iCACbK,SAAA,CAACH,EAAAA,IAAA,MAAA,CAAIF,UAAU,0JACbK,SAACH,EAAAA,IAAA,MAAA,CAAIF,UAAU,kDAAkDO,KAAK,OAAOC,OAAO,eAAeC,QAAQ,YACzGJ,SAACH,EAAAA,IAAA,OAAA,CAAKQ,cAAc,QAAQC,eAAe,QAAQC,YAAa,EAAGC,EAAE,oLAGzEP,EAAAA,KAAC,MAAI,CAAAN,UAAU,YACbK,SAAA,CAAAH,EAAAA,IAAC,IAAE,CAAAF,UAAU,8BAA+Bc,SAAAA,EAAKC,OAChDb,EAAAA,IAAA,IAAA,CAAEF,UAAU,wBAAwBK,SAAiB,4BAG1DC,EAAAA,KAAC,MAAI,CAAAN,UAAU,0BACbK,SAAA,CAAAH,EAAAA,IAAC,OAAIF,UAAU,aACbK,SAACC,EAAAA,KAAA,IAAA,CAAEN,UAAU,kCAAkCK,SAAA,CAAA,KAAGuB,OAAOd,EAAK8N,UAAY,GAAGlK,QAAQ,QAEvFxE,EAAAA,IAACiP,EAAe,CAAAnP,UAAU,6EAxBzBc,EAAKC,YAgCnBqH,GACClI,EAAAA,IAAC,MAAI,CAAAF,UAAU,uBACZoI,SAAMe,EAAAA,SAAS,uCAAyCf,EAAMe,SAAS,cACpE,6EACAf,QAoGasG,GA1FvBpO,EAAAA,KAAC,MAAI,CAAAN,UAAU,YAEbK,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,yFACbK,SAAA,CAAAH,EAAAA,IAAC,MAAGF,UAAU,kCAAmCsN,WAAsB,GAAGA,iBAAqC,qBAC9GpN,EAAAA,IAAA,IAAA,CAAEF,UAAU,6BAA8B8N,WAAY,aAAe,GAAGJ,EAAa9J,qBAA6C,IAAxB8J,EAAa9J,OAAe,IAAM,sBAI9I,MAAI,CAAA5D,UAAU,iEACZ8N,SAAAA,QACE,MAAI,CAAA9N,UAAU,0CAA0CK,SAAA,4BAC/B,IAAxBqN,EAAa9J,OACdtD,OAAA,MAAA,CAAIN,UAAU,oBACbK,SAAA,CAAAH,EAAAA,IAAC,OAAIF,UAAU,uCAAuCO,KAAK,OAAOC,OAAO,eAAeC,QAAQ,YAC9FJ,eAAC,OAAK,CAAAK,cAAc,QAAQC,eAAe,QAAQC,YAAa,IAAKC,EAAE,2HAExEX,EAAAA,IAAA,IAAA,CAAEF,UAAU,4BAA4BK,SAAqB,mCAG/D,MAAI,CAAAL,UAAU,kBACbK,SAACC,EAAAA,KAAA,QAAA,CAAMN,UAAU,SACfK,SAAA,CAAAH,MAAC,QACC,CAAAG,SAAAC,EAAAA,KAAC,KAAG,CAAAN,UAAU,wEACZK,SAAA,CAACH,EAAAA,IAAA,KAAA,CAAGF,UAAU,+EAA+EK,SAAW,gBACvGH,EAAAA,IAAA,KAAA,CAAGF,UAAU,+EAA+EK,SAAI,SAChGH,EAAAA,IAAA,KAAA,CAAGF,UAAU,gFAAgFK,SAAM,gBAGxGH,EAAAA,IAAC,QAAM,CAAAF,UAAU,2BACd0N,SAAAA,EAAa5J,IACZsL,GAAA9O,EAAAA,KAAC,KAAmC,CAAAN,UAAU,qDAC5CK,SAAA,CAACH,EAAAA,IAAA,KAAA,CAAGF,UAAU,8CAA+CK,SAAA,IAAIwO,KAAKO,EAAGC,YAAYC,mBACrFpP,EAAAA,IAAC,KAAG,CAAAF,UAAU,oBAAoBK,SAAAH,EAAAA,IAAC,QAAKF,UAAU,yHAA0HoP,SAAGG,EAAAA,iBAC/KjP,EAAAA,KAAC,KAAG,CAAAN,UAAU,wDAAwDK,SAAA,CAAA,KAAGuB,OAAOwN,EAAG7M,QAAU,GAAGmC,QAAQ,QAHjGqI,OAAOqC,EAAGI,8BA6D9BlB,EACDhO,EAAAA,KAAC,MAAI,CAAAN,UAAU,+EACbK,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAa,kBAClBH,EAAAA,IAAA,OAAA,CAAKF,UAAU,yCAAyCK,SAAC,SAE5DC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAkB,uBACvBH,EAAAA,IAAA,OAAA,CAAKF,UAAU,yCAAyCK,SAAC,SAE5DC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAM,WACXH,EAAAA,IAAA,OAAA,CAAKF,UAAU,yCAAyCK,SAAG,kBAMxE,CCpRA,SAASoP,GAAc1K,OAAEA,EAAAA,QAAQC,EAAAA,MAASzC,EAAAA,gBAAOmN,IAC/CrJ,EACE,CACE,CAAEhF,IAAK,IAAKiF,OAAQA,IAAMoJ,EAAgB,QAASnJ,QAASxB,GAC5D,CAAE1D,IAAK,IAAKiF,OAAQA,IAAMoJ,EAAgB,SAAUnJ,QAASxB,GAC7D,CAAE1D,IAAK,IAAKiF,OAAQA,IAAMoJ,EAAgB,QAASnJ,QAASxB,GAC5D,CAAE1D,IAAK,QAASiF,OAAQA,IAAMoJ,EAAgB,QAASnJ,QAASxB,GAChE,CAAE1D,IAAK,SAAUiF,OAAQtB,EAASuB,QAASxB,IAE7C,CAACA,IAGH,MAAMqB,EACJ9F,EAAAA,KAAC,MAAI,CAAAN,UAAU,6BACbK,SAAA,CAACH,EAAAA,IAAA2B,EAAA,CACCC,MAAM,mBACN9B,UAAU,kCACVwB,QAAS,IAAMkO,EAAgB,UAEjCxP,EAAAA,IAAC2B,EACC,CAAAC,MAAM,YACN9B,UAAU,kCACVwB,QAAS,IAAMkO,EAAgB,WAEjCxP,EAAAA,IAAC2B,EACC,CAAAC,MAAM,WACN9B,UAAU,kCACVwB,QAAS,IAAMkO,EAAgB,aAKrC,cACGjJ,EACC,CAAA1B,SACAC,UACAR,MAAM,WACNkC,SAAS,wBACTzE,KACE/B,EAAAA,IAAC,OACCF,UAAU,qBACVO,KAAK,OACLC,OAAO,eACPC,QAAQ,YAERJ,SAAAH,EAAAA,IAAC,QACCQ,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,2JAIR8F,OAAQP,EACRrE,KAAK,KACL6E,iBAAiB,cAEjBvG,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,gEACbK,SAAA,CAACH,EAAAA,IAAA,MAAA,CAAIF,UAAU,0BAA0BK,SAAY,iBACrDC,EAAAA,KAAC,MAAI,CAAAN,UAAU,qBAAqBK,SAAA,CAAA,IAAEkC,EAAMmC,QAAQ,SAErDxE,EAAAA,IAAA,IAAA,CAAEF,UAAU,6BAA6BK,SAE1C,yCACAC,EAAAA,KAAC,MAAI,CAAAN,UAAU,yFACbK,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAK,UACVH,EAAAA,IAAA,OAAA,CAAKF,UAAU,yCAAyCK,SAAS,iBAEpEC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAM,WACXH,EAAAA,IAAA,OAAA,CAAKF,UAAU,yCAAyCK,SAAC,SAE5DC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAK,UACVH,EAAAA,IAAA,OAAA,CAAKF,UAAU,yCAAyCK,SAAC,SAE5DC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAM,WACXH,EAAAA,IAAA,OAAA,CAAKF,UAAU,yCAAyCK,SAAG,gBAKtE,CCpFA,SAASsP,GAAyB5K,OAChCA,EAAAA,QACAC,EAAAA,OACA4K,EAAS,EAAAC,QACTA,EAAU,EAAAC,UACVA,EAAAA,WACAC,IAEA1J,EACE,CACE,CACEhF,IAAK,SACLiF,OAAQtB,EACRuB,QAASxB,EACTyB,kBAAkB,GAEpB,CACEnF,IAAK,QACLiF,OAAQA,KACFwJ,GAAqBA,KAE3BvJ,QAASxB,EACTyB,kBAAkB,IAGtB,CAACzB,IAGH,MAAMqB,EACJlG,EAAAA,IAAC,MAAI,CAAAF,UAAU,6BACbK,SAAAH,EAAAA,IAAC2B,EACC,CAAAC,MAAM,kBACN9B,UAAU,6EACVwB,QAAS,KACHsO,EAAqBA,UACd,gBAMnB,OACGxP,EAAAA,KAAAmG,EAAA,CACC1B,SACAC,UACAR,MAAM,mBACNvC,KACG/B,EAAAA,IAAA,MAAA,CACCF,UAAU,qBACVO,KAAK,OACLC,OAAO,eACPC,QAAQ,YAERJ,SAACH,EAAAA,IAAA,OAAA,CACCQ,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,qBAIR8F,OAAQP,EACRrE,KAAK,KACL6E,iBAAiB,wBAGjBvG,SAAA,CAAAH,MAAC,MAAI,CAAAF,UAAU,2BACbK,SAAAH,EAAAA,IAAC,MAAI,CAAAF,UAAU,uEACbK,SAAAH,EAAAA,IAAC,MACC,CAAAgN,MAAM,6BACNlN,UAAU,yBACVO,KAAK,OACLE,QAAQ,YACRD,OAAO,eAEPH,SAACH,EAAAA,IAAA,OAAA,CACCQ,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,yBAOVP,EAAAA,KAAC,MAAI,CAAAN,UAAU,2EACbK,SAAA,CAACH,EAAAA,IAAA,MAAA,CAAIF,UAAU,kDAAkDK,SAEjE,WAEAC,EAAAA,KAAC,MAAI,CAAAN,UAAU,yFACbK,SAAA,CAACH,EAAAA,IAAA,OAAA,CAAKF,UAAU,oBAAoBK,SAAC,MACrCH,EAAAA,IAAC,QAAKF,UAAU,qBACb4B,gBAAOgO,GAAQlL,QAAQ,QAI3BxE,EAAAA,IAAA,MAAA,CAAIF,UAAU,0BAA0BK,SAAO,YAChDC,EAAAA,KAAC,MAAI,CAAAN,UAAU,wBAAwBK,SAAA,CAAA,IACnCuB,OAAOiO,GAASnL,QAAQ,SAG9BpE,EAAAA,KAAC,MAAI,CAAAN,UAAU,yFACbK,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAqB,0BAC1BH,EAAAA,IAAA,OAAA,CAAKF,UAAU,yCAAyCK,SAAK,aAEhEC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAM,WACXH,EAAAA,IAAA,OAAA,CAAKF,UAAU,yCAAyCK,SAAG,gBAKtE,CClHA,SAAS2P,GAAiBjL,OAAEA,EAAAA,QAAQC,EAAAA,MAASzC,EAAAA,UAAO0N,IAClD,MAAOC,EAAgBC,GAAqBhL,EAAAA,SAAS,KAC9CiL,EAAcC,GAAmBlL,EAAAA,UAAS,IAC1CmL,EAAcC,GAAmBpL,EAAAA,SAAS,MAC3CqL,EAAiB7H,SAAO,MACxB8H,EAAqB9H,UAAO,GAI5B+H,EAA2BxP,IAC3BA,IACFA,EAAE8H,iBACF9H,EAAEyD,mBAGJ,MAAMgM,EAAc/O,OAAOW,GAAOmC,QAAQ,GAC1CyL,EAAkBQ,GAClBF,EAAmBjH,SAAU,EAE7BtD,WAAW,KACTuK,EAAmBjH,SAAU,GAC5B,MAGCoH,EAAuB1P,IACvBA,IACFA,EAAE8H,iBACF9H,EAAEyD,mBAOJ,IAAIkM,EAHeL,EAAehH,SAASxI,OAASkP,EAIhDO,EAAmBjH,UACrBqH,EAAcjP,OAAOW,GAAOmC,QAAQ,IAItC,MAAMoM,GAAiBD,GAAaE,YAAc,IAAIzP,OACtD,IAAKwP,EAEH,YADAE,MAAM,2BAGFC,MAAAA,EAAWrP,OAAOkP,GACxB,GAAIlG,MAAMqG,IAAaA,GAAY,EAEjC,YADAD,MAAM,gCAIR,MAAME,EAAkBzP,KAAK0P,MAAiB,IAAXF,GAAkB,IAC/CG,EAAe3P,KAAK0P,MAAc,IAAR5O,GAAe,IAC/C,GAAI2O,EAAkBE,EAEpB,YADMJ,MAAA,qBAAqBE,EAAgBxM,QAAQ,gDAAgD0M,EAAa1M,QAAQ,QAK1H,MAAMkL,EAASnO,KAAKC,IAAI,EAAGwP,EAAkBE,GAC7Bb,EAAA,CAAEX,SAAQC,QAASuB,EAAcH,SAAUC,IAC3Db,GAAgB,IAIZgB,EAAsBA,KAC1BhB,GAAgB,GACZrL,GAAiBA,KAIjBsM,EAAiBA,KACrBjB,GAAgB,GAChBF,EAAkB,IACdnL,GAAiBA,KAIjBuM,EAAgBA,KAChBtB,GAAuC,MAA1BK,GAAcW,UACnBrP,EAAAA,OAAO0O,EAAaW,YAmClC,GA7BA5K,EACE,CACE,CACEhF,IAAK,SACLiF,OAAQtB,EACRuB,QAASxB,IAAWqL,EACpB5J,kBAAkB,GAEpB,CACEnF,IAAK,QACLiF,OAAepF,IACbA,EAAE8H,iBACF9H,EAAEyD,kBACFiM,EAAc1P,IAEhBqF,QAASxB,IAAWqL,EACpB5J,kBAAkB,GAEpB,CACEnF,IAAK,IACLiF,OAAQoK,EACRnK,QAASxB,IAAWqL,EACpB5J,kBAAkB,IAGtB,CAACzB,EAAQmL,EAAgB3N,EAAO6N,KAI7BrL,IAAWqL,EAAqB,OAAA,KAGrC,GAAIA,EACF,OACGlQ,EAAAA,IAAAyP,EAAA,CACC5K,OAAQqL,EACRpL,QAASqM,EACTzB,OAAQU,GAAcV,OACtBC,QAASS,GAAcT,QACvBE,WAAYuB,EACZxB,UAAWyB,IAKjB,MAAMnL,EAEF9F,EAAAA,KAAAkR,EAAAA,SAAA,CAAAnR,SAAA,CAACH,EAAAA,IAAA2B,EAAA,CACCC,MAAM,eACN1B,QAAQ,YACRoB,QAASwD,EACTlE,KAAK,SACLd,UAAU,WAEZE,EAAAA,IAAC2B,EACC,CAAAC,MAAM,kBACN1B,QAAQ,UACRU,KAAK,SACLU,QAASoP,EACT5Q,UAAU,cAKhB,cACGyG,EACC,CAAA1B,SACAC,UACAR,MAAM,eACNkC,SAAS,wBACTzE,KACE/B,EAAAA,IAAC,OACCF,UAAU,qBACVO,KAAK,OACLC,OAAO,eACPC,QAAQ,YAERJ,SAAAH,EAAAA,IAAC,QACCQ,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,kLAIR8F,OAAQP,EACRrE,KAAK,KACL6E,iBAAiB,YAGjBvG,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,6FACbK,SAAA,CAACH,EAAAA,IAAA,MAAA,CAAIF,UAAU,0BAA0BK,SAAY,iBACrDC,EAAAA,KAAC,MAAI,CAAAN,UAAU,qBAAqBK,SAAA,CAAA,IAAEkC,EAAMmC,QAAQ,gBAIrD,MACC,CAAArE,SAAA,CAACH,EAAAA,IAAA,QAAA,CAAMF,UAAU,+CAA+CK,SAEhE,oBACCH,EAAAA,IAAA,QAAA,CACCD,IAAKuQ,EACL1P,KAAK,SACL2Q,KAAK,OACLzR,UAAU,mJACVuB,YAAY,QACZP,MAAOkP,EACPjP,SAAiBC,IAETF,MAAAA,EAAQE,EAAEC,OAAOH,OACT,KAAVA,GAAgB,cAAciC,KAAKjC,KACrCmP,EAAkBnP,gBAOzB,MACC,CAAAX,SAAA,CAACH,EAAAA,IAAA,IAAA,CAAEF,UAAU,6BAA6BK,SAAc,mBACvDH,EAAAA,IAAA,MAAA,CAAIF,UAAU,yBACZK,SAAC,CAAA,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAKyD,IAC7C4N,GAAAxR,EAAAA,IAAC,SAEC,CAAAF,UAAU,kGACVwB,QAAS,IA5MMkQ,CAAQvB,GAAAA,EAAkBvO,OAAO8P,GAAKX,YA4MtCY,CAAkBD,GAEhCA,SAJIA,GAAAA,eAWZ7P,EACC,CAAAC,MAAM,uBACN9B,UAAU,2EACVwB,QAASkP,IAEXpQ,EAAAA,KAAC,MAAI,CAAAN,UAAU,yFACbK,SAAA,CAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAgB,qBACrBH,EAAAA,IAAA,OAAA,CAAKF,UAAU,yCAAyCK,SAAC,SAE5DC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAQ,aACbH,EAAAA,IAAA,OAAA,CAAKF,UAAU,yCAAyCK,SAAK,aAEhEC,EAAAA,KAAC,MAAI,CAAAN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAM,WACXH,EAAAA,IAAA,OAAA,CAAKF,UAAU,yCAAyCK,SAAG,gBAKtE,CChPA,SAAwBuR,GAAsB7M,OAAEA,EAAAA,QAAQC,EAAAA,SAAS6M,IAC/D,MAAOC,EAAeC,GAAoB5M,EAAAA,UAAS,IAC5CiD,EAAOC,GAAYlD,EAAAA,SAAS,IAC7BuE,EAAQC,eAAenE,QAAQ,cAE/BwM,EAAOzH,KAAK0H,MAAMtI,eAAenE,QAAQ,SAAW,MAmFpDY,EACHlG,EAAAA,IAAA2B,EAAA,CACCC,MAAM,cACN1B,QAAQ,YACRoB,QAASwD,EACThF,UAAU,WASd,OALAqG,EACE,CAAC,CAAEhF,IAAK,SAAUiF,OAAQtB,EAASuB,QAASxB,IAC5C,CAACA,WAIA0B,EACC,CAAA1B,SACAC,UACAR,MAAM,qBACNkC,SAAS,gCACTzE,KACE/B,EAAAA,IAAC,OACCF,UAAU,qBACVO,KAAK,OACLC,OAAO,eACPC,QAAQ,YAERJ,SAAAH,EAAAA,IAAC,QACCQ,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,qBAIR8F,OAAQP,EACRrE,KAAK,KACL6E,iBAAiB,YAEjBvG,SAAA,CAACH,EAAAA,IAAA,MAAA,CAAIF,UAAU,oCAAoCK,SAEnD,sDACC,MAAI,CAAAL,UAAU,WACbK,SAAAH,EAAAA,IAAC2G,GACCC,OA7HWzB,MAAO0B,IAClBC,MAAAA,EAAOD,IAAS,IAAIE,SAC1B,GAAKD,EAAL,CACA+K,GAAiB,GACjB1J,EAAS,IACL,IACE8B,IAAAA,EACA,IACQI,EAAAA,KAAK0H,MAAMjL,SACd9F,GACD,MAAA,IAAIgR,MAAM,qBAAoB,CAItC,GAAkB,SAAd/H,EAAQlE,GAAgBkE,EAAQqF,eAAgB,CAC5C,MAAAA,eAAEA,EAAgB2C,YAAa7M,GAAe6E,EAG9CiI,EAAoBJ,GAAM1M,YAAc0M,GAAMG,YACpD,GAAI7M,GAAc8M,GAAqBxQ,OAAO0D,KAAgB1D,OAAOwQ,GAC7D,MAAA,IAAIF,MAAM,6CAId,IACF,MAAMG,QAAiBzM,EAAI,cAAc4J,aAA2B,CAClEnF,OAAQ,OACRR,QAAS,CAAEC,cAAe,UAAUJ,OAGtC,GAAI2I,EAAS7C,eAKX,OAHQxK,SAER+F,OAAOuH,SAASC,KAAO,eAAeF,EAASG,sBAGzC,MAAA,IAAIN,MAAM,wCAEX9D,GAEP,MADQhG,QAAAA,MAAM,gCAAiCgG,GACzC,IAAI8D,MAAM9D,EAAI9C,SAAW,0CAAyC,CAC1E,KACF,IAEuB,SAAdnB,EAAQlE,IAAgB2G,MAAMuB,QAAQhE,EAAQsI,OA0B/C,MAAA,IAAIP,MAAM,8BA1B6C,CACvD,MAAEO,MAAOC,EAAcC,EAAGrN,GAAe6E,EACzCiI,EAAoBJ,GAAM1M,YAAc0M,GAAMG,YAEpD,GAAI7M,GAAc8M,GAAqBxQ,OAAO0D,KAAgB1D,OAAOwQ,GAC7D,MAAA,IAAIF,MAAM,6CAGlB,MAAMU,EAAY,GAClB,IAAA,MAAWC,KAAMH,EAAc,CAC7B,IAAKG,GAAIC,IAAMD,GAAI3E,EAAG,SAChBjJ,MAAAA,QAAgBW,EAAI,iBAAiBF,mBAAmBmN,EAAGC,KAAM,CACrEjJ,QAAS,CAAEC,cAAe,UAAUJ,OAEtCkJ,EAAUG,KAAK,CACbC,WAAY/N,EAAQ+N,WACpBtT,IAAKuF,EAAQvF,IACbqB,KAAMkE,EAAQY,aACdjG,SAAUgC,OAAOiR,EAAG3E,GACpBzJ,MAAO7C,OAAOqD,EAAQa,eAAiB,IACxC,CAEH,GAAyB,IAArB8M,EAAUhP,OAAoB,MAAA,IAAIsO,MAAM,sBAC5CL,EAASe,GACD5N,GAAA,CAEoC,QAEvC9D,GACEA,EAAAA,EAAEoK,SAAW,6BACdlD,QAAAA,MAAM,cAAelH,EAAC,CACtB,QACR6Q,GAAiB,EAAK,CA3Eb,GA4HL7K,OAAQ4K,EACR3K,SAAU,IAAM4K,GAAiB,GACjC/R,UAAU,oBAGboI,GACClI,EAAAA,IAAC,MAAI,CAAAF,UAAU,sEACZoI,SACHA,UAED,MAAI,CAAApI,UAAU,+EACbK,SAACC,EAAAA,KAAA,MAAA,CAAIN,UAAU,oCACbK,SAAA,CAAAH,EAAAA,IAAC,QAAKG,SAAM,WACXH,EAAAA,IAAA,OAAA,CAAKF,UAAU,yCAAyCK,SAAG,eAKtE"}