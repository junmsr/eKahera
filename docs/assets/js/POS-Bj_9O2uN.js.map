{"version":3,"file":"POS-Bj_9O2uN.js","sources":["../../../frontend/src/components/modals/AdminReceiptsModal.jsx","../../../frontend/src/pages/POS.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport BaseModal from \"./BaseModal\";\r\nimport Button from \"../common/Button\";\r\nimport { api } from \"../../lib/api\";\r\n\r\nfunction AdminReceiptsModal({ isOpen, onClose }) {\r\n  const [receipts, setReceipts] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    const fetchReceipts = async () => {\r\n      setLoading(true);\r\n      setError(\"\");\r\n      try {\r\n        const token = sessionStorage.getItem(\"auth_token\");\r\n        const data = await api(\"/api/sales/business/recent\", {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        setReceipts(Array.isArray(data) ? data : []);\r\n      } catch (e) {\r\n        console.error(\"Error fetching receipts:\", e);\r\n        setError(\"Failed to load receipts. Please try again.\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchReceipts();\r\n  }, [isOpen]);\r\n\r\n  const openReceipt = (receipt) => {\r\n    const url = new URL(window.location.origin + \"/receipt\");\r\n    if (receipt.transaction_number)\r\n      url.searchParams.set(\"tn\", receipt.transaction_number);\r\n    if (receipt.transaction_id)\r\n      url.searchParams.set(\"tid\", String(receipt.transaction_id));\r\n    window.open(url.toString(), \"_blank\");\r\n  };\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"All Transactions\"\r\n      subtitle=\"Latest transactions across all cashiers\"\r\n      size=\"lg\"\r\n      footer={\r\n        <Button\r\n          label=\"Close\"\r\n          variant=\"secondary\"\r\n          onClick={onClose}\r\n          className=\"w-full\"\r\n        />\r\n      }\r\n    >\r\n      {loading && (\r\n        <div className=\"text-sm text-gray-600 py-4 text-center\">\r\n          Loading transactions...\r\n        </div>\r\n      )}\r\n      {error && (\r\n        <div className=\"text-sm text-red-600 bg-red-50 border border-red-100 rounded-lg px-3 py-2 mb-2\">\r\n          {error}\r\n        </div>\r\n      )}\r\n      {!loading && !error && receipts.length === 0 && (\r\n        <div className=\"text-sm text-gray-500 py-6 text-center\">\r\n          No transactions found.\r\n        </div>\r\n      )}\r\n      <div className=\"space-y-2 max-h-[60vh] overflow-y-auto\">\r\n        {receipts.map((r) => (\r\n          <button\r\n            key={`${r.transaction_id}-${r.transaction_number}`}\r\n            onClick={() => openReceipt(r)}\r\n            className=\"w-full text-left border border-gray-200 rounded-xl px-3 py-2 hover:border-blue-300 hover:bg-blue-50 transition-colors\"\r\n          >\r\n            <div className=\"flex justify-between items-center\">\r\n              <div>\r\n                <p className=\"text-sm font-semibold text-gray-900\">\r\n                  {r.transaction_number || `TXN-${r.transaction_id || ''}`}\r\n                </p>\r\n                <p className=\"text-xs text-gray-600\">\r\n                  {new Date(r.updated_at || r.created_at).toLocaleString()}\r\n                </p>\r\n              </div>\r\n              <div className=\"text-right\">\r\n                <p className=\"text-sm font-bold text-blue-700\">\r\n                  ₱{Number(r.total_amount || r.total || 0).toFixed(2)}\r\n                </p>\r\n                <p className=\"text-[11px] text-gray-600 uppercase\">\r\n                  {r.payment?.method || r.payment_type || 'cash'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            {(r.discount_percentage || r.discount_amount) && (\r\n              <p className=\"text-[11px] text-emerald-700 mt-1\">\r\n                Discount applied{\" \"}\r\n                {r.discount_percentage\r\n                  ? `${r.discount_percentage}%`\r\n                  : `₱${Number(r.discount_amount || 0).toFixed(2)}`}\r\n              </p>\r\n            )}\r\n          </button>\r\n        ))}\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default AdminReceiptsModal;\r\n","import React, { useState, useRef, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport ScannerCard from \"../components/ui/POS/ScannerCard\";\r\nimport PageLayout from \"../components/layout/PageLayout\";\r\nimport SkuFormCard from \"../components/ui/POS/SkuFormCard\";\r\nimport CartTableCard from \"../components/ui/POS/CartTableCard\";\r\nimport Button from \"../components/common/Button\";\r\nimport NavAdmin from \"../components/layout/Nav-Admin\";\r\n// Background gradient removed for a neutral look\r\nimport { api, createGcashCheckout, createMayaCheckout } from \"../lib/api\";\r\nimport PriceCheckModal from \"../components/modals/PriceCheckModal\";\r\nimport DiscountModal from \"../components/modals/DiscountModal\";\r\nimport CashLedgerModal from \"../components/modals/CashLedgerModal\";\r\nimport CheckoutModal from \"../components/modals/CheckoutModal\";\r\nimport CashPaymentModal from \"../components/modals/CashPaymentModal\";\r\nimport ScanCustomerCartModal from \"../components/modals/ScanCustomerCartModal\";\r\nimport ProfileModal from \"../components/modals/ProfileModal\";\r\nimport { BiReceipt, BiSync, BiUser } from \"react-icons/bi\";\r\nimport AdminReceiptsModal from \"../components/modals/AdminReceiptsModal\";\r\nimport { MdClose } from \"react-icons/md\";\r\n\r\nfunction POS() {\r\n  const navigate = useNavigate();\r\n\r\n  // States\r\n  const [sku, setSku] = useState(\"\");\r\n  const [quantity, setQuantity] = useState(1);\r\n  const [cart, setCart] = useState([]);\r\n  const [showDiscount, setShowDiscount] = useState(false);\r\n  const [showPriceCheck, setShowPriceCheck] = useState(false);\r\n  const [priceCheckSku, setPriceCheckSku] = useState(\"\");\r\n  const [showImportCart, setShowImportCart] = useState(false);\r\n  const [showCashLedger, setShowCashLedger] = useState(false);\r\n  const [showCheckout, setShowCheckout] = useState(false);\r\n  const [showCashModal, setShowCashModal] = useState(false);\r\n  const [selectedPayment, setSelectedPayment] = useState(null);\r\n  const [darkMode, setDarkMode] = useState(false);\r\n  const [scannerPaused, setScannerPaused] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [transactionNumber, setTransactionNumber] = useState(\"\");\r\n  const [transactionId, setTransactionId] = useState(null);\r\n  const [showReceipts, setShowReceipts] = useState(false);\r\n  const [showProfileModal, setShowProfileModal] = useState(false);\r\n  const skuInputRef = useRef(null);\r\n  const [isSidebarOpen, setSidebarOpen] = useState(false);\r\n  const token = sessionStorage.getItem(\"auth_token\");\r\n  const user = JSON.parse(sessionStorage.getItem(\"user\") || \"{}\");\r\n  const hasFinalizedRef = React.useRef(false);\r\n  const [businessName, setBusinessName] = useState(\"\");\r\n\r\n  // Add keyboard shortcuts for buttons: F3-F8\r\n  useEffect(() => {\r\n    const keyDownHandler = (e) => {\r\n      if (e.repeat) return;\r\n      switch (e.key) {\r\n        case \"F3\":\r\n          e.preventDefault();\r\n          skuInputRef.current?.focus();\r\n          break;\r\n        case \"F4\":\r\n          e.preventDefault();\r\n          setShowCashLedger(true);\r\n          break;\r\n        case \"F5\":\r\n          e.preventDefault();\r\n          setShowDiscount(true);\r\n          break;\r\n        case \"F6\":\r\n          e.preventDefault();\r\n          setShowPriceCheck(true);\r\n          break;\r\n        case \"F7\":\r\n          e.preventDefault();\r\n          setShowImportCart(true);\r\n          break;\r\n        case \"F8\":\r\n          e.preventDefault();\r\n          if (cart.length > 0) {\r\n            setShowCheckout(true);\r\n          }\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    };\r\n    window.addEventListener(\"keydown\", keyDownHandler);\r\n    return () => window.removeEventListener(\"keydown\", keyDownHandler);\r\n  }, [cart.length]);\r\n\r\n  // Generate a client-side provisional transaction number when POS opens\r\n  useEffect(() => {\r\n    if (!transactionNumber) {\r\n      const businessId = user?.businessId || user?.business_id || \"BIZ\";\r\n      const timePart = new Date()\r\n        .toISOString()\r\n        .replace(/[-:T.Z]/g, \"\")\r\n        .slice(0, 14);\r\n      const randPart = Math.floor(1000 + Math.random() * 9000);\r\n      setTransactionNumber(`T-${businessId}-${timePart}-${randPart}`);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  // On mount, if returned from PayMongo success/cancel, finalize or cleanup\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(window.location.search);\r\n    const status = params.get(\"payment\");\r\n    const businessId = user?.businessId || user?.business_id;\r\n\r\n    // Check if we're in a new tab (opened from payment)\r\n    const isNewTab = window.opener && !window.opener.closed;\r\n\r\n    const finalizeOnlinePayment = async (pendingCartKey, paymentType) => {\r\n      const pending = localStorage.getItem(pendingCartKey);\r\n      if (status === \"success\" && pending && businessId) {\r\n        try {\r\n          const parsed = JSON.parse(pending);\r\n          if (hasFinalizedRef.current) return;\r\n          const guardKey = `${paymentType}_finalize_done`;\r\n          if (sessionStorage.getItem(guardKey) === \"1\") return;\r\n          hasFinalizedRef.current = true;\r\n          sessionStorage.setItem(guardKey, \"1\");\r\n          try {\r\n            setError(\"\");\r\n            const body = {\r\n              items: parsed.items || [],\r\n              payment_type: paymentType.toLowerCase(),\r\n              money_received: parsed.total || null,\r\n            };\r\n            const resp = await api(\"/api/sales/checkout\", {\r\n              method: \"POST\",\r\n              headers: { Authorization: `Bearer ${token}` },\r\n              body: JSON.stringify(body),\r\n            });\r\n            if (resp?.transaction_number)\r\n              setTransactionNumber(resp.transaction_number);\r\n            if (resp?.transaction_id) setTransactionId(resp.transaction_id);\r\n            setCart([]);\r\n            try {\r\n              const url = new URL(window.location.origin + \"/receipt\");\r\n              if (resp?.transaction_number)\r\n                url.searchParams.set(\"tn\", resp.transaction_number);\r\n              if (resp?.transaction_id)\r\n                url.searchParams.set(\"tid\", String(resp.transaction_id));\r\n              if (resp?.total != null)\r\n                url.searchParams.set(\"total\", String(resp.total));\r\n              \r\n              // If in new tab, redirect opener and close this tab\r\n              if (isNewTab && window.opener) {\r\n                window.opener.location.href = url.toString();\r\n                window.close();\r\n              } else {\r\n                window.location.href = url.toString();\r\n              }\r\n            } catch (_) {}\r\n          } catch (e) {\r\n            setError(`Failed to record ${paymentType} payment`);\r\n          } finally {\r\n            localStorage.removeItem(pendingCartKey);\r\n            if (!isNewTab) {\r\n              const url = new URL(window.location.href);\r\n              url.searchParams.delete(\"payment\");\r\n              window.history.replaceState({}, \"\", url.toString());\r\n            }\r\n          }\r\n        } catch (_) {\r\n          localStorage.removeItem(pendingCartKey);\r\n        }\r\n      } else if (status === \"cancel\" && pending) {\r\n        localStorage.removeItem(pendingCartKey);\r\n        // If in new tab, close it; otherwise just clean up URL\r\n        if (isNewTab && window.opener) {\r\n          window.close();\r\n        } else {\r\n          const url = new URL(window.location.href);\r\n          url.searchParams.delete(\"payment\");\r\n          window.history.replaceState({}, \"\", url.toString());\r\n        }\r\n      }\r\n    };\r\n    \r\n    finalizeOnlinePayment(\"pending_gcash_cart\", \"GCash\");\r\n    finalizeOnlinePayment(\"pending_maya_cart\", \"Maya\");\r\n\r\n  }, []);\r\n\r\n  const addSkuToCart = async (skuValue, qty = 1) => {\r\n    if (!skuValue || qty < 1) return;\r\n    setError(\"\");\r\n    try {\r\n      const product = await api(\r\n        `/api/products/sku/${encodeURIComponent(skuValue)}`,\r\n        {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        }\r\n      );\r\n      const price = Number(product.selling_price || 0);\r\n      const stockQty = Number(product.stock_quantity ?? 0);\r\n      if (stockQty <= 0) {\r\n        setError(\r\n          `Stock for ${product.product_name} (SKU ${product.sku}) is 0.`\r\n        );\r\n        return;\r\n      }\r\n      if (qty > stockQty) {\r\n        setError(\r\n          `Insufficient stock. Available: ${stockQty}, requested: ${qty}.`\r\n        );\r\n        return;\r\n      }\r\n      setCart((prev) => {\r\n        const existingIdx = prev.findIndex(\r\n          (i) => i.product_id === product.product_id\r\n        );\r\n        if (existingIdx >= 0) {\r\n          const next = [...prev];\r\n          const newQty = next[existingIdx].quantity + qty;\r\n          if (newQty > stockQty) {\r\n            setError(\r\n              `Insufficient stock. Available: ${stockQty}, requested: ${newQty}.`\r\n            );\r\n            return prev;\r\n          }\r\n          next[existingIdx] = { ...next[existingIdx], quantity: newQty };\r\n          return next;\r\n        }\r\n        return [\r\n          ...prev,\r\n          {\r\n            product_id: product.product_id,\r\n            sku: product.sku,\r\n            name: product.product_name,\r\n            quantity: qty,\r\n            price,\r\n          },\r\n        ];\r\n      });\r\n      setSku(\"\");\r\n      setQuantity(1);\r\n      setScannerPaused(false);\r\n    } catch (err) {\r\n      setError(\"Product not found\");\r\n    }\r\n  };\r\n\r\n  const handleAddToCart = async () => {\r\n    await addSkuToCart(sku, quantity);\r\n  };\r\n\r\n  const handleRemove = (idx) => setCart(cart.filter((_, i) => i !== idx));\r\n\r\n  const handleEditQuantity = async (idx, newQty) => {\r\n    if (newQty < 1) {\r\n      setError(\"Quantity must be at least 1\");\r\n      return;\r\n    }\r\n    const item = cart[idx];\r\n    if (!item) return;\r\n    setError(\"\");\r\n    try {\r\n      const product = await api(\r\n        `/api/products/sku/${encodeURIComponent(item.sku)}`,\r\n        {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        }\r\n      );\r\n      const stockQty = Number(product.stock_quantity ?? 0);\r\n      if (newQty > stockQty) {\r\n        setError(\r\n          `Insufficient stock. Available: ${stockQty}, requested: ${newQty}.`\r\n        );\r\n        return;\r\n      }\r\n      setCart((prev) =>\r\n        prev.map((it, i) => (i === idx ? { ...it, quantity: newQty } : it))\r\n      );\r\n    } catch (err) {\r\n      setError(err.message || \"Failed to update quantity\");\r\n    }\r\n  };\r\n\r\n  const subtotal = cart.reduce(\r\n    (sum, item) => sum + item.price * item.quantity,\r\n    0\r\n  );\r\n\r\n  // Discount state and calculation\r\n  const [appliedDiscount, setAppliedDiscount] = useState(null);\r\n  \r\n  // Calculate total with discount\r\n  const total = appliedDiscount?.type === \"percentage\"\r\n    ? Math.max(0, subtotal - subtotal * (Number(appliedDiscount.value || 0) / 100))\r\n    : appliedDiscount?.type === \"amount\"\r\n    ? Math.max(0, subtotal - Number(appliedDiscount.value || 0))\r\n    : subtotal;\r\n\r\n  const handleCheckout = async (paymentMethod, amountReceived = null) => {\r\n    if (cart.length === 0) return;\r\n    setError(\"\");\r\n    try {\r\n      // Prepare the checkout payload\r\n      const payload = {\r\n        items: cart.map((item) => ({\r\n          product_id: item.product_id,\r\n          quantity: item.quantity,\r\n          price: item.price,\r\n        })),\r\n        payment_type: paymentMethod,\r\n        money_received: amountReceived,\r\n        transaction_id: transactionId, // Include the transaction ID if it exists\r\n        transaction_number: transactionNumber,\r\n        discount_id: appliedDiscount?.discount_id || null,\r\n        discount_percentage: appliedDiscount?.type === 'percentage' ? appliedDiscount.value : null,\r\n        discount_amount: appliedDiscount?.type === 'amount' ? appliedDiscount.value : null,\r\n      };\r\n\r\n      const resp = await api(\"/api/sales/checkout\", {\r\n        method: \"POST\",\r\n        headers: { Authorization: `Bearer ${token}` },\r\n        body: JSON.stringify(payload),\r\n      });\r\n      if (resp?.transaction_number)\r\n        setTransactionNumber(resp.transaction_number);\r\n      if (resp?.transaction_id) setTransactionId(resp.transaction_id);\r\n      setCart([]);\r\n      try {\r\n        const url = new URL(window.location.origin + \"/receipt\");\r\n        if (resp?.transaction_number)\r\n          url.searchParams.set(\"tn\", resp.transaction_number);\r\n        if (resp?.transaction_id)\r\n          url.searchParams.set(\"tid\", String(resp.transaction_id));\r\n        if (resp?.total != null)\r\n          url.searchParams.set(\"total\", String(resp.total));\r\n        navigate(url.pathname + url.search);\r\n      } catch (_) {}\r\n      // Start a fresh provisional transaction number after successful checkout\r\n      const businessId = user?.businessId || user?.business_id || \"BIZ\";\r\n      const timePart = new Date()\r\n        .toISOString()\r\n        .replace(/[-:T.Z]/g, \"\")\r\n        .slice(0, 14);\r\n      const randPart = Math.floor(1000 + Math.random() * 9000);\r\n      setTransactionNumber(`T-${businessId}-${timePart}-${randPart}`);\r\n      setAppliedDiscount(null); // Reset discount after successful checkout\r\n    } catch (err) {\r\n      console.error(\"Checkout error:\", err);\r\n      setError(\"Checkout failed\");\r\n    }\r\n  };\r\n\r\n  const [showRecentReceiptsModal, setShowRecentReceiptsModal] = useState(false);\r\n\r\n  const handleCopyTn = async () => {\r\n    try {\r\n      if (!user.store_name) return;\r\n      await navigator.clipboard.writeText(user.store_name);\r\n    } catch (_) {}\r\n  };\r\n\r\n  const headerActions = (\r\n    <div className=\"flex items-center gap-1 sm:gap-4 mr-3\">\r\n      {/* Transaction Number display */}\r\n      <div className=\"space-y-2\">\r\n        {appliedDiscount && (\r\n          <div className=\"flex items-center justify-between text-sm text-green-600\">\r\n            <span>Discount Applied:</span>\r\n            <span className=\"font-medium\">\r\n              {appliedDiscount.type === 'percentage' \r\n                ? `${appliedDiscount.value}%` \r\n                : `₱${Number(appliedDiscount.value).toFixed(2)}`}\r\n            </span>\r\n          </div>\r\n        )}\r\n        <div className=\"flex items-center justify-between text-lg font-semibold\">\r\n          <span>Total:</span>\r\n          <div className=\"flex items-center gap-2\">\r\n            {appliedDiscount && (\r\n              <span className=\"text-sm text-gray-500 line-through\">\r\n                ₱{subtotal.toFixed(2)}\r\n              </span>\r\n            )}\r\n            <span>₱{total.toFixed(2)}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {/* Transaction Number display */}\r\n      <div className=\"flex-1 flex items-center justify-center\">\r\n        <button\r\n          onClick={handleCopyTn}\r\n          title=\"Copy store name\"\r\n          className=\"inline-flex items-center gap-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg px-2 py-1.5 sm:px-2.5 shadow-sm\"\r\n        >\r\n          <svg\r\n            className=\"w-3 h-3 sm:w-4 sm:h-4\"\r\n            fill=\"none\"\r\n            stroke=\"currentColor\"\r\n            viewBox=\"0 0 24 24\"\r\n          >\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2M8 16h8a2 2 0 002-2v-6m-10 8l-2 2m2-2l2 2\"\r\n            />\r\n          </svg>\r\n          <span className=\"font-mono text-xs sm:text-sm font-bold tracking-wider truncate max-w-[30vw] sm:max-w-[50vw]\">\r\n            {user.store_name}\r\n          </span>\r\n        </button>\r\n      </div>\r\n      {/* View All Receipts Button */}\r\n      <button\r\n        onClick={() => setShowReceipts(true)}\r\n        className=\"flex items-center gap-2 bg-white/80 backdrop-blur-sm p-1.5 sm:px-3 sm:py-2 rounded-lg border border-gray-200/80 hover:bg-gray-50 transition-colors\"\r\n        title=\"View all receipts\"\r\n      >\r\n        <div className=\"relative\">\r\n          <BiReceipt className=\"w-5 h-5 text-blue-600\" />\r\n        </div>\r\n        <span className=\"text-sm font-medium text-gray-700 hidden sm:inline\">\r\n          Receipts\r\n        </span>\r\n      </button>\r\n\r\n      {/* Cashier Profile Button */}\r\n      <button\r\n        onClick={() => setShowProfileModal(true)}\r\n        className=\"flex items-center gap-2 bg-white/80 backdrop-blur-sm p-1.5 sm:px-3 sm:py-2 rounded-lg border border-gray-200/80\"\r\n      >\r\n        <div className=\"w-6 h-6 sm:w-7 sm:h-7 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-full flex items-center justify-center text-sm font-medium shadow-md\">\r\n          {user.username?.[0]?.toUpperCase() || \"A\"}\r\n        </div>\r\n        <span className=\"text-sm font-medium text-gray-700 hidden sm:inline\">\r\n          {user.username || \"Admin\"}\r\n        </span>\r\n      </button>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <PageLayout\r\n      title=\"POS\"\r\n      sidebar={<NavAdmin />}\r\n      headerActions={headerActions}\r\n      isSidebarOpen={isSidebarOpen}\r\n      setSidebarOpen={setSidebarOpen}\r\n    >\r\n      <div className=\"flex-1 flex flex-col min-h-screen\">\r\n        <main className=\"flex-1 bg-gradient-to-br from-gray-50/50 via-blue-50/30 to-indigo-50/50 overflow-hidden p-2 sm:p-3 md:p-4 pb-10 lg:pb-4\">\r\n          <div className=\"grid gap-2 sm:gap-3 md:gap-4 h-full grid-cols-1 lg:grid-cols-12\">\r\n            {/* Left Column - Scanner, SKU Form, Transaction */}\r\n            <div className=\"lg:col-span-4 flex flex-col gap-2 sm:gap-3 md:gap-4\">\r\n              {/* ScannerCard */}\r\n              <div className=\"flex-shrink-0\">\r\n                <ScannerCard\r\n                  onScan={async (result) => {\r\n                    const code = result?.[0]?.rawValue;\r\n                    if (!code) return;\r\n                    setScannerPaused(true);\r\n                    if (showPriceCheck) {\r\n                      setPriceCheckSku(code);\r\n                    } else {\r\n                      await addSkuToCart(code, 1);\r\n                    }\r\n                  }}\r\n                  paused={scannerPaused}\r\n                  onResume={() => setScannerPaused(false)}\r\n                  textMain=\"text-blue-700\"\r\n                />\r\n              </div>\r\n\r\n              {/* SkuFormCard */}\r\n              <div className=\"flex-shrink-0\">\r\n                <SkuFormCard\r\n                  ref={skuInputRef}\r\n                  sku={sku}\r\n                  setSku={setSku}\r\n                  quantity={quantity}\r\n                  setQuantity={setQuantity}\r\n                  handleAddToCart={handleAddToCart}\r\n                />\r\n                {error && (\r\n                  <div className=\"bg-red-50 border-l-4 border-red-500 rounded-lg p-3 flex items-start gap-2 mt-3\">\r\n                    <svg\r\n                      className=\"w-4 h-4 text-red-500 flex-shrink-0 mt-0.5\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"\r\n                      />\r\n                    </svg>\r\n                    <p className=\"text-sm font-medium text-red-700\">\r\n                      {(() => {\r\n                        try {\r\n                          const parsed = JSON.parse(error);\r\n                          return parsed.error || parsed.message || error;\r\n                        } catch {\r\n                          return error;\r\n                        }\r\n                      })()}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* TransactionCard */}\r\n              {/* Removed card display; transaction number now shown in header */}\r\n              {/* <div className=\"flex-shrink-0\">\r\n                  <TransactionCard\r\n                    transactionNumber={transactionNumber}\r\n                    transactionId={transactionId}\r\n                  />\r\n                </div> */}\r\n            </div>\r\n\r\n            {/* Right Column - Cart and Actions */}\r\n            <div className=\"lg:col-span-8 flex flex-col gap-2 sm:gap-3 min-h-0\">\r\n              {/* CartTableCard */}\r\n              <div className=\"flex-1 min-h-0 max-h-[calc(100vh-280px)]\">\r\n                <CartTableCard\r\n                  cart={cart}\r\n                  handleRemove={handleRemove}\r\n                  handleEditQuantity={handleEditQuantity}\r\n                  total={total}\r\n                  className=\"flex-1 h-full\"\r\n                />\r\n              </div>\r\n\r\n              {/* Action Buttons */}\r\n              <div className=\"grid grid-cols-12 gap-2 sm:gap-3 flex-shrink-0\">\r\n                {/* Grouped Buttons */}\r\n                <div className=\"col-span-8\">\r\n                  <div className=\"grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3\">\r\n                    <Button\r\n                      label=\"CASH LEDGER (F4)\"\r\n                      size=\"md\"\r\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\r\n                      variant=\"secondary\"\r\n                      microinteraction\r\n                      onClick={() => setShowCashLedger(true)}\r\n                      icon={\r\n                        <svg\r\n                          className=\"w-4 h-4\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                          />\r\n                        </svg>\r\n                      }\r\n                      iconPosition=\"left\"\r\n                    />\r\n                    <Button\r\n                      label={appliedDiscount ? \"Edit Discount (F5)\" : \"Add Discount (F5)\"}\r\n                      variant={appliedDiscount ? \"primary\" : \"secondary\"}\r\n                      onClick={() => setShowDiscount(true)}\r\n                      icon={\r\n                        <svg\r\n                          className=\"w-5 h-5\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                          />\r\n                        </svg>\r\n                      }\r\n                      className={`flex-1 ${appliedDiscount ? 'bg-green-600 hover:bg-green-700' : ''}`}\r\n                    />\r\n                    <Button\r\n                      label=\"PRICE CHECK (F6)\"\r\n                      size=\"md\"\r\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\r\n                      onClick={() => setShowPriceCheck(true)}\r\n                      variant=\"secondary\"\r\n                      microinteraction\r\n                      icon={\r\n                        <svg\r\n                          className=\"w-4 h-4\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                          />\r\n                        </svg>\r\n                      }\r\n                      iconPosition=\"left\"\r\n                    />\r\n                    <Button\r\n                      label=\"SCAN CUSTOMER QR (F7)\"\r\n                      size=\"md\"\r\n                      className=\"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold\"\r\n                      onClick={() => setShowImportCart(true)}\r\n                      variant=\"secondary\"\r\n                      microinteraction\r\n                      icon={\r\n                        <svg\r\n                          className=\"w-4 h-4\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12\"\r\n                          />\r\n                        </svg>\r\n                      }\r\n                      iconPosition=\"left\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Checkout Button */}\r\n                <div className=\"col-span-4\">\r\n                  <Button\r\n                    label=\"CHECKOUT (F8)\"\r\n                    size=\"md\"\r\n                    className=\"w-full h-full text-sm sm:text-base font-bold\"\r\n                    variant=\"primary\"\r\n                    microinteraction\r\n                    onClick={() => setShowCheckout(true)}\r\n                    disabled={cart.length === 0}\r\n                    icon={\r\n                      <svg\r\n                        className=\"w-5 h-5\"\r\n                        fill=\"none\"\r\n                        stroke=\"currentColor\"\r\n                        viewBox=\"0 0 24 24\"\r\n                      >\r\n                        <path\r\n                          strokeLinecap=\"round\"\r\n                          strokeLinejoin=\"round\"\r\n                          strokeWidth={2}\r\n                          d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                        />\r\n                      </svg>\r\n                    }\r\n                    iconPosition=\"left\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </main>\r\n      </div>\r\n      {/* Modals */}\r\n      <DiscountModal\r\n        isOpen={showDiscount}\r\n        onClose={() => setShowDiscount(false)}\r\n        onApplyDiscount={(discount) => {\r\n          setAppliedDiscount(discount);\r\n        }}\r\n      />\r\n      <PriceCheckModal\r\n        isOpen={showPriceCheck}\r\n        onClose={() => setShowPriceCheck(false)}\r\n        sku={priceCheckSku}\r\n        setSku={setPriceCheckSku}\r\n      />\r\n      <CashLedgerModal\r\n        isOpen={showCashLedger}\r\n        onClose={() => setShowCashLedger(false)}\r\n      />\r\n      <AdminReceiptsModal\r\n        isOpen={showReceipts}\r\n        onClose={() => setShowReceipts(false)}\r\n      />\r\n      <CheckoutModal\r\n        isOpen={showCheckout}\r\n        onClose={() => setShowCheckout(false)}\r\n        total={total}\r\n        onSelectPayment={(method) => {\r\n          setSelectedPayment(method);\r\n          setShowCheckout(false);\r\n\r\n          if (method === \"cash\") {\r\n            setShowCashModal(true);\r\n          } else if (method === \"gcash\") {\r\n            (async () => {\r\n              try {\r\n                const successUrl =\r\n                  window.location.origin + \"/pos?payment=success\";\r\n                const cancelUrl =\r\n                  window.location.origin + \"/pos?payment=cancel\";\r\n                // persist cart to finalize after redirect back\r\n                localStorage.setItem(\r\n                  \"pending_gcash_cart\",\r\n                  JSON.stringify({\r\n                    items: cart.map((i) => ({\r\n                      product_id: i.product_id,\r\n                      quantity: i.quantity,\r\n                    })),\r\n                    total,\r\n                  })\r\n                );\r\n                const { checkoutUrl } = await createGcashCheckout({\r\n                  amount: Number(total || 0),\r\n                  description: \"POS Order\",\r\n                  referenceNumber: transactionNumber || `POS-${Date.now()}`,\r\n                  cancelUrl,\r\n                  successUrl,\r\n                });\r\n                window.open(checkoutUrl, '_blank');\r\n              } catch (e) {\r\n                setError(\"Failed to init GCash\");\r\n                localStorage.removeItem(\"pending_gcash_cart\");\r\n              }\r\n            })();\r\n          } else if (method === \"maya\") {\r\n            (async () => {\r\n              try {\r\n                const successUrl =\r\n                  window.location.origin + \"/pos?payment=success\";\r\n                const cancelUrl =\r\n                  window.location.origin + \"/pos?payment=cancel\";\r\n                // persist cart to finalize after redirect back\r\n                localStorage.setItem(\r\n                  \"pending_maya_cart\",\r\n                  JSON.stringify({\r\n                    items: cart.map((i) => ({\r\n                      product_id: i.product_id,\r\n                      quantity: i.quantity,\r\n                    })),\r\n                    total,\r\n                  })\r\n                );\r\n                const { checkoutUrl } = await createMayaCheckout({\r\n                  amount: Number(total || 0),\r\n                  description: \"POS Order\",\r\n                  referenceNumber: transactionNumber || `POS-${Date.now()}`,\r\n                  cancelUrl,\r\n                  successUrl,\r\n                });\r\n                window.open(checkoutUrl, '_blank');\r\n              } catch (e) {\r\n                setError(\"Failed to init Maya\");\r\n                localStorage.removeItem(\"pending_maya_cart\");\r\n              }\r\n            })();\r\n          } else {\r\n            handleCheckout(method);\r\n          }\r\n        }}\r\n      />\r\n      <CashPaymentModal\r\n        isOpen={showCashModal}\r\n        onClose={() => setShowCashModal(false)}\r\n        total={total}\r\n        onConfirm={(amountReceived) => {\r\n          handleCheckout(\"cash\", amountReceived);\r\n          setShowCashModal(false);\r\n        }}\r\n      />\r\n      <ProfileModal\r\n        isOpen={showProfileModal}\r\n        onClose={() => setShowProfileModal(false)}\r\n        userData={user}\r\n      />\r\n      <ScanCustomerCartModal\r\n        isOpen={showImportCart}\r\n        onClose={() => setShowImportCart(false)}\r\n        onImport={(items, transactionId) => {\r\n          // If we have a transaction ID from the scanned cart, use it\r\n          if (transactionId) {\r\n            setTransactionId(transactionId);\r\n          }\r\n          \r\n          // Merge imported items into current cart\r\n          setCart((prev) => {\r\n            const bySku = new Map(prev.map((i) => [i.sku, i]));\r\n            for (const it of items) {\r\n              const existing = bySku.get(it.sku);\r\n              if (existing) {\r\n                existing.quantity += it.quantity;\r\n              } else {\r\n                bySku.set(it.sku, { ...it });\r\n              }\r\n            }\r\n            return Array.from(bySku.values());\r\n          });\r\n        }}\r\n      />\r\n    </PageLayout>\r\n  );\r\n}\r\n\r\nexport default POS;\r\n"],"names":["AdminReceiptsModal","isOpen","onClose","receipts","setReceipts","useState","loading","setLoading","error","setError","useEffect","async","token","sessionStorage","getItem","data","api","headers","Authorization","Array","isArray","e","fetchReceipts","jsxs","BaseModal","title","subtitle","size","footer","jsx","Button","label","variant","onClick","className","children","length","map","r","receipt","url","URL","window","location","origin","transaction_number","searchParams","set","transaction_id","String","open","toString","openReceipt","Date","updated_at","created_at","toLocaleString","Number","total_amount","total","toFixed","payment","method","payment_type","discount_percentage","discount_amount","POS","navigate","useNavigate","sku","setSku","quantity","setQuantity","cart","setCart","showDiscount","setShowDiscount","showPriceCheck","setShowPriceCheck","priceCheckSku","setPriceCheckSku","showImportCart","setShowImportCart","showCashLedger","setShowCashLedger","showCheckout","setShowCheckout","showCashModal","setShowCashModal","selectedPayment","setSelectedPayment","darkMode","setDarkMode","scannerPaused","setScannerPaused","transactionNumber","setTransactionNumber","transactionId","setTransactionId","showReceipts","setShowReceipts","showProfileModal","setShowProfileModal","skuInputRef","useRef","isSidebarOpen","setSidebarOpen","user","JSON","parse","hasFinalizedRef","React","businessName","setBusinessName","keyDownHandler","repeat","key","preventDefault","current","focus","addEventListener","removeEventListener","businessId","business_id","timePart","toISOString","replace","slice","randPart","Math","floor","random","status","URLSearchParams","search","get","isNewTab","opener","closed","finalizeOnlinePayment","pendingCartKey","paymentType","pending","localStorage","parsed","guardKey","setItem","body","items","toLowerCase","money_received","resp","stringify","href","close","_","removeItem","delete","history","replaceState","addSkuToCart","skuValue","qty","product","encodeURIComponent","price","selling_price","stockQty","stock_quantity","product_name","prev","existingIdx","findIndex","i","product_id","next","newQty","name","err","subtotal","reduce","sum","item","appliedDiscount","setAppliedDiscount","type","max","value","handleCheckout","paymentMethod","amountReceived","payload","discount_id","pathname","showRecentReceiptsModal","setShowRecentReceiptsModal","headerActions","store_name","navigator","clipboard","writeText","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","BiReceipt","username","toUpperCase","PageLayout","sidebar","NavAdmin","ScannerCard","onScan","result","code","rawValue","paused","onResume","textMain","SkuFormCard","ref","handleAddToCart","message","CartTableCard","handleRemove","filter","idx","handleEditQuantity","it","microinteraction","icon","iconPosition","disabled","DiscountModal","onApplyDiscount","discount","PriceCheckModal","CashLedgerModal","CheckoutModal","onSelectPayment","successUrl","cancelUrl","checkoutUrl","createGcashCheckout","amount","description","referenceNumber","now","createMayaCheckout","CashPaymentModal","onConfirm","ProfileModal","userData","ScanCustomerCartModal","onImport","bySku","Map","existing","from","values"],"mappings":"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"}