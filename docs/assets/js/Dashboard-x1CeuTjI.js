import{j as e}from"./utils-BnCj7yKo.js";import{a as t,R as s}from"./vendor-BZrj58oz.js";import{u as a,a as r,c as o,b as n}from"./index-DLptuXQb.js";import{d as i,D as l,m as d}from"./DateRangeFilterModal-LlFYLvIy.js";import c from"./html2canvas.esm-CTiZndrd.js";import{E as m}from"./jspdf.es.min-YhZRndMz.js";import{P as u}from"./PageLayout-EdUvf13k.js";import{N as h}from"./Nav-Admin-DxP7iNvw.js";import{D as p,a as x,N as g,C as f}from"./NotificationDropdown-Bnq5Jcs8.js";import{B as b,a as y}from"./index-4YedFPzh.js";import{R as v,L as j,C as w,X as N,Y as S,T as D,a as k,B as P,b as M,c as T}from"./charts-DpvQ0yPn.js";import"./Navbar-C7s4jb7w.js";import"./Logo-DtUJIMK7.js";import"./PrivacyPolicyModal-B1qn0bgk.js";import"./BaseModal-C-8Qp-dk.js";import"./Card-fMjg4IWJ.js";import"./SectionHeader-DKrtjj68.js";i.extend(d);const F="#3b82f6";function C({data:t,className:s="",rangeType:a="Custom"}){return e.jsx(f,{title:e.jsx("span",{className:"text-blue-700",children:(e=>{switch(e){case"Day":return"Customer's Transactions for Today";case"Week":return"Customer's Transactions for 7 days";case"Month":return"Customer's Transactions for Month";default:return"Customer's Transactions for the selected range"}})(a)}),className:`bg-white/80 backdrop-blur-md border border-white/60 shadow-xl ${s}`,children:e.jsx("div",{className:"h-72 w-full",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(j,{data:t,margin:{top:20,right:20,left:0,bottom:5},children:[e.jsx(w,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(N,{dataKey:"name",tick:{fill:"#374151",fontSize:10}}),e.jsx(S,{tick:{fill:"#374151",fontSize:10}}),e.jsx(D,{contentStyle:{background:"#fff",borderColor:"#e5e7eb",borderRadius:8}}),e.jsx(k,{type:"monotone",dataKey:"value",stroke:F,strokeWidth:3,dot:{r:5,fill:F},isAnimationActive:!1})]})})})})}function Y({data:t,className:s=""}){return e.jsx(f,{title:e.jsx("span",{className:"text-blue-700",children:"Sales by Product Category"}),className:`bg-white/80 backdrop-blur-md border border-white/60 shadow-xl ${s}`,children:e.jsx("div",{className:"h-72 w-full",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(P,{data:t,margin:{top:20,right:20,left:0,bottom:5},children:[e.jsx(w,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(N,{dataKey:"name",tick:{fill:"#374151",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(S,{tick:{fill:"#374151",fontSize:12}}),e.jsx(D,{formatter:(e,t,s)=>[Number(e).toLocaleString(),s?.payload?.name],contentStyle:{background:"#fafafa",borderColor:"#8b5cf6",borderRadius:8}}),e.jsx(M,{}),e.jsx(T,{dataKey:"value",fill:F,radius:[8,8,0,0],isAnimationActive:!1})]})})})})}function $(){const[d,f]=t.useState({revenue:0,expenses:0,netProfit:0,grossMargin:0,totalTransactions:0,totalItemsSold:0,averageTransactionValue:0}),[v,j]=t.useState([]),[w,N]=t.useState({startDate:i().startOf("month"),endDate:i().endOf("day"),rangeType:"Month"}),[S,D]=t.useState(!1),[k,P]=t.useState([]),[M,T]=t.useState([]),[F,$]=t.useState([]),[_,z]=t.useState(!1),[E,I]=t.useState([]),[L,A]=t.useState(0),[O,B]=t.useState(!1),W=s.useRef(null);a();const[H,V]=t.useState(!1),[K,J]=t.useState({sales:0,transactions:0,topProduct:"-",totalItemsSold:0,averageTransactionValue:0}),[U,q]=t.useState(!1),[G,Q]=t.useState(!1),[X,Z]=t.useState(i()),ee=t.useRef(null),te=t.useRef(null),se=t.useRef(null),ae=t.useRef(null),re=t.useRef(null);t.useEffect(()=>{let e;const t=()=>{"visible"===document.visibilityState&&Z(i())};t(),e=setInterval(t,1e4);const s=()=>{"visible"===document.visibilityState&&t()};return document.addEventListener("visibilitychange",s),()=>{clearInterval(e),document.removeEventListener("visibilitychange",s)}},[]);const oe=(e="")=>{if(!e)return!1;const t=e.toLowerCase();return t.includes("oklab")||t.includes("oklch")||t.includes("color(")||t.includes("color-mix")||t.includes("lab(")||t.includes("lch(")||t.includes("hwb(")},ne=(()=>{const e=document.createElement("canvas").getContext("2d");return(t,s="#ffffff")=>{if(!t)return s;try{return e.fillStyle=t,e.fillStyle||s}catch(a){return s}}})();t.useEffect(()=>{(async()=>{try{const e=sessionStorage.getItem("auth_token"),t=i().format("YYYY-MM-DD"),s=await r("/api/dashboard/overview",{headers:o(e),params:{startDate:t,endDate:t}});s&&J({sales:s.totalSales||0,transactions:s.totalTransactions||0,totalItemsSold:s.totalItemsSold||0,averageTransactionValue:s.averageTransactionValue||0,topProduct:s.topProducts?.[0]?.product_name||"-"})}catch(e){console.error("Failed to fetch today's data",e)}})()},[]),t.useMemo(()=>{try{return JSON.parse(sessionStorage.getItem("user")||"{}")}catch(e){return{}}},[]),t.useEffect(()=>{const e=e=>{W.current&&!W.current.contains(e.target)&&B(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const ie=async()=>{try{D(!0);const e=sessionStorage.getItem("auth_token"),{startDate:t,endDate:s,rangeType:a}=w,n=e=>i(e).format("YYYY-MM-DD"),l=i.min(t,s),d=i.max(t,s),c=n(l),m=n(d);console.log("Fetching data for date range:",{rangeType:a,formattedStart:c,formattedEnd:m});const[u,h,p,x]=await Promise.all([r("/api/dashboard/overview",{headers:o(e),params:{startDate:c,endDate:m}}),r("/api/stats/customers-timeseries",{headers:o(e),params:{startDate:c,endDate:m}}),r("/api/stats/sales-by-category",{headers:o(e),params:{startDate:c,endDate:m}}),r("/api/products/low-stock",{headers:o(e)})]),g=(h||[]).map(e=>({...e,name:e.date||e.name,value:Number(e.customers||e.total||e.value||0)})),b=(p||[]).reduce((e,t)=>e+Number(t.value||0),0)||1,y=(p||[]).map(e=>({...e,percent:Number(e.value||0)/b*100}));if(u){const e=Number(u.totalSales||0),t=Number(u.totalExpenses||0),s=e-t,r=e>0?(e-t)/e*100:0,o=Number(u.totalTransactions||0),n=Number(u.totalItemsSold||0),i=Number(u.averageTransactionValue||e/(o||1)),c=u.topProducts?.[0]?.product_name||"-";f({revenue:e,expenses:t,netProfit:s,grossMargin:r,totalTransactions:o,totalItemsSold:n,averageTransactionValue:i});const m="Day"===a?l.format("MMM D, YYYY"):`${l.format("MMM D")} - ${d.format("MMM D, YYYY")}`,h="Day"===a?"Daily Transactions":"Week"===a?"7-Day Transactions":"Month"===a?"Monthly Transactions":"Total Transactions";j([{label:"Day"===a?"Daily Sales":"Week"===a?"7-Day Sales":"Month"===a?"Monthly Sales":"Total Sales",value:`₱${e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`,subtext:m},{label:h,value:o,subtext:`${m}`},{label:"Top Product",value:c,subtext:`Total: ${u.topProducts?.[0]?.total_sold||0} sold`},{label:"Items Sold",value:n,subtext:`${o} transactions`}])}P(g),T(y);$(x||[])}catch(e){console.error("Failed to fetch dashboard data",e)}finally{D(!1)}};t.useEffect(()=>{ie(),(async()=>{try{const e=sessionStorage.getItem("auth_token"),t=await r("/api/logs",{headers:o(e)}),s=new Set(JSON.parse(sessionStorage.getItem("read_notif_ids")||"[]")),a=new Set(JSON.parse(sessionStorage.getItem("deleted_notif_ids")||"[]")),n=(t||[]).filter(e=>!a.has(e.log_id)).map(e=>({id:e.log_id,title:e.action,message:`${e.username} (${e.role}) did an action: ${e.action}`,time:i(e.date_time).format("MMM D, h:mm A"),isRead:s.has(e.log_id)}));I(n),A(n.filter(e=>!e.isRead).length)}catch(e){console.error("Failed to fetch notifications",e)}})()},[w]);const le=e=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2,maximumFractionDigits:2}).format(e),de=t.useMemo(()=>{if(!w.startDate||!w.endDate)return"Select Range";const e=i.min(w.startDate,w.endDate),t=i.max(w.startDate,w.endDate);return`${e.format("MMM D")} - ${t.format("MMM D, YYYY")}`},[w]),ce=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:ie,disabled:S,title:"Refresh Data",className:"bg-white/80 backdrop-blur-sm hover:bg-white text-gray-700 p-1.5 sm:p-2 rounded-lg border border-gray-200/80 text-sm font-medium transition-all duration-200 hover:shadow-md hover:scale-[1.02] shrink-0",children:e.jsx(b,{className:"w-4 h-4 sm:w-5 sm:h-5 "+(S?"animate-spin":"")})}),e.jsxs("button",{onClick:()=>z(!0),disabled:S,title:"Select Date Range",className:"flex items-center gap-1 sm:gap-2 bg-white/80 backdrop-blur-sm hover:bg-white text-gray-700 px-1.5 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-gray-200/80 text-xs sm:text-sm font-medium transition-all duration-200 outline-none cursor-pointer hover:shadow-md hover:scale-[1.02] shrink-0",children:[e.jsx(y,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden sm:inline",children:de})]}),e.jsxs("div",{className:"py-2 flex justify-end gap-2",children:[e.jsx(n,{onClick:async()=>{Q(!0);try{const e=sessionStorage.getItem("auth_token"),{startDate:t,endDate:s,rangeType:a}=w,n=e=>i(e).format("YYYY-MM-DD"),l=i.min(t,s),d=i.max(t,s),c=n(l),u=n(d),h=await r("/api/dashboard/sales-data",{headers:o(e),params:{startDate:c,endDate:u}}),p=await r("/auth/profile",{headers:o(e)}),x=p?.business||{},g=x.business_name||"Store",f=[x.house_number,x.barangay,x.city,x.province].filter(Boolean).join(", ")||"N/A",b=x.mobile||x.email||"N/A",y="Day"===a?l.format("MMM D, YYYY"):`${l.format("MMM D")} - ${d.format("MMM D, YYYY")}`;if(!h||0===h.length)return void alert("No sales data found for the selected date range.");const v=h.reduce((e,t)=>e+(t.subtotal||0),0),j=new m("p","mm","a4"),N=j.internal.pageSize.getWidth(),S=20,D=N-2*S;let k=S;const P=e=>k+e>j.internal.pageSize.getHeight()-S&&(j.addPage(),k=S,!0);j.setFontSize(20),j.setFont("helvetica","bold");const M=j.getTextWidth(g);j.text(g,(N-M)/2,k),k+=10,j.setFontSize(12),j.setFont("helvetica","normal");const T=j.getTextWidth(f);j.text(f,(N-T)/2,k),k+=7;const F=j.getTextWidth(b);j.text(b,(N-F)/2,k),k+=15,j.setFontSize(16),j.setFont("helvetica","bold"),j.text("Sales Report",S,k),k+=8,j.setFontSize(12),j.setFont("helvetica","normal"),j.text(`Date: ${y}`,S,k),k+=10;const C=[.15*D,.25*D,.15*D,.1*D,.15*D,.2*D],Y=[S];for(let r=1;r<C.length;r++)Y.push(Y[r-1]+C[r-1]);j.setFontSize(10),j.setFont("helvetica","bold");const $=k;j.text("Product ID",Y[0],$),j.text("Product Name",Y[1],$),j.text("Sold Items",Y[2],$),j.text("Unit",Y[3],$),j.text("Price",Y[4],$),j.text("Subtotal",Y[5],$),k+=8,j.setLineWidth(.5),j.line(S,k-2,N-S,k-2),k+=3,j.setFont("helvetica","normal"),j.setFontSize(9),h.forEach(e=>{P(10);const t=String(e.product_id||""),s=e.product_name||"",a=Number(e.number_of_sold_items||0).toFixed(2),r=e.unit||"pc",o=`PHP ${Number(e.price||0).toFixed(2)}`,n=`PHP ${Number(e.subtotal||0).toFixed(2)}`,i=C[1]-2;let l=s;if(j.getTextWidth(l)>i){for(;j.getTextWidth(l+"...")>i&&l.length>0;)l=l.slice(0,-1);l+="..."}j.text(t,Y[0],k),j.text(l,Y[1],k),j.text(a,Y[2],k),j.text(r,Y[3],k),j.text(o,Y[4],k),j.text(n,Y[5],k),k+=7}),P(10),k+=3,j.setLineWidth(.5),j.line(S,k,N-S,k),k+=5,j.setFont("helvetica","bold"),j.setFontSize(10),j.text("Total:",Y[4],k),j.text(`PHP ${v.toFixed(2)}`,Y[5],k);const R=`Sales-Report-${w.rangeType}-${i().format("YYYY-MM-DD")}.pdf`;j.save(R)}catch(e){console.error("Error exporting sales PDF:",e),alert("Failed to generate sales report. Please try again or contact support.")}finally{Q(!1)}},disabled:G||S,size:"sm",variant:"primary",className:"flex items-center gap-2 w-full sm:w-auto shrink-0",children:G?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:"Exporting..."}),e.jsx("span",{className:"sm:hidden",children:"..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"hidden sm:inline",children:"Export Sales"}),e.jsx("span",{className:"sm:hidden",children:"Sales"})]})}),e.jsx(n,{onClick:async()=>{q(!0);try{const t=document.getElementById("pdf-wrapper");if(!t)throw new Error("Dashboard content not found");const s=t.cloneNode(!0);s.style.position="absolute",s.style.left="-9999px",document.body.appendChild(s);const a=document.createElement("div");a.style.padding="15px 20px",a.style.backgroundColor="#1a365d",a.style.color="white",a.style.borderBottom="2px solid #2c5282";const{startDate:r,endDate:o,rangeType:n}=w,l=e=>i(e).format("MMM D, YYYY"),u="Day"===n?l(r):`${l(r)} - ${l(o)}`,h={name:"eKahera Business",address:"Bicol University, West (Main Campus) Legazpi City, Albay, Philippines",contact:"ekahera.business@gmail.com | +63 970 846 8324"};a.innerHTML=`\n        <div style="max-width: 100%; color: white;">\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">\n            <h1 style="margin: 0; font-size: 24px; font-weight: 600; color: white;">${h.name}</h1>\n            <div style="text-align: right;">\n              <div style="font-size: 14px; color: #a0aec0;">Report Period</div>\n              <div style="font-weight: 600; font-size: 16px;">${u}</div>\n            </div>\n          </div>\n          <div style="display: flex; justify-content: space-between; font-size: 12px; color: #cbd5e0;">\n            <div>${h.address}</div>\n            <div>${h.contact}</div>\n          </div>\n        </div>\n      `;const p=document.createElement("div");p.style.padding="15px",p.style.backgroundColor="#f7fafc",p.style.borderBottom="1px solid #e2e8f0",p.style.marginBottom="20px",p.innerHTML=`\n        <h3 style="margin: 0 0 10px 0; color: #2d3748; font-size: 18px;">Key Metrics Summary</h3>\n        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">\n          <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">\n            <div style="font-size: 12px; color: #718096;">Total Revenue</div>\n            <div style="font-size: 20px; font-weight: 600; color: #2b6cb0;">${le(d.revenue)}</div>\n          </div>\n          <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">\n            <div style="font-size: 12px; color: #718096;">Total Transactions</div>\n            <div style="font-size: 20px; font-weight: 600; color: #2f855a;">${d.totalTransactions}</div>\n          </div>\n          <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">\n            <div style="font-size: 12px; color: #718096;">Items Sold</div>\n            <div style="font-size: 20px; font-weight: 600; color: #b7791f;">${d.totalItemsSold}</div>\n          </div>\n          <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">\n            <div style="font-size: 12px; color: #718096;">Net Profit</div>\n            <div style="font-size: 20px; font-weight: 600; color: #2c5282;">${le(d.netProfit)}</div>\n          </div>\n        </div>\n      `,s.insertBefore(p,s.firstChild),s.insertBefore(a,s.firstChild);const x=document.createElement("div");x.style.padding="10px",x.style.backgroundColor="#f7fafc",x.style.borderTop="1px solid #e2e8f0",x.style.textAlign="center",x.style.fontSize="10px",x.style.color="#718096",x.innerText=`Page 1 of 1 • Generated on ${(new Date).toLocaleString()}`,s.appendChild(x);s.querySelectorAll("*").forEach(e=>{const t=window.getComputedStyle(e);["background","background-color","color","border","border-color"].forEach(s=>{try{const a=t.getPropertyValue(s);a&&oe(a)&&e.style.setProperty(s,"transparent","important")}catch(a){console.warn(`Error processing ${s}:`,a)}})});const g=Array.from(document.querySelectorAll(".chart-export-container")),f=[],b=[],y=e=>{const t=["color","background-color","border-color","outline-color","text-decoration-color","column-rule-color","caret-color","accent-color","fill","stroke"],s=["background","background-image","border","border-top-color","border-right-color","border-bottom-color","border-left-color","box-shadow","text-shadow","outline-color"],a=[],r=e=>{if(!(e instanceof Element))return;const r=window.getComputedStyle(e);t.forEach(t=>{const s=r.getPropertyValue(t);if(oe(s)){const o=e.style.getPropertyValue(t);a.push(()=>e.style.setProperty(t,o||"",r.getPropertyPriority(t))),e.style.setProperty(t,ne(s,t.includes("background")?"#ffffff":"#1f2937"),"important")}}),[...s].forEach(t=>{const s=r.getPropertyValue(t);((e,t,s,r)=>{if(!s)return;const o=s.toLowerCase(),n=o.includes("gradient")||o.includes("image-set");if(oe(o)||n){const o=e.style.getPropertyValue(t);a.push(()=>e.style.setProperty(t,o||"",r)),t.includes("background")||t.includes("shadow")?e.style.setProperty(t,"none","important"):t.includes("border")?e.style.setProperty(t,ne(s,"#e5e7eb"),"important"):e.style.setProperty(t,ne(s,"#1f2937"),"important")}})(e,t,s,r.getPropertyPriority(t))})};return r(e),e.querySelectorAll("*").forEach(r),()=>a.reverse().forEach(e=>e())};for(const i of g){let t=null;try{t=y(i),b.push(t);const e=i.getBoundingClientRect(),s=await c(i,{scale:2,useCORS:!0,backgroundColor:"#ffffff"});f.push({dataUrl:s.toDataURL("image/png"),width:e.width,height:e.height})}catch(e){console.warn("Chart capture failed, falling back to default capture",e),f.push(null)}finally{t&&t()}}Array.from(s.querySelectorAll(".chart-export-container")).forEach((e,t)=>{const s=f[t];if(!s||!s.dataUrl)return;e.innerHTML="";const a=document.createElement("img");a.src=s.dataUrl,a.style.width=`${s.width}px`,a.style.height=`${s.height}px`,a.style.objectFit="contain",a.style.display="block",a.setAttribute("alt","Chart snapshot"),e.appendChild(a)}),await new Promise(e=>setTimeout(e,200));const v=await c(s,{scale:2,useCORS:!0,logging:!1,backgroundColor:"#ffffff",removeContainer:!0,onclone:e=>{document.fonts.ready.then(()=>{})}});document.body.removeChild(s);const j=v.toDataURL("image/png"),N=new m("p","mm","a4"),S=N.getImageProperties(j),D=N.internal.pageSize.getWidth()-20,k=S.height*D/S.width;N.addImage(j,"PNG",10,10,D,k);const P=`eKahera-Report-${w.rangeType}-${i().format("YYYY-MM-DD")}.pdf`;N.setProperties({title:`eKahera Business Report - ${w.rangeType} (${u})`,subject:`Business Performance Report - ${u}`,author:"eKahera Business Intelligence",creator:"eKahera System",keywords:"business,report,sales,metrics,performance"}),N.setFontSize(60),N.setTextColor(240,240,240),N.text("eKahera",35,150,{angle:45}),N.setTextColor(0,0,0),N.save(P)}catch(t){console.error("Error exporting PDF:",t),alert("Failed to generate PDF report. Please try again or contact support.")}finally{q(!1)}},disabled:U||S,size:"sm",variant:"primary",className:"flex items-center gap-2 w-full sm:w-auto shrink-0",children:U?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:"Exporting..."}),e.jsx("span",{className:"sm:hidden",children:"..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),e.jsx("span",{className:"hidden sm:inline",children:"Export PDF"}),e.jsx("span",{className:"sm:hidden",children:"PDF"})]})})]}),e.jsx("div",{className:"relative",ref:W,children:e.jsx(g,{notifications:E,unreadCount:L,onMarkAsRead:e=>{const t=JSON.parse(sessionStorage.getItem("read_notif_ids")||"[]");t.includes(e)||sessionStorage.setItem("read_notif_ids",JSON.stringify([...t,e])),I(t=>t.map(t=>t.id===e?{...t,isRead:!0}:t)),A(e=>Math.max(0,e-1))},onMarkAsUnread:e=>{const t=JSON.parse(sessionStorage.getItem("read_notif_ids")||"[]").filter(t=>t!==e);sessionStorage.setItem("read_notif_ids",JSON.stringify(t)),I(t=>t.map(t=>t.id===e?{...t,isRead:!1}:t)),A(e=>e+1)},onDelete:e=>{const t=JSON.parse(sessionStorage.getItem("deleted_notif_ids")||"[]");sessionStorage.setItem("deleted_notif_ids",JSON.stringify([...t,e])),I(t=>t.filter(t=>t.id!==e));const s=E.find(t=>t.id===e);s&&!s.isRead&&A(e=>Math.max(0,e-1))},isOpen:O,onToggle:()=>B(!O),containerRef:W})})]});return e.jsx(u,{title:"DASHBOARD",subtitle:"",sidebar:e.jsx(h,{}),headerActions:ce,isSidebarOpen:H,setSidebarOpen:V,className:"bg-gray-50 min-h-screen",children:e.jsxs("div",{id:"pdf-wrapper",ref:ee,children:[e.jsx("div",{className:"p-4 lg:hidden",children:S?e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md border border-gray-200 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/2 mb-6"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full mb-3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full mb-3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-4/5"})]}):e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Low Stock Products"})}),e.jsx(R,{lowStockProducts:F})]})}),e.jsxs("div",{ref:ae,className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 w-full px-4 sm:px-6 md:px-8 py-2",children:[e.jsxs("div",{className:"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase mb-1",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:le(d.revenue)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"For selected range"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase mb-1",children:"Operating Expenses"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:le(d.expenses)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"For selected range"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase mb-1",children:"Net Profit"}),e.jsxs("p",{className:"text-2xl font-bold "+(d.netProfit>=0?"text-green-600":"text-red-600"),children:[le(Math.abs(d.netProfit)),d.netProfit<0&&e.jsx("span",{className:"text-sm text-red-500 ml-1",children:"(Loss)"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"For selected range"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase mb-1",children:"Gross Margin"}),e.jsxs("p",{className:"text-2xl font-bold "+(d.grossMargin>=0?"text-green-600":"text-red-600"),children:[d.grossMargin.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"For selected range"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 p-4 sm:p-6 md:p-8 pt-0",children:[e.jsx("div",{className:"lg:col-span-8 flex flex-col gap-6",children:S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-md border border-gray-200 h-[336px] animate-pulse flex items-center justify-center",children:e.jsx("div",{className:"w-full h-64 bg-gray-200 rounded-lg"})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-md border border-gray-200 h-[336px] animate-pulse flex items-center justify-center",children:e.jsx("div",{className:"w-64 h-64 bg-gray-200 rounded-full"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:te,className:"chart-export-container","data-export-chart":"visitors",children:e.jsx(C,{data:k,rangeType:w.rangeType})}),e.jsx("div",{ref:se,className:"chart-export-container","data-export-chart":"sales-pie",children:e.jsx(Y,{data:M})})]})}),e.jsxs("div",{className:"lg:col-span-4 flex flex-col gap-6",children:[S?e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md border border-gray-200 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-8 bg-gray-300 rounded w-1/2 mb-6"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-8 bg-gray-300 rounded w-1/2 mb-6"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-8 bg-gray-300 rounded w-1/2"})]}):e.jsx(p,{stats:K,formatCurrency:le,rangeType:"Today",currentTime:X}),S?e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md border border-gray-200 animate-pulse hidden lg:block",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/2 mb-6"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full mb-3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full mb-3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-4/5"})]}):e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md hidden lg:block",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Low Stock Products"})}),e.jsx(R,{lowStockProducts:F})]})]})]}),e.jsx("div",{ref:re,className:"w-full px-4 sm:px-6 md:px-8 pb-8",children:e.jsx(x,{dateRange:w})}),e.jsx(l,{isOpen:_,onClose:()=>z(!1),onDateRangeApply:e=>{N(e)}})]})})}function R({lowStockProducts:t}){return 0===t.length?e.jsx("p",{className:"text-sm text-gray-500",children:"No products with low stock."}):e.jsxs("ul",{className:"divide-y divide-gray-200",children:[e.jsxs("li",{className:"py-2 text-sm font-semibold text-gray-600 flex justify-between",children:[e.jsx("span",{children:"Product"}),e.jsx("span",{children:"Quantity"})]}),t.map(t=>e.jsxs("li",{className:"py-3 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-800",children:t.product_name}),e.jsxs("span",{className:"text-sm font-bold text-red-600",children:[t.quantity_in_stock," left"]})]},t.product_id))]})}i().startOf("day"),i().endOf("day");export{$ as default};
//# sourceMappingURL=Dashboard-x1CeuTjI.js.map
