{"version":3,"file":"ScannerCard-QAWLjFZI.js","sources":["../../../frontend/src/components/ui/POS/ScannerCard.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport Button from \"../../common/Button\";\r\nimport { Scanner } from \"@yudiel/react-qr-scanner\";\r\nimport Quagga from \"@ericblade/quagga2\";\r\n\r\n/**\r\n * Scanner Card Component\r\n * QR and barcode scanner interface\r\n */\r\nfunction ScannerCard({\r\n  onScan,\r\n  paused,\r\n  onResume,\r\n  textMain = \"text-blue-800\",\r\n  className = \"\",\r\n  modalContext = false, // New prop to indicate if scanner is used in modal\r\n  ...props\r\n}) {\r\n  const [facingMode, setFacingMode] = useState(\"environment\"); // Start with rear camera (better for scanning)\r\n  const [hasPermission, setHasPermission] = useState(null);\r\n  const [error, setError] = useState(\"\");\r\n  const [isInitializing, setIsInitializing] = useState(!modalContext); // Don't auto-initialize in modal\r\n  const [torchEnabled, setTorchEnabled] = useState(false);\r\n  const [isMobile, setIsMobile] = useState(false);\r\n  const [videoDevices, setVideoDevices] = useState([]);\r\n  const [hasMultipleCameras, setHasMultipleCameras] = useState(false);\r\n  const audioContext = useRef(null);\r\n  const [retryCount, setRetryCount] = useState(0);\r\n  const [scanHistory, setScanHistory] = useState([]);\r\n  const [showManualInput, setShowManualInput] = useState(false);\r\n  const [manualInput, setManualInput] = useState(\"\");\r\n  const [useQuagga, setUseQuagga] = useState(false);\r\n  const [quaggaInitialized, setQuaggaInitialized] = useState(false);\r\n  const scannerRef = useRef(null);\r\n  const [modalInitialized, setModalInitialized] = useState(false);\r\n  const [usbInputBuffer, setUsbInputBuffer] = useState(\"\");\r\n  const [lastKeyTime, setLastKeyTime] = useState(0);\r\n\r\n  useEffect(() => {\r\n    // Check camera permissions and try to initialize camera\r\n    const checkPermissions = async () => {\r\n      try {\r\n        // Try to query permissions (may not work in all browsers)\r\n        try {\r\n          const result = await navigator.permissions.query({ name: \"camera\" });\r\n          setHasPermission(result.state === \"granted\");\r\n\r\n          if (result.state === \"denied\") {\r\n            setError(\r\n              \"Camera access denied. Please enable camera permissions in your browser settings.\"\r\n            );\r\n            setIsInitializing(false);\r\n            return;\r\n          }\r\n\r\n          result.addEventListener(\"change\", () => {\r\n            setHasPermission(result.state === \"granted\");\r\n            if (result.state === \"denied\") {\r\n              setError(\r\n                \"Camera access denied. Please enable camera permissions in your browser settings.\"\r\n              );\r\n            } else {\r\n              setError(\"\");\r\n            }\r\n          });\r\n        } catch (permErr) {\r\n          // Permissions API not supported, continue anyway\r\n          console.log(\r\n            \"Permissions API not supported, attempting camera access...\"\r\n          );\r\n        }\r\n\r\n        // Try to enumerate devices to detect available cameras\r\n        try {\r\n          const devices = await navigator.mediaDevices.enumerateDevices();\r\n          const videoDevices = devices.filter(\r\n            (device) => device.kind === \"videoinput\"\r\n          );\r\n          console.log(\"Available cameras:\", videoDevices.length);\r\n          setVideoDevices(videoDevices);\r\n          setHasMultipleCameras(videoDevices.length > 1);\r\n\r\n          if (videoDevices.length === 0) {\r\n            setError(\"No camera found. Please connect a camera.\");\r\n            setIsInitializing(false);\r\n            return;\r\n          }\r\n        } catch (enumErr) {\r\n          console.log(\"Could not enumerate devices, will try direct access...\");\r\n        }\r\n\r\n        // Give a small delay to allow browser to process\r\n        setTimeout(() => {\r\n          setIsInitializing(false);\r\n        }, 500);\r\n      } catch (err) {\r\n        console.error(\"Permission check error:\", err);\r\n        setIsInitializing(false);\r\n      }\r\n    };\r\n\r\n    // Only check permissions if not in modal context or if modal is already initialized\r\n    if (!modalContext || modalInitialized) {\r\n      checkPermissions();\r\n    }\r\n  }, [modalContext, modalInitialized]);\r\n\r\n  // Initialize scanner when modal context is activated\r\n  useEffect(() => {\r\n    if (modalContext && !modalInitialized) {\r\n      setModalInitialized(true);\r\n    }\r\n  }, [modalContext, modalInitialized]);\r\n\r\n  // Detect mobile device\r\n  useEffect(() => {\r\n    setIsMobile(\r\n      /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\r\n        navigator.userAgent\r\n      )\r\n    );\r\n  }, []);\r\n\r\n  // Initialize audio context for beep\r\n  useEffect(() => {\r\n    audioContext.current = new (window.AudioContext ||\r\n      window.webkitAudioContext)();\r\n  }, []);\r\n\r\n  // Play beep sound on successful scan\r\n  const playBeep = () => {\r\n    if (audioContext.current) {\r\n      const oscillator = audioContext.current.createOscillator();\r\n      const gainNode = audioContext.current.createGain();\r\n      oscillator.connect(gainNode);\r\n      gainNode.connect(audioContext.current.destination);\r\n      oscillator.frequency.setValueAtTime(\r\n        800,\r\n        audioContext.current.currentTime\r\n      );\r\n      gainNode.gain.setValueAtTime(0.3, audioContext.current.currentTime);\r\n      oscillator.start();\r\n      oscillator.stop(audioContext.current.currentTime + 0.1);\r\n    }\r\n  };\r\n\r\n  // Trigger vibration on mobile devices for successful scan\r\n  const vibrateOnScan = () => {\r\n    if (isMobile && \"vibrate\" in navigator) {\r\n      navigator.vibrate(100); // 100ms vibration\r\n    }\r\n  };\r\n\r\n  // USB Barcode Scanner Keyboard Input Handler\r\n  useEffect(() => {\r\n    const handleKeyDown = (event) => {\r\n      // Only process if not in an input field, not a function key, and scanner is not paused\r\n      if (\r\n        event.target.tagName === \"INPUT\" ||\r\n        event.target.tagName === \"TEXTAREA\" ||\r\n        paused ||\r\n        event.key.startsWith('F') && event.key.length > 1 && !isNaN(event.key.slice(1))\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      const currentTime = Date.now();\r\n      const timeDiff = currentTime - lastKeyTime;\r\n\r\n      // If more than 100ms since last key, start new scan\r\n      if (timeDiff > 100) {\r\n        setUsbInputBuffer(event.key);\r\n      } else {\r\n        // Accumulate input\r\n        setUsbInputBuffer((prev) => prev + event.key);\r\n      }\r\n      setLastKeyTime(currentTime);\r\n\r\n      // If Enter key pressed, process the barcode\r\n      if (event.key === \"Enter\") {\r\n        event.preventDefault();\r\n        const barcode = usbInputBuffer.trim();\r\n        if (barcode) {\r\n          console.log(\"USB Scanner detected:\", barcode);\r\n          playBeep();\r\n          vibrateOnScan();\r\n          setScanHistory((prev) => {\r\n            const newHistory = [\r\n              barcode,\r\n              ...prev.filter((item) => item !== barcode),\r\n            ].slice(0, 5);\r\n            return newHistory;\r\n          });\r\n          onScan([{ rawValue: barcode }]);\r\n        }\r\n        setUsbInputBuffer(\"\");\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"keydown\", handleKeyDown);\r\n    return () => document.removeEventListener(\"keydown\", handleKeyDown);\r\n  }, [paused, lastKeyTime, usbInputBuffer, onScan, playBeep, vibrateOnScan]);\r\n\r\n  // Initialize Quagga scanner\r\n  const initQuagga = async () => {\r\n    if (quaggaInitialized) return;\r\n\r\n    try {\r\n      await Quagga.init({\r\n        inputStream: {\r\n          name: \"Live\",\r\n          type: \"LiveStream\",\r\n          target: scannerRef.current,\r\n          constraints: {\r\n            facingMode: facingMode === \"environment\" ? \"environment\" : \"user\",\r\n            width: { min: 640, ideal: 1920 },\r\n            height: { min: 480, ideal: 1080 },\r\n          },\r\n        },\r\n        locator: {\r\n          patchSize: \"medium\",\r\n          halfSample: true,\r\n        },\r\n        numOfWorkers: 2,\r\n        decoder: {\r\n          readers: [\r\n            \"code_128_reader\",\r\n            \"ean_reader\",\r\n            \"ean_8_reader\",\r\n            \"code_39_reader\",\r\n            \"code_39_vin_reader\",\r\n            \"codabar_reader\",\r\n            \"upc_reader\",\r\n            \"upc_e_reader\",\r\n            \"i2of5_reader\",\r\n            \"2of5_reader\",\r\n            \"code_93_reader\",\r\n          ],\r\n        },\r\n        locate: true,\r\n      });\r\n\r\n      Quagga.onDetected((result) => {\r\n        if (result && result.codeResult) {\r\n          const code = result.codeResult.code;\r\n          console.log(\"Quagga detected:\", code);\r\n          playBeep();\r\n          vibrateOnScan();\r\n          setScanHistory((prev) => {\r\n            const newHistory = [\r\n              code,\r\n              ...prev.filter((item) => item !== code),\r\n            ].slice(0, 5);\r\n            return newHistory;\r\n          });\r\n          onScan([{ rawValue: code }]);\r\n        }\r\n      });\r\n\r\n      Quagga.onProcessed((result) => {\r\n        // Optional: Draw boxes around detected barcodes\r\n        const drawingCtx = Quagga.canvas.ctx.overlay;\r\n        const drawingCanvas = Quagga.canvas.dom.overlay;\r\n\r\n        if (result) {\r\n          if (result.boxes) {\r\n            drawingCtx.clearRect(\r\n              0,\r\n              0,\r\n              parseInt(drawingCanvas.getAttribute(\"width\")),\r\n              parseInt(drawingCanvas.getAttribute(\"height\"))\r\n            );\r\n            result.boxes\r\n              .filter((box) => box !== result.box)\r\n              .forEach((box) => {\r\n                Quagga.ImageDebug.drawPath(box, { x: 0, y: 1 }, drawingCtx, {\r\n                  color: \"green\",\r\n                  lineWidth: 2,\r\n                });\r\n              });\r\n          }\r\n\r\n          if (result.box) {\r\n            Quagga.ImageDebug.drawPath(result.box, { x: 0, y: 1 }, drawingCtx, {\r\n              color: \"#00F\",\r\n              lineWidth: 2,\r\n            });\r\n          }\r\n\r\n          if (result.codeResult && result.codeResult.code) {\r\n            Quagga.ImageDebug.drawPath(\r\n              result.line,\r\n              { x: \"x\", y: \"y\" },\r\n              drawingCtx,\r\n              { color: \"red\", lineWidth: 3 }\r\n            );\r\n          }\r\n        }\r\n      });\r\n\r\n      await Quagga.start();\r\n      setQuaggaInitialized(true);\r\n      console.log(\"Quagga scanner initialized\");\r\n    } catch (err) {\r\n      console.error(\"Quagga initialization failed:\", err);\r\n      setError(\r\n        \"Advanced scanner initialization failed. Using fallback scanner.\"\r\n      );\r\n    }\r\n  };\r\n\r\n  // Cleanup Quagga on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (quaggaInitialized) {\r\n        Quagga.offDetected();\r\n        Quagga.offProcessed();\r\n        Quagga.stop();\r\n      }\r\n    };\r\n  }, [quaggaInitialized]);\r\n\r\n  // Toggle between scanners\r\n  const toggleScanner = () => {\r\n    if (useQuagga && quaggaInitialized) {\r\n      Quagga.stop();\r\n      setQuaggaInitialized(false);\r\n    }\r\n    setUseQuagga(!useQuagga);\r\n    setIsInitializing(true);\r\n    setTimeout(() => setIsInitializing(false), 1000);\r\n  };\r\n\r\n  const handleError = (err) => {\r\n    console.error(\"Scanner error:\", err);\r\n    let errorMessage = \"Scanner error occurred\";\r\n    let shouldRetry = false;\r\n\r\n    if (err.name === \"NotAllowedError\") {\r\n      errorMessage =\r\n        \"Camera access denied. Please allow camera access and refresh the page.\";\r\n      setHasPermission(false);\r\n    } else if (err.name === \"NotFoundError\") {\r\n      errorMessage =\r\n        \"No camera found. Please connect a camera and refresh the page.\";\r\n    } else if (err.name === \"NotReadableError\") {\r\n      errorMessage = \"Camera is being used by another application.\";\r\n    } else if (err.name === \"OverconstrainedError\") {\r\n      // Try switching facing mode if we haven't tried both\r\n      if (retryCount < 2) {\r\n        setRetryCount((prev) => prev + 1);\r\n        const newFacingMode = facingMode === \"user\" ? \"environment\" : \"user\";\r\n        setFacingMode(newFacingMode);\r\n        setError(\"\");\r\n        setIsInitializing(true);\r\n        setTimeout(() => setIsInitializing(false), 1000);\r\n        return;\r\n      } else {\r\n        // Try without facing mode constraint\r\n        errorMessage =\r\n          \"Camera constraints not supported. Trying without constraints...\";\r\n        setFacingMode(null);\r\n        shouldRetry = true;\r\n      }\r\n    } else if (err.name === \"SecurityError\") {\r\n      errorMessage = \"Camera access blocked. Please use HTTPS or localhost.\";\r\n    } else {\r\n      // Unknown error - try retry\r\n      if (retryCount < 2) {\r\n        setRetryCount((prev) => prev + 1);\r\n        shouldRetry = true;\r\n      }\r\n    }\r\n\r\n    if (shouldRetry && retryCount < 2) {\r\n      setIsInitializing(true);\r\n      setTimeout(() => {\r\n        setIsInitializing(false);\r\n        setError(\"\");\r\n      }, 1000);\r\n      return;\r\n    }\r\n\r\n    setError(errorMessage);\r\n    // Auto-retry after 3 seconds\r\n    setTimeout(() => {\r\n      setError(\"\");\r\n      setIsInitializing(true);\r\n      setTimeout(() => setIsInitializing(false), 1000);\r\n    }, 3000);\r\n  };\r\n  return (\r\n    <div\r\n      className={`flex-shrink-0 bg-white/80 backdrop-blur-md border border-white/60 shadow-xl hover:shadow-2xl transition-all duration-300 overflow-hidden ${className}`}\r\n    >\r\n      <div className=\"flex flex-col h-full p-1 sm:p-2\">\r\n        <div\r\n          className={`w-full text-center mb-1 font-bold text-xs tracking-wide ${textMain} flex items-center justify-center gap-1`}\r\n        >\r\n          <svg\r\n            className=\"w-3 h-3\"\r\n            fill=\"none\"\r\n            stroke=\"currentColor\"\r\n            viewBox=\"0 0 24 24\"\r\n          >\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              d=\"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z\"\r\n            />\r\n          </svg>\r\n          SCAN QR & BARCODE\r\n        </div>\r\n        <div className=\"w-full flex-1 bg-gradient-to-br from-blue-50/80 via-indigo-50/60 to-blue-100/80 rounded-xl flex items-center justify-center border-2 border-blue-200/50 shadow-inner overflow-hidden relative z-0 group\">\r\n          {isInitializing ? (\r\n            <div className=\"flex items-center justify-center h-full text-gray-500\">\r\n              <div className=\"text-center\">\r\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2\"></div>\r\n                <p className=\"text-sm\">Initializing camera...</p>\r\n              </div>\r\n            </div>\r\n          ) : error ? (\r\n            <div className=\"flex items-center justify-center h-full text-red-500 p-4\">\r\n              <div className=\"text-center\">\r\n                <p className=\"text-sm font-medium mb-2\">Camera Error</p>\r\n                <p className=\"text-xs\">{error}</p>\r\n                <Button\r\n                  label=\"Retry\"\r\n                  size=\"sm\"\r\n                  variant=\"secondary\"\r\n                  className=\"mt-2\"\r\n                  onClick={() => {\r\n                    setError(\"\");\r\n                    setRetryCount(0);\r\n                    setIsInitializing(true);\r\n                    // Try switching camera mode\r\n                    setFacingMode((prev) =>\r\n                      prev === \"user\" ? \"environment\" : \"user\"\r\n                    );\r\n                    setTimeout(() => setIsInitializing(false), 1000);\r\n                  }}\r\n                  microinteraction\r\n                />\r\n              </div>\r\n            </div>\r\n          ) : useQuagga ? (\r\n            <div className=\"w-full h-full relative\">\r\n              <div\r\n                ref={scannerRef}\r\n                className=\"w-full h-full rounded-xl overflow-hidden\"\r\n              ></div>\r\n              {!quaggaInitialized && (\r\n                <div className=\"absolute inset-0 flex items-center justify-center bg-black/20\">\r\n                  <Button\r\n                    label=\"Start Advanced Scanner\"\r\n                    size=\"sm\"\r\n                    variant=\"primary\"\r\n                    onClick={initQuagga}\r\n                    microinteraction\r\n                  />\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <Scanner\r\n              onScan={(result) => {\r\n                console.log(\"Scanner result:\", result);\r\n                if (result && result.length > 0) {\r\n                  const code = result[0]?.rawValue;\r\n                  console.log(\"Detected code:\", code);\r\n                  if (code) {\r\n                    playBeep(); // Audio feedback\r\n                    vibrateOnScan(); // Haptic feedback on mobile\r\n                    // Add to scan history for quick re-selection\r\n                    setScanHistory((prev) => {\r\n                      const newHistory = [\r\n                        code,\r\n                        ...prev.filter((item) => item !== code),\r\n                      ].slice(0, 5);\r\n                      return newHistory;\r\n                    });\r\n                    onScan(result);\r\n                  }\r\n                }\r\n              }}\r\n              onError={handleError}\r\n              paused={paused}\r\n              // More flexible constraints - try without facingMode if it fails\r\n              constraints={\r\n                facingMode !== null\r\n                  ? {\r\n                      facingMode,\r\n                      width: { ideal: 1920, min: 640 },\r\n                      height: { ideal: 1080, min: 480 },\r\n                      frameRate: { ideal: 30, min: 15 },\r\n                    }\r\n                  : {\r\n                      width: { ideal: 1920, min: 640 },\r\n                      height: { ideal: 1080, min: 480 },\r\n                      frameRate: { ideal: 30, min: 15 },\r\n                    }\r\n              }\r\n              // Minimal delay for fastest scanning, especially for moving objects\r\n              scanDelay={50}\r\n              // Maximize scan area for better detection in various conditions\r\n              area={{ top: \"5%\", right: \"5%\", bottom: \"5%\", left: \"5%\" }}\r\n              styles={{\r\n                container: {\r\n                  width: \"100%\",\r\n                  height: \"100%\",\r\n                  borderRadius: \"1rem\",\r\n                  overflow: \"visible\",\r\n                },\r\n                video: {\r\n                  width: \"100%\",\r\n                  height: \"100%\",\r\n                  objectFit: \"contain\",\r\n                  borderRadius: \"1rem\",\r\n                  backgroundColor: \"black\",\r\n                },\r\n              }}\r\n              classNames={{ container: \"w-full h-full\" }}\r\n              formats={[\r\n                \"qr_code\",\r\n                \"code_128\",\r\n                \"code_39\",\r\n                \"ean_13\",\r\n                \"ean_8\",\r\n                \"upc_a\",\r\n                \"upc_e\",\r\n                \"itf\",\r\n                \"codabar\",\r\n                \"data_matrix\",\r\n                \"pdf417\",\r\n              ]}\r\n              // Improve robustness on dark-on-light vs light-on-dark\r\n              inversionAttempts=\"attemptBoth\"\r\n              // Enable multiple attempts for better detection in poor lighting\r\n              multiple=\"true\"\r\n            />\r\n          )}\r\n          {!error && !isInitializing && paused && (\r\n            <div className=\"absolute bottom-2 right-2 z-10 flex gap-2\">\r\n              <Button\r\n                label=\"Resume\"\r\n                size=\"sm\"\r\n                variant=\"secondary\"\r\n                onClick={onResume}\r\n                microinteraction\r\n              />\r\n              {isMobile && hasMultipleCameras && (\r\n                <Button\r\n                  label={facingMode === \"user\" ? \"ðŸ“·\" : \"ðŸ“±\"}\r\n                  size=\"sm\"\r\n                  variant=\"secondary\"\r\n                  onClick={() => {\r\n                    setFacingMode((prev) =>\r\n                      prev === \"user\" ? \"environment\" : \"user\"\r\n                    );\r\n                    setIsInitializing(true);\r\n                    setTimeout(() => setIsInitializing(false), 1000);\r\n                  }}\r\n                  microinteraction\r\n                  title={\r\n                    facingMode === \"user\"\r\n                      ? \"Switch to back camera\"\r\n                      : \"Switch to front camera\"\r\n                  }\r\n                />\r\n              )}\r\n              {isMobile && (\r\n                <Button\r\n                  label={torchEnabled ? \"ðŸ”¦\" : \"ðŸ’¡\"}\r\n                  size=\"sm\"\r\n                  variant=\"secondary\"\r\n                  onClick={() => setTorchEnabled(!torchEnabled)}\r\n                  microinteraction\r\n                  title={\r\n                    torchEnabled ? \"Turn off flashlight\" : \"Turn on flashlight\"\r\n                  }\r\n                />\r\n              )}\r\n              <Button\r\n                label=\"âŒ¨ï¸\"\r\n                size=\"sm\"\r\n                variant=\"secondary\"\r\n                onClick={() => setShowManualInput(!showManualInput)}\r\n                microinteraction\r\n                title=\"Manual input\"\r\n              />\r\n              <Button\r\n                label={useQuagga ? \"ðŸ”„\" : \"âš¡\"}\r\n                size=\"sm\"\r\n                variant=\"secondary\"\r\n                onClick={toggleScanner}\r\n                microinteraction\r\n                title={\r\n                  useQuagga\r\n                    ? \"Switch to standard scanner\"\r\n                    : \"Switch to advanced scanner\"\r\n                }\r\n              />\r\n            </div>\r\n          )}\r\n\r\n          {/* Manual Input Modal */}\r\n          {showManualInput && (\r\n            <div className=\"absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-20\">\r\n              <div className=\"bg-white rounded-xl p-4 w-80 max-w-[90vw]\">\r\n                <h3 className=\"text-lg font-semibold mb-3 text-center\">\r\n                  Manual SKU Input\r\n                </h3>\r\n                <input\r\n                  type=\"text\"\r\n                  value={manualInput}\r\n                  onChange={(e) => setManualInput(e.target.value)}\r\n                  placeholder=\"Enter SKU or barcode\"\r\n                  className=\"w-full p-3 border border-gray-300 rounded-lg mb-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  onKeyPress={(e) => {\r\n                    if (e.key === \"Enter\" && manualInput.trim()) {\r\n                      onScan([{ rawValue: manualInput.trim() }]);\r\n                      setManualInput(\"\");\r\n                      setShowManualInput(false);\r\n                      playBeep();\r\n                      vibrateOnScan();\r\n                    }\r\n                  }}\r\n                />\r\n                <div className=\"flex gap-2\">\r\n                  <Button\r\n                    label=\"Cancel\"\r\n                    size=\"sm\"\r\n                    variant=\"secondary\"\r\n                    onClick={() => {\r\n                      setShowManualInput(false);\r\n                      setManualInput(\"\");\r\n                    }}\r\n                    className=\"flex-1\"\r\n                  />\r\n                  <Button\r\n                    label=\"Submit\"\r\n                    size=\"sm\"\r\n                    variant=\"primary\"\r\n                    onClick={() => {\r\n                      if (manualInput.trim()) {\r\n                        onScan([{ rawValue: manualInput.trim() }]);\r\n                        setManualInput(\"\");\r\n                        setShowManualInput(false);\r\n                        playBeep();\r\n                        vibrateOnScan();\r\n                      }\r\n                    }}\r\n                    className=\"flex-1\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Scan History */}\r\n          {scanHistory.length > 0 && !error && !isInitializing && paused && (\r\n            <div className=\"absolute top-2 left-2 z-10\">\r\n              <div className=\"bg-white/90 backdrop-blur-sm rounded-lg p-2 max-w-32\">\r\n                <p className=\"text-xs font-medium text-gray-700 mb-1\">\r\n                  Recent:\r\n                </p>\r\n                <div className=\"space-y-1\">\r\n                  {scanHistory.slice(0, 3).map((code, index) => (\r\n                    <button\r\n                      key={index}\r\n                      onClick={() => {\r\n                        onScan([{ rawValue: code }]);\r\n                        playBeep();\r\n                        vibrateOnScan();\r\n                      }}\r\n                      className=\"block w-full text-left text-xs text-blue-600 hover:text-blue-800 truncate\"\r\n                      title={`Scan ${code}`}\r\n                    >\r\n                      {code.length > 10 ? `${code.substring(0, 10)}...` : code}\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ScannerCard;\r\n"],"names":["ScannerCard","onScan","paused","onResume","textMain","className","modalContext","props","facingMode","setFacingMode","useState","hasPermission","setHasPermission","error","setError","isInitializing","setIsInitializing","torchEnabled","setTorchEnabled","isMobile","setIsMobile","videoDevices","setVideoDevices","hasMultipleCameras","setHasMultipleCameras","audioContext","useRef","retryCount","setRetryCount","scanHistory","setScanHistory","showManualInput","setShowManualInput","manualInput","setManualInput","useQuagga","setUseQuagga","quaggaInitialized","setQuaggaInitialized","scannerRef","modalInitialized","setModalInitialized","usbInputBuffer","setUsbInputBuffer","lastKeyTime","setLastKeyTime","useEffect","async","result","navigator","permissions","query","name","state","addEventListener","permErr","console","log","mediaDevices","enumerateDevices","filter","device","kind","length","enumErr","setTimeout","err","checkPermissions","test","userAgent","current","window","AudioContext","webkitAudioContext","playBeep","oscillator","createOscillator","gainNode","createGain","connect","destination","frequency","setValueAtTime","currentTime","gain","start","stop","vibrateOnScan","vibrate","handleKeyDown","event","target","tagName","key","startsWith","isNaN","slice","Date","now","prev","preventDefault","barcode","trim","item","rawValue","document","removeEventListener","Quagga","offDetected","offProcessed","jsx","children","jsxs","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","Button","label","size","variant","onClick","microinteraction","ref","init","inputStream","type","constraints","width","min","ideal","height","locator","patchSize","halfSample","numOfWorkers","decoder","readers","locate","onDetected","codeResult","code","onProcessed","drawingCtx","canvas","ctx","overlay","drawingCanvas","dom","boxes","clearRect","parseInt","getAttribute","box","forEach","ImageDebug","drawPath","x","y","color","lineWidth","line","Scanner","onError","errorMessage","shouldRetry","frameRate","scanDelay","area","top","right","bottom","left","styles","container","borderRadius","overflow","video","objectFit","backgroundColor","classNames","formats","inversionAttempts","multiple","title","toggleScanner","value","onChange","e","placeholder","onKeyPress","map","index","substring"],"mappings":"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"}