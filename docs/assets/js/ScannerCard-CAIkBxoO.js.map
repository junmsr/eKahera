{"version":3,"file":"ScannerCard-CAIkBxoO.js","sources":["../../../frontend/src/components/ui/POS/ScannerCard.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from \"react\";\nimport Button from \"../../common/Button\";\nimport { Scanner } from \"@yudiel/react-qr-scanner\";\n\n/**\n * Scanner Card Component\n * Camera controls for flash and flip\n * Enhanced with debouncing and better barcode scanning support\n */\nfunction ScannerCard({\n  paused,\n  onResume,\n  textMain = \"text-blue-800\",\n  className = \"\",\n  modalContext = false,\n  ...props\n}) {\n  const [facingMode, setFacingMode] = useState(\"environment\");\n  const [error, setError] = useState(\"\");\n  const [isInitializing, setIsInitializing] = useState(!modalContext);\n  const [torchEnabled, setTorchEnabled] = useState(false);\n  const [isMobile, setIsMobile] = useState(false);\n  const [hasMultipleCameras, setHasMultipleCameras] = useState(false);\n  const [modalInitialized, setModalInitialized] = useState(false);\n  const [scanSuccess, setScanSuccess] = useState(false);\n  \n  // Debouncing refs\n  const lastScanRef = useRef(null);\n  const lastScanTimeRef = useRef(0);\n  const scanTimeoutRef = useRef(null);\n  const processingRef = useRef(false);\n\n  // Detect mobile device\n  useEffect(() => {\n    setIsMobile(\n      /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\n        navigator.userAgent\n      )\n    );\n  }, []);\n\n  // Check for multiple cameras\n  useEffect(() => {\n    const checkCameras = async () => {\n      try {\n        const devices = await navigator.mediaDevices.enumerateDevices();\n        const videoDevices = devices.filter(\n          (device) => device.kind === \"videoinput\"\n        );\n        setHasMultipleCameras(videoDevices.length > 1);\n        setIsInitializing(false);\n      } catch (err) {\n        console.error(\"Error checking cameras:\", err);\n        setIsInitializing(false);\n      }\n    };\n    checkCameras();\n  }, []);\n\n  // Clear scan success indicator after 1 second\n  useEffect(() => {\n    if (scanSuccess) {\n      const timer = setTimeout(() => setScanSuccess(false), 1000);\n      return () => clearTimeout(timer);\n    }\n  }, [scanSuccess]);\n\n  // Cleanup timeouts on unmount\n  useEffect(() => {\n    return () => {\n      if (scanTimeoutRef.current) {\n        clearTimeout(scanTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  const handleError = (err) => {\n    console.error(\"Camera error:\", err);\n    setError(\"Camera access failed. Please check permissions.\");\n  };\n\n  // Enhanced scan handler with debouncing\n  const handleScan = useCallback((result) => {\n    if (!result || !result[0] || !result[0].rawValue) return;\n    \n    const code = result[0].rawValue;\n    const now = Date.now();\n    \n    // Debounce: ignore duplicate scans within 500ms\n    if (code === lastScanRef.current && now - lastScanTimeRef.current < 500) {\n      return;\n    }\n    \n    // If already processing, ignore new scans\n    if (processingRef.current) {\n      return;\n    }\n    \n    // Clear any pending timeout\n    if (scanTimeoutRef.current) {\n      clearTimeout(scanTimeoutRef.current);\n    }\n    \n    // Set processing flag\n    processingRef.current = true;\n    lastScanRef.current = code;\n    lastScanTimeRef.current = now;\n    \n    // Show success feedback\n    setScanSuccess(true);\n    \n    // Call the original onScan handler\n    if (props.onScan) {\n      // Use a small delay to ensure UI feedback is visible\n      scanTimeoutRef.current = setTimeout(async () => {\n        try {\n          await props.onScan(result);\n        } catch (err) {\n          console.error(\"Scan handler error:\", err);\n        } finally {\n          // Reset processing flag after a delay to allow for async operations\n          setTimeout(() => {\n            processingRef.current = false;\n          }, 300);\n        }\n      }, 100);\n    } else {\n      processingRef.current = false;\n    }\n  }, [props.onScan]);\n\n  return (\n    <div\n      className={`flex-shrink-0 bg-white/80 backdrop-blur-md border border-white/60 shadow-xl hover:shadow-2xl transition-all duration-300 overflow-hidden ${className}`}\n    >\n      <div className=\"flex flex-col h-full p-1 sm:p-2\">\n        <div\n          className={`w-full text-center mb-1 font-bold text-xs tracking-wide ${textMain} flex items-center justify-center gap-1`}\n        >\n          <svg\n            className=\"w-3 h-3\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z\"\n            />\n          </svg>\n          CAMERA CONTROLS\n        </div>\n        <div className=\"w-full flex-1 bg-gradient-to-br from-blue-50/80 via-indigo-50/60 to-blue-100/80 rounded-xl flex items-center justify-center border-2 border-blue-200/50 shadow-inner overflow-hidden relative z-0 group\">\n          {isInitializing ? (\n            <div className=\"flex items-center justify-center h-full text-gray-500\">\n              <div className=\"text-center\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2\"></div>\n                <p className=\"text-sm\">Initializing camera...</p>\n              </div>\n            </div>\n          ) : error ? (\n            <div className=\"flex items-center justify-center h-full text-red-500 p-4\">\n              <div className=\"text-center\">\n                <p className=\"text-sm font-medium mb-2\">Camera Error</p>\n                <p className=\"text-xs\">{error}</p>\n              </div>\n            </div>\n          ) : (\n            <>\n              <Scanner\n                onScan={handleScan}\n                onError={handleError}\n                paused={paused || processingRef.current}\n                constraints={{\n                  facingMode,\n                  // Optimized constraints for better barcode scanning\n                  // Higher resolution for better barcode detection\n                  width: { ideal: 1920, min: 640 },\n                  height: { ideal: 1080, min: 480 },\n                  frameRate: { ideal: 30, min: 15 },\n                }}\n                torch={torchEnabled}\n                // Enable barcode detection formats - support common product barcodes\n                formats={[\n                  \"qr_code\", \n                  \"ean_13\", \n                  \"ean_8\", \n                  \"code_128\", \n                  \"code_39\", \n                  \"upc_a\", \n                  \"upc_e\", \n                  \"codabar\", \n                  \"itf\",\n                  \"code_93\",\n                  \"databar\",\n                  \"databar_expanded\"\n                ]}\n                // Lower scan delay for faster detection (100ms = 10 scans per second)\n                scanDelay={100}\n                // Allow multiple scans of the same code\n                allowMultiple={false}\n                styles={{\n                  container: {\n                    width: \"100%\",\n                    height: \"100%\",\n                    borderRadius: \"1rem\",\n                    overflow: \"visible\",\n                  },\n                  video: {\n                    width: \"100%\",\n                    height: \"100%\",\n                    objectFit: \"cover\",\n                    borderRadius: \"1rem\",\n                    backgroundColor: \"black\",\n                  },\n                }}\n                classNames={{ container: \"w-full h-full\" }}\n              />\n              {/* Scan success indicator */}\n              {scanSuccess && (\n                <div className=\"absolute inset-0 flex items-center justify-center bg-green-500/20 backdrop-blur-sm rounded-xl z-20 pointer-events-none\">\n                  <div className=\"bg-green-500 text-white rounded-full p-4 shadow-2xl animate-pulse\">\n                    <svg\n                      className=\"w-8 h-8\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={3}\n                        d=\"M5 13l4 4L19 7\"\n                      />\n                    </svg>\n                  </div>\n                </div>\n              )}\n            </>\n          )}\n          {!error && !isInitializing && (\n            <div className=\"absolute bottom-2 right-2 z-10 flex gap-2\">\n              {isMobile && hasMultipleCameras && (\n                <Button\n                  label={\n                    <svg\n                      className=\"w-4 h-4\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"\n                      />\n                    </svg>\n                  }\n                  size=\"sm\"\n                  variant=\"secondary\"\n                  onClick={() => {\n                    setFacingMode((prev) =>\n                      prev === \"user\" ? \"environment\" : \"user\"\n                    );\n                  }}\n                  microinteraction\n                  title={\n                    facingMode === \"user\"\n                      ? \"Switch to back camera\"\n                      : \"Switch to front camera\"\n                  }\n                />\n              )}\n              {isMobile && (\n                <Button\n                  label={\n                    <svg\n                      className=\"w-4 h-4\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M13 10V3L4 14h7v7l9-11h-7z\"\n                      />\n                    </svg>\n                  }\n                  size=\"sm\"\n                  variant=\"secondary\"\n                  onClick={() => setTorchEnabled(!torchEnabled)}\n                  microinteraction\n                  title={\n                    torchEnabled ? \"Turn off flashlight\" : \"Turn on flashlight\"\n                  }\n                />\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default ScannerCard;\n"],"names":["ScannerCard","paused","onResume","textMain","className","modalContext","props","facingMode","setFacingMode","useState","error","setError","isInitializing","setIsInitializing","torchEnabled","setTorchEnabled","isMobile","setIsMobile","hasMultipleCameras","setHasMultipleCameras","modalInitialized","setModalInitialized","scanSuccess","setScanSuccess","lastScanRef","useRef","lastScanTimeRef","scanTimeoutRef","processingRef","useEffect","test","navigator","userAgent","async","videoDevices","mediaDevices","enumerateDevices","filter","device","kind","length","err","checkCameras","timer","setTimeout","clearTimeout","current","handleScan","useCallback","result","rawValue","code","now","Date","onScan","jsx","children","jsxs","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","Fragment","Scanner","onError","constraints","width","ideal","min","height","frameRate","torch","formats","scanDelay","allowMultiple","styles","container","borderRadius","overflow","video","objectFit","backgroundColor","classNames","Button","label","size","variant","onClick","prev","microinteraction","title"],"mappings":"8JASA,SAASA,GAAYC,OACnBA,EAAAA,SACAC,EAAAA,SACAC,EAAW,gBAAAC,UACXA,EAAY,GAAAC,aACZA,GAAe,KACZC,IAEH,MAAOC,EAAYC,GAAiBC,EAAAA,SAAS,gBACtCC,EAAOC,GAAYF,EAAAA,SAAS,KAC5BG,EAAgBC,GAAqBJ,EAAAA,UAAUJ,IAC/CS,EAAcC,GAAmBN,EAAAA,UAAS,IAC1CO,EAAUC,GAAeR,EAAAA,UAAS,IAClCS,EAAoBC,GAAyBV,EAAAA,UAAS,IACtDW,EAAkBC,GAAuBZ,EAAAA,UAAS,IAClDa,EAAaC,GAAkBd,EAAAA,UAAS,GAGzCe,EAAcC,SAAO,MACrBC,EAAkBD,SAAO,GACzBE,EAAiBF,SAAO,MACxBG,EAAgBH,UAAO,GAG7BI,EAAAA,UAAU,KACRZ,EACE,iEAAiEa,KAC/DC,UAAUC,aAGb,IAGHH,EAAAA,UAAU,KACaI,WACf,IACF,MACMC,SADgBH,UAAUI,aAAaC,oBAChBC,OACfC,GAAgB,eAAhBA,EAAOC,MAECL,EAAAA,EAAaM,OAAS,GAC5C3B,GAAkB,SACX4B,GACC/B,QAAAA,MAAM,0BAA2B+B,GACzC5B,GAAkB,EAAK,GAGd6B,IACZ,IAGHb,EAAAA,UAAU,KACR,GAAIP,EAAa,CACf,MAAMqB,EAAQC,WAAW,IAAMrB,GAAe,GAAQ,KAC/C,MAAA,IAAMsB,aAAaF,EAAK,GAEhC,CAACrB,IAGJO,EAAAA,UAAU,IACD,KACDF,EAAemB,SACjBD,aAAalB,EAAemB,UAG/B,IAEH,MAMMC,EAAaC,cAAwBC,IACrC,IAACA,IAAWA,EAAO,KAAOA,EAAO,GAAGC,SAAU,OAE5CC,MAAAA,EAAOF,EAAO,GAAGC,SACjBE,EAAMC,KAAKD,MAGbD,IAAS3B,EAAYsB,SAAWM,EAAM1B,EAAgBoB,QAAU,KAKhElB,EAAckB,UAKdnB,EAAemB,SACjBD,aAAalB,EAAemB,SAI9BlB,EAAckB,SAAU,EACxBtB,EAAYsB,QAAUK,EACtBzB,EAAgBoB,QAAUM,EAG1B7B,GAAe,GAGXjB,EAAMgD,OAEOR,EAAAA,QAAUF,WAAWX,UAC9B,UACI3B,EAAMgD,OAAOL,SACZR,GACC/B,QAAAA,MAAM,sBAAuB+B,EAAG,CAChC,QAERG,WAAW,KACThB,EAAckB,SAAU,GACvB,IAAG,GAEP,KAEHlB,EAAckB,SAAU,IAEzB,CAACxC,EAAMgD,SAGR,OAAAC,EAAAA,IAAC,OACCnD,UAAW,4IAA4IA,IAEvJoD,SAAAC,EAAAA,KAAC,MAAI,CAAArD,UAAU,kCACboD,SAAA,CAAAC,OAAC,MACC,CAAArD,UAAW,2DAA2DD,2CAEtEqD,SAAA,CAAAD,EAAAA,IAAC,OACCnD,UAAU,UACVsD,KAAK,OACLC,OAAO,eACPC,QAAQ,YAERJ,eAAC,OACC,CAAAK,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,kRAED,qBAGPP,EAAAA,KAAC,MAAI,CAAArD,UAAU,0MACZQ,SAAAA,CAAAA,QACE,MAAI,CAAAR,UAAU,wDACboD,SAACC,EAAAA,KAAA,MAAA,CAAIrD,UAAU,cACboD,SAAA,CAACD,EAAAA,IAAA,MAAA,CAAInD,UAAU,8EACdmD,EAAAA,IAAA,IAAA,CAAEnD,UAAU,UAAUoD,SAAsB,gCAG/C9C,EACD6C,EAAAA,IAAA,MAAA,CAAInD,UAAU,2DACboD,SAAAC,EAAAA,KAAC,MAAI,CAAArD,UAAU,cACboD,SAAA,CAACD,EAAAA,IAAA,IAAA,CAAEnD,UAAU,2BAA2BoD,SAAY,iBACnDD,EAAAA,IAAA,IAAA,CAAEnD,UAAU,UAAWM,SAAMA,SAKhC+C,EAAAA,KAAAQ,EAAAA,SAAA,CAAAT,SAAA,CAAAD,EAAAA,IAACW,EAAA,CACCZ,OAAQP,EACRoB,QAjGe1B,IACnB/B,QAAAA,MAAM,gBAAiB+B,GAC/B9B,EAAS,oDAgGGV,OAAQA,GAAU2B,EAAckB,QAChCsB,YAAa,CACX7D,aAGA8D,MAAO,CAAEC,MAAO,KAAMC,IAAK,KAC3BC,OAAQ,CAAEF,MAAO,KAAMC,IAAK,KAC5BE,UAAW,CAAEH,MAAO,GAAIC,IAAK,KAE/BG,MAAO5D,EAEP6D,QAAS,CACP,UACA,SACA,QACA,WACA,UACA,QACA,QACA,UACA,MACA,UACA,UACA,oBAGFC,UAAW,IAEXC,eAAe,EACfC,OAAQ,CACNC,UAAW,CACTV,MAAO,OACPG,OAAQ,OACRQ,aAAc,OACdC,SAAU,WAEZC,MAAO,CACLb,MAAO,OACPG,OAAQ,OACRW,UAAW,QACXH,aAAc,OACdI,gBAAiB,UAGrBC,WAAY,CAAEN,UAAW,mBAG1BzD,GACCiC,EAAAA,IAAC,MAAI,CAAAnD,UAAU,yHACboD,SAAAD,EAAAA,IAAC,MAAI,CAAAnD,UAAU,oEACboD,SAAAD,EAAAA,IAAC,MACC,CAAAnD,UAAU,UACVsD,KAAK,OACLC,OAAO,eACPC,QAAQ,YAERJ,SAACD,MAAA,OAAA,CACCM,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,6BAQdtD,IAAUE,GACT6C,EAAAA,KAAA,MAAA,CAAIrD,UAAU,4CACZY,SAAAA,CAAAA,GAAYE,GACXqC,MAAC+B,EACC,CAAAC,MACGhC,EAAAA,IAAA,MAAA,CACCnD,UAAU,UACVsD,KAAK,OACLC,OAAO,eACPC,QAAQ,YAERJ,SAAAD,EAAAA,IAAC,OACC,CAAAM,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,kHAIRwB,KAAK,KACLC,QAAQ,YACRC,QAAS,KACPlF,EACEmF,GAAS,SAATA,EAAkB,cAAgB,SAGtCC,kBAAgB,EAChBC,MACiB,SAAftF,EACI,wBACA,2BAITS,GACEuC,EAAAA,IAAA+B,EAAA,CACCC,MACGhC,EAAAA,IAAA,MAAA,CACCnD,UAAU,UACVsD,KAAK,OACLC,OAAO,eACPC,QAAQ,YAERJ,eAAC,OACC,CAAAK,cAAc,QACdC,eAAe,QACfC,YAAa,EACbC,EAAE,iCAIRwB,KAAK,KACLC,QAAQ,YACRC,QAAS,IAAM3E,GAAiBD,GAChC8E,kBAAgB,EAChBC,MACE/E,EAAe,sBAAwB,iCAU3D"}