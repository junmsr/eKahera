import{j as e}from"./utils-BnCj7yKo.js";import{a as t}from"./vendor-BZrj58oz.js";import{B as s}from"./BaseModal-C-8Qp-dk.js";import{b as r,a as n}from"./index-EFVr_f9Q.js";function a({isOpen:a,onClose:o}){const[c,l]=t.useState([]),[i,u]=t.useState(!1),[d,m]=t.useState(""),[x,b]=t.useState(0),p=t.useRef(null);t.useRef(null),t.useEffect(()=>{if(!a)return;(async()=>{u(!0),m("");try{const e=sessionStorage.getItem("auth_token"),t=await n("/api/sales/business/recent",{headers:{Authorization:`Bearer ${e}`}});l(Array.isArray(t)?t:[])}catch(e){console.error("Error fetching receipts:",e),m("Failed to load receipts. Please try again.")}finally{u(!1)}})()},[a]);const h=t.useCallback(e=>{const t=new URL(window.location.origin+"/receipt");e.transaction_number&&t.searchParams.set("tn",e.transaction_number),e.transaction_id&&t.searchParams.set("tid",String(e.transaction_id)),window.open(t.toString(),"_blank")},[]);t.useCallback(e=>{c[e]&&h(c[e])},[c,h]);const f=t.useCallback(e=>{if(a&&c.length)switch(e.preventDefault(),e.key){case"ArrowUp":b(e=>{const t=e<=0?c.length-1:e-1;return setTimeout(()=>{const e=p.current?.querySelectorAll("button"),s=e?.[t];s&&(s.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}),s.focus({preventScroll:!0}))},0),t});break;case"ArrowDown":b(e=>{const t=e>=c.length-1?0:e+1;return setTimeout(()=>{const e=p.current?.querySelectorAll("button"),s=e?.[t];s&&(s.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}),s.focus({preventScroll:!0}))},0),t});break;case"Enter":e.preventDefault(),c[x]&&h(c[x]);break;case"Escape":o()}},[a,c,x,o,h]);return t.useEffect(()=>{a&&(b(0),setTimeout(()=>{const e=p.current?.querySelector("button");e&&e.focus({preventScroll:!0})},100))},[a,c]),e.jsxs(s,{isOpen:a,onClose:o,title:"All Transactions",subtitle:"Latest transactions across all cashiers",size:"lg",footer:e.jsx(r,{label:"Close (Esc)",variant:"secondary",onClick:o,className:"w-full"}),children:[i&&e.jsx("div",{className:"text-sm text-gray-600 py-4 text-center",children:"Loading transactions..."}),d&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 border border-red-100 rounded-lg px-3 py-2 mb-2",children:d}),!i&&!d&&0===c.length&&e.jsx("div",{className:"text-sm text-gray-500 py-6 text-center",children:"No transactions found."}),e.jsx("div",{ref:p,className:"space-y-2 max-h-[60vh] overflow-y-auto outline-none",onKeyDown:f,tabIndex:0,children:c.map((t,s)=>e.jsxs("button",{onClick:()=>h(t),className:"w-full text-left border rounded-xl px-3 py-2 transition-colors "+(x===s?"border-blue-500 bg-blue-50 ring-2 ring-blue-200":"border-gray-200 hover:border-blue-300 hover:bg-blue-50"),onFocus:()=>b(s),tabIndex:0,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.transaction_number||`TXN-${t.transaction_id||""}`}),e.jsx("p",{className:"text-xs text-gray-600",children:new Date(t.updated_at||t.created_at).toLocaleString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-blue-700",children:["₱",Number(t.total_amount||t.total||0).toFixed(2)]}),e.jsx("p",{className:"text-[11px] text-gray-600 uppercase",children:t.payment?.method||t.payment_type||"cash"})]})]}),(t.discount_percentage||t.discount_amount)&&e.jsxs("p",{className:"text-[11px] text-emerald-700 mt-1",children:["Discount applied"," ",t.discount_percentage?`${t.discount_percentage}%`:`₱${Number(t.discount_amount||0).toFixed(2)}`]})]},`${t.transaction_id}-${t.transaction_number}`))})]})}export{a as A};
//# sourceMappingURL=AdminReceiptsModal-ozABUVCm.js.map
