import{j as e}from"./utils-BnCj7yKo.js";import{a as t}from"./vendor-BZrj58oz.js";import{P as r}from"./PageLayout-D_ZMWTMw.js";import{N as s}from"./Nav-Admin-BJoTBbbB.js";import{I as i}from"./Inventory-NDwZzHfs.js";import{M as o}from"./Modal-Cuwuhe4O.js";import{a as n,c as a,b as l}from"./index-B6EMrwoj.js";import{E as c}from"./jspdf.es.min-CgXDhZqi.js";import"./BaseModal-C-8Qp-dk.js";import"./Input-D3kbgyHK.js";import"./qr-DN-bNBye.js";import{u as d}from"./useDebounce-CoebmKoV.js";import"./Navbar-UJciBic7.js";import"./Logo-CC4Yu1_Q.js";import"./PrivacyPolicyModal-C_BSH6tZ.js";import"./Card-fMjg4IWJ.js";import"./FormField-1uEQplD4.js";import"./ScannerCard-DdUmj5XW.js";const u=[],m=[],p=10;function h(e){const t={"Grocery Store":["Fresh Produce","Meat & Poultry","Seafood","Dairy & Eggs","Bread & Bakery","Snacks & Chips","Beverages","Canned & Packaged Goods","Frozen Food","Rice, Pasta & Grains","Condiments & Spices","Cleaning Supplies","Household Essentials","Baby Products","Pet Supplies"],Pharmacy:["Prescription Medicines","OTC Medicines","Vitamins & Supplements","First Aid Supplies","Medical Devices","Personal Care","Hygiene Products","Beauty & Cosmetics","Baby Care","Adult Care","PPE & Sanitizers"],"Clothing Store":["Men’s Clothing","Women’s Clothing","Kids’ Clothing","Baby Clothing","Footwear","Bags & Accessories","Underwear & Socks"],"Electronics Store":["Mobile Devices","Computers & Laptops","Computer Accessories","Phone Accessories","Audio Devices","Cameras & Photography","Home Appliances","Personal Appliances","Gaming Consoles & Accessories","Cables, Adapters & Chargers"],Bookstore:["Fiction Books","Non-Fiction Books","Educational Books","Children’s Books","Comics & Manga","School Supplies","Art Materials","Office Supplies","Stationery & Gifts"],"Convenience Store":["Snacks","Beverages","Ready-to-Eat Food","Instant Noodles / Cup Meals","Frozen Food","Basic Grocery Items","Toiletries","Basic OTC Medicines","Household Essentials","Phone Load","Ice Cream & Desserts","Tobacco & Lighters"],Others:["General"]};return t[e]||t.Others}function g({isOpen:t,onClose:r,successCount:s,errors:i}){if(!t)return null;const o=i&&i.length>0;return e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:r,"aria-hidden":"true"}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col z-10",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:`bg-gradient-to-r ${o?"from-yellow-50 via-yellow-50/80 to-orange-50/50 border-b border-yellow-100":"from-green-50 via-green-50/80 to-emerald-50/50 border-b border-green-100"} px-6 py-5 rounded-t-2xl flex items-center justify-between`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 bg-gradient-to-br ${o?"from-yellow-500 to-orange-600":"from-green-500 to-emerald-600"} rounded-xl flex items-center justify-center shadow-lg`,children:o?e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}):e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:o?"Import Completed with Warnings":"Import Successful"}),e.jsx("p",{className:"text-sm text-gray-600",children:o?"Some products were imported with errors":"All products imported successfully"})]})]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-all duration-200 p-2 rounded-xl",type:"button","aria-label":"Close modal",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"overflow-y-auto flex-1 px-6 py-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:`bg-gradient-to-r ${o?"from-yellow-50 to-orange-50":"from-green-50 to-emerald-50"} border-l-4 ${o?"border-yellow-500":"border-green-500"} rounded-lg p-4`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex-shrink-0 w-10 h-10 ${o?"bg-yellow-100":"bg-green-100"} rounded-full flex items-center justify-center`,children:e.jsx("span",{className:"text-lg font-bold "+(o?"text-yellow-700":"text-green-700"),children:s})}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm font-semibold "+(o?"text-yellow-800":"text-green-800"),children:[s," ",1===s?"product":"products"," imported successfully"]})})]})}),o&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-red-800 mb-2",children:[i.length," ",1===i.length?"error":"errors"," encountered:"]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto space-y-1",children:[i.slice(0,10).map((t,r)=>e.jsx("p",{className:"text-xs text-red-700 font-mono bg-red-100 px-2 py-1 rounded",children:t},r)),i.length>10&&e.jsxs("p",{className:"text-xs text-red-600 italic mt-2",children:["... and ",i.length-10," more error",i.length-10>1?"s":""]})]})]})]})}),e.jsx("div",{className:"sticky bottom-0 px-6 py-4 bg-gradient-to-t from-slate-50 via-white to-transparent border-t border-slate-200/10 flex justify-end gap-3 backdrop-blur-sm",children:e.jsx(l,{onClick:r,variant:"primary",children:"OK"})})]})]})}function x({isOpen:r,onClose:s,onImport:i,loading:o,error:n}){const[a,c]=t.useState(null),[d,u]=t.useState(!1),[m,p]=t.useState(null),h=t.useRef(null);return r?e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:s,"aria-hidden":"true"}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-xl max-h-[90vh] overflow-hidden flex flex-col z-10",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 via-blue-50/80 to-indigo-50/50 border-b border-blue-100 px-6 py-5 rounded-t-2xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Import Products from CSV"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Upload a CSV file to import products"})]})]}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-all duration-200 p-2 rounded-xl",type:"button",disabled:o,"aria-label":"Close modal",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"overflow-y-auto flex-1 px-6 py-6",children:d?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"bg-gradient-to-r from-red-50 via-red-50/80 to-orange-50/50 border-l-4 border-red-500 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Warning"}),e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:"This action cannot be undone. Importing products will add them to your inventory."}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Are you sure you want to proceed with importing ",e.jsx("strong",{children:a?.name}),"?"]})]})]})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Select CSV File"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors",children:[e.jsx("input",{ref:h,type:"file",accept:".csv,text/csv",onChange:e=>{const t=e.target.files[0];if(!t)return;if(!t.name.toLowerCase().endsWith(".csv")&&"text/csv"!==t.type)return void alert("Please select a CSV file");c(t),u(!1),p(null);const r=new FileReader;r.onload=e=>{p(e.target.result)},r.onerror=()=>{alert("Failed to read file"),c(null)},r.readAsText(t)},className:"hidden",id:"csv-file-input",disabled:o}),e.jsxs("label",{htmlFor:"csv-file-input",className:"cursor-pointer flex flex-col items-center gap-2",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("span",{className:"text-sm text-gray-600",children:a?a.name:"Click to browse or drag and drop"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Only CSV files are accepted"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-800 mb-2",children:"Required CSV Columns:"}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[e.jsx("li",{children:"• sku"}),e.jsx("li",{children:"• name"}),e.jsx("li",{children:"• category"}),e.jsx("li",{children:"• description"}),e.jsx("li",{children:"• product sold by"}),e.jsx("li",{children:"• unit size"}),e.jsx("li",{children:"• unit"}),e.jsx("li",{children:"• quantity"}),e.jsx("li",{children:"• cost price"}),e.jsx("li",{children:"• selling price"}),e.jsx("li",{children:"• low stock alert"})]})]}),n&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-red-700",children:n})})]})}),e.jsx("div",{className:"sticky bottom-0 px-6 py-4 bg-gradient-to-t from-slate-50 via-white to-transparent border-t border-slate-200/10 flex justify-end gap-3 backdrop-blur-sm",children:d?e.jsxs(e.Fragment,{children:[e.jsx(l,{onClick:()=>{u(!1)},variant:"secondary",disabled:o,children:"Cancel"}),e.jsx(l,{onClick:()=>{m&&(i(m),u(!1),c(null),p(null),h.current&&(h.current.value=""))},variant:"danger",disabled:o,loading:o,children:"Proceed"})]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{onClick:s,variant:"secondary",disabled:o,children:"Cancel"}),e.jsx(l,{onClick:()=>{a&&m?u(!0):alert("Please select a CSV file first")},variant:"primary",disabled:!a||o,loading:o,children:"Import"})]})})]})]}):null}function y(){const[y,b]=t.useState(u),[_,f]=t.useState(()=>{try{let t=null;try{t="undefined"!=typeof window&&sessionStorage.getItem("business_type")||null}catch(e){t=null}if(!t&&"undefined"!=typeof window)try{const r=sessionStorage.getItem("user")||localStorage.getItem("user");if(r){const s=JSON.parse(r);if(t=s?.business?.business_type||s?.business_type||null,t)try{sessionStorage.setItem("business_type",t)}catch(e){}}}catch(e){t=null}t=t||"Others";return(h(t)||[]).map((e,t)=>({id:t+1,name:e}))}catch{return m}}),[v,j]=t.useState(!1),[k,w]=t.useState(!1),[N,C]=t.useState(null),[S,L]=t.useState({sku:"",name:"",category:"",customCategory:"",description:"",quantity:"",cost_price:"",selling_price:"",low_stock_level:p}),[P,q]=t.useState({sku:"",quantity:""}),[F,$]=t.useState(!1),[I,M]=t.useState(""),B=d(I,400),[T,E]=t.useState(10),[z,W]=t.useState(1),[A,O]=t.useState(""),[D,V]=t.useState(!1),[R,U]=t.useState(null),[H,K]=t.useState(!1),[G,J]=t.useState(null),[Y,Q]=t.useState(!1),[X,Z]=t.useState(!1),[ee,te]=t.useState(!1),[re,se]=t.useState(!1),[ie,oe]=t.useState({successCount:0,errors:[]});t.useEffect(()=>{(async()=>{try{$(!0),O("");const t=sessionStorage.getItem("auth_token"),r=await n("/api/auth/profile",{headers:a(t)}),s=r?.business?.business_type||"Others";try{"undefined"!=typeof window&&sessionStorage.setItem("business_type",s)}catch(e){console.debug("Could not persist business_type",e)}const i=h(s);f(i.map((e,t)=>({id:t+1,name:e})));const o=await n("/api/inventory",{headers:a(t),params:{limit:1e3,offset:0}}),l=(o?.products||o||[]||[]).map(e=>({id:String(e.id||""),name:e.name||"-",category:e.category||"-",quantity:Number(e.quantity||0),cost_price:Number(e.cost_price||0),selling_price:Number(e.selling_price||0),sku:e.sku||"",description:e.description||"",low_stock_level:Number(e.low_stock_level??p),product_type:e.product_type||"count",quantity_per_unit:Number(e.quantity_per_unit||1),base_unit:e.base_unit||"pc",display_unit:e.display_unit||null}));b(l)}catch(t){O("Failed to load inventory"),b([])}finally{$(!1)}})()},[]);const ne=(e,t,r,s)=>{if(!e||0===e)return 0;if("count"===t||!t)return e;if("volume"===t&&"L"===s){const t=e/1e3;if(r&&r>0){const i=t/r;return i>1e5&&console.error(`[Inventory Conversion Error] Unusually large display quantity calculated: ${i.toFixed(2)}. quantityInBaseUnits: ${e}, quantityPerUnit: ${r}, baseUnit: ${s}. This suggests incorrect data storage.`),i}return t}return r&&r>0?e/r:e},ae=y.map(e=>e.id),le=ae.filter((e,t)=>ae.indexOf(e)!==t);le.length>0&&console.warn("⚠️ Found duplicate products in array:",le);const ce=y.reduce((e,t)=>{const r=ne(t.quantity,t.product_type,t.quantity_per_unit,t.base_unit),s=Number(t.cost_price||0),i=s*r;return"volume"===t.product_type&&"L"===t.base_unit&&console.log(`[Inventory Value Debug] Product: ${t.name} (ID: ${t.id})`,{quantity_in_stock_base_units:t.quantity,quantity_per_unit:t.quantity_per_unit,base_unit:t.base_unit,display_qty_calculated:r,cost_price:s,item_value:i}),i>1e6&&(console.error(`❌ CRITICAL: Unusually high inventory value for product "${t.name}" (ID: ${t.id}): ₱${i.toLocaleString()}`),console.error(`   Details: quantity=${t.quantity}, cost_price=${s}, displayQty=${r.toFixed(2)}, quantity_per_unit=${t.quantity_per_unit}, base_unit=${t.base_unit}`),console.error("   This suggests incorrect data. Please check the product's quantity_in_stock in the database.")),e+i},0);console.log(`[Inventory Total Debug] Total inventory value: ₱${ce.toLocaleString()}`),console.log(`[Inventory Total Debug] Number of products: ${y.length}`);const de=y.map(e=>{const t=ne(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit),r=t*(e.cost_price||0);return{id:e.id,name:e.name,quantity:e.quantity,displayQty:parseFloat(t.toFixed(2)),costPrice:e.cost_price,value:r,product_type:e.product_type,base_unit:e.base_unit,quantity_per_unit:e.quantity_per_unit}}).sort((e,t)=>t.value-e.value);console.log("[Inventory Total Debug] Breakdown by product (sorted by value):",de);const ue=y.reduce((e,t)=>e+ne(t.quantity,t.product_type,t.quantity_per_unit,t.base_unit)*(t.cost_price||0),0);console.log(`[Inventory Total Debug] Sum verification: ₱${ue.toLocaleString()}`),Math.abs(ce-ue)>.01&&console.error(`❌ DISCREPANCY DETECTED: Calculated total (${ce}) doesn't match sum verification (${ue})`),ce>1e6&&(console.warn(`⚠️ WARNING: Total inventory value is unusually high: ₱${ce.toLocaleString()}`),console.warn("   Top 3 products by value:",de.slice(0,3)));const me=y.filter(e=>ne(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit)<Number(e.low_stock_level??p)).length,pe=[{label:"TOTAL ITEMS",value:y.length,icon:e.jsx("svg",{width:"32",height:"32",fill:"none",stroke:"#2563eb",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),color:"text-blue-800",sub:"Total products in inventory"},{label:"INVENTORY VALUE",value:ce,icon:e.jsx("svg",{width:"32",height:"32",fill:"none",stroke:"#2563eb",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),color:"text-green-700",formatValue:e=>(console.log(`[Format Value] Formatting inventory value: ${e} -> ₱${e.toLocaleString(void 0,{minimumFractionDigits:2})}`),`₱${e.toLocaleString(void 0,{minimumFractionDigits:2})}`),sub:"Total value of all stock"},{label:"AVAILABLE CATEGORIES",value:_.length,icon:e.jsx("svg",{width:"32",height:"32",fill:"none",stroke:"#2563eb",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M4 7h16M4 12h16M4 17h16"})}),color:"text-blue-500",sub:"Product categories"},{label:"LOW STOCK ALERTS",value:me,icon:e.jsx("svg",{width:"32",height:"32",fill:"none",stroke:"#2563eb",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),color:"text-orange-600",sub:"Items needing restock"}],[he,ge]=t.useState("name"),[xe,ye]=t.useState("asc"),[be,_e]=t.useState(null),[fe,ve]=t.useState(null),je=t.useMemo(()=>{let e=y.filter(e=>e.name.toLowerCase().includes(B.toLowerCase())||e.category.toLowerCase().includes(B.toLowerCase())||e.description.toLowerCase().includes(B.toLowerCase()));return be&&(e=e.filter(e=>e.category===be)),fe&&("out_of_stock"===fe?e=e.filter(e=>0===ne(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit)):"low_stock"===fe?e=e.filter(e=>{const t=ne(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit),r=Number(e.low_stock_level??p);return t>0&&t<r}):"in_stock"===fe&&(e=e.filter(e=>ne(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit)>=Number(e.low_stock_level??p)))),e.sort((e,t)=>{let r,s;if("name"===he)r=(e.name||"").toLowerCase(),s=(t.name||"").toLowerCase();else if("category"===he)r=(e.category||"").toLowerCase(),s=(t.category||"").toLowerCase();else if("quantity"===he)r=ne(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit),s=ne(t.quantity,t.product_type,t.quantity_per_unit,t.base_unit);else{if("selling_price"!==he)return 0;r=Number(e.selling_price||0),s=Number(t.selling_price||0)}return r<s?"asc"===xe?-1:1:r>s?"asc"===xe?1:-1:0}),e},[y,B,be,fe,he,xe]),ke=Math.ceil(je.length/T)||1,we=je.slice((z-1)*T,z*T),Ne=t.useCallback(()=>{C(null),L({sku:"",name:"",category:"",customCategory:"",description:"",quantity:"",cost_price:"",selling_price:"",low_stock_level:p,product_sold_by:"Per Piece",unit_size:"",unit:""}),j(!0)},[]),Ce=t.useCallback(e=>{C(e);let t="Per Piece";"weight"===e.product_type?t="By Weight":"volume"===e.product_type&&(t="By Volume"),L({...e,name:e.name||"",sku:e.sku||"",category:e.category||"",description:e.description||"",cost_price:e.cost_price||"",selling_price:e.selling_price||"",low_stock_level:"number"==typeof e.low_stock_level?e.low_stock_level:p,product_sold_by:t,unit_size:e.quantity_per_unit?String(e.quantity_per_unit):"",unit:e.base_unit&&"pc"!==e.base_unit?e.base_unit:"weight"===e.product_type?"g":"volume"===e.product_type?"mL":""}),j(!0)},[]),Se=t.useCallback(e=>{q({sku:e?.sku||"",quantity:""}),w(!0)},[]),Le=t.useCallback(e=>{const{name:t,value:r}=e.target;("clearError"===t||A&&"clearError"!==t)&&O(""),"clearError"!==t&&L(e=>{const s={...e,[t]:r};return"product_sold_by"===t&&("By Weight"===r||"By Volume"===r?(s.unit&&""!==s.unit||(s.unit="By Weight"===r?"g":"mL"),s.unit_size&&""!==s.unit_size||(N&&N.quantity_per_unit?s.unit_size=String(N.quantity_per_unit):s.unit_size="By Weight"===r?"100":"250")):"Per Piece"===r&&(s.unit_size="",s.unit="")),s})},[A,N]),Pe=t.useCallback(async e=>{e.preventDefault();try{$(!0),O("");const e=sessionStorage.getItem("auth_token");N?await n(`/api/inventory/${N.id}`,{method:"PUT",headers:{"Content-Type":"application/json",...a(e)},body:JSON.stringify({product_name:(S.name||"").trim(),cost_price:Number(S.cost_price)||0,selling_price:Number(S.selling_price)||0,sku:(S.sku||"").trim(),low_stock_level:Number(S.low_stock_level)||p,category:"Others"===S.category?(S.customCategory||"").trim():(S.category||"").trim(),description:(S.description||"").trim(),product_sold_by:S.product_sold_by||"Per Piece",unit_size:S.unit_size?Number(S.unit_size):void 0,unit:S.unit||void 0})}):await n("/api/products",{method:"POST",headers:{"Content-Type":"application/json",...a(e)},body:JSON.stringify({product_category_id:null,category:"Others"===S.category?(S.customCategory||"").trim():(S.category||"").trim(),product_name:(S.name||"").trim(),name:(S.name||"").trim(),description:(S.description||"").trim(),cost_price:Number(S.cost_price)||0,selling_price:Number(S.selling_price)||0,price:Number(S.selling_price)||0,sku:(S.sku||"").trim()||`SKU-${Date.now()}`,quantity:Number(S.quantity)||0,low_stock_level:Number(S.low_stock_level)||p,product_sold_by:S.product_sold_by||"Per Piece",unit_size:S.unit_size?Number(S.unit_size):void 0,unit:S.unit||void 0})});const t=await n("/api/inventory",{headers:a(e),params:{limit:1e3,offset:0}}),r=(t?.products||t||[]||[]).map(e=>({id:String(e.id||""),name:e.name||"-",category:e.category||"-",quantity:Number(e.quantity||0),cost_price:Number(e.cost_price||0),selling_price:Number(e.selling_price||0),sku:e.sku||"",description:e.description||"",low_stock_level:Number(e.low_stock_level??p),product_type:e.product_type||"count",quantity_per_unit:Number(e.quantity_per_unit||1),base_unit:e.base_unit||"pc",display_unit:e.display_unit||null}));b(r),j(!1)}catch(t){let e="Failed to save product";try{const r=t.response?.data||t.data||{},s=t.response?.status;409===s||"Product with this SKU already exists"===r.error?(e=r.message||`A product with SKU "${S.sku?.trim()||"this SKU"}" already exists. Please use a different SKU.`,r.existingProduct&&(e=`SKU "${S.sku?.trim()}" is already in use by "${r.existingProduct.product_name}". Please use a different SKU code.`)):r.error||r.message?e=r.message||r.error:t.message&&(e=t.message)}catch(r){e=t.message||"Failed to save product",console.error("Error parsing error response:",r)}O(e)}finally{$(!1)}},[N,S]),qe=t.useCallback(async e=>{e.preventDefault();try{$(!0),O("");const e=sessionStorage.getItem("auth_token");await n("/api/products/add-stock-by-sku",{method:"POST",headers:a(e),body:JSON.stringify({sku:P.sku,quantity:Number(P.quantity)})});const t=await n("/api/inventory",{headers:a(e),params:{limit:1e3,offset:0}}),r=(t?.products||t||[]||[]).map(e=>({id:String(e.id||""),name:e.name||"-",category:e.category||"-",quantity:Number(e.quantity||0),cost_price:Number(e.cost_price||0),selling_price:Number(e.selling_price||0),sku:e.sku||"",description:e.description||"",low_stock_level:Number(e.low_stock_level??p),product_type:e.product_type||"count",quantity_per_unit:Number(e.quantity_per_unit||1),base_unit:e.base_unit||"pc",display_unit:e.display_unit||null}));b(r),w(!1)}catch(t){O("Failed to add stock")}finally{$(!1)}},[P]),Fe=t.useCallback(e=>{const t=y.find(t=>String(t.id)===String(e));t&&(J(t),K(!0))},[y]),$e=t.useCallback(async()=>{if(G)try{$(!0),O("");const t=sessionStorage.getItem("auth_token");try{await n(`/api/products/${G.id}`,{method:"DELETE",headers:a(t)})}catch(e){console.log("Trying fallback delete endpoint..."),await n(`/api/inventory/${G.id}`,{method:"DELETE",headers:a(t)})}b(e=>e.filter(e=>e.id!==G.id)),K(!1),J(null)}catch(e){console.error("Error deleting product:",e),O(e.response?.data?.error||"Failed to delete product. Please try again.")}finally{$(!1)}},[G]),Ie=t.useCallback(e=>{e<1||e>ke||W(e)},[ke]),Me=t.useCallback(e=>{E(Number(e.target.value)),W(1)},[]),Be=t.useCallback(e=>{M(e.target.value),W(1)},[]),Te=t.useCallback(async e=>{try{te(!0),O("");const r=sessionStorage.getItem("auth_token"),s=e.split("\n").filter(e=>e.trim().length>0);if(s.length<2)throw new Error("CSV file must contain at least a header row and one data row");const i=s[0].split(",").map(e=>e.trim().toLowerCase()),o=["sku","name","category","description","product sold by","unit size","unit","quantity","cost price","selling price","low stock alert"].filter(e=>!i.includes(e));if(o.length>0)throw new Error(`Missing required columns: ${o.join(", ")}`);const l=[],c=[];for(let e=1;e<s.length;e++){const r=s[e].trim();if(r)try{const t=[];let s="",o=!1;for(let e=0;e<r.length;e++){const i=r[e];'"'===i?o=!o:","!==i||o?s+=i:(t.push(s.trim()),s="")}if(t.push(s.trim()),t.length!==i.length){c.push(`Row ${e+1}: Column count mismatch`);continue}if(!t.some(e=>e&&e.trim().length>0))continue;const n={};i.forEach((e,r)=>{n[e]=t[r]||""});const a=n.sku?.trim()||`SKU-${Date.now()}-${e}`,d=n.name?.trim();if(!d){c.push(`Row ${e+1}: Name is required`);continue}const u=n.category?.trim()||"",m=n.description?.trim()||"";let h=n["product sold by"]?.trim()||"Per Piece",g="Per Piece";const x=h.toLowerCase();g="per piece"===x||"per_piece"===x||"count"===x||"piece"===x?"Per Piece":"by weight"===x||"by_weight"===x||"weight"===x||"per weight"===x?"By Weight":"by volume"===x||"by_volume"===x||"volume"===x||"per volume"===x?"By Volume":h;let y=n["unit size"]?.trim()||"",b=n.unit?.trim()||"",_="",f="";if(y){const e=y.match(/^([\d.]+)\s*(kg|g|L|mL|liter|liters|litre|litres|kilogram|kilograms)$/i);if(e){_=e[1];const t=e[2].toLowerCase();"kg"===t||"kilogram"===t||"kilograms"===t?f="kg":"g"===t||"gram"===t||"grams"===t?f="g":"l"===t||"liter"===t||"liters"===t||"litre"===t||"litres"===t?f="L":"ml"!==t&&"milliliter"!==t&&"milliliters"!==t&&"millilitre"!==t&&"millilitres"!==t||(f="mL")}else if(_=y,b){const e=b.toLowerCase();f="kg"===e||"kilogram"===e||"kilograms"===e?"kg":"g"===e||"gram"===e||"grams"===e?"g":"l"===e||"liter"===e||"liters"===e||"litre"===e||"litres"===e?"L":"ml"===e||"milliliter"===e||"milliliters"===e||"millilitre"===e||"millilitres"===e?"mL":b}}else if(b){const e=b.toLowerCase();f="kg"===e||"kilogram"===e||"kilograms"===e?"kg":"g"===e||"gram"===e||"grams"===e?"g":"l"===e||"liter"===e||"liters"===e||"litre"===e||"litres"===e?"L":"ml"===e||"milliliter"===e||"milliliters"===e||"millilitre"===e||"millilitres"===e?"mL":b}"Per Piece"===g&&(_="",f="");const v=Number(n.quantity?.trim()||0),j=Number(n["cost price"]?.trim()||0),k=Number(n["selling price"]?.trim()||0),w=Number(n["low stock alert"]?.trim()||p);if(v<=0){c.push(`Row ${e+1}: Quantity must be greater than 0`);continue}if(k<j){c.push(`Row ${e+1}: Selling price must be greater than or equal to cost price`);continue}l.push({sku:a,name:d,category:u,description:m,product_sold_by:g,unit_size:_?Number(_):void 0,unit:f||void 0,quantity:v,cost_price:j,selling_price:k,low_stock_level:w})}catch(t){c.push(`Row ${e+1}: ${t.message||"Invalid data"}`)}}if(c.length>0&&0===l.length)throw new Error(`Import failed:\n${c.join("\n")}`);if(0===l.length)throw new Error("No valid products found in CSV file");const d=await n("/api/products/bulk-import",{method:"POST",headers:{"Content-Type":"application/json",...a(r)},body:JSON.stringify({products:l})}),u=await n("/api/inventory",{headers:a(r),params:{limit:1e3,offset:0}}),m=(u?.products||u||[]||[]).map(e=>({id:String(e.id||""),name:e.name||"-",category:e.category||"-",quantity:Number(e.quantity||0),cost_price:Number(e.cost_price||0),selling_price:Number(e.selling_price||0),sku:e.sku||"",description:e.description||"",low_stock_level:Number(e.low_stock_level??p),product_type:e.product_type||"count",quantity_per_unit:Number(e.quantity_per_unit||1),base_unit:e.base_unit||"pc",display_unit:e.display_unit||null}));b(m),Z(!1);const h=d?.errors||[],g=[...c,...h.map(e=>`Row ${e.index+1}: ${e.error}`)],x=d?.success?.length||l.length;oe({successCount:x,errors:g}),se(!0)}catch(t){const e=t.response?.data?.error||t.message||"Failed to import products";O(e),console.error("CSV import error:",t)}finally{te(!1)}},[]),Ee=t.useCallback(async()=>{Q(!0);try{const e=sessionStorage.getItem("auth_token"),t=await n("/auth/profile",{headers:a(e)}),r=t?.business||{},s=r.business_name||"Store",i=[r.house_number,r.barangay,r.city,r.province].filter(Boolean).join(", ")||"N/A",o=r.mobile||r.email||"N/A";if(!je||0===je.length)return void alert("No inventory data found to export.");const l=je.reduce((e,t)=>{const r=ne(t.quantity,t.product_type,t.quantity_per_unit,t.base_unit);return e+Number(t.cost_price||0)*r},0),d=new c("p","mm","a4"),u=d.internal.pageSize.getWidth(),m=20,p=u-2*m;let h=m;const g=e=>h+e>d.internal.pageSize.getHeight()-m&&(d.addPage(),h=m,!0);d.setFontSize(20),d.setFont("helvetica","bold");const x=d.getTextWidth(s);d.text(s,(u-x)/2,h),h+=10,d.setFontSize(12),d.setFont("helvetica","normal");const y=d.getTextWidth(i);d.text(i,(u-y)/2,h),h+=7;const b=d.getTextWidth(o);d.text(o,(u-b)/2,h),h+=15,d.setFontSize(16),d.setFont("helvetica","bold"),d.text("Inventory Report",m,h),h+=8,d.setFontSize(12),d.setFont("helvetica","normal");const _=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});d.text(`Date: ${_}`,m,h),h+=10;const f=[.24*p,.14*p,.16*p,.16*p,.15*p,.15*p],v=[m];for(let n=1;n<f.length;n++)v.push(v[n-1]+f[n-1]);d.setFontSize(10),d.setFont("helvetica","bold");const j=h;d.text("Product",v[0],j),d.text("Category",v[1],j),d.text("Cost Price",v[2],j),d.text("Selling Price",v[3],j),d.text("Unit",v[4],j),d.text("Stock",v[5],j),h+=8,d.setLineWidth(.5),d.line(m,h-2,u-m,h-2),h+=3,d.setFont("helvetica","normal"),d.setFontSize(9),je.forEach(e=>{g(10);const t=e.name||"",r=e.category||"",s=`PHP ${Number(e.cost_price||0).toFixed(2)}`,i=`PHP ${Number(e.selling_price||0).toFixed(2)}`,o=(n=e).display_unit?n.display_unit:"count"===n.product_type?"pc":"weight"===n.product_type||"volume"===n.product_type?n.quantity_per_unit&&n.base_unit?`${n.quantity_per_unit} ${n.base_unit}`:n.base_unit||"pc":"pc";var n;const a=((e,t,r,s)=>{if(!e||0===e)return"0";if("count"===t||!t)return`${Math.round(e)}`;if("volume"===t&&"L"===s){const t=e/1e3;return t%1==0?t.toFixed(0):t.toFixed(2)}let i=e,o=s||"g";return"g"===s&&e>=1e3?(i=e/1e3,o="kg"):"mL"===s&&e>=1e3&&(i=e/1e3,o="L"),`${i%1==0?i.toFixed(0):i.toFixed(2)} ${o}`})(e.quantity,e.product_type,e.quantity_per_unit,e.base_unit),l=f[0]-5;let c=t;if(d.getTextWidth(c)>l){for(;d.getTextWidth(c+"...")>l&&c.length>0;)c=c.slice(0,-1);c+="..."}const u=f[1]-5;let m=r;if(d.getTextWidth(m)>u){for(;d.getTextWidth(m+"...")>u&&m.length>0;)m=m.slice(0,-1);m+="..."}d.text(c,v[0],h),d.text(m,v[1],h),d.text(s,v[2],h),d.text(i,v[3],h),d.text(o,v[4],h),d.text(a,v[5],h),h+=7}),g(10),h+=3,d.setLineWidth(.5),d.line(m,h,u-m,h),h+=5,d.setFont("helvetica","bold"),d.setFontSize(10),d.text("Total Value:",v[4],h),d.text(`PHP ${l.toFixed(2)}`,v[5],h);const k=`Inventory-Report-${(new Date).toISOString().split("T")[0]}.pdf`;d.save(k)}catch(e){console.error("Error exporting inventory PDF:",e),alert("Failed to generate inventory report. Please try again or contact support.")}finally{Q(!1)}},[je]),ze=e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-end gap-3 sm:gap-4 mb-4 sm:mb-0 w-full",children:e.jsxs("div",{className:"flex items-center justify-end gap-2 sm:gap-3 w-auto",children:[e.jsxs(l,{onClick:Ne,variant:"primary",microinteraction:!0,className:"bg-blue-600 text-md text-white font-semibold rounded-lg shadow hover:bg-blue-700 transition gap-1 sm:gap-2 flex items-center justify-center sm:justify-start !py-2 !px-2 sm:!px-2 shrink-0 min-w-[40px] sm:min-w-[40px] lg:min-w-0",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"hidden sm:block",children:"Add Product"}),e.jsx("span",{className:"sm:inline"})]}),e.jsx(l,{onClick:()=>Z(!0),variant:"secondary",disabled:ee||F,className:"text-sm flex items-center justify-center sm:justify-start gap-1 sm:gap-2 shrink-0 !py-2 !px-2 sm:!px-2 min-w-[40px] sm:min-w-[40px] lg:min-w-0",children:ee?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"hidden sm:inline",children:"Importing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("span",{className:"hidden sm:inline",children:"Import"})]})}),e.jsx(l,{onClick:Ee,variant:"secondary",disabled:Y||F,className:"text-sm flex items-center justify-center sm:justify-start gap-1 sm:gap-2 shrink-0 !py-2 !px-2 sm:!px-2 min-w-[40px] sm:min-w-[40px] lg:min-w-0",children:Y?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin w-5 h-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"hidden sm:inline",children:"Exporting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})]})})]})});return e.jsxs(r,{title:"INVENTORY",sidebar:e.jsx(s,{}),isSidebarOpen:D,headerActions:ze,setSidebarOpen:V,showHeader:!0,showNavbar:!1,showFooter:!1,children:[e.jsx(i,{products:we,allProducts:je,stats:pe,page:z,entriesPerPage:T,totalPages:ke,onPageChange:Ie,onEntriesChange:Me,search:I,onSearchChange:Be,onEdit:Ce,onDelete:Fe,onAddProduct:Ne,onStockEntry:Se,categories:_,selectedCategory:be,onCategoryFilter:e=>{_e(e),W(1)},stockFilter:fe,onStockFilter:e=>{ve(e),W(1)},sortBy:he,sortOrder:xe,onSort:(e,t)=>{ge(e),ye(t),W(1)}}),A&&!v&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-4 flex items-start gap-3 mt-4 shadow-sm",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-800 mb-1",children:A.includes("already exists")||A.includes("SKU")?"Duplicate Product":"Error"}),e.jsx("p",{className:"text-sm text-red-700",children:(()=>{try{const e=JSON.parse(A);return e.error||e.message||A}catch{return A}})()}),A.includes("already exists")&&e.jsx("p",{className:"text-xs text-red-600 mt-2 italic",children:"Please use a different SKU code or update the existing product instead."})]}),e.jsx("button",{onClick:()=>O(""),className:"flex-shrink-0 text-red-400 hover:text-red-600 transition-colors","aria-label":"Close error",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx(o,{isOpen:v,onClose:()=>{j(!1),O("")},variant:"product",title:N?"Edit Product":"Add New Product",editingProduct:N,productForm:S,onChange:Le,categories:_,onSubmit:Pe,loading:F,error:A}),e.jsx(o,{isOpen:k,onClose:()=>w(!1),title:"Stock Entry",variant:"stock",editingProduct:null,stockForm:P,onChange:e=>q({...P,[e.target.name]:e.target.value}),onSubmit:qe,loading:F}),e.jsx(o,{isOpen:H,onClose:()=>K(!1),title:"",size:"sm",children:e.jsxs("div",{className:"p-0",children:[e.jsx("div",{className:"bg-gradient-to-r from-red-50 via-red-50/80 to-orange-50/50 border-b border-red-100 px-6 py-5 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"Confirm Deletion"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Are you sure you want to delete this product?"})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:["You are about to delete:"," ",e.jsx("strong",{className:"text-red-700",children:G?.name})]}),e.jsx("p",{className:"text-sm text-gray-700 mb-6",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(l,{onClick:()=>K(!1),variant:"secondary",disabled:F,children:"Cancel"}),e.jsx(l,{onClick:$e,variant:"danger",loading:F,children:"Delete"})]})]})]})}),e.jsx(x,{isOpen:X,onClose:()=>{Z(!1),O("")},onImport:Te,loading:ee,error:A}),e.jsx(g,{isOpen:re,onClose:()=>se(!1),successCount:ie.successCount,errors:ie.errors})]})}export{y as default};
//# sourceMappingURL=Inventory-B6eid1eZ.js.map
