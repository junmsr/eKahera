{"version":3,"file":"ScannerCard-B24VW-sX.js","sources":["../../../frontend/src/components/ui/POS/ScannerCard.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from \"react\";\r\nimport Button from \"../../common/Button\";\r\nimport { Scanner } from \"@yudiel/react-qr-scanner\";\r\n\r\n/**\r\n * Scanner Card Component\r\n * Camera controls for flash and flip\r\n * Enhanced with debouncing and better barcode scanning support\r\n */\r\nfunction ScannerCard({\r\n  paused,\r\n  onResume,\r\n  textMain = \"text-blue-800\",\r\n  className = \"\",\r\n  modalContext = false,\r\n  ...props\r\n}) {\r\n  const [facingMode, setFacingMode] = useState(\"environment\");\r\n  const [error, setError] = useState(\"\");\r\n  const [isInitializing, setIsInitializing] = useState(!modalContext);\r\n  const [torchEnabled, setTorchEnabled] = useState(false);\r\n  const [isMobile, setIsMobile] = useState(false);\r\n  const [hasMultipleCameras, setHasMultipleCameras] = useState(false);\r\n  const [modalInitialized, setModalInitialized] = useState(false);\r\n  const [scanSuccess, setScanSuccess] = useState(false);\r\n  \r\n  // Debouncing refs\r\n  const lastScanRef = useRef(null);\r\n  const lastScanTimeRef = useRef(0);\r\n  const scanTimeoutRef = useRef(null);\r\n  const processingRef = useRef(false);\r\n\r\n  // Detect mobile device\r\n  useEffect(() => {\r\n    setIsMobile(\r\n      /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\r\n        navigator.userAgent\r\n      )\r\n    );\r\n  }, []);\r\n\r\n  // Check for multiple cameras\r\n  useEffect(() => {\r\n    const checkCameras = async () => {\r\n      try {\r\n        const devices = await navigator.mediaDevices.enumerateDevices();\r\n        const videoDevices = devices.filter(\r\n          (device) => device.kind === \"videoinput\"\r\n        );\r\n        setHasMultipleCameras(videoDevices.length > 1);\r\n        setIsInitializing(false);\r\n      } catch (err) {\r\n        console.error(\"Error checking cameras:\", err);\r\n        setIsInitializing(false);\r\n      }\r\n    };\r\n    checkCameras();\r\n  }, []);\r\n\r\n  // Clear scan success indicator after 1 second\r\n  useEffect(() => {\r\n    if (scanSuccess) {\r\n      const timer = setTimeout(() => setScanSuccess(false), 1000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [scanSuccess]);\r\n\r\n  // Cleanup timeouts on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (scanTimeoutRef.current) {\r\n        clearTimeout(scanTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const handleError = (err) => {\r\n    console.error(\"Camera error:\", err);\r\n    setError(\"Camera access failed. Please check permissions.\");\r\n  };\r\n\r\n  // Enhanced scan handler with debouncing\r\n  const handleScan = useCallback((result) => {\r\n    if (!result || !result[0] || !result[0].rawValue) return;\r\n    \r\n    const code = result[0].rawValue;\r\n    const now = Date.now();\r\n    \r\n    // Debounce: ignore duplicate scans within 500ms\r\n    if (code === lastScanRef.current && now - lastScanTimeRef.current < 500) {\r\n      return;\r\n    }\r\n    \r\n    // If already processing, ignore new scans\r\n    if (processingRef.current) {\r\n      return;\r\n    }\r\n    \r\n    // Clear any pending timeout\r\n    if (scanTimeoutRef.current) {\r\n      clearTimeout(scanTimeoutRef.current);\r\n    }\r\n    \r\n    // Set processing flag\r\n    processingRef.current = true;\r\n    lastScanRef.current = code;\r\n    lastScanTimeRef.current = now;\r\n    \r\n    // Show success feedback\r\n    setScanSuccess(true);\r\n    \r\n    // Call the original onScan handler\r\n    if (props.onScan) {\r\n      // Use a small delay to ensure UI feedback is visible\r\n      scanTimeoutRef.current = setTimeout(async () => {\r\n        try {\r\n          await props.onScan(result);\r\n        } catch (err) {\r\n          console.error(\"Scan handler error:\", err);\r\n        } finally {\r\n          // Reset processing flag after a delay to allow for async operations\r\n          setTimeout(() => {\r\n            processingRef.current = false;\r\n          }, 300);\r\n        }\r\n      }, 100);\r\n    } else {\r\n      processingRef.current = false;\r\n    }\r\n  }, [props.onScan]);\r\n\r\n  return (\r\n    <div\r\n      className={`flex-shrink-0 bg-white/80 backdrop-blur-md border border-white/60 shadow-xl hover:shadow-2xl transition-all duration-300 overflow-hidden ${className}`}\r\n    >\r\n      <div className=\"flex flex-col h-full p-1 sm:p-2\">\r\n        <div\r\n          className={`w-full text-center mb-1 font-bold text-xs tracking-wide ${textMain} flex items-center justify-center gap-1`}\r\n        >\r\n          <svg\r\n            className=\"w-3 h-3\"\r\n            fill=\"none\"\r\n            stroke=\"currentColor\"\r\n            viewBox=\"0 0 24 24\"\r\n          >\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              d=\"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z\"\r\n            />\r\n          </svg>\r\n          CAMERA CONTROLS\r\n        </div>\r\n        <div className=\"w-full flex-1 bg-gradient-to-br from-blue-50/80 via-indigo-50/60 to-blue-100/80 rounded-xl flex items-center justify-center border-2 border-blue-200/50 shadow-inner overflow-hidden relative z-0 group\">\r\n          {isInitializing ? (\r\n            <div className=\"flex items-center justify-center h-full text-gray-500\">\r\n              <div className=\"text-center\">\r\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2\"></div>\r\n                <p className=\"text-sm\">Initializing camera...</p>\r\n              </div>\r\n            </div>\r\n          ) : error ? (\r\n            <div className=\"flex items-center justify-center h-full text-red-500 p-4\">\r\n              <div className=\"text-center\">\r\n                <p className=\"text-sm font-medium mb-2\">Camera Error</p>\r\n                <p className=\"text-xs\">{error}</p>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              <Scanner\r\n                onScan={handleScan}\r\n                onError={handleError}\r\n                paused={paused || processingRef.current}\r\n                constraints={{\r\n                  facingMode,\r\n                  // Optimized constraints for better barcode scanning\r\n                  // Higher resolution for better barcode detection\r\n                  width: { ideal: 1920, min: 640 },\r\n                  height: { ideal: 1080, min: 480 },\r\n                  frameRate: { ideal: 30, min: 15 },\r\n                }}\r\n                torch={torchEnabled}\r\n                // Enable barcode detection formats - support common product barcodes\r\n                formats={[\r\n                  \"qr_code\", \r\n                  \"ean_13\", \r\n                  \"ean_8\", \r\n                  \"code_128\", \r\n                  \"code_39\", \r\n                  \"upc_a\", \r\n                  \"upc_e\", \r\n                  \"codabar\", \r\n                  \"itf\",\r\n                  \"code_93\",\r\n                  \"databar\",\r\n                  \"databar_expanded\"\r\n                ]}\r\n                // Lower scan delay for faster detection (100ms = 10 scans per second)\r\n                scanDelay={100}\r\n                // Allow multiple scans of the same code\r\n                allowMultiple={false}\r\n                styles={{\r\n                  container: {\r\n                    width: \"100%\",\r\n                    height: \"100%\",\r\n                    borderRadius: \"1rem\",\r\n                    overflow: \"visible\",\r\n                  },\r\n                  video: {\r\n                    width: \"100%\",\r\n                    height: \"100%\",\r\n                    objectFit: \"cover\",\r\n                    borderRadius: \"1rem\",\r\n                    backgroundColor: \"black\",\r\n                  },\r\n                }}\r\n                classNames={{ container: \"w-full h-full\" }}\r\n              />\r\n              {/* Scan success indicator */}\r\n              {scanSuccess && (\r\n                <div className=\"absolute inset-0 flex items-center justify-center bg-green-500/20 backdrop-blur-sm rounded-xl z-20 pointer-events-none\">\r\n                  <div className=\"bg-green-500 text-white rounded-full p-4 shadow-2xl animate-pulse\">\r\n                    <svg\r\n                      className=\"w-8 h-8\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={3}\r\n                        d=\"M5 13l4 4L19 7\"\r\n                      />\r\n                    </svg>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </>\r\n          )}\r\n          {!error && !isInitializing && (\r\n            <div className=\"absolute bottom-2 right-2 z-10 flex gap-2\">\r\n              {isMobile && hasMultipleCameras && (\r\n                <Button\r\n                  label={\r\n                    <svg\r\n                      className=\"w-4 h-4\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"\r\n                      />\r\n                    </svg>\r\n                  }\r\n                  size=\"sm\"\r\n                  variant=\"secondary\"\r\n                  onClick={() => {\r\n                    setFacingMode((prev) =>\r\n                      prev === \"user\" ? \"environment\" : \"user\"\r\n                    );\r\n                  }}\r\n                  microinteraction\r\n                  title={\r\n                    facingMode === \"user\"\r\n                      ? \"Switch to back camera\"\r\n                      : \"Switch to front camera\"\r\n                  }\r\n                />\r\n              )}\r\n              {isMobile && (\r\n                <Button\r\n                  label={\r\n                    <svg\r\n                      className=\"w-4 h-4\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M13 10V3L4 14h7v7l9-11h-7z\"\r\n                      />\r\n                    </svg>\r\n                  }\r\n                  size=\"sm\"\r\n                  variant=\"secondary\"\r\n                  onClick={() => setTorchEnabled(!torchEnabled)}\r\n                  microinteraction\r\n                  title={\r\n                    torchEnabled ? \"Turn off flashlight\" : \"Turn on flashlight\"\r\n                  }\r\n                />\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ScannerCard;\r\n"],"names":["ScannerCard","paused","onResume","textMain","className","modalContext","props","facingMode","setFacingMode","useState","error","setError","isInitializing","setIsInitializing","torchEnabled","setTorchEnabled","isMobile","setIsMobile","hasMultipleCameras","setHasMultipleCameras","modalInitialized","setModalInitialized","scanSuccess","setScanSuccess","lastScanRef","useRef","lastScanTimeRef","scanTimeoutRef","processingRef","useEffect","test","navigator","userAgent","async","videoDevices","mediaDevices","enumerateDevices","filter","device","kind","length","err","checkCameras","timer","setTimeout","clearTimeout","current","handleScan","useCallback","result","rawValue","code","now","Date","onScan","jsx","children","jsxs","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","Fragment","Scanner","onError","constraints","width","ideal","min","height","frameRate","torch","formats","scanDelay","allowMultiple","styles","container","borderRadius","overflow","video","objectFit","backgroundColor","classNames","Button","label","size","variant","onClick","prev","microinteraction","title"],"mappings":"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"}