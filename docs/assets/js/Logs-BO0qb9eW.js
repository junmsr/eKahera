import{j as e}from"./utils-L0j39QIW.js";import{a as s}from"./vendor-DPJ7iNYg.js";import{N as t}from"./Nav-Admin-D_8KEzuU.js";import{e as r}from"./index-BXEzUCnW.js";import{P as a}from"./PageLayout-B8S1WfrH.js";import{b as l,a as i,c as n}from"./index-C3oyeyrQ.js";import"./Logo-CwZruO2T.js";import"./BaseModal-BJkFAYW_.js";import"./Navbar-C-KCmNet.js";import"./PrivacyPolicyModal-gs4rrr-L.js";const o=()=>{const[r,o]=s.useState([]),[d,c]=s.useState(""),[m,x]=s.useState(""),[u,h]=s.useState(!1),[p,g]=s.useState(!1),[b,f]=s.useState("all"),[j,v]=s.useState("desc"),[y,w]=s.useState(!1),[N,k]=s.useState(!1),L=s.useRef(null),S=async()=>{try{h(!0),c("");const e=sessionStorage.getItem("auth_token"),s=(await i("/api/logs",{headers:n(e)})||[]).map(e=>({id:e.log_id,userId:e.user_id,username:e.username||"",action:e.action||`Action by ${e.username||e.user_id}`,time:e.date_time?new Date(e.date_time).toLocaleString():"Invalid date",dateTime:e.date_time,role:("business_owner"===e.role?"admin":e.role||"").toLowerCase()}));o(s)}catch(e){c("Failed to load logs")}finally{h(!1)}};s.useEffect(()=>{S()},[]),s.useEffect(()=>{const e=e=>{L.current&&!L.current.contains(e.target)&&w(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const C=s.useMemo(()=>{let e=r;if("all"!==b&&(e=e.filter(e=>e.role===b)),m){const s=m.toLowerCase();e=e.filter(e=>(e.action||"").toLowerCase().includes(s)||(e.username||"").toLowerCase().includes(s))}return e.sort((e,s)=>{const t=new Date(e.dateTime),r=new Date(s.dateTime);return"asc"===j?t-r:r-t}),e},[r,b,m,j]),_=()=>{try{const e=[["User ID","Username","Role","Action","Time"].join(","),...C.map(e=>[e.userId||e.id||"",`"${(e.username||"").replace(/"/g,'""')}"`,e.role||"",`"${(e.action||"").replace(/"/g,'""')}"`,`"${(e.time||"").replace(/"/g,'""')}"`].join(","))].join("\n"),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a"),r=URL.createObjectURL(s);t.setAttribute("href",r),t.setAttribute("download",`logs_export_${(new Date).toISOString().split("T")[0]}.csv`),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(e){c("Failed to export logs as CSV"),console.error("CSV export error:",e)}},I=[{value:"all",label:"All Roles"},{value:"cashier",label:"Cashier"},{value:"admin",label:"Admin"},{value:"user",label:"User"}],M=I.find(e=>e.value===b);return C.length,e.jsx(a,{title:"LOGS",sidebar:e.jsx(t,{}),isSidebarOpen:N,setSidebarOpen:k,className:"overflow-hidden",children:e.jsxs("div",{className:"h-[calc(100vh-80px)] bg-transparent p-4 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between mb-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-xl w-full flex-shrink-0",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search logs...",value:m,onChange:e=>x(e.target.value),className:"w-full pl-12 pr-4 py-3 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 placeholder-gray-400"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative",ref:L,children:[e.jsxs("button",{onClick:()=>w(!y),className:"w-full sm:w-auto pl-4 pr-10 py-3 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:M.icon}),e.jsx("span",{children:M.label})]}),e.jsx("svg",{className:"w-4 h-4 transition-transform duration-200 "+(y?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),y&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white border border-gray-200 rounded-xl shadow-lg max-h-60 overflow-auto",children:I.map(s=>e.jsxs("button",{onClick:()=>{f(s.value),w(!1)},className:"w-full px-4 py-3 text-left text-sm hover:bg-gray-50 flex items-center gap-2 transition-colors duration-150 "+(b===s.value?"bg-blue-50 text-blue-600":"text-gray-700"),children:[e.jsx("span",{children:s.icon}),e.jsx("span",{children:s.label})]},s.value))})]}),e.jsxs(l,{onClick:()=>v("asc"===j?"desc":"asc"),variant:"secondary",size:"md",className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"})}),"Sort (","asc"===j?"Oldest":"Newest",")"]}),e.jsxs(l,{onClick:_,variant:"secondary",size:"md",className:"flex items-center gap-2",disabled:0===C.length||u,children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Export as CSV"]})]})]}),e.jsx("div",{className:"hidden sm:block overflow-hidden rounded-xl border border-gray-200/50 h-[calc(100%-150px)] flex-1 min-h-0",children:e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsxs("table",{className:"w-full bg-white/80 backdrop-blur-md",children:[e.jsx("thead",{className:"bg-gray-100/90 backdrop-blur-md sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Timestamp"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200/50",children:u?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-8 text-gray-500",children:"Loading logs..."})}):0===C.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-8 text-gray-500",children:"No logs found."})}):C.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.username}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",s.userId]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+("admin"===s.role||"business_owner"===s.role?"bg-purple-100 text-purple-800":"cashier"===s.role?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:s.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-800",children:s.action}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.time})]},s.id))})]})})}),e.jsx("div",{className:"sm:hidden overflow-y-auto space-y-3 h-[calc(100%-150px)]",children:u?Array.from({length:5}).map((s,t)=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-md rounded-xl p-4 border border-gray-200/50 animate-pulse",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/4"})]}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-full mb-3"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]},t)):0===C.length?e.jsx("div",{className:"text-center py-8 text-gray-500 bg-white/80 backdrop-blur-md rounded-xl",children:"No logs found."}):C.map(s=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-md rounded-xl p-4 border border-gray-200/50 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:s.username}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",s.userId]})]}),e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full capitalize "+("admin"===s.role||"business_owner"===s.role?"bg-purple-100 text-purple-800":"cashier"===s.role?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:s.role})]}),e.jsx("p",{className:"text-sm text-gray-800 mb-2",children:s.action}),e.jsx("div",{className:"text-xs text-gray-500 text-right border-t border-gray-200/50 pt-2 mt-2",children:s.time})]},s.id))}),d&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-3 flex items-start gap-2 mt-4",children:[e.jsx("svg",{className:"w-4 h-4 text-red-500 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("p",{className:"text-sm font-medium text-red-700",children:(()=>{try{const e=JSON.parse(d);return e.error||e.message||d}catch{return d}})()})]})]})})};export{o as default};
//# sourceMappingURL=Logs-BO0qb9eW.js.map
