{"version":3,"file":"Dashboard-CUpnuhrm.js","sources":["../../../frontend/src/pages/Dashboard.jsx"],"sourcesContent":["// Dashboard.jsx — Part 1/3 (start)\r\nimport React, { useState, useEffect, useMemo, useRef } from \"react\";\r\nimport { api, authHeaders } from \"../lib/api\";\r\nimport dayjs from \"dayjs\"; \r\nimport minMax from \"dayjs/plugin/minMax\";\r\nimport html2canvas from \"html2canvas\";\r\nimport jsPDF from \"jspdf\"; \r\n\r\nimport {\r\n  LineChart,\r\n  Line,\r\n  XAxis,\r\n  YAxis,\r\n  CartesianGrid,\r\n  Tooltip,\r\n  BarChart,\r\n  Bar,\r\n  ResponsiveContainer,\r\n  Legend,\r\n} from \"recharts\";\r\n\r\nimport { useAuth } from \"../hooks/useAuth\";\r\n\r\n// Components\r\nimport PageLayout from \"../components/layout/PageLayout\";\r\nimport NavAdmin from \"../components/layout/Nav-Admin\";\r\nimport ChartCard from \"../components/ui/Dashboard/ChartCard\";\r\nimport DashboardStatsCard from \"../components/ui/Dashboard/DashboardStatsCard\";\r\nimport DashboardBusinessReport from \"../components/ui/Dashboard/DashboardBusinessReport\";\r\nimport Button from \"../components/common/Button\";\r\nimport { BiBell, BiRefresh, BiCalendarAlt } from \"react-icons/bi\";\r\nimport NotificationDropdown from \"../components/common/NotificationDropdown\";\r\nimport DateRangeFilterModal from \"../components/modals/DateRangeFilterModal\";\r\n\r\n// Extend the minMax plugin globally for this file\r\ndayjs.extend(minMax);\r\n\r\n// Constants\r\nconst BLUE_COLORS = [\"#2563eb\", \"#60a5fa\", \"#93c5fd\", \"#dbeafe\"]; // Blue shades\r\nconst SOFT_BLUE = \"#3b82f6\"; // Tailwind blue-500/600 for lines/accents\r\nconst SOFT_GREEN = \"#10b981\"; // Retain green for profit\r\nconst SOFT_PURPLE = \"#8b5cf6\"; // Retain purple/accent for pie chart variation\r\nconst TODAY_START = dayjs().startOf(\"day\");\r\nconst TODAY_END = dayjs().endOf(\"day\");\r\n\r\nfunction VisitorsChart({ data, className = \"\", rangeType = \"Custom\" }) {\r\n  const getChartTitle = (rangeType) => {\r\n    switch (rangeType) {\r\n      case \"Day\":\r\n        return \"Customer's Transactions for Today\";\r\n      case \"Week\":\r\n        return \"Customer's Transactions for 7 days\";\r\n      case \"Month\":\r\n        return \"Customer's Transactions for Month\";\r\n      case \"Custom\":\r\n      default:\r\n        return \"Customer's Transactions for the selected range\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <ChartCard\r\n      title={<span className=\"text-blue-700\">{getChartTitle(rangeType)}</span>}\r\n      className={`bg-white/80 backdrop-blur-md border border-white/60 shadow-xl ${className}`}\r\n    >\r\n      <div className=\"h-72 w-full\">\r\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n          <LineChart\r\n            data={data}\r\n            margin={{ top: 20, right: 20, left: 0, bottom: 5 }}\r\n          >\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\r\n            <XAxis dataKey=\"name\" tick={{ fill: \"#374151\", fontSize: 10 }} />\r\n            <YAxis tick={{ fill: \"#374151\", fontSize: 10 }} />\r\n            <Tooltip\r\n              contentStyle={{\r\n                background: \"#fff\",\r\n                borderColor: \"#e5e7eb\",\r\n                borderRadius: 8,\r\n              }}\r\n            />\r\n            <Line\r\n              type=\"monotone\"\r\n              dataKey=\"value\"\r\n              stroke={SOFT_BLUE}\r\n              strokeWidth={3}\r\n              dot={{ r: 5, fill: SOFT_BLUE }}\r\n              isAnimationActive={false}\r\n            />\r\n          </LineChart>\r\n        </ResponsiveContainer>\r\n      </div>\r\n    </ChartCard>\r\n  );\r\n}\r\n\r\nfunction SalesPieChart({ data, className = \"\" }) {\r\n  return (\r\n    <ChartCard\r\n      title={<span className=\"text-blue-700\">Sales by Product Category</span>}\r\n      className={`bg-white/80 backdrop-blur-md border border-white/60 shadow-xl ${className}`}\r\n    >\r\n      <div className=\"h-72 w-full\">\r\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n          <BarChart\r\n            data={data}\r\n            margin={{ top: 20, right: 20, left: 0, bottom: 5 }}\r\n          >\r\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\r\n            <XAxis\r\n              dataKey=\"name\"\r\n              tick={{ fill: \"#374151\", fontSize: 12 }}\r\n              interval={0}\r\n              angle={-20}\r\n              textAnchor=\"end\"\r\n              height={60}\r\n            />\r\n            <YAxis tick={{ fill: \"#374151\", fontSize: 12 }} />\r\n            <Tooltip\r\n              formatter={(value, name, props) => [\r\n                Number(value).toLocaleString(),\r\n                props?.payload?.name,\r\n              ]}\r\n              contentStyle={{\r\n                background: \"#fafafa\",\r\n                borderColor: SOFT_PURPLE,\r\n                borderRadius: 8,\r\n              }}\r\n            />\r\n            <Legend />\r\n            <Bar dataKey=\"value\" fill={SOFT_BLUE} radius={[8, 8, 0, 0]} isAnimationActive={false} />\r\n          </BarChart>\r\n        </ResponsiveContainer>\r\n      </div>\r\n    </ChartCard>\r\n  );\r\n}\r\n\r\n// Main Dashboard Component\r\nexport default function Dashboard() {\r\n  const [keyMetrics, setKeyMetrics] = useState({\r\n    revenue: 0,\r\n    expenses: 0,\r\n    netProfit: 0,\r\n    grossMargin: 0,\r\n    totalTransactions: 0,\r\n    totalItemsSold: 0,\r\n    averageTransactionValue: 0,\r\n  });\r\n\r\n  // State\r\n  const [stats, setStats] = useState([]);\r\n  const [dateRange, setDateRange] = useState({\r\n    startDate: dayjs().startOf(\"month\"),\r\n    endDate: dayjs().endOf(\"day\"),\r\n    rangeType: \"Month\",\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n  const [chartData, setChartData] = useState([]);\r\n  const [pieData, setPieData] = useState([]);\r\n  const [lowStockProducts, setLowStockProducts] = useState([]);\r\n  const [showFilterModal, setShowFilterModal] = useState(false);\r\n  const [notifications, setNotifications] = useState([]);\r\n  const [unreadCount, setUnreadCount] = useState(0);\r\n  const [showNotifications, setShowNotifications] = useState(false);\r\n  const notificationRef = React.useRef(null);\r\n  const { logout } = useAuth();\r\n  const [isSidebarOpen, setSidebarOpen] = useState(false);\r\n  const [todayHighlight, setTodayHighlight] = useState({\r\n    sales: 0,\r\n    transactions: 0,\r\n    topProduct: \"-\",\r\n    totalItemsSold: 0,\r\n    averageTransactionValue: 0,\r\n  });\r\n  const [exportingPDF, setExportingPDF] = useState(false);\r\n  const [exportingSales, setExportingSales] = useState(false);\r\n  const [currentTime, setCurrentTime] = useState(dayjs());\r\n  const [topProducts, setTopProducts] = useState([]);\r\n  const [paymentMethods, setPaymentMethods] = useState([]);\r\n\r\n  // Refs for PDF export\r\n  const dashboardRef = useRef(null);\r\n  const visitorsChartRef = useRef(null);\r\n  const pieChartRef = useRef(null);\r\n  const keyMetricsRef = useRef(null);\r\n  const businessReportRef = useRef(null);\r\n\r\n  // Optimized timer: only update when page is visible and reduce frequency to every 10 seconds\r\n  useEffect(() => {\r\n    let timer;\r\n    const updateTime = () => {\r\n      if (document.visibilityState === 'visible') {\r\n        setCurrentTime(dayjs());\r\n      }\r\n    };\r\n    \r\n    // Update immediately\r\n    updateTime();\r\n    \r\n    // Update every 10 seconds (instead of every second) and only when visible\r\n    timer = setInterval(updateTime, 10000);\r\n    \r\n    // Also update when page becomes visible\r\n    const handleVisibilityChange = () => {\r\n      if (document.visibilityState === 'visible') {\r\n        updateTime();\r\n      }\r\n    };\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    \r\n    return () => {\r\n      clearInterval(timer);\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n    };\r\n  }, []);\r\n\r\n  // Helper function to detect modern CSS color functions\r\n  const hasModernColor = (val = \"\") => {\r\n    if (!val) return false;\r\n    const lower = val.toLowerCase();\r\n    return (\r\n      lower.includes(\"oklab\") ||\r\n      lower.includes(\"oklch\") ||\r\n      lower.includes(\"color(\") ||\r\n      lower.includes(\"color-mix\") ||\r\n      lower.includes(\"lab(\") ||\r\n      lower.includes(\"lch(\") ||\r\n      lower.includes(\"hwb(\")\r\n    );\r\n  };\r\n\r\n  // Normalize any CSS color string to a safe RGB/HEX; returns fallback when unsupported\r\n  const normalizeToRGB = (() => {\r\n    const canvas = document.createElement(\"canvas\");\r\n    const ctx = canvas.getContext(\"2d\");\r\n    return (value, fallback = \"#ffffff\") => {\r\n      if (!value) return fallback;\r\n      try {\r\n        ctx.fillStyle = value;\r\n        return ctx.fillStyle || fallback;\r\n      } catch (_) {\r\n        return fallback;\r\n      }\r\n    };\r\n  })();\r\n\r\n  // Fetch Today's data (independent of the main filter)\r\n  useEffect(() => {\r\n    const fetchTodayData = async () => {\r\n      try {\r\n        const token = sessionStorage.getItem(\"auth_token\");\r\n        const todayStr = dayjs().format(\"YYYY-MM-DD\");\r\n\r\n        const overview = await api(\"/api/dashboard/overview\", {\r\n          headers: authHeaders(token),\r\n          params: { startDate: todayStr, endDate: todayStr },\r\n        });\r\n\r\n        if (overview) {\r\n          setTodayHighlight({\r\n            sales: overview.totalSales || 0,\r\n            transactions: overview.totalTransactions || 0,\r\n            totalItemsSold: overview.totalItemsSold || 0,\r\n            averageTransactionValue: overview.averageTransactionValue || 0,\r\n            topProduct: overview.topProducts?.[0]?.product_name || \"-\",\r\n          });\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Failed to fetch today's data\", err);\r\n      }\r\n    };\r\n    fetchTodayData();\r\n  }, []);\r\n// Dashboard.jsx — Part 2/3 (middle)\r\n  const user = useMemo(() => {\r\n    try {\r\n      return JSON.parse(sessionStorage.getItem(\"user\") || \"{}\");\r\n    } catch (e) {\r\n      return {};\r\n    }\r\n  }, []);\r\n\r\n  // Close notification dropdown on outside click\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (\r\n        notificationRef.current &&\r\n        !notificationRef.current.contains(event.target)\r\n      ) {\r\n        setShowNotifications(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  // Data fetching\r\n  const fetchData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n\r\n      const { startDate, endDate, rangeType } = dateRange;\r\n\r\n      const formatDate = (date) => dayjs(date).format(\"YYYY-MM-DD\");\r\n\r\n      const finalStart = dayjs.min(startDate, endDate);\r\n      const finalEnd = dayjs.max(startDate, endDate);\r\n\r\n      const startDateStr = formatDate(finalStart);\r\n      const endDateStr = formatDate(finalEnd);\r\n\r\n      console.log(\"Fetching data for date range:\", {\r\n        rangeType,\r\n        formattedStart: startDateStr,\r\n        formattedEnd: endDateStr,\r\n      });\r\n\r\n      const [overview, timeseries, pie, oldLowStock, paymentMethodsData] = await Promise.all([\r\n        api(\"/api/dashboard/overview\", {\r\n          headers: authHeaders(token),\r\n          params: {\r\n            startDate: startDateStr,\r\n            endDate: endDateStr,\r\n          },\r\n        }),\r\n        api(`/api/stats/customers-timeseries`, {\r\n          headers: authHeaders(token),\r\n          params: {\r\n            startDate: startDateStr,\r\n            endDate: endDateStr,\r\n          },\r\n        }),\r\n        api(\"/api/stats/sales-by-category\", {\r\n          headers: authHeaders(token),\r\n          params: {\r\n            startDate: startDateStr,\r\n            endDate: endDateStr,\r\n          },\r\n        }),\r\n        api(\"/api/products/low-stock\", { headers: authHeaders(token) }),\r\n        api(\"/api/stats/payment-methods\", {\r\n          headers: authHeaders(token),\r\n          params: {\r\n            startDate: startDateStr,\r\n            endDate: endDateStr,\r\n          },\r\n        }),\r\n      ]);\r\n\r\n      const derived = (timeseries || []).map((d) => ({\r\n        ...d,\r\n        name: d.date || d.name,\r\n        value: Number(d.customers || d.total || d.value || 0),\r\n      }));\r\n\r\n      const pieTotal =\r\n        (pie || []).reduce((s, p) => s + Number(p.value || 0), 0) || 1;\r\n      const piePercent = (pie || []).map((p) => ({\r\n        ...p,\r\n        percent: (Number(p.value || 0) / pieTotal) * 100,\r\n      }));\r\n\r\n      if (overview) {\r\n        const revenue = Number(overview.totalSales || 0);\r\n        const expenses = Number(overview.totalExpenses || 0);\r\n        const netProfit = revenue - expenses;\r\n        const grossMargin =\r\n          revenue > 0 ? ((revenue - expenses) / revenue) * 100 : 0;\r\n        const totalTransactions = Number(overview.totalTransactions || 0);\r\n        const totalItemsSold = Number(overview.totalItemsSold || 0);\r\n        const avgTxValue = Number(\r\n          overview.averageTransactionValue || revenue / (totalTransactions || 1)\r\n        );\r\n        const topProduct = overview.topProducts?.[0]?.product_name || \"-\";\r\n\r\n        setKeyMetrics({\r\n          revenue,\r\n          expenses,\r\n          netProfit,\r\n          grossMargin,\r\n          totalTransactions,\r\n          totalItemsSold,\r\n          averageTransactionValue: avgTxValue,\r\n        });\r\n\r\n        const dateRangeText =\r\n          rangeType === \"Day\"\r\n            ? finalStart.format(\"MMM D, YYYY\")\r\n            : `${finalStart.format(\"MMM D\")} - ${finalEnd.format(\r\n                \"MMM D, YYYY\"\r\n              )}`;\r\n\r\n        const salesLabel =\r\n          rangeType === \"Day\"\r\n            ? \"Daily Sales\"\r\n            : rangeType === \"Week\"\r\n            ? \"7-Day Sales\"\r\n            : rangeType === \"Month\"\r\n            ? \"Monthly Sales\"\r\n            : \"Total Sales\";\r\n        const transactionsLabel =\r\n          rangeType === \"Day\"\r\n            ? \"Daily Transactions\"\r\n            : rangeType === \"Week\"\r\n            ? \"7-Day Transactions\"\r\n            : rangeType === \"Month\"\r\n            ? \"Monthly Transactions\"\r\n            : \"Total Transactions\";\r\n\r\n        setStats([\r\n          {\r\n            label: salesLabel,\r\n            value: `₱${revenue.toLocaleString(undefined, {\r\n              minimumFractionDigits: 2,\r\n              maximumFractionDigits: 2,\r\n            })}`,\r\n            subtext: dateRangeText,\r\n          },\r\n          {\r\n            label: transactionsLabel,\r\n            value: totalTransactions,\r\n            subtext: `${dateRangeText}`,\r\n          },\r\n          {\r\n            label: \"Top Product\",\r\n            value: topProduct,\r\n            subtext: `Total: ${\r\n              overview.topProducts?.[0]?.total_sold || 0\r\n            } sold`,\r\n          },\r\n          {\r\n            label: \"Items Sold\",\r\n            value: totalItemsSold,\r\n            subtext: `${totalTransactions} transactions`,\r\n          },\r\n        ]);\r\n      }\r\n\r\n      setChartData(derived);\r\n      setPieData(piePercent);\r\n\r\n      const lowStock = oldLowStock || [];\r\n      setLowStockProducts(lowStock);\r\n\r\n      // Set top products and payment methods for business report\r\n      if (overview && overview.topProducts) {\r\n        setTopProducts(overview.topProducts || []);\r\n      }\r\n      setPaymentMethods(paymentMethodsData || []);\r\n    } catch (err) {\r\n      console.error(\"Failed to fetch dashboard data\", err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchNotifications = async () => {\r\n    try {\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n      const resp = await api(\"/api/logs\", { headers: authHeaders(token) });\r\n      const readIds = new Set(\r\n        JSON.parse(sessionStorage.getItem(\"read_notif_ids\") || \"[]\")\r\n      );\r\n      const deletedIds = new Set(\r\n        JSON.parse(sessionStorage.getItem(\"deleted_notif_ids\") || \"[]\")\r\n      );\r\n      const mapped = (resp || [])\r\n        .filter((log) => !deletedIds.has(log.log_id))\r\n        .map((log) => ({\r\n          id: log.log_id,\r\n          title: log.action,\r\n          message: `${log.username} (${log.role}) did an action: ${log.action}`,\r\n          time: dayjs(log.date_time).format(\"MMM D, h:mm A\"),\r\n          isRead: readIds.has(log.log_id),\r\n        }));\r\n      setNotifications(mapped);\r\n      setUnreadCount(mapped.filter((n) => !n.isRead).length);\r\n    } catch (e) {\r\n      console.error(\"Failed to fetch notifications\", e);\r\n    }\r\n  };\r\n\r\n  const handleMarkAsRead = (id) => {\r\n    const readIds = JSON.parse(\r\n      sessionStorage.getItem(\"read_notif_ids\") || \"[]\"\r\n    );\r\n    if (!readIds.includes(id)) {\r\n      sessionStorage.setItem(\r\n        \"read_notif_ids\",\r\n        JSON.stringify([...readIds, id])\r\n      );\r\n    }\r\n    setNotifications((notifs) =>\r\n      notifs.map((n) => (n.id === id ? { ...n, isRead: true } : n))\r\n    );\r\n    setUnreadCount((c) => Math.max(0, c - 1));\r\n  };\r\n\r\n  const handleDeleteNotification = (id) => {\r\n    const deletedIds = JSON.parse(\r\n      sessionStorage.getItem(\"deleted_notif_ids\") || \"[]\"\r\n    );\r\n    sessionStorage.setItem(\r\n      \"deleted_notif_ids\",\r\n      JSON.stringify([...deletedIds, id])\r\n    );\r\n    setNotifications((notifs) => notifs.filter((n) => n.id !== id));\r\n    const notif = notifications.find((n) => n.id === id);\r\n    if (notif && !notif.isRead) {\r\n      setUnreadCount((c) => Math.max(0, c - 1));\r\n    }\r\n  };\r\n\r\n  const handleMarkAsUnread = (id) => {\r\n    const readIds = JSON.parse(\r\n      sessionStorage.getItem(\"read_notif_ids\") || \"[]\"\r\n    );\r\n    const filtered = readIds.filter((rid) => rid !== id);\r\n    sessionStorage.setItem(\"read_notif_ids\", JSON.stringify(filtered));\r\n    setNotifications((notifs) =>\r\n      notifs.map((n) => (n.id === id ? { ...n, isRead: false } : n))\r\n    );\r\n    setUnreadCount((c) => c + 1);\r\n  };\r\n\r\n  // Robust captureElement that clones and copies computed styles safely (forces RGB colors and strips unsupported effects)\r\n  const captureElement = async (element) => {\r\n    if (!element) return null;\r\n\r\n    const normalizeColor = (() => {\r\n      const canvas = document.createElement(\"canvas\");\r\n      const ctx = canvas.getContext(\"2d\");\r\n      return (value, fallback = \"#ffffff\") => {\r\n        if (!value) return fallback;\r\n        try {\r\n          ctx.fillStyle = value;\r\n          return ctx.fillStyle || fallback;\r\n        } catch (_) {\r\n          return fallback;\r\n        }\r\n      };\r\n    })();\r\n\r\n    // Using the top-level hasModernColor function\r\n\r\n    const shouldStripBackgroundImage = (value) => {\r\n      if (!value || value === \"none\") return false;\r\n      const lower = value.toLowerCase();\r\n      return (\r\n        lower.includes(\"gradient\") ||\r\n        lower.includes(\"image-set\") ||\r\n        hasModernColor(lower)\r\n      );\r\n    };\r\n\r\n    const stripProps = new Set([\r\n      \"box-shadow\",\r\n      \"filter\",\r\n      \"backdrop-filter\",\r\n      \"mix-blend-mode\",\r\n      \"text-shadow\",\r\n    ]);\r\n\r\n    const colorProps = new Set([\r\n      \"color\",\r\n      \"background-color\",\r\n      \"border-color\",\r\n      \"outline-color\",\r\n      \"text-decoration-color\",\r\n      \"column-rule-color\",\r\n      \"caret-color\",\r\n      \"accent-color\",\r\n      \"fill\",\r\n      \"stroke\",\r\n    ]);\r\n\r\n    const copyComputedStyles = (source, target) => {\r\n      const computed = window.getComputedStyle(source);\r\n\r\n      for (const prop of computed) {\r\n        if (prop.startsWith(\"--\")) continue; // drop CSS variables that may carry modern colors\r\n        if (prop === \"background-image\" || prop === \"background\" || prop === \"border-image\") continue;\r\n\r\n        let value = computed.getPropertyValue(prop);\r\n        const priority = computed.getPropertyPriority(prop);\r\n\r\n        if (hasModernColor(value) && !colorProps.has(prop)) {\r\n          continue; // skip unsupported color functions on non-color props\r\n        }\r\n\r\n        if (colorProps.has(prop)) {\r\n          value = normalizeColor(value, value);\r\n        }\r\n\r\n        if (stripProps.has(prop)) {\r\n          value = prop === \"mix-blend-mode\" ? \"normal\" : \"none\";\r\n        }\r\n\r\n        target.style.setProperty(prop, value, priority);\r\n      }\r\n\r\n      // Force safe backgrounds and borders\r\n      target.style.backgroundColor = normalizeColor(computed.getPropertyValue(\"background-color\"), \"#ffffff\");\r\n      target.style.backgroundImage = \"none\";\r\n      target.style.background = normalizeColor(computed.getPropertyValue(\"background-color\"), \"#ffffff\");\r\n      target.style.borderColor = normalizeColor(computed.getPropertyValue(\"border-color\"), \"transparent\");\r\n      target.style.boxShadow = \"none\";\r\n      target.style.filter = \"none\";\r\n      target.style.mixBlendMode = \"normal\";\r\n      target.style.textShadow = \"none\";\r\n\r\n      const rect = source.getBoundingClientRect();\r\n      target.style.width = `${rect.width}px`;\r\n      target.style.height = `${rect.height}px`;\r\n      target.style.boxSizing = computed.getPropertyValue(\"box-sizing\") || \"border-box\";\r\n    };\r\n\r\n    const clone = element.cloneNode(true);\r\n\r\n    const origNodes = [element, ...Array.from(element.querySelectorAll(\"*\"))];\r\n    const cloneNodes = [clone, ...Array.from(clone.querySelectorAll(\"*\"))];\r\n    const len = Math.min(origNodes.length, cloneNodes.length);\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      try {\r\n        copyComputedStyles(origNodes[i], cloneNodes[i]);\r\n      } catch {\r\n        // Best-effort; skip nodes that fail style copying\r\n      }\r\n    }\r\n\r\n    // Sanitize SVG/HTML attributes that may carry modern color functions\r\n    const sanitizeAttributes = (node) => {\r\n      if (!(node instanceof Element)) return;\r\n      const attrs = Array.from(node.attributes || []);\r\n      for (const attr of attrs) {\r\n        const name = attr.name;\r\n        const value = attr.value || \"\";\r\n        if (hasModernColor(value)) {\r\n          if (\r\n            name === \"fill\" ||\r\n            name === \"stroke\" ||\r\n            name === \"stop-color\" ||\r\n            name === \"color\"\r\n          ) {\r\n            node.setAttribute(name, normalizeColor(value, \"#000000\"));\r\n          } else {\r\n            node.removeAttribute(name);\r\n          }\r\n        }\r\n        if (name === \"style\" && hasModernColor(value)) {\r\n          node.removeAttribute(\"style\");\r\n        }\r\n      }\r\n      // For SVG gradients/defs, disable by forcing fill/stroke to currentColor\r\n      if (node.tagName === \"linearGradient\" || node.tagName === \"radialGradient\") {\r\n        node.parentNode && node.parentNode.removeChild(node);\r\n      }\r\n      if (node.tagName === \"stop\" && node.hasAttribute(\"stop-color\")) {\r\n        node.setAttribute(\r\n          \"stop-color\",\r\n          normalizeColor(node.getAttribute(\"stop-color\"), \"#000000\")\r\n        );\r\n      }\r\n    };\r\n\r\n    clone.querySelectorAll(\"*\").forEach(sanitizeAttributes);\r\n    sanitizeAttributes(clone);\r\n\r\n    const sandbox = document.createElement(\"div\");\r\n    sandbox.style.position = \"absolute\";\r\n    sandbox.style.left = \"-9999px\";\r\n    sandbox.style.top = \"0\";\r\n    sandbox.style.zIndex = \"-9999\";\r\n    sandbox.style.background = normalizeColor(\r\n      window.getComputedStyle(element).backgroundColor,\r\n      \"#ffffff\"\r\n    );\r\n    sandbox.appendChild(clone);\r\n    document.body.appendChild(sandbox);\r\n\r\n    await new Promise((resolve) => setTimeout(resolve, 50));\r\n\r\n    const canvas = await html2canvas(clone, {\r\n      useCORS: true,\r\n      scale: 2,\r\n      backgroundColor: \"#ffffff\",\r\n      allowTaint: true,\r\n    });\r\n\r\n    document.body.removeChild(sandbox);\r\n\r\n    return canvas.toDataURL(\"image/png\");\r\n  };\r\n\r\n  const exportSalesToPDF = async () => {\r\n    setExportingSales(true);\r\n    try {\r\n      const token = sessionStorage.getItem(\"auth_token\");\r\n      const { startDate, endDate, rangeType } = dateRange;\r\n\r\n      const formatDate = (date) => dayjs(date).format(\"YYYY-MM-DD\");\r\n      const finalStart = dayjs.min(startDate, endDate);\r\n      const finalEnd = dayjs.max(startDate, endDate);\r\n      const startDateStr = formatDate(finalStart);\r\n      const endDateStr = formatDate(finalEnd);\r\n\r\n      // Fetch comprehensive sales data\r\n      const reportData = await api(\"/api/dashboard/sales-data\", {\r\n        headers: authHeaders(token),\r\n        params: {\r\n          startDate: startDateStr,\r\n          endDate: endDateStr,\r\n        },\r\n      });\r\n\r\n      // Log for debugging\r\n      console.log(\"Sales report data received:\", reportData);\r\n\r\n      // Fetch store information\r\n      const profileData = await api(\"/auth/profile\", {\r\n        headers: authHeaders(token),\r\n      });\r\n\r\n      const business = profileData?.business || {};\r\n      const businessName = business.business_name || \"Business\";\r\n      const storeName = business.business_name || \"Store\";\r\n      const addressParts = [\r\n        business.house_number,\r\n        business.barangay,\r\n        business.city,\r\n        business.province,\r\n      ].filter(Boolean);\r\n      const address = addressParts.join(\", \") || \"N/A\";\r\n\r\n      // Format date range text\r\n      const dateRangeText =\r\n        rangeType === \"Day\"\r\n          ? finalStart.format(\"MMM D, YYYY\")\r\n          : `${finalStart.format(\"MMM D\")} - ${finalEnd.format(\"MMM D, YYYY\")}`;\r\n\r\n      // Check if there's any sales data\r\n      if (!reportData || !reportData.salesByProduct || reportData.salesByProduct.length === 0) {\r\n        alert(\"No sales data found for the selected date range.\");\r\n        return;\r\n      }\r\n\r\n      // Extract data from response\r\n      const {\r\n        salesByProduct = [],\r\n        summary = {},\r\n        paymentMethods = [],\r\n        bestSellingProducts = [],\r\n        salesByCategory = [],\r\n        transactions = []\r\n      } = reportData;\r\n\r\n      // Create PDF\r\n      const pdf = new jsPDF(\"p\", \"mm\", \"a4\");\r\n      const pageWidth = pdf.internal.pageSize.getWidth();\r\n      const pageHeight = pdf.internal.pageSize.getHeight();\r\n      const margin = 15;\r\n      const contentWidth = pageWidth - 2 * margin;\r\n      let yPos = margin;\r\n      let pageNumber = 1;\r\n\r\n      // Helper function to add a new page if needed\r\n      const checkPageBreak = (requiredHeight) => {\r\n        if (yPos + requiredHeight > pageHeight - margin - 10) {\r\n          // Add footer before new page\r\n          addFooter();\r\n          pdf.addPage();\r\n          pageNumber++;\r\n          yPos = margin;\r\n          return true;\r\n        }\r\n        return false;\r\n      };\r\n\r\n      // Helper function to add footer\r\n      const addFooter = () => {\r\n        const footerY = pageHeight - 8;\r\n        pdf.setFontSize(8);\r\n        pdf.setFont(\"helvetica\", \"normal\");\r\n        pdf.setTextColor(128, 128, 128);\r\n        pdf.text(\r\n          `Page ${pageNumber} | Generated by eKahera POS System | ${dayjs().format(\"MMM D, YYYY h:mm A\")}`,\r\n          pageWidth / 2,\r\n          footerY,\r\n          { align: \"center\" }\r\n        );\r\n        pdf.text(\r\n          \"System-generated report. This is an automated document.\",\r\n          pageWidth / 2,\r\n          footerY + 4,\r\n          { align: \"center\" }\r\n        );\r\n        pdf.setTextColor(0, 0, 0);\r\n      };\r\n\r\n      // Helper function to format currency\r\n      const formatCurrency = (amount) => {\r\n        return `PHP ${Number(amount || 0).toFixed(2)}`;\r\n      };\r\n\r\n      // Helper function to add section title\r\n      const addSectionTitle = (title, fontSize = 12) => {\r\n        checkPageBreak(15);\r\n        yPos += 5;\r\n        pdf.setFontSize(fontSize);\r\n        pdf.setFont(\"helvetica\", \"bold\");\r\n        pdf.text(title, margin, yPos);\r\n        yPos += 8;\r\n      };\r\n\r\n      // Helper function to add subsection title\r\n      const addSubsectionTitle = (title) => {\r\n        checkPageBreak(12);\r\n        yPos += 3;\r\n        pdf.setFontSize(10);\r\n        pdf.setFont(\"helvetica\", \"bold\");\r\n        pdf.text(title, margin, yPos);\r\n        yPos += 6;\r\n      };\r\n\r\n      // ============================================\r\n      // 1. REPORT HEADER\r\n      // ============================================\r\n      pdf.setFontSize(18);\r\n      pdf.setFont(\"helvetica\", \"bold\");\r\n      const businessNameWidth = pdf.getTextWidth(businessName);\r\n      pdf.text(businessName, (pageWidth - businessNameWidth) / 2, yPos);\r\n      yPos += 8;\r\n\r\n      pdf.setFontSize(11);\r\n      pdf.setFont(\"helvetica\", \"normal\");\r\n      if (storeName !== businessName) {\r\n        const storeNameWidth = pdf.getTextWidth(`Store/Branch: ${storeName}`);\r\n        pdf.text(`Store/Branch: ${storeName}`, (pageWidth - storeNameWidth) / 2, yPos);\r\n        yPos += 6;\r\n      }\r\n\r\n      pdf.setFontSize(10);\r\n      pdf.setTextColor(100, 100, 100);\r\n      const addressWidth = pdf.getTextWidth(address);\r\n      pdf.text(address, (pageWidth - addressWidth) / 2, yPos);\r\n      yPos += 8;\r\n\r\n      // Report type and date range\r\n      pdf.setFontSize(12);\r\n      pdf.setFont(\"helvetica\", \"bold\");\r\n      pdf.setTextColor(0, 0, 0);\r\n      const reportTypeText = `${rangeType} Sales Report`;\r\n      const reportTypeWidth = pdf.getTextWidth(reportTypeText);\r\n      pdf.text(reportTypeText, (pageWidth - reportTypeWidth) / 2, yPos);\r\n      yPos += 6;\r\n\r\n      pdf.setFontSize(10);\r\n      pdf.setFont(\"helvetica\", \"normal\");\r\n      const dateRangeWidth = pdf.getTextWidth(`Date Range: ${dateRangeText}`);\r\n      pdf.text(`Date Range: ${dateRangeText}`, (pageWidth - dateRangeWidth) / 2, yPos);\r\n      yPos += 5;\r\n\r\n      pdf.setFontSize(9);\r\n      pdf.setTextColor(100, 100, 100);\r\n      const generatedText = `Generated: ${dayjs().format(\"MMM D, YYYY h:mm A\")}`;\r\n      const generatedWidth = pdf.getTextWidth(generatedText);\r\n      pdf.text(generatedText, (pageWidth - generatedWidth) / 2, yPos);\r\n      yPos += 4;\r\n\r\n      const systemText = \"System: eKahera POS\";\r\n      const systemWidth = pdf.getTextWidth(systemText);\r\n      pdf.text(systemText, (pageWidth - systemWidth) / 2, yPos);\r\n      yPos += 10;\r\n\r\n      // Draw separator line\r\n      pdf.setLineWidth(0.5);\r\n      pdf.setDrawColor(200, 200, 200);\r\n      pdf.line(margin, yPos, pageWidth - margin, yPos);\r\n      yPos += 8;\r\n\r\n      // ============================================\r\n      // 2. SALES SUMMARY (TOP SECTION)\r\n      // ============================================\r\n      addSectionTitle(\"SALES SUMMARY\", 14);\r\n\r\n      const summaryData = [\r\n        [\"Total Sales (Net)\", formatCurrency(summary.net_sales || 0)],\r\n        [\"Gross Sales\", formatCurrency(summary.gross_sales || 0)],\r\n        [\"Total Transactions\", String(summary.total_transactions || 0)],\r\n        [\"Total Items Sold\", String(summary.total_items_sold || 0)],\r\n        [\"Total Discounts\", formatCurrency(summary.total_discounts || 0)],\r\n        [\"Average Transaction Value\", formatCurrency(summary.average_transaction_value || 0)],\r\n      ];\r\n\r\n      pdf.setFontSize(9);\r\n      pdf.setFont(\"helvetica\", \"normal\");\r\n      pdf.setTextColor(0, 0, 0);\r\n\r\n      const summaryCol1 = margin;\r\n      const summaryCol2 = pageWidth - margin - 60;\r\n\r\n      summaryData.forEach(([label, value]) => {\r\n        checkPageBreak(8);\r\n        pdf.setFont(\"helvetica\", \"normal\");\r\n        pdf.text(label + \":\", summaryCol1, yPos);\r\n        pdf.setFont(\"helvetica\", \"bold\");\r\n        pdf.text(value, summaryCol2, yPos);\r\n        yPos += 7;\r\n      });\r\n\r\n      yPos += 5;\r\n\r\n      // ============================================\r\n      // 3. PAYMENT METHOD BREAKDOWN\r\n      // ============================================\r\n      addSectionTitle(\"PAYMENT METHOD BREAKDOWN\", 14);\r\n\r\n      if (paymentMethods.length > 0) {\r\n        checkPageBreak(15);\r\n        pdf.setFontSize(9);\r\n        pdf.setFont(\"helvetica\", \"bold\");\r\n        pdf.text(\"Payment Method\", margin, yPos);\r\n        pdf.text(\"Total Amount\", pageWidth - margin - 50, yPos);\r\n        yPos += 6;\r\n\r\n        pdf.setLineWidth(0.3);\r\n        pdf.line(margin, yPos - 2, pageWidth - margin, yPos - 2);\r\n        yPos += 4;\r\n\r\n        pdf.setFont(\"helvetica\", \"normal\");\r\n        paymentMethods.forEach((pm) => {\r\n          checkPageBreak(8);\r\n          const methodName = pm.payment_type || \"Unknown\";\r\n          const amount = formatCurrency(pm.total_amount || 0);\r\n          pdf.text(methodName, margin + 5, yPos);\r\n          pdf.setFont(\"helvetica\", \"bold\");\r\n          pdf.text(amount, pageWidth - margin - 50, yPos);\r\n          pdf.setFont(\"helvetica\", \"normal\");\r\n          yPos += 6;\r\n        });\r\n\r\n        // Total\r\n        checkPageBreak(8);\r\n        yPos += 2;\r\n        pdf.setLineWidth(0.3);\r\n        pdf.line(margin, yPos, pageWidth - margin, yPos);\r\n        yPos += 5;\r\n        pdf.setFont(\"helvetica\", \"bold\");\r\n        const paymentTotal = paymentMethods.reduce((sum, pm) => sum + (pm.total_amount || 0), 0);\r\n        pdf.text(\"Total:\", margin + 5, yPos);\r\n        pdf.text(formatCurrency(paymentTotal), pageWidth - margin - 50, yPos);\r\n        yPos += 8;\r\n      } else {\r\n        pdf.setFontSize(9);\r\n        pdf.setTextColor(150, 150, 150);\r\n        pdf.text(\"No payment method data available\", margin, yPos);\r\n        yPos += 8;\r\n        pdf.setTextColor(0, 0, 0);\r\n      }\r\n\r\n      // ============================================\r\n      // 4. SALES BY PRODUCT TABLE\r\n      // ============================================\r\n      addSectionTitle(\"SALES BY PRODUCT\", 14);\r\n\r\n      if (salesByProduct.length > 0) {\r\n        checkPageBreak(20);\r\n        // Table header\r\n        pdf.setFontSize(8);\r\n        pdf.setFont(\"helvetica\", \"bold\");\r\n        const productColWidths = [\r\n          contentWidth * 0.20, // Product Name\r\n          contentWidth * 0.15, // SKU\r\n          contentWidth * 0.15, // Category\r\n          contentWidth * 0.12, // Quantity\r\n          contentWidth * 0.15, // Price\r\n          contentWidth * 0.23, // Total Sales\r\n        ];\r\n        const productColX = [margin];\r\n        for (let i = 1; i < productColWidths.length; i++) {\r\n          productColX.push(productColX[i - 1] + productColWidths[i - 1]);\r\n        }\r\n\r\n        pdf.text(\"Product Name\", productColX[0], yPos);\r\n        pdf.text(\"SKU\", productColX[1], yPos);\r\n        pdf.text(\"Category\", productColX[2], yPos);\r\n        pdf.text(\"Qty Sold\", productColX[3], yPos);\r\n        pdf.text(\"Price\", productColX[4], yPos);\r\n        pdf.text(\"Total Sales\", productColX[5], yPos);\r\n        yPos += 5;\r\n\r\n        pdf.setLineWidth(0.5);\r\n        pdf.line(margin, yPos - 2, pageWidth - margin, yPos - 2);\r\n        yPos += 4;\r\n\r\n        // Table rows\r\n        pdf.setFont(\"helvetica\", \"normal\");\r\n        pdf.setFontSize(7);\r\n\r\n        salesByProduct.forEach((product) => {\r\n          checkPageBreak(8);\r\n          const name = (product.product_name || \"\").substring(0, 20);\r\n          const sku = (product.sku || \"N/A\").substring(0, 12);\r\n          const category = (product.category || \"N/A\").substring(0, 12);\r\n          const qty = Number(product.quantity_sold || 0).toFixed(2);\r\n          const price = formatCurrency(product.selling_price || 0);\r\n          const total = formatCurrency(product.total_sales || 0);\r\n\r\n          pdf.text(name, productColX[0], yPos);\r\n          pdf.text(sku, productColX[1], yPos);\r\n          pdf.text(category, productColX[2], yPos);\r\n          pdf.text(qty, productColX[3], yPos);\r\n          pdf.text(price, productColX[4], yPos);\r\n          pdf.text(total, productColX[5], yPos);\r\n          yPos += 6;\r\n        });\r\n\r\n        // Total row\r\n        checkPageBreak(10);\r\n        yPos += 2;\r\n        pdf.setLineWidth(0.5);\r\n        pdf.line(margin, yPos, pageWidth - margin, yPos);\r\n        yPos += 5;\r\n\r\n        pdf.setFont(\"helvetica\", \"bold\");\r\n        pdf.setFontSize(8);\r\n        const productTotal = salesByProduct.reduce((sum, p) => sum + (p.total_sales || 0), 0);\r\n        pdf.text(\"Total:\", productColX[4], yPos);\r\n        pdf.text(formatCurrency(productTotal), productColX[5], yPos);\r\n        yPos += 8;\r\n      } else {\r\n        pdf.setFontSize(9);\r\n        pdf.setTextColor(150, 150, 150);\r\n        pdf.text(\"No product sales data available\", margin, yPos);\r\n        yPos += 8;\r\n        pdf.setTextColor(0, 0, 0);\r\n      }\r\n\r\n      // ============================================\r\n      // 5. BEST-SELLING PRODUCTS\r\n      // ============================================\r\n      addSectionTitle(\"BEST-SELLING PRODUCTS (Top 5)\", 14);\r\n\r\n      if (bestSellingProducts.length > 0) {\r\n        checkPageBreak(15);\r\n        pdf.setFontSize(9);\r\n        pdf.setFont(\"helvetica\", \"bold\");\r\n        pdf.text(\"Rank\", margin, yPos);\r\n        pdf.text(\"Product Name\", margin + 15, yPos);\r\n        pdf.text(\"SKU\", margin + 80, yPos);\r\n        pdf.text(\"Quantity Sold\", pageWidth - margin - 40, yPos);\r\n        yPos += 6;\r\n\r\n        pdf.setLineWidth(0.3);\r\n        pdf.line(margin, yPos - 2, pageWidth - margin, yPos - 2);\r\n        yPos += 4;\r\n\r\n        pdf.setFont(\"helvetica\", \"normal\");\r\n        bestSellingProducts.forEach((product, index) => {\r\n          checkPageBreak(8);\r\n          pdf.text(`${index + 1}.`, margin, yPos);\r\n          pdf.text((product.product_name || \"\").substring(0, 30), margin + 15, yPos);\r\n          pdf.text((product.sku || \"N/A\").substring(0, 15), margin + 80, yPos);\r\n          pdf.text(String(product.quantity_sold || 0), pageWidth - margin - 40, yPos);\r\n          yPos += 6;\r\n        });\r\n        yPos += 5;\r\n      } else {\r\n        pdf.setFontSize(9);\r\n        pdf.setTextColor(150, 150, 150);\r\n        pdf.text(\"No best-selling products data available\", margin, yPos);\r\n        yPos += 8;\r\n        pdf.setTextColor(0, 0, 0);\r\n      }\r\n\r\n      // ============================================\r\n      // 6. SALES BY CATEGORY\r\n      // ============================================\r\n      addSectionTitle(\"SALES BY CATEGORY\", 14);\r\n\r\n      if (salesByCategory.length > 0) {\r\n        checkPageBreak(15);\r\n        pdf.setFontSize(9);\r\n        pdf.setFont(\"helvetica\", \"bold\");\r\n        pdf.text(\"Category\", margin, yPos);\r\n        pdf.text(\"Items Sold\", margin + 80, yPos);\r\n        pdf.text(\"Total Sales\", pageWidth - margin - 50, yPos);\r\n        yPos += 6;\r\n\r\n        pdf.setLineWidth(0.3);\r\n        pdf.line(margin, yPos - 2, pageWidth - margin, yPos - 2);\r\n        yPos += 4;\r\n\r\n        pdf.setFont(\"helvetica\", \"normal\");\r\n        salesByCategory.forEach((cat) => {\r\n          checkPageBreak(8);\r\n          pdf.text((cat.category_name || \"Uncategorized\").substring(0, 25), margin, yPos);\r\n          pdf.text(String(cat.total_items_sold || 0), margin + 80, yPos);\r\n          pdf.setFont(\"helvetica\", \"bold\");\r\n          pdf.text(formatCurrency(cat.total_sales_amount || 0), pageWidth - margin - 50, yPos);\r\n          pdf.setFont(\"helvetica\", \"normal\");\r\n          yPos += 6;\r\n        });\r\n\r\n        // Total\r\n        checkPageBreak(8);\r\n        yPos += 2;\r\n        pdf.setLineWidth(0.3);\r\n        pdf.line(margin, yPos, pageWidth - margin, yPos);\r\n        yPos += 5;\r\n        pdf.setFont(\"helvetica\", \"bold\");\r\n        const categoryTotal = salesByCategory.reduce((sum, c) => sum + (c.total_sales_amount || 0), 0);\r\n        pdf.text(\"Total:\", margin, yPos);\r\n        pdf.text(formatCurrency(categoryTotal), pageWidth - margin - 50, yPos);\r\n        yPos += 8;\r\n      } else {\r\n        pdf.setFontSize(9);\r\n        pdf.setTextColor(150, 150, 150);\r\n        pdf.text(\"No category sales data available\", margin, yPos);\r\n        yPos += 8;\r\n        pdf.setTextColor(0, 0, 0);\r\n      }\r\n\r\n      // ============================================\r\n      // 7. TRANSACTION DETAILS\r\n      // ============================================\r\n      addSectionTitle(\"TRANSACTION DETAILS\", 14);\r\n\r\n      if (transactions.length > 0) {\r\n        checkPageBreak(20);\r\n        // Export all transactions - no limit\r\n        const displayTransactions = transactions;\r\n\r\n        pdf.setFontSize(6);\r\n        pdf.setFont(\"helvetica\", \"bold\");\r\n        const txnColWidths = [\r\n          contentWidth * 0.09, // Transaction ID\r\n          contentWidth * 0.11, // Date & Time\r\n          contentWidth * 0.09, // Cashier\r\n          contentWidth * 0.07,  // Payment\r\n          contentWidth * 0.18,  // Product\r\n          contentWidth * 0.08,  // Price\r\n          contentWidth * 0.07,  // Qty\r\n          contentWidth * 0.09,  // Discount\r\n          contentWidth * 0.11,  // Amount\r\n        ];\r\n        const txnColX = [margin];\r\n        for (let i = 1; i < txnColWidths.length; i++) {\r\n          txnColX.push(txnColX[i - 1] + txnColWidths[i - 1]);\r\n        }\r\n\r\n        pdf.text(\"Txn ID\", txnColX[0], yPos);\r\n        pdf.text(\"Date & Time\", txnColX[1], yPos);\r\n        pdf.text(\"Cashier\", txnColX[2], yPos);\r\n        pdf.text(\"Payment\", txnColX[3], yPos);\r\n        pdf.text(\"Product\", txnColX[4], yPos);\r\n        pdf.text(\"Price\", txnColX[5], yPos);\r\n        pdf.text(\"Qty\", txnColX[6], yPos);\r\n        pdf.text(\"Discount\", txnColX[7], yPos);\r\n        pdf.text(\"Amount\", txnColX[8], yPos);\r\n        yPos += 4;\r\n\r\n        pdf.setLineWidth(0.5);\r\n        pdf.line(margin, yPos - 2, pageWidth - margin, yPos - 2);\r\n        yPos += 3;\r\n\r\n        pdf.setFont(\"helvetica\", \"normal\");\r\n        pdf.setFontSize(5.5);\r\n\r\n        let lastTransactionId = null;\r\n        displayTransactions.forEach((txn) => {\r\n          checkPageBreak(6);\r\n          \r\n          const txnId = (txn.transaction_number || `TXN-${txn.transaction_id}`).substring(0, 12);\r\n          const dateTime = dayjs(txn.date_time).format(\"MMM D, YYYY h:mm A\");\r\n          const cashier = (txn.cashier_name || \"N/A\").substring(0, 10);\r\n          const payment = (txn.payment_method || \"Unknown\").substring(0, 8);\r\n          const product = (txn.product_name || \"Unknown\").substring(0, 18);\r\n          const price = formatCurrency(txn.price || 0);\r\n          const qty = `${Number(txn.quantity || 0).toFixed(2)} ${txn.unit || 'pc'}`.substring(0, 10);\r\n          const discount = formatCurrency(txn.item_discount || 0);\r\n          const amount = formatCurrency(txn.item_amount || 0);\r\n\r\n          // Show transaction details only on the first row of each transaction\r\n          if (lastTransactionId !== txn.transaction_id) {\r\n            pdf.text(txnId, txnColX[0], yPos);\r\n            pdf.text(dateTime, txnColX[1], yPos);\r\n            pdf.text(cashier, txnColX[2], yPos);\r\n            pdf.text(payment, txnColX[3], yPos);\r\n            lastTransactionId = txn.transaction_id;\r\n          } else {\r\n            // Leave empty for repeated transaction details\r\n            pdf.text(\"\", txnColX[0], yPos);\r\n            pdf.text(\"\", txnColX[1], yPos);\r\n            pdf.text(\"\", txnColX[2], yPos);\r\n            pdf.text(\"\", txnColX[3], yPos);\r\n          }\r\n          \r\n          // Always show product details\r\n          pdf.text(product, txnColX[4], yPos);\r\n          pdf.text(price, txnColX[5], yPos);\r\n          pdf.text(qty, txnColX[6], yPos);\r\n          pdf.text(discount, txnColX[7], yPos);\r\n          pdf.text(amount, txnColX[8], yPos);\r\n          yPos += 5;\r\n        });\r\n\r\n        yPos += 5;\r\n      } else {\r\n        pdf.setFontSize(9);\r\n        pdf.setTextColor(150, 150, 150);\r\n        pdf.text(\"No transaction details available\", margin, yPos);\r\n        yPos += 8;\r\n        pdf.setTextColor(0, 0, 0);\r\n      }\r\n\r\n      // ============================================\r\n      // 8. FOOTER\r\n      // ============================================\r\n      addFooter();\r\n\r\n      // Save PDF\r\n      const fileName = `Sales-Report-${rangeType}-${dayjs().format(\"YYYY-MM-DD\")}.pdf`;\r\n      pdf.save(fileName);\r\n    } catch (error) {\r\n      console.error(\"Error exporting sales PDF:\", error);\r\n      console.error(\"Error details:\", {\r\n        message: error.message,\r\n        stack: error.stack,\r\n        name: error.name\r\n      });\r\n      \r\n      // Show more detailed error message\r\n      const errorMessage = error.message || \"Unknown error occurred\";\r\n      alert(`Failed to generate sales report: ${errorMessage}\\n\\nPlease check the console for more details.`);\r\n    } finally {\r\n      setExportingSales(false);\r\n    }\r\n  };\r\n\r\n  const exportToPDF = async () => {\r\n    setExportingPDF(true);\r\n    try {\r\n      const element = document.getElementById(\"pdf-wrapper\");\r\n      if (!element) throw new Error(\"Dashboard content not found\");\r\n\r\n      // Create a clone of the element to avoid affecting the original\r\n      const clone = element.cloneNode(true);\r\n      clone.style.position = 'absolute';\r\n      clone.style.left = '-9999px';\r\n      document.body.appendChild(clone);\r\n\r\n      // Create a header with business information\r\n      const header = document.createElement('div');\r\n      header.style.padding = '15px 20px';\r\n      header.style.backgroundColor = '#1a365d';\r\n      header.style.color = 'white';\r\n      header.style.borderBottom = '2px solid #2c5282';\r\n      \r\n      // Format the date range\r\n      const { startDate, endDate, rangeType } = dateRange;\r\n      const formatDate = (date) => dayjs(date).format('MMM D, YYYY');\r\n      const dateRangeText = rangeType === 'Day' \r\n        ? formatDate(startDate)\r\n        : `${formatDate(startDate)} - ${formatDate(endDate)}`;\r\n      \r\n      // Business information (you can customize these values)\r\n      const businessInfo = {\r\n        name: \"eKahera Business\",\r\n        address: \"Bicol University, West (Main Campus) Legazpi City, Albay, Philippines\",\r\n        contact: \"ekahera.business@gmail.com | +63 970 846 8324\"\r\n      };\r\n\r\n      header.innerHTML = `\r\n        <div style=\"max-width: 100%; color: white;\">\r\n          <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;\">\r\n            <h1 style=\"margin: 0; font-size: 24px; font-weight: 600; color: white;\">${businessInfo.name}</h1>\r\n            <div style=\"text-align: right;\">\r\n              <div style=\"font-size: 14px; color: #a0aec0;\">Report Period</div>\r\n              <div style=\"font-weight: 600; font-size: 16px;\">${dateRangeText}</div>\r\n            </div>\r\n          </div>\r\n          <div style=\"display: flex; justify-content: space-between; font-size: 12px; color: #cbd5e0;\">\r\n            <div>${businessInfo.address}</div>\r\n            <div>${businessInfo.contact}</div>\r\n          </div>\r\n        </div>\r\n      `;\r\n\r\n      // Create a summary section\r\n      const summarySection = document.createElement('div');\r\n      summarySection.style.padding = '15px';\r\n      summarySection.style.backgroundColor = '#f7fafc';\r\n      summarySection.style.borderBottom = '1px solid #e2e8f0';\r\n      summarySection.style.marginBottom = '20px';\r\n      \r\n      // Add key metrics to the summary\r\n      summarySection.innerHTML = `\r\n        <h3 style=\"margin: 0 0 10px 0; color: #2d3748; font-size: 18px;\">Key Metrics Summary</h3>\r\n        <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;\">\r\n          <div style=\"background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);\">\r\n            <div style=\"font-size: 12px; color: #718096;\">Total Revenue</div>\r\n            <div style=\"font-size: 20px; font-weight: 600; color: #2b6cb0;\">${formatCurrency(keyMetrics.revenue)}</div>\r\n          </div>\r\n          <div style=\"background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);\">\r\n            <div style=\"font-size: 12px; color: #718096;\">Total Transactions</div>\r\n            <div style=\"font-size: 20px; font-weight: 600; color: #2f855a;\">${keyMetrics.totalTransactions}</div>\r\n          </div>\r\n          <div style=\"background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);\">\r\n            <div style=\"font-size: 12px; color: #718096;\">Items Sold</div>\r\n            <div style=\"font-size: 20px; font-weight: 600; color: #b7791f;\">${keyMetrics.totalItemsSold}</div>\r\n          </div>\r\n          <div style=\"background: white; padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);\">\r\n            <div style=\"font-size: 12px; color: #718096;\">Net Profit</div>\r\n            <div style=\"font-size: 20px; font-weight: 600; color: #2c5282;\">${formatCurrency(keyMetrics.netProfit)}</div>\r\n          </div>\r\n        </div>\r\n      `;\r\n\r\n      // Insert the header and summary at the top of the clone\r\n      clone.insertBefore(summarySection, clone.firstChild);\r\n      clone.insertBefore(header, clone.firstChild);\r\n\r\n      // Add a footer with page numbers\r\n      const footer = document.createElement('div');\r\n      footer.style.padding = '10px';\r\n      footer.style.backgroundColor = '#f7fafc';\r\n      footer.style.borderTop = '1px solid #e2e8f0';\r\n      footer.style.textAlign = 'center';\r\n      footer.style.fontSize = '10px';\r\n      footer.style.color = '#718096';\r\n      footer.innerText = `Page 1 of 1 • Generated on ${new Date().toLocaleString()}`;\r\n      clone.appendChild(footer);\r\n\r\n      // Process all elements for modern color functions\r\n      const allElements = clone.querySelectorAll('*');\r\n      allElements.forEach(el => {\r\n        const style = window.getComputedStyle(el);\r\n        \r\n        // Process background and color properties\r\n        ['background', 'background-color', 'color', 'border', 'border-color'].forEach(prop => {\r\n          try {\r\n            const value = style.getPropertyValue(prop);\r\n            if (value && hasModernColor(value)) {\r\n              el.style.setProperty(prop, 'transparent', 'important');\r\n            }\r\n          } catch (e) {\r\n            console.warn(`Error processing ${prop}:`, e);\r\n          }\r\n        });\r\n      });\r\n\r\n      // Capture chart areas separately to ensure they render inside the PDF\r\n      const liveCharts = Array.from(document.querySelectorAll(\".chart-export-container\"));\r\n      const chartSnapshots = [];\r\n      const chartRestorers = [];\r\n      const sanitizeChartNode = (root) => {\r\n        const colorProps = [\r\n          \"color\",\r\n          \"background-color\",\r\n          \"border-color\",\r\n          \"outline-color\",\r\n          \"text-decoration-color\",\r\n          \"column-rule-color\",\r\n          \"caret-color\",\r\n          \"accent-color\",\r\n          \"fill\",\r\n          \"stroke\",\r\n        ];\r\n        const extraProps = [\r\n          \"background\",\r\n          \"background-image\",\r\n          \"border\",\r\n          \"border-top-color\",\r\n          \"border-right-color\",\r\n          \"border-bottom-color\",\r\n          \"border-left-color\",\r\n          \"box-shadow\",\r\n          \"text-shadow\",\r\n          \"outline-color\",\r\n        ];\r\n        const restores = [];\r\n        const normalizeOrStrip = (node, prop, value, priority) => {\r\n          if (!value) return;\r\n          const lower = value.toLowerCase();\r\n          const isGradient = lower.includes(\"gradient\") || lower.includes(\"image-set\");\r\n          if (hasModernColor(lower) || isGradient) {\r\n            const prev = node.style.getPropertyValue(prop);\r\n            restores.push(() => node.style.setProperty(prop, prev || \"\", priority));\r\n            if (prop.includes(\"background\")) {\r\n              node.style.setProperty(prop, \"none\", \"important\");\r\n            } else if (prop.includes(\"shadow\")) {\r\n              node.style.setProperty(prop, \"none\", \"important\");\r\n            } else if (prop.includes(\"border\")) {\r\n              node.style.setProperty(prop, normalizeToRGB(value, \"#e5e7eb\"), \"important\");\r\n            } else {\r\n              node.style.setProperty(prop, normalizeToRGB(value, \"#1f2937\"), \"important\");\r\n            }\r\n          }\r\n        };\r\n        const processNode = (node) => {\r\n          if (!(node instanceof Element)) return;\r\n          const style = window.getComputedStyle(node);\r\n          colorProps.forEach((prop) => {\r\n            const val = style.getPropertyValue(prop);\r\n            if (hasModernColor(val)) {\r\n              const prev = node.style.getPropertyValue(prop);\r\n              restores.push(() => node.style.setProperty(prop, prev || \"\", style.getPropertyPriority(prop)));\r\n              node.style.setProperty(prop, normalizeToRGB(val, prop.includes(\"background\") ? \"#ffffff\" : \"#1f2937\"), \"important\");\r\n            }\r\n          });\r\n          [...extraProps].forEach((prop) => {\r\n            const val = style.getPropertyValue(prop);\r\n            normalizeOrStrip(node, prop, val, style.getPropertyPriority(prop));\r\n          });\r\n        };\r\n        processNode(root);\r\n        root.querySelectorAll(\"*\").forEach(processNode);\r\n        return () => restores.reverse().forEach((fn) => fn());\r\n      };\r\n\r\n      for (const chartNode of liveCharts) {\r\n        let restoreFn = null;\r\n        try {\r\n          restoreFn = sanitizeChartNode(chartNode);\r\n          chartRestorers.push(restoreFn);\r\n          const rect = chartNode.getBoundingClientRect();\r\n          const chartCanvas = await html2canvas(chartNode, {\r\n            scale: 2,\r\n            useCORS: true,\r\n            backgroundColor: \"#ffffff\",\r\n          });\r\n          chartSnapshots.push({\r\n            dataUrl: chartCanvas.toDataURL(\"image/png\"),\r\n            width: rect.width,\r\n            height: rect.height,\r\n          });\r\n        } catch (e) {\r\n          console.warn(\"Chart capture failed, falling back to default capture\", e);\r\n          chartSnapshots.push(null);\r\n        } finally {\r\n          if (restoreFn) restoreFn();\r\n        }\r\n      }\r\n\r\n      // Replace chart containers in the cloned DOM with static images\r\n      const cloneCharts = Array.from(clone.querySelectorAll(\".chart-export-container\"));\r\n      cloneCharts.forEach((chartNode, idx) => {\r\n        const snapshot = chartSnapshots[idx];\r\n        if (!snapshot || !snapshot.dataUrl) return;\r\n        chartNode.innerHTML = \"\";\r\n        const img = document.createElement(\"img\");\r\n        img.src = snapshot.dataUrl;\r\n        img.style.width = `${snapshot.width}px`;\r\n        img.style.height = `${snapshot.height}px`;\r\n        img.style.objectFit = \"contain\";\r\n        img.style.display = \"block\";\r\n        img.setAttribute(\"alt\", \"Chart snapshot\");\r\n        chartNode.appendChild(img);\r\n      });\r\n\r\n      // Add a small delay to ensure all styles are applied\r\n      await new Promise(resolve => setTimeout(resolve, 200));\r\n\r\n      const canvas = await html2canvas(clone, {\r\n        scale: 2,\r\n        useCORS: true,\r\n        logging: false,\r\n        backgroundColor: '#ffffff',\r\n        removeContainer: true,\r\n        onclone: (clonedDoc) => {\r\n          document.fonts.ready.then(() => {});\r\n        }\r\n      });\r\n\r\n      // Remove the clone\r\n      document.body.removeChild(clone);\r\n\r\n      const imgData = canvas.toDataURL('image/png');\r\n      const pdf = new jsPDF('p', 'mm', 'a4');\r\n      const imgProps = pdf.getImageProperties(imgData);\r\n      const pdfWidth = pdf.internal.pageSize.getWidth() - 20;\r\n      const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;\r\n      \r\n      // Add the image to PDF\r\n      pdf.addImage(imgData, 'PNG', 10, 10, pdfWidth, pdfHeight);\r\n      \r\n      // Set PDF metadata\r\n      const fileName = `eKahera-Report-${dateRange.rangeType}-${dayjs().format('YYYY-MM-DD')}.pdf`;\r\n      pdf.setProperties({\r\n        title: `eKahera Business Report - ${dateRange.rangeType} (${dateRangeText})`,\r\n        subject: `Business Performance Report - ${dateRangeText}`,\r\n        author: 'eKahera Business Intelligence',\r\n        creator: 'eKahera System',\r\n        keywords: 'business,report,sales,metrics,performance'\r\n      });\r\n      \r\n      // Add a watermark (optional)\r\n      pdf.setFontSize(60);\r\n      pdf.setTextColor(240, 240, 240);\r\n      pdf.text('eKahera', 35, 150, { angle: 45 });\r\n      \r\n      // Reset text color\r\n      pdf.setTextColor(0, 0, 0);\r\n      \r\n      // Save the PDF\r\n      pdf.save(fileName);\r\n      \r\n    } catch (error) {\r\n      console.error('Error exporting PDF:', error);\r\n      alert('Failed to generate PDF report. Please try again or contact support.');\r\n    } finally {\r\n      setExportingPDF(false);\r\n    }\r\n  };\r\n\r\n  // Fetch filtered data when dateRange changes\r\n  useEffect(() => {\r\n    fetchData();\r\n    fetchNotifications();\r\n  }, [dateRange]);\r\n\r\n  // Helper function to format currency values\r\n  const formatCurrency = (value) => {\r\n    return new Intl.NumberFormat(\"en-PH\", {\r\n      style: \"currency\",\r\n      currency: \"PHP\",\r\n      minimumFractionDigits: 2,\r\n      maximumFractionDigits: 2,\r\n    }).format(value);\r\n  };\r\n\r\n  // New handler to receive selected dates from modal\r\n  const handleDateRangeApply = (newRange) => {\r\n    setDateRange(newRange);\r\n  };\r\n\r\n  const headerDateDisplay = useMemo(() => {\r\n    if (!dateRange.startDate || !dateRange.endDate) return \"Select Range\";\r\n\r\n    const finalStart = dayjs.min(dateRange.startDate, dateRange.endDate);\r\n    const finalEnd = dayjs.max(dateRange.startDate, dateRange.endDate);\r\n\r\n    return `${finalStart.format(\"MMM D\")} - ${finalEnd.format(\"MMM D, YYYY\")}`;\r\n  }, [dateRange]);\r\n\r\n  // Header actions - REMOVED SELECT DROPDOWN\r\n  const headerActions = (\r\n    <div className=\"flex items-center gap-2\">\r\n      <button\r\n        onClick={fetchData}\r\n        disabled={loading}\r\n        title=\"Refresh Data\"\r\n        className=\"bg-white/80 backdrop-blur-sm hover:bg-white text-gray-700 p-1.5 sm:p-2 rounded-lg border border-gray-200/80 text-sm font-medium transition-all duration-200 hover:shadow-md hover:scale-[1.02] shrink-0\"\r\n      >\r\n        <BiRefresh\r\n          className={`w-4 h-4 sm:w-5 sm:h-5 ${loading ? \"animate-spin\" : \"\"}`}\r\n        />\r\n      </button>\r\n\r\n      {/* NEW CALENDAR BUTTON */}\r\n      <button\r\n        onClick={() => setShowFilterModal(true)}\r\n        disabled={loading}\r\n        title=\"Select Date Range\"\r\n        className=\"flex items-center gap-1 sm:gap-2 bg-white/80 backdrop-blur-sm hover:bg-white text-gray-700 px-1.5 sm:px-3 py-1.5 sm:py-2 rounded-lg border border-gray-200/80 text-xs sm:text-sm font-medium transition-all duration-200 outline-none cursor-pointer hover:shadow-md hover:scale-[1.02] shrink-0\"\r\n      >\r\n        <BiCalendarAlt className=\"w-4 h-4 sm:w-5 sm:h-5\" />\r\n        <span className=\"hidden sm:inline\">{headerDateDisplay}</span>\r\n      </button>\r\n\r\n      <div className=\"py-2 flex justify-end gap-2\">\r\n        <Button\r\n          onClick={exportSalesToPDF}\r\n          disabled={exportingSales || loading}\r\n          size=\"sm\"\r\n          variant=\"primary\"\r\n          className=\"flex items-center gap-2 w-full sm:w-auto shrink-0\"\r\n        >\r\n          {exportingSales ? (\r\n            <>\r\n              <BiRefresh className=\"w-5 h-5 animate-spin\" />\r\n              <span className=\"hidden sm:inline\">Exporting...</span>\r\n              <span className=\"sm:hidden\">...</span>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <svg\r\n                className=\"w-5 h-5\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\r\n                />\r\n              </svg>\r\n              <span className=\"hidden sm:inline\">Export Sales</span>\r\n              <span className=\"sm:hidden\">Sales</span>\r\n            </>\r\n          )}\r\n        </Button>\r\n        <Button\r\n          onClick={exportToPDF}\r\n          disabled={exportingPDF || loading}\r\n          size=\"sm\"\r\n          variant=\"primary\"\r\n          className=\"flex items-center gap-2 w-full sm:w-auto shrink-0\"\r\n        >\r\n          {exportingPDF ? (\r\n            <>\r\n              <BiRefresh className=\"w-5 h-5 animate-spin\" />\r\n              <span className=\"hidden sm:inline\">Exporting...</span>\r\n              <span className=\"sm:hidden\">...</span>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <svg\r\n                className=\"w-5 h-5\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z\"\r\n                />\r\n              </svg>\r\n              <span className=\"hidden sm:inline\">Export Dashboard</span>\r\n              <span className=\"sm:hidden\">PDF</span>\r\n            </>\r\n          )}\r\n        </Button>\r\n      </div>\r\n\r\n      <div className=\"relative\" ref={notificationRef}>\r\n        <NotificationDropdown\r\n          notifications={notifications}\r\n          unreadCount={unreadCount}\r\n          onMarkAsRead={handleMarkAsRead}\r\n          onMarkAsUnread={handleMarkAsUnread}\r\n          onDelete={handleDeleteNotification}\r\n          isOpen={showNotifications}\r\n          onToggle={() => setShowNotifications(!showNotifications)}\r\n          containerRef={notificationRef}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <PageLayout\r\n      title=\"DASHBOARD\"\r\n      subtitle=\"\"\r\n      sidebar={<NavAdmin />}\r\n      headerActions={headerActions}\r\n      isSidebarOpen={isSidebarOpen}\r\n      setSidebarOpen={setSidebarOpen}\r\n      className=\"bg-gray-50 min-h-screen\"\r\n    >\r\n      {/* Wrap dashboard content in a stable wrapper we can capture */}\r\n      <div id=\"pdf-wrapper\" ref={dashboardRef}>\r\n        {/* Low Stock Products - Mobile View (Added padding class p-6-safe) */}\r\n        <div className=\"p-4 lg:hidden\">\r\n          {loading ? (\r\n            <div className=\"bg-white p-6 rounded-xl shadow-md border border-gray-200 animate-pulse\">\r\n              <div className=\"h-6 bg-gray-200 rounded w-1/2 mb-6\"></div>\r\n              <div className=\"h-4 bg-gray-200 rounded w-full mb-3\"></div>\r\n              <div className=\"h-4 bg-gray-200 rounded w-full mb-3\"></div>\r\n              <div className=\"h-4 bg-gray-200 rounded w-4/5\"></div>\r\n            </div>\r\n          ) : (\r\n            <div className=\"bg-white p-6 rounded-xl shadow-md\">\r\n              <div className=\"flex justify-between items-center mb-4\">\r\n                <h3 className=\"text-lg font-bold text-gray-800\">\r\n                  Low Stock Products\r\n                </h3>\r\n              </div>\r\n              <LowStockList lowStockProducts={lowStockProducts} />\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Key Metrics Cards - Optimized for all screens */}\r\n        <div ref={keyMetricsRef} className=\"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 w-full px-4 sm:px-6 md:px-8 py-2\">\r\n          {/* Card 1: Total Revenue */}\r\n          <div className=\"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n            <p className=\"text-xs font-medium text-gray-500 uppercase mb-1\">\r\n              Total Revenue\r\n            </p>\r\n            <p className=\"text-2xl font-bold text-gray-900\">\r\n              {formatCurrency(keyMetrics.revenue)}\r\n            </p>\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              For selected range\r\n            </p>\r\n          </div>\r\n          {/* Card 2: Operating Expenses */}\r\n          <div className=\"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n            <p className=\"text-xs font-medium text-gray-500 uppercase mb-1\">\r\n              Operating Expenses\r\n            </p>\r\n            <p className=\"text-2xl font-bold text-gray-900\">\r\n              {formatCurrency(keyMetrics.expenses)}\r\n            </p>\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              For selected range\r\n            </p>\r\n          </div>\r\n          {/* Card 3: Net Profit */}\r\n          <div className=\"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n            <p className=\"text-xs font-medium text-gray-500 uppercase mb-1\">\r\n              Net Profit\r\n            </p>\r\n            <p\r\n              className={`text-2xl font-bold ${\r\n                keyMetrics.netProfit >= 0 ? \"text-green-600\" : \"text-red-600\"\r\n              }`}\r\n            >\r\n              {formatCurrency(Math.abs(keyMetrics.netProfit))}\r\n              {keyMetrics.netProfit < 0 && (\r\n                <span className=\"text-sm text-red-500 ml-1\">(Loss)</span>\r\n              )}\r\n            </p>\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              For selected range\r\n            </p>\r\n          </div>\r\n          {/* Card 4: Gross Margin */}\r\n          <div className=\"bg-white rounded-lg p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n            <p className=\"text-xs font-medium text-gray-500 uppercase mb-1\">\r\n              Gross Margin\r\n            </p>\r\n            <p\r\n              className={`text-2xl font-bold ${\r\n                keyMetrics.grossMargin >= 0 ? \"text-green-600\" : \"text-red-600\"\r\n              }`}\r\n            >\r\n              {keyMetrics.grossMargin.toFixed(1)}%\r\n            </p>\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              For selected range\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Main Content Area - Optimized for large screen side-by-side layout */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-6 p-4 sm:p-6 md:p-8 pt-0\">\r\n          {/* Main Chart Area (8/12 width on large screens) */}\r\n          <div className=\"lg:col-span-8 flex flex-col gap-6\">\r\n            {loading ? (\r\n              <>\r\n                <div className=\"bg-white p-6 rounded-xl shadow-md border border-gray-200 h-[336px] animate-pulse flex items-center justify-center\">\r\n                  <div className=\"w-full h-64 bg-gray-200 rounded-lg\"></div>\r\n                </div>\r\n                <div className=\"bg-white p-6 rounded-xl shadow-md border border-gray-200 h-[336px] animate-pulse flex items-center justify-center\">\r\n                  <div className=\"w-64 h-64 bg-gray-200 rounded-full\"></div>\r\n                </div>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <div\r\n                  ref={visitorsChartRef}\r\n                  className=\"chart-export-container\"\r\n                  data-export-chart=\"visitors\"\r\n                >\r\n                  <VisitorsChart data={chartData} rangeType={dateRange.rangeType} />\r\n                </div>\r\n                <div\r\n                  ref={pieChartRef}\r\n                  className=\"chart-export-container\"\r\n                  data-export-chart=\"sales-pie\"\r\n                >\r\n                  <SalesPieChart data={pieData} />\r\n                </div>\r\n              </>\r\n            )}\r\n          </div>\r\n\r\n          {/* Sidebar with Stats and Low Stock (4/12 width on large screens) */}\r\n          <div className=\"lg:col-span-4 flex flex-col gap-6\">\r\n            {loading ? (\r\n              <div className=\"bg-white p-6 rounded-xl shadow-md border border-gray-200 animate-pulse\">\r\n                <div className=\"h-6 bg-gray-200 rounded w-1/3 mb-4\"></div>\r\n                <div className=\"h-8 bg-gray-300 rounded w-1/2 mb-6\"></div>\r\n                <div className=\"h-6 bg-gray-200 rounded w-1/3 mb-4\"></div>\r\n                <div className=\"h-8 bg-gray-300 rounded w-1/2 mb-6\"></div>\r\n                <div className=\"h-6 bg-gray-200 rounded w-1/3 mb-4\"></div>\r\n                <div className=\"h-8 bg-gray-300 rounded w-1/2\"></div>\r\n              </div>\r\n            ) : (\r\n              <DashboardStatsCard \r\n                  stats={todayHighlight}\r\n                  formatCurrency={formatCurrency}\r\n                  rangeType=\"Today\"\r\n                  currentTime={currentTime}\r\n              />\r\n            )}\r\n\r\n            {/* Low Stock Products - Desktop View */}\r\n            {loading ? (\r\n              <div className=\"bg-white p-6 rounded-xl shadow-md border border-gray-200 animate-pulse hidden lg:block\">\r\n                <div className=\"h-6 bg-gray-200 rounded w-1/2 mb-6\"></div>\r\n                <div className=\"h-4 bg-gray-200 rounded w-full mb-3\"></div>\r\n                <div className=\"h-4 bg-gray-200 rounded w-full mb-3\"></div>\r\n                <div className=\"h-4 bg-gray-200 rounded w-4/5\"></div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"bg-white p-6 rounded-lg shadow-md hidden lg:block\">\r\n                <div className=\"flex justify-between items-center mb-4\">\r\n                  <h3 className=\"text-lg font-bold text-gray-800\">\r\n                    Low Stock Products\r\n                  </h3>\r\n                </div>\r\n                <LowStockList lowStockProducts={lowStockProducts} />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Business Report Component - Ensure it uses the full content width */}\r\n        <div ref={businessReportRef} className=\"w-full px-4 sm:px-6 md:px-8 pb-8\">\r\n          <DashboardBusinessReport \r\n            dateRange={dateRange} \r\n            topProducts={topProducts}\r\n            paymentMethods={paymentMethods}\r\n          />\r\n        </div>\r\n\r\n        \r\n        {/* NEW DATE RANGE FILTER MODAL */}\r\n        <DateRangeFilterModal\r\n          isOpen={showFilterModal}\r\n          onClose={() => setShowFilterModal(false)}\r\n          onDateRangeApply={handleDateRangeApply}\r\n        />\r\n      </div>\r\n    </PageLayout>\r\n  );\r\n}\r\n\r\n// LowStockList is kept as a separate component for clean code, as in the original\r\nfunction LowStockList({ lowStockProducts }) {\r\n  if (lowStockProducts.length === 0) {\r\n    return <p className=\"text-sm text-gray-500\">No products with low stock.</p>;\r\n  }\r\n\r\n  return (\r\n    <ul className=\"divide-y divide-gray-200\">\r\n      <li className=\"py-2 text-sm font-semibold text-gray-600 flex justify-between\">\r\n          <span>Product</span>\r\n          <span>Quantity</span>\r\n      </li>\r\n      {lowStockProducts.map((product) => (\r\n        <li\r\n          key={product.product_id}\r\n          className=\"py-3 flex justify-between items-center\"\r\n        >\r\n          <span className=\"text-sm font-medium text-gray-800\">\r\n            {product.product_name}\r\n          </span>\r\n          <span className=\"text-sm font-bold text-red-600\">\r\n            {product.quantity_in_stock} left\r\n          </span>\r\n        </li>\r\n      ))}\r\n    </ul>\r\n  );\r\n}\r\n"],"names":["dayjs","extend","minMax","SOFT_BLUE","VisitorsChart","data","className","rangeType","jsx","ChartCard","title","getChartTitle","children","ResponsiveContainer","width","height","jsxs","LineChart","margin","top","right","left","bottom","CartesianGrid","strokeDasharray","stroke","XAxis","dataKey","tick","fill","fontSize","YAxis","Tooltip","contentStyle","background","borderColor","borderRadius","Line","type","strokeWidth","dot","r","isAnimationActive","SalesPieChart","BarChart","interval","angle","textAnchor","formatter","value","name","props","Number","toLocaleString","payload","Legend","Bar","radius","Dashboard","keyMetrics","setKeyMetrics","useState","revenue","expenses","netProfit","grossMargin","totalTransactions","totalItemsSold","averageTransactionValue","stats","setStats","dateRange","setDateRange","startDate","startOf","endDate","endOf","loading","setLoading","chartData","setChartData","pieData","setPieData","lowStockProducts","setLowStockProducts","showFilterModal","setShowFilterModal","notifications","setNotifications","unreadCount","setUnreadCount","showNotifications","setShowNotifications","notificationRef","React","useRef","useAuth","isSidebarOpen","setSidebarOpen","todayHighlight","setTodayHighlight","sales","transactions","topProduct","exportingPDF","setExportingPDF","exportingSales","setExportingSales","currentTime","setCurrentTime","topProducts","setTopProducts","paymentMethods","setPaymentMethods","dashboardRef","visitorsChartRef","pieChartRef","keyMetricsRef","businessReportRef","useEffect","timer","updateTime","document","visibilityState","setInterval","handleVisibilityChange","addEventListener","clearInterval","removeEventListener","hasModernColor","val","lower","toLowerCase","includes","normalizeToRGB","canvas","ctx","createElement","getContext","fallback","fillStyle","_","async","token","sessionStorage","getItem","todayStr","format","overview","api","headers","authHeaders","params","totalSales","product_name","err","error","fetchTodayData","useMemo","JSON","parse","e","handleClickOutside","event","current","contains","target","fetchData","formatDate","date","finalStart","min","finalEnd","max","startDateStr","endDateStr","console","log","formattedStart","formattedEnd","timeseries","pie","oldLowStock","paymentMethodsData","Promise","all","derived","map","d","customers","total","pieTotal","reduce","s","p","piePercent","percent","totalExpenses","avgTxValue","dateRangeText","transactionsLabel","label","undefined","minimumFractionDigits","maximumFractionDigits","subtext","total_sold","resp","readIds","Set","deletedIds","mapped","filter","has","log_id","id","action","message","username","role","time","date_time","isRead","n","length","fetchNotifications","formatCurrency","Intl","NumberFormat","style","currency","headerDateDisplay","headerActions","onClick","disabled","BiRefresh","BiCalendarAlt","Button","reportData","profileData","business","businessName","business_name","storeName","address","house_number","barangay","city","province","Boolean","join","salesByProduct","alert","summary","bestSellingProducts","salesByCategory","pdf","jsPDF","pageWidth","internal","pageSize","getWidth","pageHeight","getHeight","contentWidth","yPos","pageNumber","checkPageBreak","requiredHeight","addFooter","addPage","footerY","setFontSize","setFont","setTextColor","text","align","amount","toFixed","addSectionTitle","businessNameWidth","getTextWidth","storeNameWidth","addressWidth","reportTypeText","reportTypeWidth","dateRangeWidth","generatedText","generatedWidth","systemText","systemWidth","setLineWidth","setDrawColor","line","summaryData","net_sales","gross_sales","String","total_transactions","total_items_sold","total_discounts","average_transaction_value","summaryCol1","summaryCol2","forEach","pm","methodName","payment_type","total_amount","paymentTotal","sum","productColWidths","productColX","i","push","product","substring","sku","category","qty","quantity_sold","price","selling_price","total_sales","productTotal","index","cat","category_name","total_sales_amount","categoryTotal","c","displayTransactions","txnColWidths","txnColX","lastTransactionId","txn","txnId","transaction_number","transaction_id","dateTime","cashier","cashier_name","payment","payment_method","quantity","unit","discount","item_discount","item_amount","fileName","save","stack","errorMessage","size","variant","Fragment","viewBox","strokeLinecap","strokeLinejoin","element","getElementById","Error","clone","cloneNode","position","body","appendChild","header","padding","backgroundColor","color","borderBottom","businessInfo","contact","innerHTML","summarySection","marginBottom","insertBefore","firstChild","footer","borderTop","textAlign","innerText","Date","querySelectorAll","el","window","getComputedStyle","prop","getPropertyValue","setProperty","warn","liveCharts","Array","from","chartSnapshots","chartRestorers","sanitizeChartNode","root","colorProps","extraProps","restores","processNode","node","Element","prev","getPropertyPriority","normalizeOrStrip","priority","isGradient","reverse","fn","chartNode","restoreFn","rect","getBoundingClientRect","chartCanvas","html2canvas","scale","useCORS","dataUrl","toDataURL","idx","snapshot","img","src","objectFit","display","setAttribute","resolve","setTimeout","logging","removeContainer","onclone","clonedDoc","fonts","ready","then","removeChild","imgData","imgProps","getImageProperties","pdfWidth","pdfHeight","addImage","setProperties","subject","author","creator","keywords","ref","NotificationDropdown","onMarkAsRead","setItem","stringify","notifs","Math","onMarkAsUnread","filtered","rid","onDelete","notif","find","isOpen","onToggle","containerRef","PageLayout","subtitle","sidebar","NavAdmin","LowStockList","abs","DashboardStatsCard","DashboardBusinessReport","DateRangeFilterModal","onClose","onDateRangeApply","newRange","quantity_in_stock","product_id"],"mappings":"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"}