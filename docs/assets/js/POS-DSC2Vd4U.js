import{j as e}from"./utils-L0j39QIW.js";import{a as t,u as s,R as n}from"./vendor-DPJ7iNYg.js";import{S as a}from"./ScannerCard-DJyziL7r.js";import{P as r}from"./PageLayout-l_SewvMg.js";import{S as o,C as i,D as c,P as l,a as d,b as u,c as m,d as p}from"./ScanCustomerCartModal-C_rMfsdn.js";import{b as h,a as x,d as f,e as g}from"./index-BlnpEVUf.js";import{N as y}from"./Nav-Admin-CDvTswGx.js";import{P as b}from"./ProfileModal-DOqTFOaF.js";import{c as w}from"./index-D5t29eUG.js";import{B as v}from"./BaseModal-Cy73DE2S.js";import{u as j}from"./useKeyboardShortcuts-5Dd6maPO.js";import"./qr-Dta_7pGb.js";import"./Navbar-BmWsPlqJ.js";import"./Logo-CUFb3t3i.js";import"./PrivacyPolicyModal-CvShh0Ko.js";import"./Card-DXlcOk_J.js";import"./Input-DoNyYXSI.js";import"./FormField-NRg-OFLz.js";import"./locationApi-D8IA0i6v.js";function k({isOpen:s,onClose:n}){const[a,r]=t.useState([]),[o,i]=t.useState(!1),[c,l]=t.useState(""),[d,u]=t.useState(0),m=t.useRef(null);t.useRef(null),t.useEffect(()=>{if(!s)return;(async()=>{i(!0),l("");try{const e=sessionStorage.getItem("auth_token"),t=await x("/api/sales/business/recent",{headers:{Authorization:`Bearer ${e}`}});r(Array.isArray(t)?t:[])}catch(e){console.error("Error fetching receipts:",e),l("Failed to load receipts. Please try again.")}finally{i(!1)}})()},[s]);const p=t.useCallback(e=>{const t=new URL(window.location.origin+"/receipt");e.transaction_number&&t.searchParams.set("tn",e.transaction_number),e.transaction_id&&t.searchParams.set("tid",String(e.transaction_id)),window.open(t.toString(),"_blank")},[]);t.useCallback(e=>{a[e]&&p(a[e])},[a,p]);const f=t.useCallback(e=>{if(s&&a.length)switch(e.preventDefault(),e.key){case"ArrowUp":u(e=>{const t=e<=0?a.length-1:e-1;return setTimeout(()=>{const e=m.current?.querySelectorAll("button"),s=e?.[t];s&&(s.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}),s.focus({preventScroll:!0}))},0),t});break;case"ArrowDown":u(e=>{const t=e>=a.length-1?0:e+1;return setTimeout(()=>{const e=m.current?.querySelectorAll("button"),s=e?.[t];s&&(s.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}),s.focus({preventScroll:!0}))},0),t});break;case"Enter":e.preventDefault(),a[d]&&p(a[d]);break;case"Escape":n()}},[s,a,d,n,p]);return t.useEffect(()=>{s&&(u(0),setTimeout(()=>{const e=m.current?.querySelector("button");e&&e.focus({preventScroll:!0})},100))},[s,a]),e.jsxs(v,{isOpen:s,onClose:n,title:"All Transactions",subtitle:"Latest transactions across all cashiers",size:"lg",footer:e.jsx(h,{label:"Close (Esc)",variant:"secondary",onClick:n,className:"w-full"}),children:[o&&e.jsx("div",{className:"text-sm text-gray-600 py-4 text-center",children:"Loading transactions..."}),c&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 border border-red-100 rounded-lg px-3 py-2 mb-2",children:c}),!o&&!c&&0===a.length&&e.jsx("div",{className:"text-sm text-gray-500 py-6 text-center",children:"No transactions found."}),e.jsx("div",{ref:m,className:"space-y-2 max-h-[60vh] overflow-y-auto outline-none",onKeyDown:f,tabIndex:0,children:a.map((t,s)=>e.jsxs("button",{onClick:()=>p(t),className:"w-full text-left border rounded-xl px-3 py-2 transition-colors "+(d===s?"border-blue-500 bg-blue-50 ring-2 ring-blue-200":"border-gray-200 hover:border-blue-300 hover:bg-blue-50"),onFocus:()=>u(s),tabIndex:0,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.transaction_number||`TXN-${t.transaction_id||""}`}),e.jsx("p",{className:"text-xs text-gray-600",children:new Date(t.updated_at||t.created_at).toLocaleString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-blue-700",children:["₱",Number(t.total_amount||t.total||0).toFixed(2)]}),e.jsx("p",{className:"text-[11px] text-gray-600 uppercase",children:t.payment?.method||t.payment_type||"cash"})]})]}),(t.discount_percentage||t.discount_amount)&&e.jsxs("p",{className:"text-[11px] text-emerald-700 mt-1",children:["Discount applied"," ",t.discount_percentage?`${t.discount_percentage}%`:`₱${Number(t.discount_amount||0).toFixed(2)}`]})]},`${t.transaction_id}-${t.transaction_number}`))})]})}function N(){const v=s(),[N,_]=t.useState(""),[S,C]=t.useState(1),[L,E]=t.useState([]),[q,I]=t.useState(!1),[P,$]=t.useState(!1),[A,M]=t.useState(""),[O,D]=t.useState(!1),[R,z]=t.useState(!1),[B,U]=t.useState(!1),[F,T]=t.useState(!1),[V,W]=t.useState(null),[H,J]=t.useState(!1),[Q,K]=t.useState(!1),[G,Z]=t.useState(""),[X,Y]=t.useState(""),[ee,te]=t.useState(null),[se,ne]=t.useState(!1),[ae,re]=t.useState(!1),oe=t.useRef(null),[ie,ce]=t.useState(!1),[le,de]=t.useState(-1),[ue,me]=t.useState(null),pe=sessionStorage.getItem("auth_token"),he=JSON.parse(sessionStorage.getItem("user")||"{}"),xe=n.useRef(!1),[fe,ge]=t.useState(""),[ye,be]=t.useState(0),[we,ve]=t.useState(null),[je,ke]=t.useState("1"),[Ne,_e]=t.useState(!1),[Se,Ce]=t.useState(null),Le=t.useRef(null);t.useEffect(()=>{if(!X){const e=he?.businessId||he?.business_id||"BIZ",t=(new Date).toISOString().replace(/[-:T.Z]/g,"").slice(0,14),s=Math.floor(1e3+9e3*Math.random());Y(`T-${e.toString().padStart(2,"0")}-${t}-${s}`)}},[]),t.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("payment"),t=he?.businessId||he?.business_id,s=window.opener&&!window.opener.closed,n=async(n,a)=>{const r=localStorage.getItem(n);if("success"===e&&r&&t)try{const e=JSON.parse(r);if(xe.current)return;const t=`${a}_finalize_done`;if("1"===sessionStorage.getItem(t))return;xe.current=!0,sessionStorage.setItem(t,"1");try{Z("");const t={items:e.items||[],payment_type:a.toLowerCase(),money_received:e.total||null,discount_id:e.discount_id||null,discount_percentage:e.discount_percentage||null,discount_amount:e.discount_amount||null},n=await x("/api/sales/checkout",{method:"POST",headers:{Authorization:`Bearer ${pe}`},body:JSON.stringify(t)});n?.transaction_number&&Y(n.transaction_number),n?.transaction_id&&te(n.transaction_id),E([]);try{const e=new URL(window.location.origin+"/receipt");n?.transaction_number&&e.searchParams.set("tn",n.transaction_number),n?.transaction_id&&e.searchParams.set("tid",String(n.transaction_id)),null!=n?.total&&e.searchParams.set("total",String(n.total)),s&&window.opener?(window.opener.location.href=e.toString(),window.close()):window.location.href=e.toString()}catch(o){}}catch(i){Z(`Failed to record ${a} payment`)}finally{if(localStorage.removeItem(n),!s){const e=new URL(window.location.href);e.searchParams.delete("payment"),window.history.replaceState({},"",e.toString())}}}catch(o){localStorage.removeItem(n)}else if("cancel"===e&&r)if(localStorage.removeItem(n),s&&window.opener)window.close();else{const e=new URL(window.location.href);e.searchParams.delete("payment"),window.history.replaceState({},"",e.toString())}};n("pending_gcash_cart","GCash"),n("pending_maya_cart","Maya")},[]);const Ee=async(e,t=1)=>{if(e&&!(t<1)){Z("");try{const s=await x(`/api/products/sku/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${pe}`}}),n=Number(s.selling_price||0),a=Number(s.stock_quantity??0);if(a<=0)return void Z(`Stock for ${s.product_name} (SKU ${s.sku}) is 0.`);if(t>a)return void Z(`Insufficient stock. Available: ${a}, requested: ${t}.`);E(e=>{const r=e.findIndex(e=>e.product_id===s.product_id);if(r>=0){const s=[...e],n=s[r].quantity+t;return n>a?(Z(`Insufficient stock. Available: ${a}, requested: ${n}.`),e):(s[r]={...s[r],quantity:n},s)}return[...e,{product_id:s.product_id,sku:s.sku,name:s.product_name,quantity:t,price:n}]}),_(""),C(1),K(!1)}catch(s){Z("Product not found")}}},qe=e=>{e>=0&&e<L.length&&E(L.filter((t,s)=>s!==e))},Ie=async(e,t)=>{const s=""===t?1:Math.max(1,Number(t)||1),n=L[e];if(n){Z("");try{const t=await x(`/api/products/sku/${encodeURIComponent(n.sku)}`,{headers:{Authorization:`Bearer ${pe}`}}),a=Number(t.stock_quantity??0);if(s>a)return void Z(`Insufficient stock. Available: ${a}, requested: ${s}.`);E(t=>t.map((t,n)=>n===e?{...t,quantity:s}:t)),ke(s),ve(null)}catch(a){Z(a.message||"Failed to update quantity")}}},Pe=L.reduce((e,t)=>e+t.price*t.quantity,0);let $e=Pe;if(Se)if("percentage"===Se.type){const e=Number(Se.value);if(!isNaN(e)&&e>0){const t=Pe*(e/100);$e=Math.max(0,Pe-t)}}else if("amount"===Se.type){const e=Number(Se.value);!isNaN(e)&&e>0&&($e=Math.max(0,Pe-e))}t.useEffect(()=>{const e=e=>{if(!(q||P||O||R||B||F||se||ae||Ne))switch(e.key){case"ArrowUp":e.preventDefault(),be(e=>e>0?e-1:L.length-1);break;case"ArrowDown":e.preventDefault(),be(e=>e<L.length-1?e+1:0);break;case"e":case"E":e.preventDefault(),L.length>0&&ye>=0&&ye<L.length&&(ve(ye),ke(String(L[ye].quantity)));break;case"d":case"D":e.preventDefault(),L.length>0&&ye>=0&&ye<L.length&&(qe(ye),be(e=>Math.min(e,L.length-2)));break;case"Enter":null!==we&&(e.preventDefault(),Ie(we,je),ve(null));break;case"Escape":null!==we&&(e.preventDefault(),ve(null))}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[L.length,ye,we,je,q,P,O,R,B,F,se,ae,Ne]),t.useEffect(()=>{0===L.length?be(0):be(e=>Math.min(e,L.length-1))},[L.length]),t.useEffect(()=>{K(q||P||O||R||B||F||se||ae||Ne)},[q,P,O,R,B,F,se,ae,Ne]);const Ae=()=>{oe.current?.focus(),oe.current?.select?.()};j([{key:"f1",action:()=>{E([]),Ce(null),te(null),Z(""),Ae()}},{key:"f2",action:()=>{$(!0)}},{key:"f3",action:Ae},{key:"f4",action:()=>{0!==L.length&&null!=ye&&qe(ye)},enabled:L.length>0},{key:"f5",action:()=>I(!0)},{key:"f6",action:()=>{if(0===L.length||null==ye)return;const e=L[ye],t=Number(window.prompt(`Set quantity for ${e.name||e.sku}:`,e.quantity));!Number.isNaN(t)&&t>0&&Ie(ye,t)},enabled:L.length>0},{key:"f7",action:()=>U(!0),enabled:L.length>0},{key:"f8",action:()=>D(!0)},{key:"f10",action:()=>U(!0),enabled:L.length>0},{key:"f11",action:()=>ne(!0)},{key:"f12",description:"Logout",action:()=>_e(!0)},{key:"r",description:"Remove Discount",action:()=>{Se&&Ce(null)},enabled:!!Se},{key:"ctrl+l",action:()=>z(!0)},{key:"escape",action:()=>{B?U(!1):q?I(!1):P?$(!1):O?D(!1):F?T(!1):R?z(!1):se?ne(!1):ae?re(!1):Ne&&_e(!1)},allowWhileTyping:!0}],[L.length,ye,B,q,P,O,F,R,se,ae,Ne,Se]);const Me=()=>{sessionStorage.removeItem("auth_token"),sessionStorage.removeItem("user"),_e(!1),v("/")},Oe=()=>{_e(!1)};t.useEffect(()=>{if(!Ne)return;const e=e=>{e.stopPropagation(),"Escape"===e.key||"Esc"===e.key?(e.preventDefault(),Oe()):"Enter"===e.key&&(e.preventDefault(),Me())};return document.addEventListener("keydown",e,{capture:!0}),()=>document.removeEventListener("keydown",e,{capture:!0})},[Ne]);const De=async(e,t=null)=>{if(0!==L.length){Z("");try{const n={items:L.map(e=>({product_id:e.product_id,quantity:e.quantity,price:e.price})),payment_type:e,money_received:t,transaction_id:ee,transaction_number:X,discount_id:Se?.discount_id||null,discount_percentage:"percentage"===Se?.type?Se.value:null,discount_amount:"amount"===Se?.type?Se.value:null},a=await x("/api/sales/checkout",{method:"POST",headers:{Authorization:`Bearer ${pe}`},body:JSON.stringify(n)});a?.transaction_number&&Y(a.transaction_number),a?.transaction_id&&te(a.transaction_id),E([]);try{const e=new URL(window.location.origin+"/receipt");a?.transaction_number&&e.searchParams.set("tn",a.transaction_number),a?.transaction_id&&e.searchParams.set("tid",String(a.transaction_id)),null!=a?.total&&e.searchParams.set("total",String(a.total)),v(e.pathname+e.search)}catch(s){}const r=he?.businessId||he?.business_id||"BIZ",o=(new Date).toISOString().replace(/[-:T.Z]/g,"").slice(0,14),i=Math.floor(1e3+9e3*Math.random());Y(`T-${r.toString().padStart(2,"0")}-${o}-${i}`),Ce(null),te(null)}catch(n){console.error("Checkout error:",n),Z("Checkout failed")}}},[Re,ze]=t.useState(!1),Be=e.jsxs("div",{className:"flex items-center gap-1 sm:gap-4 mr-3",children:[e.jsxs("div",{className:"space-y-2",children:[Se&&e.jsxs("div",{className:"flex items-center justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount Applied:"}),e.jsx("span",{className:"font-medium",children:"percentage"===Se.type?`${Se.value}%`:`₱${Number(Se.value).toFixed(2)}`})]}),e.jsxs("div",{className:"flex items-center justify-between text-lg font-semibold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[Se&&e.jsxs("span",{className:"text-sm text-gray-500 line-through",children:["₱",Pe.toFixed(2)]}),e.jsxs("span",{children:["₱",$e.toFixed(2)]})]})]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("button",{onClick:async()=>{try{if(!he.store_name)return;await navigator.clipboard.writeText(he.store_name)}catch(e){}},title:"Copy store name",className:"inline-flex items-center gap-2 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg px-2 py-1.5 sm:px-2.5 shadow-sm",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2M8 16h8a2 2 0 002-2v-6m-10 8l-2 2m2-2l2 2"})}),e.jsx("span",{className:"font-mono text-xs sm:text-sm font-bold tracking-wider truncate max-w-[30vw] sm:max-w-[50vw]",children:he.store_name})]})}),e.jsxs("button",{onClick:()=>ne(!0),className:"flex items-center gap-2 bg-white/80 backdrop-blur-sm p-1.5 sm:px-3 sm:py-2 rounded-lg border border-gray-200/80 hover:bg-gray-50 transition-colors",title:"View all receipts",children:[e.jsx("div",{className:"relative",children:e.jsx(w,{className:"w-5 h-5 text-blue-600"})}),e.jsx("span",{className:"text-sm font-medium text-gray-700 hidden sm:inline",children:"(F11) Receipts"})]}),e.jsxs("button",{onClick:()=>re(!0),className:"flex items-center gap-2 bg-white/80 backdrop-blur-sm p-1.5 sm:px-3 sm:py-2 rounded-lg border border-gray-200/80",children:[e.jsx("div",{className:"w-6 h-6 sm:w-7 sm:h-7 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-full flex items-center justify-center text-sm font-medium shadow-md",children:he.username?.[0]?.toUpperCase()||"A"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 hidden sm:inline",children:he.username||"Admin"})]})]});return e.jsxs(r,{title:"POS",sidebar:e.jsx(y,{}),headerActions:Be,isSidebarOpen:ie,setSidebarOpen:ce,children:[e.jsx("div",{className:"flex-1 flex flex-col min-h-screen",children:e.jsx("main",{className:"flex-1 bg-gradient-to-br from-gray-50/50 via-blue-50/30 to-indigo-50/50 overflow-hidden p-2 sm:p-3 md:p-4 pb-10 lg:pb-4",children:e.jsxs("div",{className:"grid gap-2 sm:gap-3 md:gap-4 h-full grid-cols-1 lg:grid-cols-12",children:[e.jsxs("div",{className:"lg:col-span-4 flex flex-col gap-2 sm:gap-3 md:gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(a,{onScan:async e=>{const t=e?.[0]?.rawValue;if(t)if(K(!0),P)M(t);else try{let e;try{e=JSON.parse(t)}catch(s){e=null}if(e&&"cart"===e.t&&Array.isArray(e.items)){e.transaction_id&&te(e.transaction_id),e.transaction_number&&Y(e.transaction_number);const t=e.items.map(e=>({product_id:e.p,quantity:e.q,sku:e.sku||""}));try{const e=await Promise.all(t.map(async e=>{const t=await x(`/api/products/${e.product_id}`,{headers:{Authorization:`Bearer ${pe}`}});return{product_id:e.product_id,sku:t.sku||e.sku||"",name:t.product_name||"",price:Number(t.selling_price)||0,quantity:e.quantity}}));return void E(t=>{const s=new Map(t.map(e=>[e.product_id,e]));for(const n of e){const e=s.get(n.product_id);e?e.quantity+=n.quantity:s.set(n.product_id,{...n})}return Array.from(s.values())})}catch(n){return console.error("Error fetching product details for scanned cart:",n),void E(e=>{const s=new Map(e.map(e=>[e.product_id,e]));for(const n of t){const e=s.get(n.product_id);e?e.quantity+=n.quantity:s.set(n.product_id,{...n,name:"",price:0})}return Array.from(s.values())})}}await Ee(t,1)}catch(n){console.error("Error processing scanned code:",n),await Ee(t,1)}},paused:Q,onResume:()=>K(!1),textMain:"text-blue-700"})}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx(o,{ref:oe,sku:N,setSku:_,quantity:S,setQuantity:C,handleAddToCart:async()=>{await Ee(N,S)},quantityInputRef:Le}),G&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 rounded-lg p-3 flex items-start gap-2 mt-3",children:[e.jsx("svg",{className:"w-4 h-4 text-red-500 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("p",{className:"text-sm font-medium text-red-700",children:(()=>{try{const e=JSON.parse(G);return e.error||e.message||G}catch{return G}})()})]})]})]}),e.jsxs("div",{className:"lg:col-span-8 flex flex-col gap-2 sm:gap-3 min-h-0",children:[e.jsx("div",{className:"flex-1 min-h-0 max-h-[calc(100vh-280px)]",children:e.jsx(i,{cart:L,handleRemove:qe,handleEditQuantity:(e,t)=>{Ie(e,t),ve(null)},total:$e,appliedDiscount:Se,selectedIdx:ye,onSelectRow:e=>{be(e),e>=0&&e<L.length&&ke(String(L[e].quantity))},editingIdx:we,editQty:je,onEditQtyChange:e=>{ke(e)},onEditComplete:()=>ve(null),className:"flex-1 h-full"})}),e.jsxs("div",{className:"grid grid-cols-12 gap-2 sm:gap-3 flex-shrink-0",children:[Se&&e.jsxs("div",{className:"col-span-12 flex items-center justify-between bg-emerald-50 border border-emerald-200 text-emerald-800 rounded-lg px-3 py-2",children:[e.jsxs("span",{className:"text-sm font-semibold",children:["Discount applied: ",Se.label]}),e.jsxs("button",{className:"text-xs font-bold underline flex items-center gap-1",onClick:()=>Ce(null),children:[e.jsx("span",{className:"text-yellow-600",children:"(R)"})," Remove"]})]}),e.jsx("div",{className:"col-span-8",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 gap-2 sm:gap-3",children:[e.jsx(h,{label:"CASH LEDGER (Ctrl+L)",size:"md",className:"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold",variant:"secondary",microinteraction:!0,onClick:()=>z(!0),icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),iconPosition:"left"}),e.jsxs("div",{className:"relative group flex-1",children:[e.jsx(h,{label:Se?`REMOVE ${Se.label||"DISCOUNT"}`:"ADD DISCOUNT (F5)",variant:Se?"danger":"secondary",onClick:()=>{Se?window.confirm(`Remove ${Se.label||"discount"}?`)&&Ce(null):I(!0)},icon:Se?e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}):e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),className:"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold "+(Se?"bg-red-600 hover:bg-red-700":"")}),Se&&e.jsxs("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:["Click to remove discount",e.jsx("div",{className:"absolute bottom-0 left-1/2 w-2 h-2 bg-gray-800 transform -translate-x-1/2 translate-y-1/2 rotate-45"})]})]}),e.jsx(h,{label:"PRICE CHECK (F2)",size:"md",className:"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold",onClick:()=>$(!0),variant:"secondary",microinteraction:!0,icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),iconPosition:"left"}),e.jsx(h,{label:"SCAN CUSTOMER QR (F8)",size:"md",className:"w-full h-10 sm:h-12 text-xs sm:text-sm font-bold",onClick:()=>D(!0),variant:"secondary",microinteraction:!0,icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),iconPosition:"left"})]})}),e.jsx("div",{className:"col-span-4",children:e.jsx(h,{label:"CHECKOUT (F10)",size:"md",className:"w-full h-full text-sm sm:text-base font-bold",variant:"primary",microinteraction:!0,onClick:()=>U(!0),disabled:0===L.length,icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),iconPosition:"left"})})]})]})]})})}),e.jsx(c,{isOpen:q,onClose:()=>I(!1),onApplyDiscount:e=>{Ce(e),I(!1)}}),e.jsx(l,{isOpen:P,onClose:()=>$(!1),sku:A,setSku:M}),e.jsx(d,{isOpen:R,onClose:()=>z(!1)}),e.jsx(k,{isOpen:se,onClose:()=>ne(!1)}),e.jsx(u,{isOpen:B,onClose:()=>U(!1),total:$e,onSelectPayment:e=>{W(e),U(!1),"cash"===e?T(!0):"gcash"===e?(async()=>{try{const e=window.location.origin+"/pos?payment=success",t=window.location.origin+"/pos?payment=cancel";localStorage.setItem("pending_gcash_cart",JSON.stringify({items:L.map(e=>({product_id:e.product_id,quantity:e.quantity})),total:$e,discount_id:Se?.discount_id||null,discount_percentage:"percentage"===Se?.type?Number(Se.value):null,discount_amount:"amount"===Se?.type?Number(Se.value):null}));const{checkoutUrl:s}=await f({amount:Number($e||0),description:"POS Order",referenceNumber:X||`POS-${Date.now()}`,cancelUrl:t,successUrl:e});window.open(s,"_blank")}catch(e){Z("Failed to init GCash"),localStorage.removeItem("pending_gcash_cart")}})():"maya"===e?(async()=>{try{const e=window.location.origin+"/pos?payment=success",t=window.location.origin+"/pos?payment=cancel";localStorage.setItem("pending_maya_cart",JSON.stringify({items:L.map(e=>({product_id:e.product_id,quantity:e.quantity})),total:$e,discount_id:Se?.discount_id||null,discount_percentage:"percentage"===Se?.type?Number(Se.value):null,discount_amount:"amount"===Se?.type?Number(Se.value):null}));const{checkoutUrl:s}=await g({amount:Number($e||0),description:"POS Order",referenceNumber:X||`POS-${Date.now()}`,cancelUrl:t,successUrl:e});window.open(s,"_blank")}catch(e){Z("Failed to init Maya"),localStorage.removeItem("pending_maya_cart")}})():De(e)}}),e.jsx(m,{isOpen:F,onClose:()=>T(!1),total:$e,onConfirm:e=>{De("cash",e),T(!1)}}),Ne&&e.jsxs("div",{className:"fixed inset-0 z-90 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 z-90",onClick:Oe}),e.jsxs("div",{className:"relative bg-white rounded-xl shadow-xl w-[92%] max-w-md z-100 p-0",onKeyDown:e=>{e.stopPropagation(),"Enter"!==e.key||e.isPropagationStopped()||(e.preventDefault(),Me())},children:[e.jsx("div",{className:"bg-gradient-to-r from-red-50 via-red-50/80 to-orange-50/50 border-b border-red-100 px-6 py-5 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"white",viewBox:"0 0 24 24",children:e.jsx("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"Confirm Logout"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Are you sure you want to log out? ",e.jsx("span",{className:"text-xs opacity-70",children:"(Press Esc to cancel, Enter to confirm)"})]})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-6",children:"You will be redirected to the login page and your session will end."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:Oe,className:"px-5 py-2.5 rounded-lg text-sm font-semibold text-gray-700 bg-white border-2 border-gray-300 hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",autoFocus:!0,children:"Cancel (Esc)"}),e.jsxs("button",{onClick:Me,className:"px-5 py-2.5 rounded-lg text-sm font-semibold text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 shadow-md hover:shadow-lg transition-all duration-200 flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Logout (Enter)"]})]})]})]})]}),e.jsx(b,{isOpen:ae,onClose:()=>re(!1),userData:he}),e.jsx(p,{isOpen:O,onClose:()=>D(!1),onImport:async(e,t,s)=>{try{if(s&&t)return E([]),te(null),Y(null),Z(""),D(!1),void(window.location.href=`/receipt?tn=${s.transaction_number||t}`);if(!e||0===e.length)return void Z("No items found in QR code");t&&te(t),console.log("Scanned items:",e);const n=await Promise.all(e.map(async e=>{const t=await x(`/api/products/${e.product_id}`,{headers:{Authorization:`Bearer ${pe}`}});return console.log("Fetched product for id",e.product_id,":",t),{product_id:e.product_id,sku:t.sku||e.sku||"",name:t.product_name||"",price:Number(t.selling_price)||0,quantity:e.quantity}}));E(e=>{const t=new Map(e.map(e=>[e.product_id,e]));for(const s of n){const e=t.get(s.product_id);e?e.quantity+=s.quantity:t.set(s.product_id,{...s})}return Array.from(t.values())})}catch(n){console.error("Error fetching products for scanned items:",n),E(t=>{const s=new Map(t.map(e=>[e.product_id,e]));for(const n of e){const e=s.get(n.product_id);e?e.quantity+=n.quantity:s.set(n.product_id,{...n,name:"",price:0})}return Array.from(s.values())})}}})]})}export{N as default};
//# sourceMappingURL=POS-DSC2Vd4U.js.map
